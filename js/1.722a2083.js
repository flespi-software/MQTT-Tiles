(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[1],{0:function(t,e){},"0070":function(t,e,i){},"00a1":function(t,e,i){"use strict";i("0070")},"00b3":function(t,e,i){},"0fea":function(t,e,i){},"11e5":function(t,e,i){},"152c":function(t,e,i){"use strict";i("3514")},1975:function(t,e,i){"use strict";i("994d")},"1a79":function(t,e,i){},"1d3f":function(t,e,i){"use strict";i("c2e3")},"1e40":function(t,e,i){},"1f32":function(t,e,i){},"1f6e":function(t,e,i){"use strict";i("eb38")},2:function(t,e){},"224a":function(t,e,i){"use strict";i("dd8b")},2484:function(t,e,i){},"272a":function(t,e,i){"use strict";i("ea98")},"2d3c":function(t,e,i){"use strict";i("8be3")},"2e6d":function(t,e,i){"use strict";i("7713")},"2f2f":function(t,e,i){"use strict";i("8b76")},"2f81":function(t,e,i){"use strict";i("d886")},3:function(t,e){},3264:function(t,e,i){},3514:function(t,e,i){},"3a0c":function(t,e,i){"use strict";i("fcee")},"3fc9":function(t,e,i){"use strict";i("86e9")},4:function(t,e){},4880:function(t,e,i){"use strict";i("a1a7")},5:function(t,e){},5412:function(t,e,i){},"5a50":function(t,e,i){"use strict";i.d(e,"b",(function(){return s})),i.d(e,"k",(function(){return o})),i.d(e,"l",(function(){return r})),i.d(e,"c",(function(){return a})),i.d(e,"a",(function(){return n})),i.d(e,"h",(function(){return l})),i.d(e,"g",(function(){return c})),i.d(e,"i",(function(){return d})),i.d(e,"j",(function(){return u})),i.d(e,"d",(function(){return p})),i.d(e,"f",(function(){return m})),i.d(e,"e",(function(){return h})),i.d(e,"s",(function(){return g})),i.d(e,"o",(function(){return b})),i.d(e,"m",(function(){return v})),i.d(e,"r",(function(){return f})),i.d(e,"q",(function(){return y})),i.d(e,"p",(function(){return x})),i.d(e,"n",(function(){return S}));const s="mqtt-tiles-boards",a="mqtt-tiles-clients",n="mqtt-tiles-active-client",o=0,r=1,l=0,c=1,d=0,u=1,p=0,m=1,h=2,g=0,b=1,v=2,f=3,y=4,x=5,S=6},"5ece":function(t,e,i){"use strict";i("e56a")},6:function(t,e){},6709:function(t,e,i){"use strict";i("edaf7")},"67e1":function(t,e,i){},"68cb":function(t,e,i){},"6ad6":function(t,e,i){"use strict";i("1f32")},"6ba0":function(t,e,i){},"6de5":function(t,e,i){"use strict";i("8ce2")},7134:function(t,e,i){"use strict";i("e612")},7713:function(t,e,i){},7953:function(t,e,i){"use strict";i("68cb")},"86e9":function(t,e,i){},"887d":function(t,e,i){"use strict";i("1e40")},"8a3b":function(t,e,i){"use strict";i("6ba0")},"8b24":function(t,e,i){"use strict";i.r(e);var s=function(){var t=this,e=t._self._c;return e("q-page",{staticClass:"flex flex-center",class:[`bg-${t.$theme}-1`]},[e("dash",{ref:"dash",attrs:{"client-settings":t.client,"init-boards":t.initBoards},on:{"change-status":e=>{t.$emit("change-status",e)},share:e=>t.$emit("share",e),"share:prepare":t.sharePrepareHandler,"change:title":e=>t.title=e,"update:boards":t.updateBoards,"change:attach":t.changeAttachedBoards,"update-client-settings":function(e){return t.$emit("update-client-settings")}}}),t.shareWizardConfig?e("share-wizard",{attrs:{config:t.shareWizardConfig},on:{hide:function(e){t.shareWizardConfig=void 0,t.shareWizardOpened=!1},share:t.shareBoard},model:{value:t.shareWizardOpened,callback:function(e){t.shareWizardOpened=e},expression:"shareWizardOpened"}}):t._e()],1)},a=[],n=i("ceac"),o=i.n(n),r=function(){var t=this,e=t._self._c;return e("div",{staticClass:"dash__wrapper",class:{"dash__wrapper--full":!t.fullView}},[t.activeBoardId?e("board",{style:{height:""+(t.clientSettings?t.fullView?"calc(100vh - 50px)":"100vh":"calc(100vh - 110px)")},attrs:{board:t.boards[t.activeBoardId],boards:t.boards,widgets:t.widgets,values:t.values,"variables-values":t.boardsVariablesValues[t.activeBoardId],canShare:t.canShare,isFrized:!t.fullView,hasConnection:!!t.clientSettings},on:{close:t.clearActiveBoard,"add:widget":t.addWidget,"edit:widget":t.editWidget,"edit:board":t.editBoardHandler,"delete:widget":t.deleteWidget,action:t.actionHandler,"fast-bind":t.fastBindWidgetHandler,resized:t.resizeHandler,block:t.blockBoardHandler,prevent:t.preventBoardHandler,"update:layout":t.layoutUpdateHandler,share:function(e){return t.shareHandler(t.activeBoardId)},"share-error":t.shareErrorHandler,upload:function(e){return t.exportPrepareBoardHandler(t.activeBoardId)},modify:function(e){return t.setModifyTimeBoardHandler(t.activeBoardId)},"export-widgets":t.exportWidgetsFromBoard,"import-widgets":function(e){return t.importClickHandler("widgets")},"get-board-info":function(e){return t.getBoardInfoHandler(t.boards[t.activeBoardId])}}}):e("boards",{style:{height:""+(t.clientSettings?"calc(100vh - 50px)":"calc(100vh - 110px)")},attrs:{boards:t.boards,"boards-configs":t.boardsConfigs,widgets:t.widgets,values:t.values,"variables-values":t.boardsVariablesValues,remoteBoards:t.boardsFromConnection,canShare:t.canShare,isFrized:!t.fullView,"connection-settings":t.clientSettings},on:{add:t.addBoard,edit:t.editBoardHandler,"edit:widget":t.editWidget,delete:t.deleteBoardDialogHandler,select:t.setActiveBoard,action:t.actionHandler,share:t.shareHandler,"share-uploaded":t.shareUploadedHandler,"share-error":t.shareErrorHandler,"delete-uploaded":t.deleteUploadedBoard,export:t.exportPrepareBoardHandler,"export-as":t.exportBoardAsHandler,import:t.importBoardFromConnectionHandler,"change:attach":t.changeAttachedBoards,"get-board-info":e=>t.getBoardInfoHandler(t.boards[e])}},[e("div",{attrs:{slot:"actions"},slot:"actions"},[e("q-btn",{attrs:{label:"import",flat:"",color:"grey-9"},on:{click:function(e){return t.importClickHandler("board")}}})],1)]),t.clientSettings?t._e():e("div",{staticClass:"bg-red-2 text-red-8 text-center absolute connections--empty"},[e("div",{staticClass:"text-bold q-mt-md"},[t._v("No active connections")])]),e("copy-replace-dialog",{ref:"copyReplaceDialog",attrs:{initName:t.exportBoardId},on:{"change:name":e=>t.exportBoardId=e}}),e("import-export-modal",{ref:"importExportModal",attrs:{mode:t.importExportMode,data:t.importExportData},on:{close:t.importExportClose,import:t.importFromUserHandler}}),e("board-info-dialog",{attrs:{board:t.boardInfo},on:{close:function(e){t.boardInfo=void 0}}})],1)},l=[],c=(i("14d9"),i("e7fc")),d=i.n(c);class u{constructor(t){this._client=t}set handleMessage(t){this._client.handleMessage=t}get handleMessage(){return this._client.handleMessage}get connected(){return this._client.connected}get reconnecting(){return this._client.reconnecting}publish(...t){return new Promise(((e,i)=>{this._client.publish(...t,((t,s)=>{t?i(t):e(s)}))}))}subscribe(...t){return new Promise(((e,i)=>{this._client.subscribe(...t,((t,s)=>{t?i(t):e(s)}))}))}unsubscribe(...t){return new Promise(((e,i)=>{this._client.unsubscribe(...t,((t,s)=>{t?i(t):e(s)}))}))}end(...t){return new Promise(((e,i)=>{this._client.end(...t,((t,s)=>{t?i(t):e(s)}))}))}reconnect(...t){return this._client.reconnect(...t)}addListener(...t){return this._client.addListener(...t)}emit(...t){return this._client.emit(...t)}eventNames(...t){return this._client.eventNames(...t)}getLastMessageId(...t){return this._client.getLastMessageId(...t)}getMaxListeners(...t){return this._client.getMaxListeners(...t)}listenerCount(...t){return this._client.listenerCount(...t)}listeners(...t){return this._client.listeners(...t)}off(...t){return this._client.off(...t)}on(...t){return this._client.on(...t)}once(...t){return this._client.once(...t)}prependListener(...t){return this._client.prependListener(...t)}prependOnceListener(...t){return this._client.prependOnceListener(...t)}rawListeners(...t){return this._client.rawListeners(...t)}removeAllListeners(...t){return this._client.removeAllListeners(...t)}removeListener(...t){return this._client.removeListener(...t)}removeOutgoingMessage(...t){return this._client.removeOutgoingMessage(...t)}setMaxListeners(...t){return this._client.setMaxListeners(...t)}}var p={connect(t,e){const i=d.a.connect(t,e),s=new u(i);return s},connectAsync(t,e,i=!0){const s=d.a.connect(t,e),a=new u(s);return new Promise(((t,e)=>{const n={connect:e=>{o(),t(a)},end:()=>{o(),t(a)},error:t=>{o(),s.end(),e(t)}};!1===i&&(n.close=()=>{n.error("Couldn't connect to server")});const o=()=>{Object.keys(n).forEach((t=>{s.removeListener(t,n[t])}))};Object.keys(n).forEach((t=>{s.on(t,n[t])}))}))},AsyncClient:u},m=i("2b0e"),h=function(){var t=this,e=t._self._c;return e("q-input",t._b({attrs:{value:t.viewedValue,outlined:"",dense:"","hide-bottom-space":"",color:"grey-9"},on:{input:t.setTypedValue}},"q-input",t.settings,!1),[e("q-icon",{attrs:{slot:"append",name:"mdi-information-outline"},slot:"append"},[e("q-tooltip",[e("div",{staticClass:"text-bold"},[t._v("Typed input")]),e("div",{staticStyle:{"max-width":"150px"}},[t._v("All values in this input will be interpreted by the auto type check. Example: 10 => number, true => boolean, null => null. If you want to set a string type, just wrap the value in quotes. Example: '10', 'true', 'null'.")])])],1)],1)},g=[],b={props:["value","settings"],data(){return{typedValue:this.value}},computed:{viewedValue(){let t=this.typedValue;try{t=JSON.parse(t)}catch(i){}const e=typeof this.typedValue!==typeof t;return t=e?`'${t}'`:null!==t?t:JSON.stringify(t),t}},methods:{getTypedValue(t){const e=t,i=!!("string"===typeof t&&t.length&&t[0].match(/'|"/)&&t.slice(-1).match(/'|"/));i&&(t=t.slice(1,-1));try{t=JSON.parse(t)}catch(s){}return"string"===typeof t&&(t=e),i&&(t=t?t.toString():JSON.stringify(t)),t},setTypedValue(t){t=this.getTypedValue(t),this.typedValue=t,this.$emit("input",t)}}},v=b,f=i("2877"),y=i("27f9"),x=i("0016"),S=i("05c0"),_=i("eebe"),q=i.n(_),w=Object(f["a"])(v,h,g,!1,null,null,null),T=w.exports;q()(w,"components",{QInput:y["a"],QIcon:x["a"],QTooltip:S["a"]}),m["default"].component("typed-input",T);var $=i("1732"),C=i("51e9"),k=i.n(C),I=i("63ea"),V=i.n(I),M=i("b047c"),O=i.n(M),B=i("0f32"),E=i.n(B),A=i("0644"),F=i.n(A),L=i("c04c"),N=i.n(L),D=i("42454"),Q=i.n(D),H=i("9b02"),R=i.n(H),P=i("e762"),z=function(){var t=this,e=t._self._c;return e("div",{staticClass:"dash__board"},[t.settingsModel?e("settings",{attrs:{settings:t.currentSettings,board:t.board,mode:t.operationMode},on:{save:t.saveSettingsHandler,hide:t.hideSettingsHandler},model:{value:t.settingsModel,callback:function(e){t.settingsModel=e},expression:"settingsModel"}}):t._e(),t.board.settings.blocked||t.isFrized?t._e():e("q-btn",{staticClass:"absolute button--add",attrs:{fab:"",color:`${t.$theme}-9`,icon:"mdi-plus"},on:{click:t.addWidgetHandler}},[e("q-tooltip",[t._v("Add new widget")])],1),t.isFrized&&t.board.name||!t.isFrized?e("q-toolbar",{class:[`bg-${t.$theme}-2`]},[t.isFrized?t._e():e("q-btn",{attrs:{round:"",flat:"",color:"grey-9",icon:"mdi-arrow-left"},on:{click:function(e){return t.$emit("close")}}},[e("q-tooltip",[t._v("Back to boards list")])],1),e("q-toolbar-title",{staticClass:"text-grey-9"},[t._v(t._s(t.board.name||"*No name*"))]),t.isFrized?t._e():[t.exportEnabled?e("q-btn",{attrs:{label:"export",color:"green-9",flat:""},on:{click:t.doneExport}},[e("q-tooltip",[t._v("Export widgets")])],1):t._e(),e("q-btn",{attrs:{icon:"mdi-link",flat:"",round:"",color:"grey-"+(t.canShare?9:7),ripple:!!t.canShare},on:{click:function(e){return t.share(t.shareHandler)}}},[e("q-tooltip",[t._v("Get link")])],1),t.board.settings.blocked?t._e():e("q-btn",{attrs:{icon:t.board.settings.preventCollision?"mdi-pin":"mdi-pin-outline",color:"grey-9",flat:"",round:""},on:{click:t.preventCollisionBoardHandler}},[e("q-tooltip",[t._v(t._s(t.board.settings.preventCollision?"Unlock widgets positions":"Lock widgets positions"))])],1),e("q-btn",{attrs:{icon:t.board.settings.blocked?"mdi-lock":"mdi-lock-open",color:"grey-9",flat:"",round:""},on:{click:t.blockBoardHandler}},[e("q-tooltip",[t._v(t._s(t.board.settings.blocked?"Unlock your board":"Lock your board"))])],1),e("q-btn",{attrs:{round:"",dense:"",flat:"",icon:"mdi-dots-vertical",color:"grey-9"}},[e("q-menu",{attrs:{anchor:"bottom right",self:"top right"}},[e("q-list",{class:[`bg-${t.$theme}-1`],attrs:{dense:""}},[e("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:""},on:{click:function(e){return e.stopPropagation(),t.importWidgets.apply(null,arguments)}}},[e("q-item-section",{attrs:{avatar:""}},[e("q-icon",{attrs:{name:"mdi-application-import"}})],1),e("q-item-section",[t._v("Import widgets")])],1),e("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:""},on:{click:function(e){return e.stopPropagation(),t.prepareExport.apply(null,arguments)}}},[e("q-item-section",{attrs:{avatar:""}},[e("q-icon",{attrs:{name:"mdi-application-export"}})],1),e("q-item-section",[t._v("Export widgets")])],1),e("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:!!t.canShare},on:{click:function(e){return e.stopPropagation(),t.share(t.uploadHandler)}}},[e("q-item-section",{attrs:{avatar:""}},[e("q-icon",{attrs:{name:"mdi-cloud-upload-outline"}})],1),e("q-item-section",[t._v("Upload board")])],1),e("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:""},on:{click:function(e){return e.stopPropagation(),t.$emit("get-board-info")}}},[e("q-item-section",{attrs:{avatar:""}},[e("q-icon",{attrs:{name:"mdi-information-outline"}})],1),e("q-item-section",[t._v("Board info")])],1),e("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:""},on:{click:function(e){return e.stopPropagation(),t.modifyBoardSettings.apply(null,arguments)}}},[e("q-item-section",{attrs:{avatar:""}},[e("q-icon",{attrs:{name:"mdi-cog"}})],1),e("q-item-section",[t._v("Board settings")])],1)],1)],1)],1)]],2):t._e(),t.board.settings.variables&&t.board.settings.variables.length?e("q-toolbar",{staticClass:"q-py-none bg-white",staticStyle:{"flex-wrap":"wrap"}},[e("q-resize-observer",{on:{resize:t.onVariablesWrapperResize}}),t._l(t.board.settings.variables,(function(i,s){return e("board-variable",{key:i.name,attrs:{variable:i,options:t.getVariableValues(s),value:t.variablesListValues[s][t.board.activeVariables[i.name]]&&t.variablesListValues[s][t.board.activeVariables[i.name]].value||""},on:{input:e=>{t.changeVaribleHandler(i.name,e)}}})}))],2):t._e(),e("div",{staticClass:"widgets__wrapper scroll",class:{"q-px-sm":t.$q.platform.is.mobile,[`bg-${t.$theme}-1`]:!0},style:{height:t.wrapperHeight}},[t.board.widgetsIndexes.length?e("div",{staticStyle:{width:"100%",position:"relative"}},[e("q-resize-observer",{on:{resize:t.onResize}}),e("grid-layout",{ref:"grid",attrs:{layout:t.currentLayout,"col-num":t.colNum,"row-height":t.rowHeight,"is-draggable":!t.board.settings.blocked&&!t.isFrized&&!t.exportEnabled,"is-resizable":!t.board.settings.blocked&&!t.isFrized,"is-mirrored":!1,"vertical-compact":!1,margin:[10,10],"use-css-transforms":!0,responsive:!0,"prevent-collision":t.board.settings.preventCollision},on:{"update:layout":function(e){t.currentLayout=e},"layout-ready":function(e){return t.$refs.grid.onWindowResize()}}},t._l(t.board.widgetsIndexes,(function(i,s){return e("grid-item",{key:i,attrs:{x:t.currentLayout[s].x,y:t.currentLayout[s].y,w:t.currentLayout[s].w,h:t.currentLayout[s].h,i:t.currentLayout[s].i,minW:t.widgets[i].settings.minWidth||1,minH:t.widgets[i].settings.minHeight||1,dragIgnoreFrom:".widget__content"},on:{resized:t.resizeHandler}},[t.exportEnabled?e("div",{staticClass:"wrapper__item--export absolute-top-left absolute-bottom-right cursor-pointer"},[e("q-btn",{staticClass:"absolute-top-left absolute-bottom-right full-width",attrs:{icon:"mdi-check",color:t.exportedWidgetsIndexes[i]?"green":"grey",size:`${t.currentLayout[s].h>t.currentLayout[s].w?t.currentLayout[s].w:t.currentLayout[s].h}rem`,flat:""},on:{click:function(e){return t.exportWidgets(i)}}})],1):t._e(),e("widget-wrapper",{staticClass:"wrapper__items",class:{"wrapper__items--edited":!t.board.settings.blocked&&!t.isFrized},attrs:{item:t.widgets[i],value:t.values[i],"in-shortcuts":t.getInShortcutsAbility(t.widgets[i])&&Boolean(t.board.shortcutsIndexes.includes(i)),blocked:t.board.settings.blocked||t.isFrized},on:{update:function(e){return t.editWidgetSettings(i)},duplicate:function(e){return t.duplicateWidgetHandler(i)},delete:function(e){return t.deleteWidgetHandler(i)},"fast-bind":function(e){return t.fastBindHandler(i)}}},[e(t.widgets[i].type,{tag:"component",attrs:{item:t.widgets[i],value:t.values[i],index:i,blocked:t.board.settings.blocked||t.isFrized},on:{action:t.actionHandler}})],1)],1)})),1)],1):e("div",{staticClass:"text-center text-grey-8 q-mt-md",staticStyle:{"font-size":"2rem"}},[e("div",{staticClass:"text-bold",class:[`text-${t.$theme}-9`]},[t._v("The board is empty")]),e("div",[e("q-btn",{attrs:{color:`${t.$theme}-9`,icon:"mdi-plus-circle-outline",label:"Add widget"},on:{click:t.addWidgetHandler}})],1)])]),t.boardSettingsModalModel?e("board-settings",{attrs:{settings:t.board,boards:t.boards},on:{edit:t.editBoardHandler},model:{value:t.boardSettingsModalModel,callback:function(e){t.boardSettingsModalModel=e},expression:"boardSettingsModalModel"}}):t._e()],1)},j=[],W=function(){var t=this,e=t._self._c;return e("q-dialog",{attrs:{value:t.value,maximized:t.$q.platform.is.mobile,"no-backdrop-dismiss":""},on:{hide:t.closeHandler,"escape-key":t.closeHandler}},[e("div",{style:{width:t.$q.platform.is.mobile?"100%":"50vw"}},[e("q-toolbar",{staticClass:"text-white",class:[`bg-${t.$theme}-9`]},[e("q-toolbar-title",[t._v("\n        Board settings\n      ")])],1),e("div",{staticClass:"q-pa-md scroll",class:[`bg-${t.$theme}-1`],style:{height:t.$q.platform.is.mobile?"calc(100% - 100px)":"50vh"}},[e("div",{staticClass:"row"},[e("q-input",{staticClass:"col-12 q-mb-sm",attrs:{outlined:"","hide-bottom-space":"",dense:"",autofocus:"",color:"grey-9",label:"Name"},model:{value:t.currentSettings.name,callback:function(e){t.$set(t.currentSettings,"name",e)},expression:"currentSettings.name"}}),e("q-input",{staticClass:"col-12 q-mb-sm",attrs:{outlined:"","hide-bottom-space":"",dense:"",color:"grey-9",error:!t.currentSettings.id||!!t.currentSettings.id.match(/[/+#\s]/g)||t.boards[t.currentSettings.id]&&t.settings&&t.settings.id!==t.currentSettings.id,label:"Sync alias"},model:{value:t.currentSettings.id,callback:function(e){t.$set(t.currentSettings,"id",e)},expression:"currentSettings.id"}}),e("div",{staticClass:"board-settings__variables col-12 q-mt-lg relative-position"},[e("q-list",{class:[`bg-${t.$theme}-1`],attrs:{bordered:""}},[e("q-item-label",{staticClass:"q-py-md q-px-sm list__header",class:[`bg-${t.$theme}-${t.currentSettings.settings.variables.length?3:2}`]},[e("div",[t._v("Variables"+t._s(t.currentSettings.settings.variables.length?"":" are empty"))]),e("q-btn",{staticClass:"absolute-right",attrs:{color:"grey-9",flat:"",label:"ADD",icon:"mdi-plus"},on:{click:t.addVar}})],1),t._l(t.currentSettings.settings.variables,(function(i,s){return e("q-expansion-item",{key:`${s}`,class:[`bg-${t.$theme}-1`],attrs:{group:"variables","header-class":["bg-"+(t.checkUniqueVariables(s)?`${t.$theme}-2`:"red-2")],"expand-icon":"mdi-cog",value:s===t.currentSettings.settings.variables.length-1}},[e("template",{slot:"header"},[e("q-item-section",{attrs:{avatar:""}},[e("div",[e("q-btn",{staticClass:"col-1",attrs:{disabled:0===s,round:"",dense:"",flat:"",icon:"mdi-arrow-up"},on:{click:function(e){return e.stopPropagation(),t.upItem(s)}}}),e("q-btn",{staticClass:"col-1",attrs:{disabled:s===t.currentSettings.settings.variables.length-1,round:"",dense:"",flat:"",icon:"mdi-arrow-down"},on:{click:function(e){return e.stopPropagation(),t.downItem(s)}}})],1)]),e("q-item-section",[t._v(t._s(i.name))]),e("q-item-section",{attrs:{side:""}},[e("q-btn",{attrs:{flat:"",color:"red-6",round:"",dense:"",icon:"mdi-delete"},on:{click:function(e){return t.removeVar(s)}}})],1)],1),e("div",{staticClass:"row q-pa-sm"},[e("q-input",{staticClass:"col-12 q-my-sm",attrs:{outlined:"","hide-bottom-space":"",dense:"",color:"grey-9",label:"Name",error:!i.name},model:{value:i.name,callback:function(e){t.$set(i,"name",e)},expression:"variable.name"}}),t.$flespiMode?e("q-select",{staticClass:"col-12 q-my-sm",attrs:{"emit-value":"","map-options":"",outlined:"",dense:"","hide-bottom-space":"",color:"grey-9",options:t.variablesPresets,label:"Presets"},on:{input:e=>{t.setPresetByIndex(s,e)}},model:{value:i.preset,callback:function(e){t.$set(i,"preset",e)},expression:"variable.preset"}}):t._e(),"custom"!==i.preset&&void 0!==i.preset&&t.$flespiMode?t._e():[e("q-select",{staticClass:"col-12 q-mb-sm",attrs:{outlined:"",dense:"","hide-bottom-space":"",value:i.type,"emit-value":"","map-options":"",options:t.variableTypeOptions,color:"grey-9","popup-content-class":`bg-${t.$theme}-1`,label:"Type"},on:{input:e=>t.changeTypeVariableHandler(s,e)}}),i.type===t.VARIABLE_TYPE_SOURCE?e("topic",{staticClass:"col-12 q-mb-sm",attrs:{config:{needLabel:!0}},model:{value:i.topic,callback:function(e){t.$set(i,"topic",e)},expression:"variable.topic"}}):t._e(),i.type===t.VARIABLE_TYPE_SOURCE?e("div",[t._v("\n                    Sort variables by:\n                    "),e("q-btn-toggle",{attrs:{options:[{label:"value",value:t.SORT_VARS_BY_VALUE},{label:"label",value:t.SORT_VARS_BY_LABEL}],rounded:"","toggle-text-color":"grey-9","text-color":"grey-6",flat:"",color:"grey-9"},model:{value:i.sortVarsBy,callback:function(e){t.$set(i,"sortVarsBy",e)},expression:"variable.sortVarsBy"}})],1):t._e(),i.type===t.VARIABLE_TYPE_CUSTOM?[e("div",{staticClass:"variable__items-wrapper col-12 relative-position q-mt-md"},[e("q-list",{attrs:{bordered:""}},[e("q-item-label",{staticClass:"q-py-md q-px-sm list__header",class:{"text-red-6":!i.values.length,[`bg-${t.$theme}-${i.values.length?3:2}`]:!0}},[t._v("\n                          Items"+t._s(i.values.length?"":" are empty")+"\n                          "),e("q-btn",{staticClass:"absolute-right",attrs:{color:"grey-9",flat:"",label:"ADD",icon:"mdi-plus"},on:{click:function(e){return t.addVarItem(i)}}})],1),t._l(i.values,(function(s,a){return e("q-expansion-item",{key:`${a}`,attrs:{group:"singleselect-items","header-class":["bg-"+(-1===s[1].indexOf("#")?`${t.$theme}-2`:"red-2")],"expand-icon":"mdi-cog",value:a===i.values.length-1}},[e("template",{slot:"header"},[e("q-item-section",{attrs:{avatar:""}},[e("div",[e("q-btn",{staticClass:"col-1",attrs:{disabled:0===a,round:"",dense:"",flat:"",icon:"mdi-arrow-up"},on:{click:function(e){return e.stopPropagation(),t.upVarItem(i,a)}}}),e("q-btn",{staticClass:"col-1",attrs:{disabled:a===i.values.length-1,round:"",dense:"",flat:"",icon:"mdi-arrow-down"},on:{click:function(e){return e.stopPropagation(),t.downVarItem(i,a)}}})],1)]),e("q-item-section",[t._v(t._s(s[0]?`${s[0]} [${s[1]}]`:s[1]||"new item"))]),e("q-item-section",{attrs:{side:""}},[e("q-btn",{attrs:{flat:"",color:"red-6",round:"",dense:"",icon:"mdi-delete"},on:{click:function(e){return t.removeVarItem(i,a)}}})],1)],1),e("div",{staticClass:"row q-pa-sm"},[e("div",{staticClass:"col-6"},[e("q-input",{staticClass:"q-mr-xs",attrs:{autofocus:"",dense:"",outlined:"","hide-bottom-space":"",color:"grey-9",label:"Label"},model:{value:s[0],callback:function(e){t.$set(s,0,e)},expression:"item[0]"}})],1),e("div",{staticClass:"col-6"},[e("q-input",{staticClass:"q-ml-xs",attrs:{outlined:"",dense:"","hide-bottom-space":"",color:"grey-9",label:"Value",error:-1!==s[1].indexOf("#")},model:{value:s[1],callback:function(e){t.$set(s,1,e)},expression:"item[1]"}})],1)])],2)}))],2)],1)]:t._e()]],2)],2)}))],2)],1)],1)]),e("q-toolbar",{staticClass:"text-white",class:[`bg-${t.$theme}-9`]},[e("q-toolbar-title"),e("q-btn",{staticClass:"q-mr-sm",attrs:{flat:"",dense:""},on:{click:t.closeHandler}},[t._v("Close")]),e("q-btn",{attrs:{flat:"",dense:"",disable:!t.validateCurrentSettings},on:{click:t.saveBoardSettingsHandler}},[t._v(t._s(t.settings?"Update":"Save"))]),e("q-btn",{attrs:{flat:"",dense:"",disable:!t.validateCurrentSettings},on:{click:t.saveAndOpenBoardSettingsHandler}},[t._v(t._s(t.settings?"Update & open":"Save & open"))])],1)],1)])},U=[],G=function(){var t=this,e=t._self._c;return e("div",{staticClass:"row"},[e("q-slide-transition",[t.shownSelectors?e("flespi-selector",{staticClass:"col-12",attrs:{value:this.currentValue.topicTemplate,connector:t.$flespiRestBus,variables:t.selectorsVariables},on:{input:t.selectorTopicUpdate}}):t._e()],1),e("q-input",{staticClass:"col-8 q-pr-sm",attrs:{dense:"",autofocus:t.config&&t.config.needAutofocus,outlined:"","hide-bottom-space":"",color:"grey-9",label:"Topic",error:!t.validateTopic(t.currentValue.topicFilter)},on:{input:function(e){t.currentValue.topicFilter=t.currentValue.topicTemplate}},model:{value:t.currentValue.topicTemplate,callback:function(e){t.$set(t.currentValue,"topicTemplate",e)},expression:"currentValue.topicTemplate"}},[t.config&&t.config.needSelectors&&t.$flespiMode?e("q-btn",{attrs:{slot:"append",flat:"",round:"",color:"red",icon:"icon-flespi2-02-01"},on:{click:function(e){t.shownSelectors=!t.shownSelectors}},slot:"append"},[e("q-tooltip",[t._v("flespi topic helper")])],1):t._e()],1),e("q-select",{staticClass:"col-4",attrs:{dense:"",outlined:"","hide-bottom-space":"",color:"grey-9","emit-value":"","map-options":"",label:"Payload type",options:t.payloadTypeOptions},model:{value:t.currentValue.payloadType,callback:function(e){t.$set(t.currentValue,"payloadType",e)},expression:"currentValue.payloadType"}}),t.board&&t.board.settings.variables&&t.board.settings.variables.length?e("variables-helper",{staticClass:"col-12",attrs:{variables:t.board.settings.variables},on:{add:e=>t.currentValue.topicTemplate+=e}}):t._e(),t.currentValue.payloadType===t.WIDGET_PAYLOAD_TYPE_JSON?e("q-input",{staticClass:"col-12 q-mt-sm",attrs:{dense:"",outlined:"","hide-bottom-space":"",color:"grey-9",label:"Payload path",hint:"You can set path in result JSON. Path started from root of object. Example: names[0].value"},model:{value:t.currentValue.payloadField,callback:function(e){t.$set(t.currentValue,"payloadField",e)},expression:"currentValue.payloadField"}}):t._e(),t.config&&t.config.needLabel&&t.currentValue.payloadType===t.WIDGET_PAYLOAD_TYPE_JSON?e("q-input",{staticClass:"col-12 q-mt-sm",attrs:{dense:"",outlined:"","hide-bottom-space":"",color:"grey-9",label:"Value`s label",hint:"Value`s label gets from resilt JSON by path. Example: names[0].label"},model:{value:t.currentValue.payloadNameField,callback:function(e){t.$set(t.currentValue,"payloadNameField",e)},expression:"currentValue.payloadNameField"}}):t._e(),t.config&&t.config.needDefault?e("q-input",{staticClass:"col-12 q-mt-sm",attrs:{dense:"",outlined:"","hide-bottom-space":"",color:"grey-9",label:"Default value",hint:"If you currently have no any value by this subscription, you can set an empty state value"},model:{value:t.currentValue.default,callback:function(e){t.$set(t.currentValue,"default",e)},expression:"currentValue.default"}}):t._e()],1)},Y=[],J={methods:{validateTopic(t){if(!t.length)return!1;const e=t.split("/");for(let i=0;i<e.length;i++)if("+"!==e[i]){if("#"===e[i])return!1;if(-1!==e[i].indexOf("+")||-1!==e[i].indexOf("#"))return!1}return!0},validateFiniteTopic(t){if(!t.length)return!1;const e=t.split("/");for(let i=0;i<e.length;i++){if("+"===e[i])return!1;if("#"===e[i])return!1;if(-1!==e[i].indexOf("+")||-1!==e[i].indexOf("#"))return!1}return!0}}},K=function(){var t=this,e=t._self._c;return e("div",{staticClass:"q-mt-xs",staticStyle:{"font-size":".8rem","line-height":"1"}},[t._v("\n  You can use variables:\n  "),t._l(t.variables,(function(i){return e("span",{key:i.name,staticClass:"cursor-pointer q-mr-xs text-grey-9",domProps:{innerHTML:t._s(`<%${i.name}%>`)},on:{click:function(e){return t.$emit("add",`<%${i.name}%>`)}}})}))],2)},X=[],Z={name:"VariablesHelper",props:["variables"]},tt=Z,et=Object(f["a"])(tt,K,X,!1,null,null,null),it=et.exports,st=function(){var t=this,e=t._self._c;return e("div",[t.$q.platform.is.desktop&&t.$q.screen.width>650?e("q-btn-toggle",{staticClass:"q-mb-md",attrs:{options:t.options,spread:"",unelevated:"","toggle-color":"grey-9"},model:{value:t.entity,callback:function(e){t.entity=e},expression:"entity"}}):e("q-select",{staticClass:"q-mb-md",attrs:{label:t.entity?void 0:"Choose..",options:t.options,"emit-value":"","map-options":"",outlined:"",dense:"",color:"grey-9"},model:{value:t.entity,callback:function(e){t.entity=e},expression:"entity"}}),e("div",{staticClass:"relative-position"},[t.entity?t._e():e("div",{staticClass:"selectors__settings-splash"}),t.renderConfig.selectors?t._l(t.renderConfig.selectors,(function(i){return e("div",{key:`${t.entity}-${i.name}`},[t.useVars[i.name]?e("q-select",{staticClass:"q-mb-md",attrs:{options:t.variables,"emit-value":"","map-options":"",outlined:"",dense:"",color:"grey-9",label:"Variables"},on:{input:()=>t.update(i.name,null)},scopedSlots:t._u([{key:"no-option",fn:function(){return[e("q-item",[e("q-item-section",[e("div",{staticClass:"text-italic text-grey-9 text-h6 text-center text-bold"},[t._v(t._s(`No ${i.name}`))]),e("div",{staticClass:"text-grey text-center"},[t._v("Maybe you need to clean another related selectors")])])],1)]},proxy:!0},{key:"after",fn:function(){return[e("q-btn",{attrs:{round:"",dense:"",flat:"",icon:"mdi-format-list-bulleted-square"},on:{click:function(e){return t.toggleVariableView(i.name)}}},[e("q-tooltip",[t._v(t._s(`Select ${i.name}`))])],1)]},proxy:!0}],null,!0),model:{value:t.vars[i.name],callback:function(e){t.$set(t.vars,i.name,e)},expression:"vars[selector.name]"}}):e("q-select",{staticClass:"q-mb-md",attrs:{value:t.model[i.name],options:t.renderLists[i.name],"emit-value":"","map-options":"",multiple:"",clearable:"","use-input":"","use-chips":"",outlined:"",dense:"",color:"grey-9",label:t.model[i.name]?i.name:`All ${i.name}`},on:{input:e=>t.update(i.name,e),filter:(e,s)=>t.filterItems(i,e,s)},scopedSlots:t._u([{key:"no-option",fn:function(){return[e("q-item",[e("q-item-section",[e("div",{staticClass:"text-italic text-grey-9 text-h6 text-center text-bold"},[t._v(t._s(`No ${i.name}`))]),e("div",{staticClass:"text-grey text-center"},[t._v("Maybe you need to clean another related selectors")])])],1)]},proxy:!0},t.variables.length?{key:"after",fn:function(){return[e("q-btn",{attrs:{round:"",dense:"",flat:"",icon:"mdi-variable"},on:{click:function(e){return t.toggleVariableView(i.name)}}},[e("q-tooltip",[t._v("Select variables")])],1)]},proxy:!0}:null,{key:"option",fn:function(i){return[e("q-item",t._g(t._b({},"q-item",i.itemProps,!1),i.itemEvents),[e("q-item-section",[e("q-item-label",{domProps:{innerHTML:t._s(i.opt.label||"*Empty*")}}),e("q-item-label",{attrs:{caption:""}},[t._v(t._s(i.opt.value))])],1)],1)]}}],null,!0)})],1)})):t._e(),t.renderConfig.children?[e("flespi-selectors",{key:t.entity,attrs:{value:t.value,config:t.renderConfig.children,variables:t.variables,connector:t.connector,entities:t.model},on:{input:t.updateModel}})]:t._e()],2)],1)},at=[],nt=i("db97"),ot={name:"FlespiSelectors",props:{config:{type:Object,default(){return nt}},connector:Object,entities:{type:Object,default(){return{}}},variables:{type:Array,default(){return[]}},value:String},data(){const t=void 0,e={},i={},s={},a={},n="";return{entity:t,lists:i,renderLists:{...i},model:e,topic:n,vars:s,useVars:a}},computed:{options(){return Object.keys(this.config).map((t=>({label:t,value:t})))},entitiesNames(){return Object.keys(this.config)},renderConfig(){return this.entity?this.config[this.entity]:this.config[this.entitiesNames[0]]}},methods:{initByEntity(t){const e=this.config[t].selectors,i={},s={},a={},n={};return e&&e.forEach((t=>{t.value&&(s[t.name]=null),t.list?(i[t.name]=t.list,i[t.name].inited=!0):(i[t.name]=[],i[t.name].inited=!1),a[t.name]=null,n[t.name]=!1})),{lists:i,model:s,vars:a,useVars:n}},filterItems(t,e,i){if(this.lists[t.name].inited)return this.$set(this.renderLists,t.name,e?this.lists[t.name].filter((t=>t.label.toLowerCase().indexOf(e.toLowerCase())>-1)):this.lists[t.name]),void i();this.connector[t.getter.name](...t.getter.params.map((t=>this.model[t]||"all"))).then((s=>{this.$set(this.lists,t.name,s),this.$set(this.renderLists,t.name,e?this.lists[t.name].filter((t=>t.label.toLowerCase().indexOf(e.toLowerCase())>-1)):this.lists[t.name]),this.lists[t.name].inited=!0,i()}))},update(t,e){this.$set(this.model,t,e&&e.length?e:null),this.entity&&this.config[this.entity].selectors&&this.config[this.entity].selectors.forEach((e=>{e.getter&&e.getter.params&&e.getter.params.includes(t)&&(this.$set(this.lists,e.name,[]),this.$set(this.renderLists,e.name,[]))})),this.$emit("input",{topic:this.getCurrentTopic(this.topic,this.model)})},updateModel({topic:t}){this.topic=t,this.$emit("input",{topic:this.getCurrentTopic(this.topic,this.model)})},getCurrentTopic(t,e){let i=t&&t.topicPattern;if(t&&this.entity&&this.config[this.entity].selectors){const t=this.config[this.entity].selectors.map((t=>t.name));i=t.reduce(((t,i)=>{const s=i,a=e[s],n=this.useVars[s]&&this.vars[s];return n?t=t.replace(`\${${s}}`,`<%${n}%>`):void 0!==a&&(t=a&&a.length?t.replace(`\${${s}}`,a):t.replace(`\${${s}}`,"+")),t}),i)}return{...t,topicPattern:i}},topicToModelHandler(t){function e(t){const i=[];for(const s in t){const a=t[s],n=[s],o=a.topic&&a.topic.topicPattern;if(a.children){const t=e(a.children);for(const e of t)i.push({path:[...n,...e.path],topic:e.topic})}else i.push({path:n,topic:o})}return i}const i=e(this.config),s=i.filter((({path:e,topic:i})=>(i=new RegExp(i.replace(/\$\{\w+\}/g,".*")),i.test(t)))),a=s.pop();let n;if(a){n={path:a.path,values:{},vars:{}};const e=a.topic.split("/"),i=t.split("/");e.forEach(((t,e)=>{t.replace(/\$\{(\w+)\}/,((t,s)=>{const a=i[e];a.match(/<%.*%>/)?n.vars[s]=a.slice(2,-2):n.values[s]="+"===a?null:a.split(",")}))}))}return n},setModel(t){if(!t)return!1;const{lists:e,model:i,vars:s,useVars:a}=this.initByEntity(t.path[0]);this.entity=t.path[0],this.lists=e;for(const n in t.vars)a[n]=!0,s[n]=t.vars[n];this.vars=s,this.useVars=a,this.model=Object.assign(i,t.values),this.topic=this.config[t.path[0]].topic,this.topic&&this.$emit("input",{topic:this.getCurrentTopic(this.topic,this.model)})},changeEntity(t){const{lists:e,model:i,vars:s,useVars:a}=this.initByEntity(t);this.lists=e,this.vars=s,this.useVars=a,this.model={...i,...this.entities},this.topic=this.config[t].topic,this.topic&&this.$emit("input",{topic:this.getCurrentTopic(this.topic,this.model)})},toggleVariableView(t){this.$set(this.useVars,t,!this.useVars[t]),this.topic&&this.$emit("input",{topic:this.getCurrentTopic(this.topic,this.model)})}},created(){this.setModel(this.topicToModelHandler(this.value));const t=this.getCurrentTopic(this.topic,this.model);this.$watch("entity",this.changeEntity),t&&this.$emit("input",{topic:t})},watch:{entities:{deep:!0,handler(t){if(this.model={...this.model,...t},this.entity){const{lists:t}=this.initByEntity(this.entity);this.lists=t}}}}},rt=ot,lt=(i("a765"),i("6a67")),ct=i("ddd8"),dt=i("66e5"),ut=i("4074"),pt=i("9c40"),mt=i("0170"),ht=Object(f["a"])(rt,st,at,!1,null,null,null),gt=ht.exports;q()(ht,"components",{QBtnToggle:lt["a"],QSelect:ct["a"],QItem:dt["a"],QItemSection:ut["a"],QBtn:pt["a"],QTooltip:S["a"],QItemLabel:mt["a"]});var bt=i("a11b"),vt=i("5a50"),ft={name:"Topic",props:["value","board","config"],data(){const t=Object(bt["b"])(),e=Object.assign({},this.defaultTopic,this.value);return e.topicTemplate||(e.topicTemplate=e.topicFilter),{defaultTopic:t,currentValue:e,WIDGET_PAYLOAD_TYPE_STRING:vt["h"],WIDGET_PAYLOAD_TYPE_JSON:vt["g"],shownSelectors:!1,payloadTypeOptions:[{label:"String",value:vt["h"]},{label:"JSON",value:vt["g"]}]}},computed:{selectorsVariables(){let t=[];return this.board&&this.board.settings.variables&&this.board.settings.variables.length&&(t=this.board.settings.variables.map((t=>({label:t.name,value:t.name})))),t}},watch:{currentValue:{deep:!0,handler(t){this.$emit("input",t)}},value(t){this.currentValue=t}},methods:{selectorTopicUpdate({topic:{topicPattern:t,payloadType:e}}){if(!t)return!1;this.$set(this.currentValue,"topicTemplate",t),this.$set(this.currentValue,"topicFilter",t),e="JSON"===e?vt["g"]:vt["h"],this.$set(this.currentValue,"payloadType",e)}},mixins:[J],components:{VariablesHelper:it,FlespiSelector:gt}},yt=ft,xt=i("e9c1"),St=Object(f["a"])(yt,G,Y,!1,null,null,null),_t=St.exports;q()(St,"components",{QSlideTransition:xt["a"],QInput:y["a"],QBtn:pt["a"],QTooltip:S["a"],QSelect:ct["a"]});const qt=0,wt=1,Tt=0,$t=1;var Ct={devices:{name:"devices",preset:"devices",type:wt,topic:Object(bt["b"])({topicTemplate:"flespi/state/gw/devices/+",topicFilter:"flespi/state/gw/devices/+",payloadType:1,payloadField:"id",payloadNameField:"name"}),sortVarsBy:$t,values:[]},calcs:{name:"calcs",preset:"calcs",type:wt,topic:Object(bt["b"])({topicTemplate:"flespi/state/gw/calcs/+",topicFilter:"flespi/state/gw/calcs/+",payloadType:1,payloadField:"id",payloadNameField:"name"}),sortVarsBy:$t,values:[]},channels:{name:"channels",preset:"channels",type:wt,topic:Object(bt["b"])({topicTemplate:"flespi/state/gw/channels/+",topicFilter:"flespi/state/gw/channels/+",payloadType:1,payloadField:"id",payloadNameField:"name"}),sortVarsBy:$t,values:[]},custom:{name:"name",preset:"custom",type:qt,topic:Object(bt["b"])(),sortVarsBy:Tt,values:[]}};const kt=0,It=1,Vt=0,Mt=1;var Ot={props:["settings","value","boards"],data(){const t=Object.freeze({name:"New board",id:"",settings:{blocked:!1,variables:[]},activeVariables:{},shortcutsIndexes:[],widgetsIndexes:[],layouts:{lg:[],md:[],sm:[],xs:[],xxs:[]}}),e=Object(bt["b"])();let i={};return this.settings?(i=F()(Q()({},t,this.settings)),i.settings.variables&&i.settings.variables.forEach((t=>{void 0===t.type&&(t.type=0,t.topic=F()(e)),void 0===t.sortVarsBy&&(t.sortVarsBy=0),t.preset||(t.preset="custom")}))):(i=F()(t),i.id=Object($["a"])()),{currentSettings:i,defaultTopic:e,defaultVariable:{name:"name",preset:"custom",type:kt,topic:e,sortVarsBy:Vt,values:[]},VARIABLE_TYPE_CUSTOM:kt,VARIABLE_TYPE_SOURCE:It,SORT_VARS_BY_VALUE:Vt,SORT_VARS_BY_LABEL:Mt,variableTypeOptions:[{label:"Custom",value:kt},{label:"Source",value:It}],variablesPresets:[{label:"Devices",value:"devices"},{label:"Channels",value:"channels"},{label:"Calcs",value:"calcs"},{label:"Custom",value:"custom"}]}},computed:{validateCurrentSettings(){const t=this.currentSettings.settings.variables;return this.currentSettings.id&&(!t.length||t.length&&t.reduce(((t,e,i)=>t&&(!e.type&&this.checkUniqueVariables(i)&&e.values.length||e.type&&e.topic.topicFilter)),!0))}},methods:{saveBoardSettingsHandler(){const t=this.settings?"edit":"add";"add"===t&&this.$set(this.currentSettings,"activeVariables",this.currentSettings.settings.variables.reduce(((t,e)=>(t[e.name]=void 0,t)),{})),this.$emit(t,this.currentSettings),this.closeHandler()},saveAndOpenBoardSettingsHandler(){this.saveBoardSettingsHandler(),this.$emit("open",this.currentSettings.id)},closeHandler(){this.$emit("input",!1),this.$emit("hide")},addVar(){this.currentSettings.settings.variables.push(F()(this.$flespiMode?Ct.devices:this.defaultVariable))},removeVar(t){this.$delete(this.currentSettings.settings.variables,t)},changeTypeVariableHandler(t,e){const i=this.currentSettings.settings.variables[t];e===kt?i.topic=F()(this.defaultTopic):i.values=[],this.$set(i,"type",e)},setPresetByIndex(t,e){const i=Ct[e];this.$set(this.currentSettings.settings.variables,t,i)},checkUniqueVariables(t){const e=this.currentSettings.settings.variables[t],i=this.currentSettings.settings.variables.reduce(((t,i,s)=>(i.name===e.name&&t.push(s),t)),[]);return e.name&&0===i.indexOf(t)},upItem(t){const e=this.currentSettings.settings.variables.splice(t,1)[0];this.currentSettings.settings.variables.splice(t-1,0,e)},downItem(t){const e=this.currentSettings.settings.variables.splice(t,1)[0];this.currentSettings.settings.variables.splice(t+1,0,e)},addVarItem(t){t.values.push(["",""])},removeVarItem(t,e){this.$delete(t.values,e)},upVarItem(t,e){const i=t.values.splice(e,1)[0];t.values.splice(e-1,0,i)},downVarItem(t,e){const i=t.values.splice(e,1)[0];t.values.splice(e+1,0,i)}},components:{Topic:_t}},Bt=Ot,Et=(i("aeac"),i("24e8")),At=i("65c6"),Ft=i("6ac5"),Lt=i("1c1c"),Nt=i("3b73"),Dt=Object(f["a"])(Bt,W,U,!1,null,null,null),Qt=Dt.exports;q()(Dt,"components",{QDialog:Et["a"],QToolbar:At["a"],QToolbarTitle:Ft["a"],QInput:y["a"],QList:Lt["a"],QItemLabel:mt["a"],QBtn:pt["a"],QExpansionItem:Nt["a"],QItemSection:ut["a"],QSelect:ct["a"],QBtnToggle:lt["a"]});var Ht=function(){var t=this,e=t._self._c;return e("q-select",{staticClass:"q-mr-sm",staticStyle:{"min-width":"120px"},attrs:{outlined:"","hide-bottom-space":"",color:"grey-9","emit-value":"","map-options":"",dense:"","use-input":"","hide-selected":"","fill-input":"",options:t.filterOptions,value:t.value,label:t.variable.name},on:{input:e=>{t.$emit("input",e)},filter:t.filterFn},scopedSlots:t._u([{key:"option",fn:function(i){return[e("q-item",t._g(t._b({},"q-item",i.itemProps,!1),i.itemEvents),[e("q-item-section",[e("q-item-label",{class:{"text-grey-7":!i.opt.label}},[t._v(t._s(i.opt.label||"*Empty*"))])],1),i.opt.label!=i.opt.value?e("q-item-section",{attrs:{side:""}},[e("q-item-label",[t._v(t._s(i.opt.value))])],1):t._e()],1)]}},{key:"no-option",fn:function(){return[e("q-item",[e("q-item-section",[e("div",{staticClass:"text-italic text-grey-9 text-h6 text-center text-bold"},[t._v(t._s(`No ${t.variable.name}`))])])],1)]},proxy:!0},{key:"selected-item",fn:function(i){return[e("q-item",t._g(t._b({staticClass:"q-pa-none",staticStyle:{"min-height":"14px"}},"q-item",i.itemProps,!1),i.itemEvents),[e("q-item-section",[e("q-item-label",[t._v(t._s(i.opt.label&&i.opt.value?i.opt.label:i.opt.value?i.opt.label||"*Empty*":""))])],1),i.opt.label!=i.opt.value?e("q-item-section",{attrs:{side:""}},[e("q-item-label",[t._v(t._s(i.opt.value))])],1):t._e()],1)]}}])})},Rt=[],Pt={props:["value","options","variable"],data(){return{filterOptions:this.options}},methods:{filterFn(t,e){e((()=>{if(""===t)this.filterOptions=this.options;else{const e=t.toLowerCase();this.filterOptions=this.options.filter((t=>-1!==JSON.stringify(t.label).toLowerCase().indexOf(e)||-1!==JSON.stringify(t.value).toLowerCase().indexOf(e)))}}))}}},zt=Pt,jt=Object(f["a"])(zt,Ht,Rt,!1,null,null,null),Wt=jt.exports;q()(jt,"components",{QSelect:ct["a"],QItem:dt["a"],QItemSection:ut["a"],QItemLabel:mt["a"]});var Ut=i("89c1"),Gt=i.n(Ut),Yt=function(){var t=this,e=t._self._c;return e("q-card",{staticClass:"widget-wrapper",class:[`bg-${t.item.color}-1`],staticStyle:{width:"100%",height:"100%"},attrs:{flat:"",inline:""}},[e("q-item",{staticClass:"q-px-sm q-pt-sm q-pb-none",staticStyle:{"min-height":"0"}},[e("q-item-section",{staticClass:"ellipsis",class:[`text-${t.item.color}-7`],staticStyle:{"font-size":".9rem"}},[e("q-item-label",{staticClass:"ellipsis"},[t._v(t._s(t.item.name))]),e("q-tooltip",[t._v(t._s(t.item.name))])],1),e("transition",{attrs:{name:"block"}},[t.blocked?t._e():e("q-item-section",{staticStyle:{"min-width":"20px"},attrs:{side:""}},[e("div",[void 0!==t.inShortcuts&&1!==t.item.settings.width?e("q-btn",{staticClass:"q-pa-none q-mr-xs",staticStyle:{"min-height":"1rem"},attrs:{size:"0.7rem",icon:t.inShortcuts?"mdi-star":"mdi-star-outline",dense:"",flat:"",color:t.inShortcuts?"yellow-9":`${t.item.color}-7`},on:{click:function(e){return t.$emit("fast-bind")}}},[e("q-tooltip",[t._v(t._s((t.inShortcuts?"Remove from":"Add to")+" shortcuts"))])],1):t._e(),e("q-btn",{staticClass:"q-pa-none",staticStyle:{"min-height":"1rem"},attrs:{size:"0.7rem",dense:"",flat:"",icon:"mdi-dots-vertical",color:`${t.item.color}-7`}},[e("q-menu",{staticStyle:{"box-shadow":"none"},attrs:{anchor:"top right",self:"top right",offset:[8,8]}},[e("div",{staticClass:"q-pa-sm",class:[`bg-${t.item.color}-1`]},[void 0!==t.inShortcuts&&1===t.item.settings.width?e("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],staticClass:"q-pa-none q-mr-xs",staticStyle:{"min-height":"1rem"},attrs:{size:"0.7rem",icon:t.inShortcuts?"mdi-star":"mdi-star-outline",dense:"",flat:"",color:t.inShortcuts?"yellow-9":`${t.item.color}-7`},on:{click:function(e){return t.$emit("fast-bind")}}},[e("q-tooltip",[t._v(t._s((t.inShortcuts?"Remove from":"Add to")+" shortcuts"))])],1):t._e(),e("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],staticClass:"q-pa-none q-mr-xs",staticStyle:{"min-height":"1rem"},attrs:{size:"0.7rem",icon:"mdi-content-duplicate",dense:"",flat:"",color:`${t.item.color}-7`},on:{click:function(e){return t.$emit("duplicate")}}},[e("q-tooltip",[t._v("Duplicate")])],1),e("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],staticClass:"q-pa-none q-mr-xs",staticStyle:{"min-height":"1rem"},attrs:{size:"0.7rem",icon:"mdi-cog",dense:"",flat:"",color:`${t.item.color}-7`},on:{click:function(e){return t.$emit("update")}}},[e("q-tooltip",[t._v("Edit")])],1),e("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],staticClass:"q-pa-none q-mr-xs",staticStyle:{"min-height":"1rem"},attrs:{size:"0.7rem",icon:"mdi-delete-outline",dense:"",flat:"",color:"red"},on:{click:function(e){return t.$emit("delete")}}},[e("q-tooltip",[t._v("Remove")])],1),e("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],staticClass:"q-pa-none",staticStyle:{"min-height":"1rem"},attrs:{size:"0.7rem",icon:"mdi-close",dense:"",flat:"",color:`${t.item.color}-7`}})],1)])],1)],1)])],1)],1),e("q-card-section",{staticClass:"widget__content scroll q-pa-none",class:[`bg-${t.item.color}-1`],style:{height:t.contentHeight}},[t._t("default")],2),t.item.settings.isNeedTime?e("div",{staticClass:"widget__timestamp absolute-bottom-left q-px-xs q-pt-xs",class:[`text-${t.item.color}-7`,`bg-${t.item.color}-1`]},[t._v("\n    "+t._s(t.timestamp)+"\n  ")]):t._e()],1)},Jt=[],Kt=i("bd4c");const Xt=t=>1e3*parseInt(R()(t,"properties.userProperties.timestamp",t.timestamp/1e3)),Zt=t=>{const e=t,i=new Date(Date.now()),s=new Date(e);let a="DD/MM HH:mm:ss";return i.getDate()+i.getMonth()===s.getDate()+s.getMonth()&&(a="HH:mm:ss"),e?Kt["a"].formatDate(e,a):""};var te={computed:{time(){return Object.keys(this.value).reduce(((t,e)=>{if(!this.value[e])return t;const i=Xt(this.value[e]);return i>t&&(t=i),t}),0)},timestamp(){return Zt(this.time)}}},ee={props:["item","value","blocked","in-shortcuts"],mixins:[te],computed:{contentHeight(){let t=0;return this.blocked?this.item.name&&this.blocked?t+=25:t+=8:t+=34,this.timestamp&&(t+=10),`calc(100% - ${t}px)`}}},ie=ee,se=(i("6709"),i("f09f")),ae=i("4e73"),ne=i("a370"),oe=i("7f67"),re=Object(f["a"])(ie,Yt,Jt,!1,null,null,null),le=re.exports;q()(re,"components",{QCard:se["a"],QItem:dt["a"],QItemSection:ut["a"],QItemLabel:mt["a"],QTooltip:S["a"],QBtn:pt["a"],QMenu:ae["a"],QCardSection:ne["a"]}),q()(re,"directives",{ClosePopup:oe["a"]});var ce=i("eed6"),de=i.n(ce),ue=function(){var t=this,e=t._self._c;return e("q-dialog",{staticClass:"row",attrs:{"no-esc-dismiss":"","no-backdrop-dismiss":"",maximized:t.$q.screen.width<1023},on:{hide:t.closeHandler},model:{value:t.status,callback:function(e){t.status=e},expression:"status"}},[e("div",{staticClass:"bg-white",style:{width:t.$q.screen.width<1023?"100%":"50%"}},[e("q-toolbar",{staticClass:"bg-grey-9 text-white"},[e("q-toolbar-title",[t._v("\n        Widget\n      ")])],1),e("div",{staticClass:"scroll q-pa-md",style:{maxHeight:t.$q.screen.width<1023?"":"calc(100vh - 148px)",height:t.$q.screen.width<1023?"calc(100% - 100px)":""}},[e("q-input",{attrs:{outlined:"","hide-bottom-space":"",dense:"",color:"grey-9 q-mb-sm",label:"Name"},model:{value:t.currentSettings.name,callback:function(e){t.$set(t.currentSettings,"name","string"===typeof e?e.trim():e)},expression:"currentSettings.name"}}),e("q-select",{attrs:{outlined:"",dense:"","hide-bottom-space":"",color:"grey-9",value:t.currentSettings.type,options:t.typeOptions,"emit-value":"","map-options":"",label:"Type","popup-content-class":"type__content","popup-content-style":{width:`${t.typeElementWidth}px`}},on:{input:t.typeChangeHandler},scopedSlots:t._u([{key:"option",fn:function(i){return[e("q-item",t._g(t._b({style:{width:t.$q.screen.width>=1023?"16.6666667%":"25%",minHeight:"70px"}},"q-item",i.itemProps,!1),i.itemEvents),[e("q-item-section",{staticClass:"text-center"},[e("q-icon",{staticStyle:{width:"auto"},attrs:{size:t.$q.screen.width>=1023?"2rem":"1.5rem",name:i.opt.rightIcon}}),e("q-item-label",{staticClass:"q-mt-xs ellipsis",style:{fontSize:".7rem"},domProps:{innerHTML:t._s(i.opt.label)}}),e("q-tooltip",[t._v(t._s(i.opt.label))])],1)],1)]}}])},[e("q-resize-observer",{on:{resize:t.onResize}})],1),e("div",{staticClass:"color-palette q-px-sm q-py-xs rounded-borders q-mb-lg q-mt-sm"},[e("div",{staticClass:"text-grey-9 q-pb-xs q-ml-xs color-palette__label"},[t._v("Color")]),e("div",{staticClass:"row color-palette__wrapper"},t._l(t.colors,(function(i){return e("span",{key:i,staticClass:"q-mr-sm cursor-pointer color-palette__item",class:[`bg-${i}`],on:{click:function(e){return t.setColor(i)}}},[i===t.currentSettings.color?e("q-icon",{staticClass:"item__icon",attrs:{size:"1.4rem",name:"mdi-check",color:"white"}}):t._e()],1)})),0)]),0!==t.currentSettings.settings.maxTopicsLength?e("q-list",{staticClass:"relative-position q-mb-sm",attrs:{bordered:""}},[e("q-item-label",{staticClass:"q-py-md q-px-sm list__header",class:{"text-red-6":!t.currentSettings.dataTopics.length}},[t._v("\n          Topics"+t._s(t.currentSettings.dataTopics.length?"":" are empty")+"\n          "),this.currentSettings.settings.maxTopicsLength&&this.currentSettings.dataTopics.length>=this.currentSettings.settings.maxTopicsLength&&void 0!==this.currentSettings.settings.maxTopicsLength?t._e():e("q-btn",{staticClass:"absolute-right",attrs:{color:"grey-9",flat:"",label:"ADD",icon:"mdi-plus"},on:{click:t.addTopicHandler}})],1),t._l(t.currentSettings.dataTopics,(function(i,s){return e("q-expansion-item",{key:s,attrs:{"header-class":[`bg-${t.topicsHighlight[s]}`],group:"topics","expand-icon":"mdi-cog",value:s===t.currentSettings.dataTopics.length-1}},[e("template",{slot:"header"},[e("q-item-section",[e("span",{staticClass:"ellipsis full-width"},[t._v(t._s(i.topicTemplate||"Empty"))])]),e("q-item-section",{attrs:{side:""}},[e("q-btn",{attrs:{flat:"",color:"red-6",round:"",dense:"",icon:"mdi-delete"},on:{click:function(e){return t.removeTopicHandler(s)}}})],1)],1),e("topic",{staticClass:"q-pa-sm",attrs:{board:t.board,config:{needSelectors:!0,needDefault:"multiplier"!==t.currentSettings.type}},model:{value:t.currentSettings.dataTopics[s],callback:function(e){t.$set(t.currentSettings.dataTopics,s,e)},expression:"currentSettings.dataTopics[index]"}})],2)}))],2):t._e(),t.$q.screen.width<1023?e("div",{staticClass:"q-mb-lg flex justify-center",staticStyle:{"pointer-events":"none"}},[e("div",{class:[`bg-${t.currentSettings.color}-1`],style:t.previewStyles},[e("widget-wrapper",{attrs:{item:t.currentSettings,value:{},"in-shortcuts":!1,blocked:!1}},[e(`${t.currentSettings.type}-view`,{tag:"component",attrs:{item:t.currentSettings,value:{},blocked:!0}})],1)],1)]):t._e(),e(t.currentSettings.type,{tag:"component",attrs:{widget:t.currentSettings,board:t.board},on:{update:t.updateSettingsHandler,"update-widget":t.updateWidgetHandler,validate:t.validateSchemas}})],1),e("q-toolbar",{staticClass:"bg-grey-9 text-white"},[e("q-toolbar-title"),e("q-btn",{staticClass:"q-mr-sm",attrs:{flat:"",dense:""},on:{click:t.closeHandler}},[t._v("Close")]),e("q-btn",{attrs:{flat:"",dense:"",disable:!t.validateCurrentSettings||!t.isValideSchema},on:{click:t.saveSettingsHandler}},[t._v(t._s(t.saveButtonLabels[t.mode]))])],1)],1),t.$q.screen.width>=1023?e("span",{staticClass:"q-pa-md flex justify-center all-pointer-events",staticStyle:{width:"50%"}},[e("div",{class:[`bg-${t.currentSettings.color}-1`],style:t.previewStyles},[e("widget-wrapper",{attrs:{item:t.currentSettings,value:{},blocked:!0}},[e(`${t.currentSettings.type}-view`,{tag:"component",attrs:{item:t.currentSettings,value:{},blocked:!0}})],1)],1)]):t._e()])},pe=[],me=function(){var t=this,e=t._self._c;return e("div",[e("div",{staticClass:"row"},[e("div",{staticClass:"q-mt-sm col-12"},[e("q-toggle",{attrs:{color:"grey-9",label:"Save last status on server (retained message)"},model:{value:t.currentSettings.save,callback:function(e){t.$set(t.currentSettings,"save",e)},expression:"currentSettings.save"}})],1),e("q-btn-toggle",{staticClass:"q-my-sm col-12",attrs:{rounded:"","toggle-text-color":"grey-9","text-color":"grey-6",flat:"",options:t.modeOptions},model:{value:t.currentSettings.mode,callback:function(e){t.$set(t.currentSettings,"mode",e)},expression:"currentSettings.mode"}}),0===t.currentSettings.mode&&t.widget.topics.length>1?e("q-input",{staticClass:"col-12 q-mb-sm",attrs:{outlined:"",dense:"","hide-bottom-space":"",color:"grey-9",label:"Action topic"},model:{value:t.currentSettings.actionTopic,callback:function(e){t.$set(t.currentSettings,"actionTopic",e)},expression:"currentSettings.actionTopic"}}):t._e(),e("div",{staticClass:"col-6 q-pr-sm"},[e("typed-input",{staticClass:"q-mb-sm",attrs:{settings:{label:"True value"}},model:{value:t.currentSettings.trueValue,callback:function(e){t.$set(t.currentSettings,"trueValue",e)},expression:"currentSettings.trueValue"}}),e("q-input",{staticClass:"q-mb-sm",attrs:{outlined:"",dense:"","hide-bottom-space":"",color:"grey-9",label:"True value icon"},model:{value:t.currentSettings.trueIcon,callback:function(e){t.$set(t.currentSettings,"trueIcon",e)},expression:"currentSettings.trueIcon"}},[e("q-icon",{attrs:{slot:"append",name:`mdi-${t.currentSettings.trueIcon||"toggle-switch-outline"}`,size:"1.5rem"},slot:"append"}),e("q-btn",{style:{backgroundColor:t.currentSettings.trueColor},attrs:{slot:"after",flat:""},slot:"after"},[e("q-menu",{staticClass:"q-pa-sm",attrs:{anchor:"top right",self:"bottom right"}},[e("q-color",{attrs:{"format-model":"hex"},model:{value:t.currentSettings.trueColor,callback:function(e){t.$set(t.currentSettings,"trueColor",e)},expression:"currentSettings.trueColor"}})],1)],1)],1),1===t.currentSettings.mode?e("div",{staticClass:"q-mb-sm"},[e("q-input",{attrs:{outlined:"",dense:"","hide-bottom-space":"",color:"grey-9",label:"True action topic"},model:{value:t.currentSettings.trueActionTopic,callback:function(e){t.$set(t.currentSettings,"trueActionTopic",e)},expression:"currentSettings.trueActionTopic"}},[t.currentSettings.trueActionTopic?e("q-btn",{attrs:{slot:"after",icon:"mdi-arrow-right",dense:"",flat:""},on:{click:function(e){t.currentSettings.falseActionTopic=t.currentSettings.trueActionTopic}},slot:"after"}):t._e()],1),t.board.settings.variables&&t.board.settings.variables.length?e("variables-helper",{attrs:{variables:t.board.settings.variables},on:{add:e=>t.currentSettings.trueActionTopic+=e}}):t._e()],1):t._e(),1===t.currentSettings.mode?e("q-input",{attrs:{outlined:"",dense:"","hide-bottom-space":"",color:"grey-9",label:"True action payload"},model:{value:t.currentSettings.truePayload,callback:function(e){t.$set(t.currentSettings,"truePayload",e)},expression:"currentSettings.truePayload"}},[t.currentSettings.truePayload?e("q-btn",{attrs:{slot:"after",icon:"mdi-arrow-right",dense:"",flat:""},on:{click:function(e){t.currentSettings.falsePayload=t.currentSettings.truePayload}},slot:"after"}):t._e()],1):t._e()],1),e("div",{staticClass:"col-6 q-pl-sm"},[e("typed-input",{staticClass:"q-mb-sm",attrs:{settings:{label:"False value"}},model:{value:t.currentSettings.falseValue,callback:function(e){t.$set(t.currentSettings,"falseValue",e)},expression:"currentSettings.falseValue"}}),e("q-input",{staticClass:"q-mb-sm",attrs:{outlined:"",dense:"","hide-bottom-space":"",color:"grey-9",label:"False value icon"},model:{value:t.currentSettings.falseIcon,callback:function(e){t.$set(t.currentSettings,"falseIcon",e)},expression:"currentSettings.falseIcon"}},[e("q-icon",{attrs:{slot:"append",name:`mdi-${t.currentSettings.falseIcon||"toggle-switch-off-outline"}`,size:"1.5rem"},slot:"append"}),e("q-btn",{style:{backgroundColor:t.currentSettings.falseColor},attrs:{slot:"after",flat:""},slot:"after"},[e("q-menu",{staticClass:"q-pa-sm",attrs:{anchor:"top right",self:"bottom right"}},[e("q-color",{attrs:{"format-model":"hex"},model:{value:t.currentSettings.falseColor,callback:function(e){t.$set(t.currentSettings,"falseColor",e)},expression:"currentSettings.falseColor"}})],1)],1)],1),1===t.currentSettings.mode?e("div",{staticClass:"q-mb-sm"},[e("q-input",{attrs:{outlined:"",dense:"","hide-bottom-space":"",color:"grey-9",label:"False action topic"},model:{value:t.currentSettings.falseActionTopic,callback:function(e){t.$set(t.currentSettings,"falseActionTopic",e)},expression:"currentSettings.falseActionTopic"}}),t.board.settings.variables&&t.board.settings.variables.length?e("variables-helper",{attrs:{variables:t.board.settings.variables},on:{add:e=>t.currentSettings.falseActionTopic+=e}}):t._e()],1):t._e(),1===t.currentSettings.mode?e("q-input",{attrs:{outlined:"",dense:"","hide-bottom-space":"",color:"grey-9",label:"False action payload"},model:{value:t.currentSettings.falsePayload,callback:function(e){t.$set(t.currentSettings,"falsePayload",e)},expression:"currentSettings.falsePayload"}}):t._e()],1),e("q-input",{staticClass:"col-12 q-mt-sm",attrs:{outlined:"",dense:"","hide-bottom-space":"",color:"grey-9",label:"Math expression",placeholder:"%value%"},model:{value:t.currentSettings.math,callback:function(e){t.$set(t.currentSettings,"math",e)},expression:"currentSettings.math"}}),e("div",{staticClass:"text-grey-9",staticStyle:{"font-size":".8rem"}},[t._v("You can use math expressions to calculate the final value. Example: (%value% * 1000) / 1024, where %value% is the payload from your subscription.")]),t.widget.topics.length>1?e("div",{staticClass:"q-my-md col-12"},[e("div",{staticClass:"text-grey-6",staticStyle:{"font-size":"0.75rem"}},[t._v("Accumulate logic")]),e("q-btn-toggle",{attrs:{rounded:"","toggle-text-color":"grey-9","text-color":"grey-6",flat:"",options:t.accumulateLogicOptions},model:{value:t.currentSettings.accumulateLogic,callback:function(e){t.$set(t.currentSettings,"accumulateLogic",e)},expression:"currentSettings.accumulateLogic"}}),e("div",{staticClass:"text-grey-6",staticStyle:{"font-size":"0.75rem"}},[t._v("How value will be accumulating*")])],1):t._e(),e("div",{staticClass:"q-mt-sm col-12"},[e("q-toggle",{attrs:{color:"grey-9",label:"Show last update time"},model:{value:t.currentSettings.isNeedTime,callback:function(e){t.$set(t.currentSettings,"isNeedTime",e)},expression:"currentSettings.isNeedTime"}})],1)],1)])},he=[];const ge=0,be=1,ve=0,fe=1;var ye={name:"SwitcherSchema",props:["widget","board"],data(){const t={math:"",actionTopic:"",trueValue:"1",trueIcon:"",trueActionTopic:"",truePayload:"",falseValue:"0",falseIcon:"",falseActionTopic:"",trueColor:"#333",falseColor:"#9e9e9e",falsePayload:"",accumulateLogic:ve,save:!0,mode:ge,height:2,width:2,minWidth:1,minHeight:2,isNeedTime:!0};return{defaultSettings:t,currentSettings:Object.assign({},t,this.widget.settings),modeOptions:[{label:"Default mode",value:ge},{label:"Command mode",value:be}],accumulateLogicOptions:[{label:"AND",value:ve},{label:"OR",value:fe}]}},created(){this.$emit("update",this.currentSettings)},watch:{currentSettings:{deep:!0,handler(t){this.$emit("update",t)}}},components:{VariablesHelper:it}},xe=ye,Se=i("9564"),_e=i("b498"),qe=Object(f["a"])(xe,me,he,!1,null,null,null),we=qe.exports;q()(qe,"components",{QToggle:Se["a"],QBtnToggle:lt["a"],QInput:y["a"],QIcon:x["a"],QBtn:pt["a"],QMenu:ae["a"],QColor:_e["a"]});var Te=function(){var t=this,e=t._self._c;return e("div",[e("div",{staticClass:"row"},[e("div",{staticClass:"col-6 q-mb-sm"},[e("q-input",{staticClass:"q-mr-sm",attrs:{outlined:"",dense:"","hide-bottom-space":"",color:"grey-9",label:"Prefix"},model:{value:t.currentSettings.prefix,callback:function(e){t.$set(t.currentSettings,"prefix",e)},expression:"currentSettings.prefix"}})],1),e("div",{staticClass:"col-6 q-mb-sm"},[e("q-input",{staticClass:"q-ml-sm",attrs:{outlined:"",dense:"","hide-bottom-space":"",color:"grey-9",label:"Postfix"},model:{value:t.currentSettings.postfix,callback:function(e){t.$set(t.currentSettings,"postfix",e)},expression:"currentSettings.postfix"}})],1),e("q-input",{staticClass:"col-8 q-mb-sm q-pr-xs",attrs:{outlined:"",dense:"","hide-bottom-space":"",color:"grey-9",label:"Math expression",placeholder:"%value%"},model:{value:t.currentSettings.math,callback:function(e){t.$set(t.currentSettings,"math",e)},expression:"currentSettings.math"}}),e("q-select",{staticClass:"col-4 q-mb-sm",attrs:{outlined:"",dense:"","hide-bottom-space":"",color:"grey-9",options:t.formatOptions,"emit-value":"","map-options":"",label:"Format value as"},model:{value:t.currentSettings.valueFormat,callback:function(e){t.$set(t.currentSettings,"valueFormat",e)},expression:"currentSettings.valueFormat"}}),t.currentSettings.valueFormat===t.constants.WIDGET_VALUE_FORMAT_DATE?e("q-input",{staticClass:"col-12 q-mb-sm",attrs:{outlined:"",dense:"","hide-bottom-space":"",color:"grey-9",label:"Datetime format",placeholder:"DD/MM/YYYY HH:mm:ss.SSS"},model:{value:t.currentSettings.dateFormat,callback:function(e){t.$set(t.currentSettings,"dateFormat",e)},expression:"currentSettings.dateFormat"}}):t._e(),e("div",{staticClass:"col-12 text-grey-7",staticStyle:{"font-size":"12px","line-height":"1"}},[t._v("You can use math expressions to calculate the final value. Example: (%value% * 1000) / 1024, where %value% is the payload from your subscription.")]),e("div",{staticClass:"q-mt-sm col-12"},[e("q-toggle",{attrs:{color:"grey-9",label:"Show last update time"},model:{value:t.currentSettings.isNeedTime,callback:function(e){t.$set(t.currentSettings,"isNeedTime",e)},expression:"currentSettings.isNeedTime"}})],1)],1)])},$e=[],Ce={name:"InformerSchema",props:["widget","board"],data(){const t={math:"",valueFormat:0,prefix:"",postfix:"",height:2,width:2,minWidth:1,minHeight:2,maxTopicsLength:1,isNeedTime:!0};return{defaultSettings:t,constants:{WIDGET_VALUE_FORMAT_STRING:vt["s"],WIDGET_VALUE_FORMAT_HUMAN_READABLE_SIZE:vt["o"],WIDGET_VALUE_FORMAT_DATE:vt["m"],WIDGET_VALUE_FORMAT_PRE:vt["r"],WIDGET_VALUE_FORMAT_MARKDOWN:vt["q"],WIDGET_VALUE_FORMAT_JSON:vt["p"],WIDGET_VALUE_FORMAT_DURATION:vt["n"]},currentSettings:Object.assign({},t,this.widget.settings),formatOptions:[{label:"String",value:vt["s"]},{label:"Human readable size, B",value:vt["o"]},{label:"Datetime, s",value:vt["m"]},{label:"Duration, s",value:vt["n"]},{label:"Preformated",value:vt["r"]},{label:"Markdown",value:vt["q"]},{label:"JSON",value:vt["p"]}]}},created(){this.$emit("update",this.currentSettings)},watch:{currentSettings:{deep:!0,handler(t){this.$emit("update",t)}}}},ke=Ce,Ie=Object(f["a"])(ke,Te,$e,!1,null,null,null),Ve=Ie.exports;q()(Ie,"components",{QInput:y["a"],QSelect:ct["a"],QToggle:Se["a"]});var Me=function(){var t=this,e=t._self._c;return e("div",[e("div",{staticClass:"row"},[e("div",{staticClass:"col-xs-12 q-mb-sm"},[e("q-select",{attrs:{outlined:"",dense:"","hide-bottom-space":"",color:"grey-9",options:t.formatOptions,"emit-value":"","map-options":"",label:"Format value as"},model:{value:t.currentSettings.valueFormat,callback:function(e){t.$set(t.currentSettings,"valueFormat",e)},expression:"currentSettings.valueFormat"}})],1),e("div",{staticClass:"col-xs-12"},[e("q-input",{attrs:{outlined:"",dense:"","hide-bottom-space":"",color:"grey-9","max-height":300,type:"textarea",label:"Text","input-style":"resize: none;"},model:{value:t.currentSettings.text,callback:function(e){t.$set(t.currentSettings,"text",e)},expression:"currentSettings.text"}})],1)])])},Oe=[],Be={name:"StaticInformerSchema",props:["widget","board"],data(){const t={valueFormat:0,text:"",height:2,width:2,minWidth:1,minHeight:2,maxTopicsLength:0};return{defaultSettings:t,currentSettings:Object.assign({},t,this.widget.settings),formatOptions:[{label:"String",value:vt["s"]},{label:"Preformated",value:vt["r"]},{label:"Markdown",value:vt["q"]},{label:"JSON",value:vt["p"]}]}},created(){this.$emit("update",this.currentSettings)},watch:{currentSettings:{deep:!0,handler(t){this.$emit("update",t)}}}},Ee=Be,Ae=Object(f["a"])(Ee,Me,Oe,!1,null,null,null),Fe=Ae.exports;q()(Ae,"components",{QSelect:ct["a"],QInput:y["a"]});var Le=function(){var t=this,e=t._self._c;return e("div",[e("div",{staticClass:"row"},[e("div",{staticClass:"multi-informer__items-wrapper col-12 relative-position q-mb-sm"},[e("q-list",{attrs:{bordered:""}},[e("q-item-label",{staticClass:"q-py-md q-px-sm list__header",class:{"text-red-6":!t.currentSettings.items.length}},[t._v("\n          Items"+t._s(t.currentSettings.items.length?"":" are empty")+"\n          "),e("q-btn",{staticClass:"absolute-right",attrs:{color:"grey-9",flat:"",label:"ADD",icon:"mdi-plus"},on:{click:t.addItem}})],1),t._l(t.currentSettings.items,(function(i,s){return e("q-expansion-item",{key:`${s}${i.topic}`,attrs:{group:"singleselect-items","header-class":["bg-"+(i.topic.topicFilter?"grey-4":"red-2")],"expand-icon":"mdi-cog",value:s===t.currentSettings.items.length-1}},[e("template",{slot:"header"},[e("q-item-section",{attrs:{side:""}},[e("div",[e("q-btn",{staticClass:"col-1",attrs:{disabled:0===s,round:"",dense:"",flat:"",icon:"mdi-arrow-up"},on:{click:function(e){return e.stopPropagation(),t.upItem(s)}}}),e("q-btn",{staticClass:"col-1",attrs:{disabled:s===t.currentSettings.items.length-1,round:"",dense:"",flat:"",icon:"mdi-arrow-down"},on:{click:function(e){return e.stopPropagation(),t.downItem(s)}}})],1)]),e("q-item-section",[e("span",{staticClass:"ellipsis full-width"},[t._v(t._s(i.topic.topicFilter||"New item"))])]),e("q-item-section",{attrs:{side:""}},[e("q-btn",{attrs:{flat:"",color:"red-6",round:"",dense:"",icon:"mdi-delete"},on:{click:function(e){return t.removeItem(s)}}})],1)],1),e("div",{staticClass:"row q-pa-sm"},[e("topic",{staticClass:"col-12 q-mb-sm",attrs:{board:t.board,config:{needSelectors:!0,needDefault:!0}},on:{input:t.updateTopics},model:{value:i.topic,callback:function(e){t.$set(i,"topic",e)},expression:"item.topic"}}),e("div",{staticClass:"col-6 q-mb-sm"},[e("q-input",{staticClass:"q-mr-sm",attrs:{outlined:"",dense:"","hide-bottom-space":"",color:"grey-9",label:"Prefix"},model:{value:i.prefix,callback:function(e){t.$set(i,"prefix",e)},expression:"item.prefix"}})],1),e("div",{staticClass:"col-6"},[e("q-input",{staticClass:"q-ml-sm",attrs:{outlined:"",dense:"","hide-bottom-space":"",color:"grey-9",label:"Postfix"},model:{value:i.postfix,callback:function(e){t.$set(i,"postfix",e)},expression:"item.postfix"}})],1),e("q-input",{staticClass:"col-8 q-pr-xs q-mb-sm",attrs:{outlined:"",dense:"","hide-bottom-space":"",color:"grey-9",label:"Math expression",placeholder:"%value%"},model:{value:i.math,callback:function(e){t.$set(i,"math",e)},expression:"item.math"}}),e("q-select",{staticClass:"col-4 q-mb-sm",attrs:{outlined:"",dense:"","hide-bottom-space":"",color:"grey-9",options:t.formatOptions,"emit-value":"","map-options":"",label:"Format value as"},model:{value:i.valueFormat,callback:function(e){t.$set(i,"valueFormat",e)},expression:"item.valueFormat"}}),i.valueFormat===t.constants.WIDGET_VALUE_FORMAT_DATE?e("q-input",{staticClass:"col-12 q-mb-xs",attrs:{outlined:"",dense:"","hide-bottom-space":"",color:"grey-9",label:"Datetime format",placeholder:"DD/MM/YYYY HH:mm:ss.SSS"},model:{value:i.dateFormat,callback:function(e){t.$set(i,"dateFormat",e)},expression:"item.dateFormat"}}):t._e(),e("div",{staticClass:"col-12 text-grey-7 q-px-sm q-mb-sm",staticStyle:{"font-size":"12px","line-height":"1"}},[t._v("You can use math expressions to calculate the final value. Example: (%value% * 1000) / 1024, where %value% is the payload from your subscription.")])],1)],2)}))],2)],1),e("div",{staticClass:"q-mt-sm col-12"},[e("q-toggle",{attrs:{color:"grey-9",label:"Show last update time"},model:{value:t.currentSettings.isNeedTime,callback:function(e){t.$set(t.currentSettings,"isNeedTime",e)},expression:"currentSettings.isNeedTime"}})],1)])])},Ne=[],De={name:"SchemeSchema",props:["widget","board"],data(){const t={items:[],topics:[],height:2,width:2,minWidth:1,minHeight:2,maxTopicsLength:0,isNeedTime:!0},e={topic:Object(bt["b"])(),math:"",valueFormat:0,prefix:"",postfix:""};return{defaultSettings:t,defaultItem:e,constants:{WIDGET_VALUE_FORMAT_STRING:vt["s"],WIDGET_VALUE_FORMAT_HUMAN_READABLE_SIZE:vt["o"],WIDGET_VALUE_FORMAT_DATE:vt["m"],WIDGET_VALUE_FORMAT_PRE:vt["r"],WIDGET_VALUE_FORMAT_MARKDOWN:vt["q"],WIDGET_VALUE_FORMAT_JSON:vt["p"],WIDGET_VALUE_FORMAT_DURATION:vt["n"]},currentItem:F()(e),currentSettings:Object.assign({},t,this.widget.settings),formatOptions:[{label:"String",value:vt["s"]},{label:"Human readable size, B",value:vt["o"]},{label:"Datetime, s",value:vt["m"]},{label:"Duration, s",value:vt["n"]},{label:"Preformated",value:vt["r"]},{label:"Markdown",value:vt["q"]},{label:"JSON",value:vt["p"]}],defaultTopic:Object(bt["b"])()}},methods:{addItem(){this.currentSettings.items.push(this.currentItem),this.currentItem=F()(this.defaultItem)},removeItem(t){this.$delete(this.currentSettings.items,t)},upItem(t){const e=this.currentSettings.items.splice(t,1)[0];this.currentSettings.items.splice(t-1,0,e)},downItem(t){const e=this.currentSettings.items.splice(t,1)[0];this.currentSettings.items.splice(t+1,0,e)},updateTopics(){this.$set(this.currentSettings,"topics",this.currentSettings.items.map((t=>t.topic)))},validate(){return!0}},created(){this.$emit("update",this.currentSettings)},mixins:[J],watch:{widget:{deep:!0,handler(t,e){if(this.$emit("validate",this.validate()),V()(t,e))return!1;this.$emit("update",t)}}},components:{Topic:_t}},Qe=De,He=(i("887d"),Object(f["a"])(Qe,Le,Ne,!1,null,null,null)),Re=He.exports;q()(He,"components",{QList:Lt["a"],QItemLabel:mt["a"],QBtn:pt["a"],QExpansionItem:Nt["a"],QItemSection:ut["a"],QInput:y["a"],QSelect:ct["a"],QToggle:Se["a"]});var Pe=function(){var t=this,e=t._self._c;return e("div",[e("q-toggle",{staticClass:"q-mt-sm",attrs:{color:"grey-9",label:"Save last status on server (retained message)"},model:{value:t.currentSettings.save,callback:function(e){t.$set(t.currentSettings,"save",e)},expression:"currentSettings.save"}}),e("q-input",{staticClass:"q-mb-sm",attrs:{color:"grey-9",outlined:"","hide-bottom-space":"",dense:"",label:t.currentSettings.label.length<=25?"Button label":"Button label (25 symbols max)",error:t.currentSettings.label.length>25},model:{value:t.currentSettings.label,callback:function(e){t.$set(t.currentSettings,"label",e)},expression:"currentSettings.label"}}),e("q-input",{staticClass:"q-mb-sm",attrs:{outlined:"","hide-bottom-space":"",dense:"",color:"grey-9",label:"Icon"},model:{value:t.currentSettings.icon,callback:function(e){t.$set(t.currentSettings,"icon",e)},expression:"currentSettings.icon"}},[e("q-icon",{attrs:{slot:"append",name:`mdi-${t.currentSettings.icon||"send"}`,size:"1.5rem"},slot:"append"})],1),e("q-list",{staticClass:"relative-position q-mt-lg",attrs:{bordered:""}},[e("q-item-label",{staticClass:"q-py-md q-px-sm list__header",class:{"text-red-6":!t.currentSettings.topics.length}},[t._v("\n      Topics"+t._s(t.currentSettings.topics.length?"":" are empty")+"\n      "),e("q-btn",{staticClass:"absolute-right",attrs:{color:"grey-9",flat:"",label:"ADD",icon:"mdi-plus"},on:{click:t.addTopic}})],1),t._l(t.currentSettings.topics,(function(i,s){return e("q-expansion-item",{key:s,attrs:{group:"frame-items","header-class":["bg-"+(t.checkUniqueTopic(s)?"grey-4":"red-2")],"expand-icon":"mdi-cog",value:s===t.currentSettings.topics.length-1}},[e("template",{slot:"header"},[e("q-item-section",[e("span",{staticClass:"ellipsis full-width"},[t._v(t._s(i.topicTemplate||"New topic"))])]),e("q-item-section",{attrs:{side:""}},[e("q-btn",{attrs:{flat:"",color:"red-6",round:"",dense:"",icon:"mdi-delete"},on:{click:function(e){return t.removeTopic(s)}}})],1)],1),e("div",{staticClass:"row q-pa-sm"},[e("q-input",{staticClass:"col-12 q-mb-sm",attrs:{outlined:"",dense:"","hide-bottom-space":"",color:"grey-9",label:"Topic"},on:{input:t=>i.topicFilter=t},model:{value:i.topicTemplate,callback:function(e){t.$set(i,"topicTemplate",e)},expression:"item.topicTemplate"}}),t.board.settings.variables&&t.board.settings.variables.length?e("variables-helper",{attrs:{variables:t.board.settings.variables},on:{add:t=>i.topicTemplate+=t}}):t._e(),e("q-input",{staticClass:"q-mt-sm full-width",attrs:{type:"textarea",outlined:"","hide-bottom-space":"",dense:"",color:"grey-9",label:"Payload","input-style":"resize: none;"},model:{value:i.payload,callback:function(e){t.$set(i,"payload",e)},expression:"item.payload"}})],1)],2)}))],2)],1)},ze=[],je={name:"ClickerSchema",props:["widget","board"],data(){const t={label:"",icon:"",topics:[],save:!1,height:2,width:3,minWidth:1,minHeight:2,maxTopicsLength:0};return{defaultSettings:t,currentSettings:Object.assign({},t,this.widget.settings)}},created(){this.$emit("update",this.currentSettings)},methods:{validate(){return this.currentSettings.label.length<=25&&this.currentSettings.topics.length>0},addTopic(){this.currentSettings.topics.push(Object(bt["b"])())},removeTopic(t){this.$delete(this.currentSettings.topics,t)},checkUniqueTopic(t){const e=this.currentSettings.topics[t],i=this.currentSettings.topics.reduce(((t,i,s)=>(i.topicTemplate===e.topicTemplate&&t.push(s),t)),[]);return e.topicTemplate&&0===i.indexOf(t)}},watch:{currentSettings:{deep:!0,handler(t){this.$emit("validate",this.validate()),this.$emit("update",t)}}},components:{VariablesHelper:it}},We=je,Ue=(i("e2f8"),Object(f["a"])(We,Pe,ze,!1,null,null,null)),Ge=Ue.exports;q()(Ue,"components",{QToggle:Se["a"],QInput:y["a"],QIcon:x["a"],QList:Lt["a"],QItemLabel:mt["a"],QBtn:pt["a"],QExpansionItem:Nt["a"],QItemSection:ut["a"]});var Ye=function(){var t=this,e=t._self._c;return e("div",[e("div",{staticClass:"row"},[e("q-input",{staticClass:"col-12",attrs:{outlined:"",dense:"","hide-bottom-space":"",color:"grey-9",label:"Math expression",placeholder:"%value%"},model:{value:t.currentSettings.math,callback:function(e){t.$set(t.currentSettings,"math",e)},expression:"currentSettings.math"}}),e("div",{staticClass:"text-grey-9",staticStyle:{"font-size":".8rem"}},[t._v("You can use math expressions to calculate the final value. Example: (%value% * 1000) / 1024, where %value% is the payload from your subscription.")]),e("q-expansion-item",{staticClass:"col-12 q-mt-sm",staticStyle:{border:"solid #e0e0e0 1px"},attrs:{"default-opened":"",label:"Min value settings","header-class":["bg-"+(t.isValidMinValue?"grey-4":"red-2")]}},[e("div",{staticClass:"row q-pa-sm"},[e("div",{staticClass:"col-5 q-mb-sm"},[e("q-select",{attrs:{outlined:"",dense:"","hide-bottom-space":"",color:"grey-9","emit-value":"","map-options":"",label:"Min value source",options:t.rangeValueModeOptions},on:{input:function(e){return t.changeRangeValueTypeHandler("min")}},model:{value:t.currentSettings.minValueMode,callback:function(e){t.$set(t.currentSettings,"minValueMode",e)},expression:"currentSettings.minValueMode"}})],1),e("div",{staticClass:"col-12"},[0===t.currentSettings.minValueMode?e("q-input",{attrs:{outlined:"",dense:"","hide-bottom-space":"",type:"number",color:"grey-9",label:"Min value"},model:{value:t.currentSettings.minValue,callback:function(e){t.$set(t.currentSettings,"minValue",t._n(e))},expression:"currentSettings.minValue"}}):e("topic",{attrs:{label:"Min value",board:t.board,config:{needDefault:!0}},model:{value:t.minValue,callback:function(e){t.minValue=e},expression:"minValue"}})],1)])]),e("q-expansion-item",{staticClass:"col-12 q-my-sm",staticStyle:{border:"solid #e0e0e0 1px"},attrs:{"default-opened":"",label:"Max value settings","header-class":["bg-"+(t.isValidMaxValue?"grey-4":"red-2")]}},[e("div",{staticClass:"row q-pa-sm"},[e("div",{staticClass:"col-5 q-mb-sm"},[e("q-select",{attrs:{outlined:"",dense:"","hide-bottom-space":"",color:"grey-9","emit-value":"","map-options":"",label:"Max value source",options:t.rangeValueModeOptions},on:{input:function(e){return t.changeRangeValueTypeHandler("max")}},model:{value:t.currentSettings.maxValueMode,callback:function(e){t.$set(t.currentSettings,"maxValueMode",e)},expression:"currentSettings.maxValueMode"}})],1),e("div",{staticClass:"col-12"},[0===t.currentSettings.maxValueMode?e("q-input",{attrs:{outlined:"",dense:"","hide-bottom-space":"",type:"number",color:"grey-9",label:"Max value"},model:{value:t.currentSettings.maxValue,callback:function(e){t.$set(t.currentSettings,"maxValue",t._n(e))},expression:"currentSettings.maxValue"}}):e("topic",{attrs:{label:"Max value",board:t.board,config:{needDefault:!0}},model:{value:t.maxValue,callback:function(e){t.maxValue=e},expression:"maxValue"}})],1)])]),e("div",{staticClass:"col-4 q-mb-sm"},[e("q-input",{staticClass:"q-mr-sm",attrs:{outlined:"",dense:"","hide-bottom-space":"",type:"number",color:"grey-9",label:"Low level"},model:{value:t.currentSettings.lowLevel,callback:function(e){t.$set(t.currentSettings,"lowLevel",t._n(e))},expression:"currentSettings.lowLevel"}})],1),e("div",{staticClass:"col-4"},[e("q-input",{staticClass:"q-mx-sm",attrs:{outlined:"",dense:"","hide-bottom-space":"",type:"number",color:"grey-9",label:"Mid level"},model:{value:t.currentSettings.midLevel,callback:function(e){t.$set(t.currentSettings,"midLevel",t._n(e))},expression:"currentSettings.midLevel"}})],1),e("div",{staticClass:"col-4"},[e("q-input",{staticClass:"q-ml-sm",attrs:{outlined:"",dense:"","hide-bottom-space":"",type:"number",color:"grey-9",label:"High level"},model:{value:t.currentSettings.highLevel,callback:function(e){t.$set(t.currentSettings,"highLevel",t._n(e))},expression:"currentSettings.highLevel"}})],1),e("div",{staticClass:"col-4"},[e("q-input",{staticClass:"q-mr-sm",attrs:{outlined:"",dense:"","hide-bottom-space":"",color:"grey-9",label:"Units"},model:{value:t.currentSettings.units,callback:function(e){t.$set(t.currentSettings,"units",e)},expression:"currentSettings.units"}})],1),e("div",{staticClass:"q-mt-sm col-12"},[e("q-toggle",{attrs:{color:"grey-9",label:"Show last update time"},model:{value:t.currentSettings.isNeedTime,callback:function(e){t.$set(t.currentSettings,"isNeedTime",e)},expression:"currentSettings.isNeedTime"}})],1)],1)])},Je=[],Ke={name:"RadialSchema",props:["widget","board"],data(){const t={math:"",lowLevel:60,midLevel:100,highLevel:120,minValue:0,topics:[],minValueMode:vt["i"],maxValue:250,maxValueMode:vt["i"],units:"",height:6,width:3,maxTopicsLength:1,minWidth:2,minHeight:4,isNeedTime:!0};return{defaultSettings:t,currentSettings:Object.assign({},t,this.widget.settings),rangeValueModeOptions:[{label:"Manual",value:vt["i"]},{label:"Broker",value:vt["j"]}],defaultTopic:Object(bt["b"])()}},computed:{minValue:{get(){return this.currentSettings.minValueMode===vt["i"]?this.currentSettings.minValue:this.currentSettings.topics[0]},set(t){m["default"].set(this.currentSettings.topics,0,t)}},maxValue:{get(){return this.currentSettings.maxValueMode===vt["i"]?this.currentSettings.maxValue:this.currentSettings.minValueMode===vt["i"]?this.currentSettings.topics[0]:this.currentSettings.topics[1]},set(t){this.currentSettings.minValueMode===vt["i"]?m["default"].set(this.currentSettings.topics,0,t):m["default"].set(this.currentSettings.topics,1,t)}},isValidMinValue(){return this.currentSettings.minValueMode===vt["i"]||this.currentSettings.minValueMode===vt["j"]&&!this.widget.dataTopics.map((t=>t.topicFilter)).includes(this.minValue.topicFilter)&&this.maxValue.topicFilter!==this.minValue.topicFilter&&this.validateTopic(this.minValue.topicFilter)},isValidMaxValue(){return this.currentSettings.maxValueMode===vt["i"]||this.currentSettings.maxValueMode===vt["j"]&&!this.widget.dataTopics.map((t=>t.topicFilter)).includes(this.maxValue.topicFilter)&&this.maxValue.topicFilter!==this.minValue.topicFilter&&this.validateTopic(this.maxValue.topicFilter)}},methods:{changeRangeValueTypeHandler(t){const e=[];this.currentSettings.minValueMode===vt["j"]&&("max"===t?e.push(this.currentSettings.topics[0]):e.push(Object.assign({},this.defaultTopic))),this.currentSettings.maxValueMode===vt["j"]&&("min"===t?this.currentSettings.minValueMode===vt["j"]?e.push(this.currentSettings.topics[0]):e.push(this.currentSettings.topics[1]):e.push(Object.assign({},this.defaultTopic))),m["default"].set(this.currentSettings,"topics",e)},validate(){return this.isValidMinValue&&this.isValidMaxValue}},created(){this.$emit("update",this.currentSettings)},mixins:[J],components:{Topic:_t},watch:{widget:{deep:!0,handler(t,e){if(this.$emit("validate",this.validate()),V()(t,e))return!1;this.$emit("update",this.currentSettings)}}}},Xe=Ke,Ze=Object(f["a"])(Xe,Ye,Je,!1,null,null,null),ti=Ze.exports;q()(Ze,"components",{QInput:y["a"],QExpansionItem:Nt["a"],QSelect:ct["a"],QToggle:Se["a"]});var ei=function(){var t=this,e=t._self._c;return e("div",[e("div",{staticClass:"row"},[e("q-input",{staticClass:"col-12",attrs:{outlined:"",dense:"","hide-bottom-space":"",color:"grey-9",label:"Math expression",placeholder:"%value%"},model:{value:t.currentSettings.math,callback:function(e){t.$set(t.currentSettings,"math",e)},expression:"currentSettings.math"}}),e("div",{staticClass:"text-grey-9",staticStyle:{"font-size":".8rem"}},[t._v("You can use math expressions to calculate the final value. Example: (%value% * 1000) / 1024, where %value% is the payload from your subscription.")]),e("q-expansion-item",{staticClass:"col-12 q-mt-sm",staticStyle:{border:"solid #e0e0e0 1px"},attrs:{"default-opened":"",label:"Min value settings","header-class":["bg-"+(t.isValidMinValue?"grey-4":"red-2")]}},[e("div",{staticClass:"row q-pa-sm"},[e("div",{staticClass:"col-3 q-mb-sm"},[e("q-select",{attrs:{outlined:"",dense:"","hide-bottom-space":"",color:"grey-9","emit-value":"","map-options":"",label:"Min value source",options:t.rangeValueModeOptions},on:{input:function(e){return t.changeRangeValueTypeHandler("min")}},model:{value:t.currentSettings.minValueMode,callback:function(e){t.$set(t.currentSettings,"minValueMode",e)},expression:"currentSettings.minValueMode"}})],1),e("div",{staticClass:"col-12"},[0===t.currentSettings.minValueMode?e("q-input",{attrs:{outlined:"",dense:"","hide-bottom-space":"",type:"number",color:"grey-9",label:"Min value"},model:{value:t.currentSettings.minValue,callback:function(e){t.$set(t.currentSettings,"minValue",t._n(e))},expression:"currentSettings.minValue"}}):e("topic",{attrs:{label:"Min value",board:t.board,config:{needDefault:!0}},model:{value:t.minValue,callback:function(e){t.minValue=e},expression:"minValue"}})],1)])]),e("q-expansion-item",{staticClass:"col-12 q-my-sm",staticStyle:{border:"solid #e0e0e0 1px"},attrs:{"default-opened":"",label:"Max value settings","header-class":["bg-"+(t.isValidMaxValue?"grey-4":"red-2")]}},[e("div",{staticClass:"row q-pa-sm"},[e("div",{staticClass:"col-3 q-mb-sm"},[e("q-select",{attrs:{outlined:"",dense:"","hide-bottom-space":"",color:"grey-9","emit-value":"","map-options":"",label:"Max value source",options:t.rangeValueModeOptions},on:{input:function(e){return t.changeRangeValueTypeHandler("max")}},model:{value:t.currentSettings.maxValueMode,callback:function(e){t.$set(t.currentSettings,"maxValueMode",e)},expression:"currentSettings.maxValueMode"}})],1),e("div",{staticClass:"col-12"},[0===t.currentSettings.maxValueMode?e("q-input",{attrs:{outlined:"",dense:"","hide-bottom-space":"",type:"number",color:"grey-9",label:"Max value"},model:{value:t.currentSettings.maxValue,callback:function(e){t.$set(t.currentSettings,"maxValue",t._n(e))},expression:"currentSettings.maxValue"}}):e("topic",{attrs:{label:"Max value",board:t.board,config:{needDefault:!0}},model:{value:t.maxValue,callback:function(e){t.maxValue=e},expression:"maxValue"}})],1)])]),e("div",{staticClass:"col-4 q-mb-sm"},[e("q-input",{staticClass:"q-mr-sm",attrs:{outlined:"",dense:"","hide-bottom-space":"",type:"number",color:"grey-9",label:"Low level"},model:{value:t.currentSettings.lowLevel,callback:function(e){t.$set(t.currentSettings,"lowLevel",t._n(e))},expression:"currentSettings.lowLevel"}})],1),e("div",{staticClass:"col-4"},[e("q-input",{staticClass:"q-mx-sm",attrs:{outlined:"",dense:"","hide-bottom-space":"",type:"number",color:"grey-9",label:"Mid level"},model:{value:t.currentSettings.midLevel,callback:function(e){t.$set(t.currentSettings,"midLevel",t._n(e))},expression:"currentSettings.midLevel"}})],1),e("div",{staticClass:"col-4"},[e("q-input",{staticClass:"q-ml-sm",attrs:{outlined:"",dense:"","hide-bottom-space":"",type:"number",color:"grey-9",label:"High level"},model:{value:t.currentSettings.highLevel,callback:function(e){t.$set(t.currentSettings,"highLevel",t._n(e))},expression:"currentSettings.highLevel"}})],1),e("div",{staticClass:"col-4"},[e("q-input",{staticClass:"q-mr-sm",attrs:{outlined:"",dense:"","hide-bottom-space":"",color:"grey-9",label:"Units"},model:{value:t.currentSettings.units,callback:function(e){t.$set(t.currentSettings,"units",e)},expression:"currentSettings.units"}})],1),e("div",{staticClass:"q-mt-sm col-12"},[e("q-toggle",{attrs:{color:"grey-9",label:"Show last update time"},model:{value:t.currentSettings.isNeedTime,callback:function(e){t.$set(t.currentSettings,"isNeedTime",e)},expression:"currentSettings.isNeedTime"}})],1)],1)])},ii=[],si={name:"LinearSchema",props:["widget","board"],data(){const t={math:"",lowLevel:60,midLevel:100,highLevel:120,minValue:0,topics:[],minValueMode:vt["i"],maxValue:250,maxValueMode:vt["i"],units:"",height:8,width:1,maxTopicsLength:1,minWidth:1,minHeight:2,isNeedTime:!0};return{defaultSettings:t,currentSettings:Object.assign({},t,this.widget.settings),rangeValueModeOptions:[{label:"Manual",value:vt["i"]},{label:"Broker",value:vt["j"]}],defaultTopic:Object(bt["b"])()}},computed:{minValue:{get(){return this.currentSettings.minValueMode===vt["i"]?this.currentSettings.minValue:this.currentSettings.topics[0]},set(t){m["default"].set(this.currentSettings.topics,0,t)}},maxValue:{get(){return this.currentSettings.maxValueMode===vt["i"]?this.currentSettings.maxValue:this.currentSettings.minValueMode===vt["i"]?this.currentSettings.topics[0]:this.currentSettings.topics[1]},set(t){this.currentSettings.minValueMode===vt["i"]?m["default"].set(this.currentSettings.topics,0,t):m["default"].set(this.currentSettings.topics,1,t)}},isValidMinValue(){return this.currentSettings.minValueMode===vt["i"]||this.currentSettings.minValueMode===vt["j"]&&!this.widget.dataTopics.map((t=>t.topicFilter)).includes(this.minValue.topicFilter)&&this.maxValue.topicFilter!==this.minValue.topicFilter&&this.validateTopic(this.minValue.topicFilter)},isValidMaxValue(){return this.currentSettings.maxValueMode===vt["i"]||this.currentSettings.maxValueMode===vt["j"]&&!this.widget.dataTopics.map((t=>t.topicFilter)).includes(this.maxValue.topicFilter)&&this.maxValue.topicFilter!==this.minValue.topicFilter&&this.validateTopic(this.maxValue.topicFilter)}},methods:{changeRangeValueTypeHandler(t){const e=[];this.currentSettings.minValueMode===vt["j"]&&("max"===t?e.push(this.currentSettings.topics[0]):e.push(Object.assign({},this.defaultTopic))),this.currentSettings.maxValueMode===vt["j"]&&("min"===t?this.currentSettings.minValueMode===vt["j"]?e.push(this.currentSettings.topics[0]):e.push(this.currentSettings.topics[1]):e.push(Object.assign({},this.defaultTopic))),m["default"].set(this.currentSettings,"topics",e)},validate(){return this.isValidMinValue&&this.isValidMaxValue}},created(){this.$emit("update",this.currentSettings)},mixins:[J],components:{Topic:_t},watch:{widget:{deep:!0,handler(t,e){if(this.$emit("validate",this.validate()),V()(t,e))return!1;this.$emit("update",this.currentSettings)}}}},ai=si,ni=Object(f["a"])(ai,ei,ii,!1,null,null,null),oi=ni.exports;q()(ni,"components",{QInput:y["a"],QExpansionItem:Nt["a"],QSelect:ct["a"],QToggle:Se["a"]});var ri=function(){var t=this,e=t._self._c;return e("div",[e("div",{staticClass:"text-grey-6 text-center q-mt-md",staticStyle:{"font-size":"1.3rem"}},[t._v(t._s(t.descriptions[t.currentSettings.mode]))]),e("div",{staticClass:"row"},[e("q-btn-toggle",{staticClass:"q-mt-md col-12",attrs:{rounded:"","toggle-text-color":"grey-9","text-color":"grey-6",flat:"",options:t.modeOptions},model:{value:t.currentSettings.mode,callback:function(e){t.$set(t.currentSettings,"mode",e)},expression:"currentSettings.mode"}}),t.currentSettings.mode===t.IFRAME_MODE_INTEGRATION?e("q-input",{staticClass:"col-12 q-mb-sm",attrs:{outlined:"",dense:"","hide-bottom-space":"",color:"grey-9",label:"Iframe link"},model:{value:t.currentSettings.link,callback:function(e){t.$set(t.currentSettings,"link",e)},expression:"currentSettings.link"}}):t._e(),t.currentSettings.mode===t.IFRAME_MODE_INTEGRATION?e("q-input",{staticClass:"col-12 q-mb-sm",attrs:{outlined:"",dense:"","hide-bottom-space":"",color:"grey-9",autogrow:"",label:"Ready message from iframe"},model:{value:t.currentSettings.readyMessage,callback:function(e){t.$set(t.currentSettings,"readyMessage",e)},expression:"currentSettings.readyMessage"}}):t._e(),t.currentSettings.mode===t.IFRAME_MODE_INTEGRATION?e("q-input",{staticClass:"col-12",attrs:{outlined:"",dense:"","hide-bottom-space":"",color:"grey-9",autogrow:"",label:"Init message to iframe"},model:{value:t.currentSettings.initMessage,callback:function(e){t.$set(t.currentSettings,"initMessage",e)},expression:"currentSettings.initMessage"}}):t._e(),t.currentSettings.mode===t.IFRAME_MODE_INTEGRATION?e("div",{staticClass:"frame__items-wrapper col-12 relative-position q-mb-sm q-mt-lg"},[e("q-list",{attrs:{bordered:""}},[e("q-item-label",{staticClass:"q-py-md q-px-sm list__header",class:{"text-red-6":!t.currentSettings.items.length}},[t._v("\n          Post message commands"+t._s(t.currentSettings.items.length?"":" are empty")+"\n          "),e("q-btn",{staticClass:"absolute-right",attrs:{color:"grey-9",flat:"",label:"ADD",icon:"mdi-plus"},on:{click:t.addItem}})],1),t._l(t.currentSettings.items,(function(i,s){return e("q-expansion-item",{key:`${s}${i.value}`,attrs:{group:"frame-items","header-class":["bg-"+(t.checkUniqueTopic(s)?"grey-4":"red-2")],"expand-icon":"mdi-cog",value:s===t.currentSettings.items.length-1}},[e("template",{slot:"header"},[e("q-item-section",[e("span",{staticClass:"ellipsis full-width"},[t._v(t._s(i.label||i.topic.topicFilter))])]),e("q-item-section",{attrs:{side:""}},[e("q-btn",{attrs:{flat:"",color:"red-6",round:"",dense:"",icon:"mdi-delete"},on:{click:function(e){return t.removeItem(s)}}})],1)],1),e("div",{staticClass:"row q-pa-sm"},[e("q-input",{staticClass:"col-12 q-mb-sm",attrs:{outlined:"",dense:"","hide-bottom-space":"",color:"grey-9",label:"Label"},model:{value:i.label,callback:function(e){t.$set(i,"label",e)},expression:"item.label"}}),e("topic",{key:`${s}${i.value}`,staticClass:"col-12 q-mb-sm",attrs:{label:i.label,board:t.board},on:{input:t.setTopics},model:{value:i.topic,callback:function(e){t.$set(i,"topic",e)},expression:"item.topic"}}),e("q-input",{staticClass:"col-12",attrs:{outlined:"",dense:"","hide-bottom-space":"",type:"textarea",color:"grey-9",label:"Payload template","input-style":"resize: none;"},model:{value:i.template,callback:function(e){t.$set(i,"template",e)},expression:"item.template"}}),e("div",{staticClass:"col-12 text-grey-6",staticStyle:{"font-size":".8rem"}},[t._v("\n              You can use variables in template: "),e("span",{staticClass:"text-grey-10 cursor-pointer",on:{click:function(t){i.template+="<{topic}>"}}},[t._v("<{topic}>")]),t._v(" is a topic from payload packet, "),e("span",{staticClass:"text-grey-10 cursor-pointer",on:{click:function(t){i.template+="<{topic[0]}>"}}},[t._v("<{topic[0]}>")]),t._v(" is a slash separated topic part (0 is part index), "),e("span",{staticClass:"text-grey-10 cursor-pointer",on:{click:function(t){i.template+="<{payload}>"}}},[t._v("<{payload}>")]),t._v(" is a stringified payload of packet, "),e("span",{staticClass:"text-grey-8"},[t._v("<%payload.name%>")]),t._v(" is a JSON path to value in payload, if payload is object.\n            ")])],1)],2)}))],2)],1):t._e(),e("div",{staticClass:"col-12 text-grey-6 q-mt-xs",staticStyle:{"font-size":".8rem"}},[e("span",{staticClass:"text-grey-9 cursor-pointer",on:{click:t.exampleSettingsApply}},[t._v("Example")]),e("span",{staticClass:"text-red"},[t._v(" (will clear all your settings)")])]),e("div",{staticClass:"q-mt-sm col-12"},[e("q-input",{attrs:{outlined:"",dense:"","hide-bottom-space":"",color:"grey-9",label:"ACL Topic",hint:'You can specify tokens which be used for publishing from iframe logic. Command format: `MQTTTiles|${postkey}|publish=>{ "topic":"topic/to/data", "payload":"message", "retain":true }`, where postkey is a uniq key for iframe.'},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.addAcl.apply(null,arguments)}},model:{value:t.aclTopicName,callback:function(e){t.aclTopicName=e},expression:"aclTopicName"}},[e("q-btn",{attrs:{round:"",flat:"",dense:"",icon:"mdi-plus",disable:!t.aclTopicName},on:{click:t.addAcl}},[t.aclTopicName?t._e():e("q-tooltip",[t._v("Enter topic first")])],1)],1),t.currentSettings.aclTopics.length?e("q-list",{staticClass:"q-mt-sm",attrs:{bordered:"",separator:""}},[e("q-item-label",{staticClass:"q-py-sm q-px-sm",staticStyle:{"font-size":".7rem"}},[t._v("\n          ACL Topics\n        ")]),e("q-separator"),t._l(t.currentSettings.aclTopics,(function(i,s){return e("q-item",{key:i,staticClass:"q-px-sm"},[e("q-item-section",{staticStyle:{"word-break":"break-word"}},[t._v(t._s(i))]),e("q-item-section",{attrs:{side:""}},[e("q-btn",{attrs:{round:"",flat:"",dense:"",icon:"mdi-close"},on:{click:function(e){return t.removeAcl(s)}}})],1)],1)}))],2):t._e()],1),e("div",{staticClass:"q-mt-sm col-12"},[e("q-toggle",{attrs:{color:"grey-9",label:"Show last update time"},model:{value:t.currentSettings.isNeedTime,callback:function(e){t.$set(t.currentSettings,"isNeedTime",e)},expression:"currentSettings.isNeedTime"}})],1)],1)])},li=[];const ci=0,di=1;var ui={name:"FrameSchema",props:["widget","board"],data(){const t={height:6,width:3,maxTopicsLength:0,minWidth:3,minHeight:3,mode:0,template:"",items:[],topics:[],link:"https://flespi.io/mapview",readyMessage:"",initMessage:"",isNeedTime:!0,aclTopics:[]},e={label:"New item",template:"",topic:Object(bt["b"])()};return{defaultSettings:t,defaultItem:e,currentSettings:Object.assign({},t,this.widget.settings),IFRAME_MODE_INTEGRATION:ci,IFRAME_MODE_SHOW:di,modeOptions:[{label:"Integration mode",value:ci},{label:"Show mode",value:di}],descriptions:["Payload will be posted to your iframe","Link as payload expected!"],aclTopicName:""}},methods:{exampleSettingsApply(){this.$set(this.currentSettings,"link","https://flespi.io/mapview"),this.$set(this.currentSettings,"readyMessage",'MapView|state:{"ready": true}'),this.$set(this.currentSettings,"items",[{label:"Map item",template:'MapView|cmd:{"addmarkers": [[<%position.latitude%>, <%position.longitude%>]], "clear": "all"}',topic:{topicFilter:"flespi/message/gw/devices/+",payloadType:1,payloadField:""}}]),this.$set(this.currentSettings,"topics",[{topicFilter:"flespi/message/gw/devices/+",payloadType:1,payloadField:""}])},addItem(){this.currentSettings.items.push(F()(this.defaultItem))},removeItem(t){this.$delete(this.currentSettings.items,t)},setTopics(){this.$set(this.currentSettings,"topics",this.currentSettings.items.map((t=>t.topic)))},checkUniqueTopic(t){const e=this.currentSettings.items[t],i=this.currentSettings.items.reduce(((t,i,s)=>(i.topic.topicFilter===e.topic.topicFilter&&t.push(s),t)),[]);return e.topic.topicFilter&&0===i.indexOf(t)},validate(){return this.currentSettings.mode===ci&&this.currentSettings.items.length&&this.currentSettings.items.reduce(((t,e,i)=>t&&this.checkUniqueTopic(i)),!0)||this.currentSettings.mode===di},addAcl(){this.currentSettings.aclTopics.push(this.aclTopicName),this.aclTopicName=""},removeAcl(t){this.currentSettings.aclTopics.splice(t,1)}},created(){this.$emit("update",this.currentSettings)},watch:{currentSettings:{deep:!0,handler(t,e){if(this.$emit("validate",this.validate()),V()(t,e))return!1;this.$emit("update",this.currentSettings)}},"currentSettings.mode"(t){t===ci?(this.currentSettings.maxTopicsLength=0,this.$emit("update-widget",{dataTopics:[]})):(this.currentSettings.maxTopicsLength=1,this.currentSettings.topics=[],this.currentSettings.items=[])}},components:{Topic:_t}},pi=ui,mi=(i("7134"),i("eb85")),hi=Object(f["a"])(pi,ri,li,!1,null,null,null),gi=hi.exports;q()(hi,"components",{QBtnToggle:lt["a"],QInput:y["a"],QList:Lt["a"],QItemLabel:mt["a"],QBtn:pt["a"],QExpansionItem:Nt["a"],QItemSection:ut["a"],QTooltip:S["a"],QSeparator:mi["a"],QItem:dt["a"],QToggle:Se["a"]});var bi=function(){var t=this,e=t._self._c;return e("div",[e("div",{staticClass:"row"},[e("div",{staticClass:"q-mt-sm col-12"},[e("q-toggle",{attrs:{color:"grey-9",label:"Save last status on server (retained message)"},model:{value:t.currentSettings.save,callback:function(e){t.$set(t.currentSettings,"save",e)},expression:"currentSettings.save"}})],1),e("q-btn-toggle",{staticClass:"q-mt-md col-12",attrs:{rounded:"","toggle-text-color":"grey-9","text-color":"grey-6",flat:"",options:t.modeOptions},model:{value:t.currentSettings.mode,callback:function(e){t.$set(t.currentSettings,"mode",e)},expression:"currentSettings.mode"}}),e("div",{staticClass:"singleselect__items-wrapper col-12 relative-position q-mb-sm"},[e("q-list",{attrs:{bordered:""}},[e("q-item-label",{staticClass:"q-py-md q-px-sm list__header",class:{"text-red-6":!t.currentSettings.items.length}},[t._v("\n          Items"+t._s(t.currentSettings.items.length?"":" are empty")+"\n          "),e("q-btn",{staticClass:"absolute-right",attrs:{color:"grey-9",flat:"",label:"ADD",icon:"mdi-plus"},on:{click:t.addItem}})],1),t._l(t.currentSettings.items,(function(i,s){return e("q-expansion-item",{key:`${s}${i.value}`,attrs:{group:"singleselect-items","header-class":["bg-"+(t.checkUniqueValue(i.val,s)&&i.actionTopic?"grey-4":"red-2")],"expand-icon":"mdi-cog",value:s===t.currentSettings.items.length-1}},[e("template",{slot:"header"},[e("q-item-section",{attrs:{avatar:""}},[e("div",[e("q-btn",{staticClass:"col-1",attrs:{disabled:0===s,round:"",dense:"",flat:"",icon:"mdi-arrow-up"},on:{click:function(e){return e.stopPropagation(),t.upItem(s)}}}),e("q-btn",{staticClass:"col-1",attrs:{disabled:s===t.currentSettings.items.length-1,round:"",dense:"",flat:"",icon:"mdi-arrow-down"},on:{click:function(e){return e.stopPropagation(),t.downItem(s)}}})],1)]),e("q-item-section",[e("span",{staticClass:"ellipsis full-width"},[t._v(t._s(i.label?`${i.label} [${i.val}]`:i.val||"New item"))])]),e("q-item-section",{attrs:{side:""}},[e("q-btn",{attrs:{flat:"",color:"red-6",round:"",dense:"",icon:"mdi-delete"},on:{click:function(e){return t.removeItem(s)}}})],1)],1),e("div",{staticClass:"row q-pa-sm"},[e("div",{staticClass:"col-6 q-mb-sm"},[e("q-input",{staticClass:"q-mr-xs",attrs:{outlined:"",dense:"","hide-bottom-space":"",autofocus:"",color:"grey-9",label:"Label"},model:{value:i.label,callback:function(e){t.$set(i,"label",e)},expression:"item.label"}})],1),e("div",{staticClass:"col-6 q-mb-sm"},[e("typed-input",{staticClass:"q-ml-xs",attrs:{settings:{label:"Value",error:!t.checkUniqueValue(i.val,s)}},model:{value:i.val,callback:function(e){t.$set(i,"val",e)},expression:"item.val"}})],1),1===t.currentSettings.mode?e("div",{staticClass:"col-6"},[e("q-input",{staticClass:"q-mr-xs",attrs:{outlined:"",dense:"","hide-bottom-space":"",color:"grey-9",label:"Action topic",error:!i.actionTopic},model:{value:i.actionTopic,callback:function(e){t.$set(i,"actionTopic",e)},expression:"item.actionTopic"}})],1):t._e(),1===t.currentSettings.mode?e("div",{staticClass:"col-6"},[e("q-input",{staticClass:"q-ml-xs",attrs:{outlined:"",dense:"","hide-bottom-space":"",color:"grey-9",label:"Action payload"},model:{value:i.actionPayload,callback:function(e){t.$set(i,"actionPayload",e)},expression:"item.actionPayload"}})],1):t._e(),t.board.settings.variables&&t.board.settings.variables.length?e("variables-helper",{staticClass:"col-12",attrs:{variables:t.board.settings.variables},on:{add:t=>i.actionTopic+=t}}):t._e()],1)],2)}))],2)],1),e("div",{staticClass:"q-mt-sm col-12"},[e("q-toggle",{attrs:{color:"grey-9",label:"Show last update time"},model:{value:t.currentSettings.isNeedTime,callback:function(e){t.$set(t.currentSettings,"isNeedTime",e)},expression:"currentSettings.isNeedTime"}})],1)],1)])},vi=[];const fi=0,yi=1;var xi={name:"SingleselectSchema",props:["widget","board"],data(){const t={label:"item",val:"",actionTopic:"topic/to/action",actionPayload:""},e={items:[],save:!0,mode:fi,height:4,width:2,maxTopicsLength:1,minWidth:2,minHeight:4,isNeedTime:!0};return{defaultSettings:e,defaultItem:t,currentItem:Object.assign({},t),currentSettings:Object.assign({},e,this.widget.settings),modeOptions:[{label:"Default mode",value:fi},{label:"Command mode",value:yi}]}},methods:{addItem(){this.currentSettings.items.push(this.currentItem),this.currentItem=Object.assign({},this.defaultItem)},removeItem(t){this.$delete(this.currentSettings.items,t)},upItem(t){const e=this.currentSettings.items.splice(t,1)[0];this.currentSettings.items.splice(t-1,0,e)},downItem(t){const e=this.currentSettings.items.splice(t,1)[0];this.currentSettings.items.splice(t+1,0,e)},checkUniqueValue(t,e){let i=!0;return this.currentSettings.items.map((t=>t.val)).some(((s,a)=>{const n=s===t;return n&&(i=a===e),n})),i},validate(){return(this.currentSettings.mode===fi||this.currentSettings.mode===yi&&this.currentSettings.items.reduce(((t,e)=>t&&!!e.actionTopic),!0))&&!!this.currentSettings.items.length&&this.currentSettings.items.reduce(((t,e,i,s)=>(t[e.val]||(t[e.val]=0),t[e.val]++,i===s.length-1?Object.keys(t).reduce(((e,i)=>e?1===t[i]:e),!0):t)),{})}},created(){this.$emit("update",this.currentSettings)},watch:{currentSettings:{deep:!0,handler(t,e){if(V()(t,e))return!1;this.$emit("validate",this.validate()),this.$emit("update",t)}}},components:{VariablesHelper:it}},Si=xi,_i=(i("2e6d"),Object(f["a"])(Si,bi,vi,!1,null,null,null)),qi=_i.exports;q()(_i,"components",{QToggle:Se["a"],QBtnToggle:lt["a"],QList:Lt["a"],QItemLabel:mt["a"],QBtn:pt["a"],QExpansionItem:Nt["a"],QItemSection:ut["a"],QInput:y["a"]});var wi=function(){var t=this,e=t._self._c;return e("div",[e("div",{staticClass:"row"},[t.widget.topics.length&&t.widget.topics[0]&&t.widget.topics[0].split("/").length?e("div",{staticClass:"q-mb-sm col-12"},[e("div",{staticClass:"q-mb-sm text-grey-9"},[t._v("Group layer")]),t._l(t.widget.topics[0].split("/"),(function(i,s){return e("div",{key:`${s}${i}`,staticClass:"q-mr-xs q-pa-xs rounded-borders cursor-pointer inline-block",class:{"bg-grey-9 text-white":t.currentSettings.groupLayout>=s,"text-grey-9 bg-grey-3":t.currentSettings.groupLayout<s},on:{click:function(e){return t.setGroupLayer(s)}}},[t._v("\n        "+t._s(i)+"\n      ")])}))],2):t._e(),t.widget.dataTopics[0]&&1===t.widget.dataTopics[0].payloadType?e("q-input",{staticClass:"col-12 q-mb-sm",attrs:{outlined:"",dense:"","hide-bottom-space":"",label:"Widget`s name field",color:"grey-9"},model:{value:t.currentSettings.nameField,callback:function(e){t.$set(t.currentSettings,"nameField",e)},expression:"currentSettings.nameField"}}):t._e(),e("q-input",{staticClass:"col-12 q-mb-sm",attrs:{outlined:"",dense:"","hide-bottom-space":"",label:"Multiplied widget render logic",color:"grey-9",hint:"You can use math logic to define what values to show in the widget. Example: `%value% > 1000` or `<%jsons-some-field%> != nill`, where %value% is a payload and <%jsons-some-field%> is a JSON field from your subscription."},model:{value:t.currentSettings.math,callback:function(e){t.$set(t.currentSettings,"math",e)},expression:"currentSettings.math"}}),e("div",{staticClass:"q-mb-sm col-12"},[e("q-select",{attrs:{outlined:"",dense:"","hide-bottom-space":"",color:"grey-9",options:t.typeOptions,"emit-value":"","map-options":"",label:"Widget multiplier type"},on:{input:function(e){t.currentSettings.widgetSettings={}}},model:{value:t.currentSettings.type,callback:function(e){t.$set(t.currentSettings,"type",e)},expression:"currentSettings.type"}})],1),e("div",{staticClass:"color-palette q-pa-sm rounded-borders q-mb-lg col-12"},[e("div",{staticClass:"text-grey-9 q-pb-sm color-palette__label"},[t._v("Widgets color")]),e("div",{staticClass:"row color-palette__wrapper"},t._l(t.colors,(function(i){return e("span",{key:i,staticClass:"q-mr-sm cursor-pointer color-palette__item",class:[`bg-${i}`],on:{click:function(e){return t.setColor(i)}}},[i===t.currentSettings.color?e("q-icon",{staticClass:"item__icon",attrs:{size:"1.4rem",name:"mdi-check",color:"white"}}):t._e()],1)})),0)]),e("div",{staticClass:"q-mt-sm col-12"},[e(t.currentSettings.type,{tag:"component",attrs:{widget:t.schemaWidget,board:t.board,integration:!0},on:{update:t.updateSettingsHandler,validate:t.validateSchemas}})],1)],1)])},Ti=[],$i=function(){var t=this,e=t._self._c;return e("div",{staticClass:"q-mt-xl"},[e("div",{staticClass:"row"},[t.edited?e("div",{staticClass:"complex__items-wrapper col-12 relative-position q-mb-sm"},[e("q-expansion-item",{staticStyle:{border:"solid #e0e0e0 1px"},attrs:{"header-class":["bg-grey-4"],"expand-icon":"mdi-cog","default-opened":""}},[e("template",{slot:"header"},[e("q-item-section",[e("span",{staticClass:"ellipsis full-width"},[t._v(t._s(t.editedItem.label?`${t.editedItem.label} [${t.editedItem.type}]`:t.editedItem.type))])]),e("q-item-section",{attrs:{side:""}},[e("q-btn",{attrs:{flat:"",color:"red-6",round:"",dense:"",icon:"mdi-delete"},on:{click:function(e){return t.removeItem(t.editedItem.index)}}})],1)],1),e("div",{staticClass:"row q-pa-sm"},[e("div",{staticClass:"col-6 q-mb-sm"},[e("q-input",{staticClass:"q-mr-xs",attrs:{outlined:"",dense:"","hide-bottom-space":"",autofocus:"",color:"grey-9",label:"Label"},model:{value:t.editedItem.label,callback:function(e){t.$set(t.editedItem,"label",e)},expression:"editedItem.label"}})],1),e("div",{staticClass:"col-6 q-mb-sm"},[e("q-input",{staticClass:"q-ml-xs",attrs:{outlined:"",dense:"","hide-bottom-space":"",color:"grey-9",label:"Path",placeholder:"item[0].value"},model:{value:t.editedItem.path,callback:function(e){t.$set(t.editedItem,"path",e)},expression:"editedItem.path"}})],1),"knob"===t.editedItem.type||"progress"===t.editedItem.type?e("q-expansion-item",{staticClass:"col-12 q-mt-sm",staticStyle:{border:"solid #e0e0e0 1px"},attrs:{"default-opened":"",label:"Min value settings","header-class":["bg-"+(t.isValidMinValue(t.editedItem.index)?"grey-4":"red-2")]}},[e("div",{staticClass:"row q-pa-sm"},[e("div",{staticClass:"col-5 q-mb-sm"},[e("q-select",{attrs:{outlined:"",dense:"","hide-bottom-space":"",color:"grey-9",label:"Min value source","emit-value":"","map-options":"",options:t.rangeValueModeOptions},on:{input:function(e){return t.changeRangeValueTypeHandler(t.editedItem.index,"min")}},model:{value:t.editedItem.minValueMode,callback:function(e){t.$set(t.editedItem,"minValueMode",e)},expression:"editedItem.minValueMode"}})],1),e("div",{staticClass:"col-12"},[0===t.editedItem.minValueMode?e("q-input",{attrs:{outlined:"",dense:"","hide-bottom-space":"",type:"number",color:"grey-9",label:"Min value"},model:{value:t.editedItem.minValue,callback:function(e){t.$set(t.editedItem,"minValue",t._n(e))},expression:"editedItem.minValue"}}):e("topic",{attrs:{label:"Min value",board:t.board},model:{value:t.editedItem.minValue,callback:function(e){t.$set(t.editedItem,"minValue",e)},expression:"editedItem.minValue"}})],1)])]):t._e(),"knob"===t.editedItem.type||"progress"===t.editedItem.type?e("q-expansion-item",{staticClass:"col-12 q-mt-sm",staticStyle:{border:"solid #e0e0e0 1px"},attrs:{"default-opened":"",label:"Max value settings","header-class":["bg-"+(t.isValidMaxValue(t.editedItem.index)?"grey-4":"red-2")]}},[e("div",{staticClass:"row q-pa-sm"},[e("div",{staticClass:"col-5 q-mb-sm"},[e("q-select",{attrs:{outlined:"",dense:"","hide-bottom-space":"",color:"grey-9","emit-value":"","map-options":"",label:"Max value source",options:t.rangeValueModeOptions},on:{input:function(e){return t.changeRangeValueTypeHandler(t.editedItem.index,"max")}},model:{value:t.editedItem.maxValueMode,callback:function(e){t.$set(t.editedItem,"maxValueMode",e)},expression:"editedItem.maxValueMode"}})],1),e("div",{staticClass:"col-12"},[0===t.editedItem.maxValueMode?e("q-input",{attrs:{outlined:"",dense:"","hide-bottom-space":"",type:"number",color:"grey-9",label:"Max value"},model:{value:t.editedItem.maxValue,callback:function(e){t.$set(t.editedItem,"maxValue",t._n(e))},expression:"editedItem.maxValue"}}):e("topic",{attrs:{label:"Max value",board:t.board},model:{value:t.editedItem.maxValue,callback:function(e){t.$set(t.editedItem,"maxValue",e)},expression:"editedItem.maxValue"}})],1)])]):t._e(),"text"===t.editedItem.type?e("div",{staticClass:"row"},[e("q-input",{staticClass:"col-8 q-mb-sm q-pr-xs",attrs:{outlined:"",dense:"","hide-bottom-space":"",color:"grey-9",label:"Math expression",placeholder:"%value%"},model:{value:t.editedItem.math,callback:function(e){t.$set(t.editedItem,"math",e)},expression:"editedItem.math"}}),e("q-select",{staticClass:"col-4 q-mb-sm",attrs:{outlined:"",dense:"","hide-bottom-space":"",color:"grey-9",options:t.formatOptions,"emit-value":"","map-options":"",label:"Format value as"},model:{value:t.editedItem.valueFormat,callback:function(e){t.$set(t.editedItem,"valueFormat",e)},expression:"editedItem.valueFormat"}}),t.editedItem.valueFormat===t.constants.WIDGET_VALUE_FORMAT_DATE?e("q-input",{staticClass:"col-12",attrs:{outlined:"",dense:"","hide-bottom-space":"",color:"grey-9",label:"Datetime format",placeholder:"DD/MM/YYYY HH:mm:ss.SSS"},model:{value:t.editedItem.dateFormat,callback:function(e){t.$set(t.editedItem,"dateFormat",e)},expression:"editedItem.dateFormat"}}):t._e(),e("div",{staticClass:"text-grey-7 q-mt-xs",staticStyle:{"font-size":"12px","line-height":"1"}},[t._v("You can use math expressions to calculate the final value. Example: (%value% * 1000) / 1024, where %value% is the payload from your subscription.")])],1):t._e()],1)],2)],1):t._e(),e("div",{staticClass:"q-mt-sm col-12"},[e("q-toggle",{attrs:{color:"grey-9",label:"Show last update time"},model:{value:t.currentSettings.isNeedTime,callback:function(e){t.$set(t.currentSettings,"isNeedTime",e)},expression:"currentSettings.isNeedTime"}})],1)])])},Ci=[],ki={name:"ComplexSchema",props:["widget","board"],data(){const t={label:"item",type:"knob",path:"",position:"top",minValueMode:vt["i"],minValue:0,maxValueMode:vt["i"],maxValue:100},e={items:[],topics:[],height:8,width:4,maxTopicsLength:1,minWidth:2,minHeight:4,isNeedTime:!0};return{defaultSettings:e,constants:{WIDGET_VALUE_FORMAT_STRING:vt["s"],WIDGET_VALUE_FORMAT_HUMAN_READABLE_SIZE:vt["o"],WIDGET_VALUE_FORMAT_DATE:vt["m"],WIDGET_VALUE_FORMAT_PRE:vt["r"],WIDGET_VALUE_FORMAT_MARKDOWN:vt["q"],WIDGET_VALUE_FORMAT_JSON:vt["p"],WIDGET_VALUE_FORMAT_DURATION:vt["n"]},defaultItem:t,currentItem:Object.assign({},t),currentSettings:Object.assign({},e,this.widget.settings),itemTypes:[{label:"Knob",value:"knob"},{label:"Progress",value:"progress"},{label:"Text",value:"text"}],rangeValueModeOptions:[{label:"Manual",value:vt["i"]},{label:"Broker",value:vt["j"]}],formatOptions:[{label:"String",value:vt["s"]},{label:"Human readable size, B",value:vt["o"]},{label:"Datetime, s",value:vt["m"]},{label:"Duration, s",value:vt["n"]},{label:"Preformated",value:vt["r"]},{label:"Markdown",value:vt["q"]},{label:"JSON",value:vt["p"]}],defaultTopic:Object(bt["b"])(),edited:null}},computed:{editedItem(){return this.edited?this.currentSettings.items[this.edited.index]:null}},methods:{selectHandler(t){this.edited=t},addItem({type:t,position:e}){const i=this.currentSettings.items.length;return this.currentItem.index=i,this.currentItem.type=t,this.currentItem.position=e,this.currentSettings.items.push(this.currentItem),this.currentItem=Object.assign({},this.defaultItem),this.currentSettings.items.length-1},removeItem(t){this.edited=null,this.currentSettings.items.forEach((e=>{t<e.index&&e.index--})),this.$delete(this.currentSettings.items,t)},isValidMinValue(t){const e=this.currentSettings.items[t];return e.minValueMode===vt["i"]||e.minValueMode===vt["j"]&&!this.widget.dataTopics.map((t=>t.topicFilter)).includes(e.minValue.topicFilter)&&e.maxValue.topicFilter!==e.minValue.topicFilter&&this.validateTopic(e.minValue.topicFilter)},isValidMaxValue(t){const e=this.currentSettings.items[t];return e.maxValueMode===vt["i"]||e.maxValueMode===vt["j"]&&!this.widget.dataTopics.map((t=>t.topicFilter)).includes(e.maxValue.topicFilter)&&e.maxValue.topicFilter!==e.minValue.topicFilter&&this.validateTopic(e.maxValue.topicFilter)},changeRangeValueTypeHandler(t,e){const i=this.currentSettings.items[t];"min"===e?i.minValueMode?this.$set(i,"minValue",Object.assign({},this.defaultTopic)):this.$set(i,"minValue",0):"max"===e&&(i.maxValueMode?this.$set(i,"maxValue",Object.assign({},this.defaultTopic)):this.$set(i,"maxValue",100))},validate(){return this.currentSettings.items.length}},created(){this.$emit("update",this.currentSettings),this.$widgetBus.$on("add",this.addItem),this.$widgetBus.$on("edit",this.selectHandler)},destroyed(){this.$widgetBus.$off("add",this.addItem),this.$widgetBus.$off("edit",this.selectHandler)},watch:{currentSettings:{deep:!0,handler(t,e){if(this.$emit("validate",this.validate()),V()(t,e))return!1;this.$emit("update",t)}},"currentSettings.items":{deep:!0,handler(t){const e=t.reduce(((t,e)=>(e.minValueMode===vt["j"]&&t.push(e.minValue),e.maxValueMode===vt["j"]&&t.push(e.maxValue),t)),[]);this.$set(this.currentSettings,"topics",e)}}},mixins:[J],components:{Topic:_t}},Ii=ki,Vi=(i("fb4f"),Object(f["a"])(Ii,$i,Ci,!1,null,null,null)),Mi=Vi.exports;q()(Vi,"components",{QExpansionItem:Nt["a"],QItemSection:ut["a"],QBtn:pt["a"],QInput:y["a"],QSelect:ct["a"],QToggle:Se["a"]});var Oi={name:"MultiplierSchema",props:["widget","board"],data(){const t={type:"informer",groupLayout:0,widgetSettings:{},topics:[],nameField:"",math:"",height:8,width:5,maxTopicsLength:1,minWidth:1,minHeight:2,color:"grey"};return{defaultSettings:t,currentSettings:Object.assign({},t,this.widget.settings),typeOptions:[{label:"Text",value:"informer"},{label:"Toggle",value:"switcher"},{label:"Radial gauge",value:"radial"},{label:"Linear gauge",value:"linear"},{label:"Radio button",value:"singleselect"},{label:"Complex",value:"complex"}],colors:["grey","red","green","orange","blue","light-blue","purple","deep-orange","cyan","brown","blue-grey"]}},computed:{schemaWidget(){return this.updateTopics(),{name:"Multiplier",parentType:this.widget.type,color:this.currentSettings.color,type:this.currentSettings.type,topics:[],dataTopics:this.widget.dataTopics,settings:this.currentSettings.widgetSettings,status:vt["k"]}}},created(){this.$emit("update",this.currentSettings)},methods:{updateTopics(){this.$set(this.currentSettings,"topics",this.currentSettings.widgetSettings.topics)},updateSettingsHandler(t){m["default"].set(this.currentSettings,"widgetSettings",{}),m["default"].set(this.currentSettings,"widgetSettings",t)},setColor(t){m["default"].set(this.currentSettings,"color",t)},validateSchemas(t){this.$emit("validate",t)},setGroupLayer(t){this.$set(this.currentSettings,"groupLayout",t)}},watch:{currentSettings:{deep:!0,handler(t){this.$emit("update",t)}}},mixins:[J],components:{Switcher:we,Informer:Ve,Radial:ti,Linear:oi,Singleselect:qi,Complex:Mi}},Bi=Oi,Ei=Object(f["a"])(Bi,wi,Ti,!1,null,null,null),Ai=Ei.exports;q()(Ei,"components",{QInput:y["a"],QSelect:ct["a"],QIcon:x["a"]});var Fi=function(){var t=this,e=t._self._c;return e("div",[e("div",{staticClass:"row"},[e("q-toggle",{staticClass:"q-mt-sm col-12",attrs:{color:"grey-9",label:"Save last status on server (retained message)"},model:{value:t.currentSettings.save,callback:function(e){t.$set(t.currentSettings,"save",e)},expression:"currentSettings.save"}}),e("q-expansion-item",{staticClass:"col-12 q-mt-sm",staticStyle:{border:"solid #e0e0e0 1px"},attrs:{"default-opened":"",label:"Min value settings","header-class":["bg-"+(t.isValidMinValue?"grey-4":"red-2")]}},[e("div",{staticClass:"row q-pa-sm"},[e("div",{staticClass:"col-5 q-mb-sm"},[e("q-select",{attrs:{outlined:"",dense:"","hide-bottom-space":"",color:"grey-9","emit-value":"","map-options":"",label:"Min value source",options:t.rangeValueModeOptions},on:{input:function(e){return t.changeRangeValueTypeHandler("min")}},model:{value:t.currentSettings.minValueMode,callback:function(e){t.$set(t.currentSettings,"minValueMode",e)},expression:"currentSettings.minValueMode"}})],1),e("div",{staticClass:"col-12"},[0===t.currentSettings.minValueMode?e("q-input",{attrs:{outlined:"",dense:"","hide-bottom-space":"",type:"number",color:"grey-9",label:"Min value"},model:{value:t.currentSettings.minValue,callback:function(e){t.$set(t.currentSettings,"minValue",t._n(e))},expression:"currentSettings.minValue"}}):e("topic",{attrs:{label:"Min value",board:t.board,config:{needDefault:!0}},model:{value:t.minValue,callback:function(e){t.minValue=e},expression:"minValue"}})],1)])]),e("q-expansion-item",{staticClass:"col-12 q-my-sm",staticStyle:{border:"solid #e0e0e0 1px"},attrs:{"default-opened":"",label:"Max value settings","header-class":["bg-"+(t.isValidMaxValue?"grey-4":"red-2")]}},[e("div",{staticClass:"row q-pa-sm"},[e("div",{staticClass:"col-5 q-mb-sm"},[e("q-select",{attrs:{outlined:"",dense:"","hide-bottom-space":"",color:"grey-9","emit-value":"","map-options":"",label:"Max value source",options:t.rangeValueModeOptions},on:{input:function(e){return t.changeRangeValueTypeHandler("max")}},model:{value:t.currentSettings.maxValueMode,callback:function(e){t.$set(t.currentSettings,"maxValueMode",e)},expression:"currentSettings.maxValueMode"}})],1),e("div",{staticClass:"col-12"},[0===t.currentSettings.maxValueMode?e("q-input",{attrs:{outlined:"",dense:"","hide-bottom-space":"",type:"number",color:"grey-9",label:"Max value"},model:{value:t.currentSettings.maxValue,callback:function(e){t.$set(t.currentSettings,"maxValue",t._n(e))},expression:"currentSettings.maxValue"}}):e("topic",{attrs:{label:"Max value",board:t.board,config:{needDefault:!0}},model:{value:t.maxValue,callback:function(e){t.maxValue=e},expression:"maxValue"}})],1)])]),e("div",{staticClass:"col-6"},[e("q-input",{staticClass:"q-mr-sm",attrs:{outlined:"",dense:"","hide-bottom-space":"",type:"number",color:"grey-9",label:"Step"},model:{value:t.currentSettings.step,callback:function(e){t.$set(t.currentSettings,"step",t._n(e))},expression:"currentSettings.step"}})],1),e("div",{staticClass:"col-6"},[e("q-input",{staticClass:"q-mr-sm",attrs:{outlined:"",dense:"","hide-bottom-space":"",color:"grey-9",label:"Units"},model:{value:t.currentSettings.units,callback:function(e){t.$set(t.currentSettings,"units",e)},expression:"currentSettings.units"}})],1),e("div",{staticClass:"q-mt-sm col-12"},[e("q-toggle",{attrs:{color:"grey-9",label:"Show last update time"},model:{value:t.currentSettings.isNeedTime,callback:function(e){t.$set(t.currentSettings,"isNeedTime",e)},expression:"currentSettings.isNeedTime"}})],1)],1)])},Li=[],Ni={name:"SliderSchema",props:["widget","board"],data(){const t={minValue:0,topics:[],minValueMode:vt["i"],maxValue:250,maxValueMode:vt["i"],units:"",step:5,save:!0,height:2,width:3,maxTopicsLength:1,minWidth:3,minHeight:2,isNeedTime:!0};return{defaultSettings:t,currentSettings:Object.assign({},t,this.widget.settings),rangeValueModeOptions:[{label:"Manual",value:vt["i"]},{label:"Broker",value:vt["j"]}],defaultTopic:Object(bt["b"])()}},computed:{minValue:{get(){return this.currentSettings.minValueMode===vt["i"]?this.currentSettings.minValue:this.currentSettings.topics[0]},set(t){m["default"].set(this.currentSettings.topics,0,t)}},maxValue:{get(){return this.currentSettings.maxValueMode===vt["i"]?this.currentSettings.maxValue:this.currentSettings.minValueMode===vt["i"]?this.currentSettings.topics[0]:this.currentSettings.topics[1]},set(t){this.currentSettings.minValueMode===vt["i"]?m["default"].set(this.currentSettings.topics,0,t):m["default"].set(this.currentSettings.topics,1,t)}},isValidMinValue(){return this.currentSettings.minValueMode===vt["i"]||this.currentSettings.minValueMode===vt["j"]&&!this.widget.dataTopics.map((t=>t.topicFilter)).includes(this.minValue.topicFilter)&&this.maxValue.topicFilter!==this.minValue.topicFilter&&this.validateTopic(this.minValue.topicFilter)},isValidMaxValue(){return this.currentSettings.maxValueMode===vt["i"]||this.currentSettings.maxValueMode===vt["j"]&&!this.widget.dataTopics.map((t=>t.topicFilter)).includes(this.maxValue.topicFilter)&&this.maxValue.topicFilter!==this.minValue.topicFilter&&this.validateTopic(this.maxValue.topicFilter)}},methods:{changeRangeValueTypeHandler(t){const e=[];this.currentSettings.minValueMode===vt["j"]&&("max"===t?e.push(this.currentSettings.topics[0]):e.push(Object.assign({},this.defaultTopic))),this.currentSettings.maxValueMode===vt["j"]&&("min"===t?this.currentSettings.minValueMode===vt["j"]?e.push(this.currentSettings.topics[0]):e.push(this.currentSettings.topics[1]):e.push(Object.assign({},this.defaultTopic))),m["default"].set(this.currentSettings,"topics",e)},validate(){return this.isValidMinValue&&this.isValidMaxValue}},created(){this.$emit("update",this.currentSettings)},mixins:[J],components:{Topic:_t},watch:{widget:{deep:!0,handler(t,e){if(this.$emit("validate",this.validate()),V()(t,e))return!1;this.$emit("update",this.currentSettings)}}}},Di=Ni,Qi=Object(f["a"])(Di,Fi,Li,!1,null,null,null),Hi=Qi.exports;q()(Qi,"components",{QToggle:Se["a"],QExpansionItem:Nt["a"],QSelect:ct["a"],QInput:y["a"]});var Ri=function(){var t=this,e=t._self._c;return e("div",[e("div",{staticClass:"row"},[e("div",{staticClass:"col-12 q-mb-sm"},[e("q-btn-toggle",{attrs:{rounded:"","toggle-text-color":"grey-9","text-color":"grey-6",flat:"",options:t.modeOptions},model:{value:t.currentSettings.mode,callback:function(e){t.$set(t.currentSettings,"mode",e)},expression:"currentSettings.mode"}})],1),e("div",{staticClass:"col-12 q-mb-sm"},[e("q-select",{attrs:{dense:"",outlined:"","hide-bottom-space":"",color:"grey-9",label:"Format",options:t.formatOptions,"emit-value":"","map-options":""},model:{value:t.currentSettings.format,callback:function(e){t.$set(t.currentSettings,"format",e)},expression:"currentSettings.format"}})],1),e("div",{staticClass:"col-12 q-mb-sm"},[e("q-input",{attrs:{outlined:"",dense:"","hide-bottom-space":"",error:!t.isValueTemplateValide,hint:t.valueTemplateHelper,type:"textarea",color:"grey-9",label:"Value template"},model:{value:t.currentSettings.valueTemplate,callback:function(e){t.$set(t.currentSettings,"valueTemplate",e)},expression:"currentSettings.valueTemplate"}})],1),t.widget.dataTopics[0]&&t.widget.dataTopics[0].payloadType?e("div",{staticClass:"col-12 q-mb-sm"},[e("q-input",{attrs:{outlined:"","hide-bottom-space":"",dense:"",type:"textarea","input-style":"resize: none;",color:"grey-9",hint:"You can set publish template. %value% is variable of your color.",label:"Publish template"},model:{value:t.currentSettings.publishTemplate,callback:function(e){t.$set(t.currentSettings,"publishTemplate",e)},expression:"currentSettings.publishTemplate"}})],1):t._e(),e("q-toggle",{staticClass:"q-mt-sm col-12",attrs:{color:"grey-9",label:"Save last status on server (retained message)"},model:{value:t.currentSettings.save,callback:function(e){t.$set(t.currentSettings,"save",e)},expression:"currentSettings.save"}}),e("q-toggle",{staticClass:"q-mt-sm col-12",attrs:{color:"grey-9",label:"Show last update time"},model:{value:t.currentSettings.isNeedTime,callback:function(e){t.$set(t.currentSettings,"isNeedTime",e)},expression:"currentSettings.isNeedTime"}})],1)])},Pi=[];const zi="hexa",ji="rgba",Wi="hsva",Ui=0,Gi=1;var Yi={name:"ColorSchema",props:["widget","board"],data(){const t={publishTemplate:"",valueTemplate:"",format:zi,mode:Ui,save:!0,width:2,minWidth:2,height:6,minHeight:6,maxTopicsLength:1,isNeedTime:!0};return{defaultSettings:t,currentSettings:Object.assign({},t,this.widget.settings),modeOptions:[{label:"Simple",value:Ui},{label:"Advanced",value:Gi}],formatOptions:[{label:"HEX",value:zi},{label:"RGB",value:ji},{label:"HSV",value:Wi}]}},computed:{valueTemplateHelper(){let t="You can set a template of publish string. Variables to use in this case: ";switch(this.currentSettings.format){case zi:t+="%hex%.";break;case ji:t+="%r%, %g%, %b%, %a%.";break;case Wi:t+="%h%, %s%, %v%, %a%.";break}return t},isValueTemplateValide(){if(!this.currentSettings.valueTemplate)return!0;let t=this.currentSettings.valueTemplate.match(/%[hex|r|g|b|h|s|v|a]{1,3}%/g);if(!t)return!1;t=t.map((t=>t.slice(1,-1)));let e=!1;return this.currentSettings.format===zi?e=t.includes("hex")&&1===t.length:this.currentSettings.format===ji?e=t.reduce(((t,e)=>t&&["r","g","b","a"].includes(e)),!0)&&t.length>2&&t.length<5:this.currentSettings.format===Wi&&(e=t.reduce(((t,e)=>t&&["h","s","v","a"].includes(e)),!0)&&t.length>2&&t.length<5),e}},methods:{validate(){return this.isValueTemplateValide}},created(){this.$emit("update",this.currentSettings)},watch:{widget:{deep:!0,handler(t,e){if(this.$emit("validate",this.validate()),V()(t,e))return!1;this.$emit("update",this.currentSettings)}},"widget.dataTopics.0.payloadType"(t){t||(this.currentSettings.publishTemplate="")}}},Ji=Yi,Ki=Object(f["a"])(Ji,Ri,Pi,!1,null,null,null),Xi=Ki.exports;q()(Ki,"components",{QBtnToggle:lt["a"],QSelect:ct["a"],QInput:y["a"],QToggle:Se["a"]});var Zi=function(){var t=this,e=t._self._c;return e("div",[e("div",{staticClass:"row"},[e("div",{staticClass:"map__items-wrapper col-12 relative-position q-mb-sm"},[e("q-list",{attrs:{bordered:""}},[e("q-item-label",{staticClass:"q-py-md q-px-sm list__header",class:{"text-red-6":!t.currentSettings.items.length}},[t._v("\n          Items"+t._s(t.currentSettings.items.length?"":" are empty")+"\n          "),e("q-btn",{staticClass:"absolute-right",attrs:{color:"grey-9",flat:"",label:"ADD",icon:"mdi-plus"},on:{click:t.addItem}})],1),t._l(t.currentSettings.items,(function(i,s){return e("q-expansion-item",{key:`${s}${i.name}`,attrs:{group:"map-items","header-class":["bg-"+(t.isitemValid(s)?"grey-4":"red-2")],"expand-icon":"mdi-cog",value:s===t.currentSettings.items.length-1}},[e("template",{slot:"header"},[e("q-item-section",{attrs:{side:""}},[e("div",[e("q-btn",{staticClass:"col-1",attrs:{disabled:0===s,round:"",dense:"",flat:"",icon:"mdi-arrow-up"},on:{click:function(e){return e.stopPropagation(),t.upItem(s)}}}),e("q-btn",{staticClass:"col-1",attrs:{disabled:s===t.currentSettings.items.length-1,round:"",dense:"",flat:"",icon:"mdi-arrow-down"},on:{click:function(e){return e.stopPropagation(),t.downItem(s)}}})],1)]),e("q-item-section",[e("span",{staticClass:"ellipsis full-width"},[t._v(t._s(i.name||"New item"))])]),e("q-item-section",{attrs:{side:""}},[e("q-btn",{attrs:{flat:"",color:"red-6",round:"",dense:"",icon:"mdi-delete"},on:{click:function(e){return t.removeItem(s)}}})],1)],1),e("div",{staticClass:"row q-pa-sm"},[e("q-input",{staticClass:"full-width",attrs:{outlined:"",dense:"","hide-bottom-space":"",color:"grey-9",label:"Name",autofocus:""},model:{value:i.name,callback:function(e){t.$set(i,"name",e)},expression:"item.name"}}),e("q-expansion-item",{staticClass:"col-12 q-mt-sm",staticStyle:{border:"solid #e0e0e0 1px"},attrs:{"default-opened":"",label:"Latitude settings","header-class":["bg-"+(t.isValidLatValue(s)?"grey-4":"red-2")]}},[e("div",{staticClass:"row"},[e("div",{staticClass:"col-12 q-pa-xs"},[e("topic",{attrs:{label:"Latitude value",board:t.board,config:{needSelectors:!0}},on:{input:t.updateTopics},model:{value:i.lat,callback:function(e){t.$set(i,"lat",e)},expression:"item.lat"}})],1)])]),e("q-expansion-item",{staticClass:"col-12 q-mt-sm",staticStyle:{border:"solid #e0e0e0 1px"},attrs:{"default-opened":"",label:"Longitude settings","header-class":["bg-"+(t.isValidLonValue(s)?"grey-4":"red-2")]}},[e("div",{staticClass:"row"},[e("div",{staticClass:"col-12 q-pa-xs"},[e("topic",{attrs:{label:"Longitude value",board:t.board,config:{needSelectors:!0}},on:{input:t.updateTopics},model:{value:i.lon,callback:function(e){t.$set(i,"lon",e)},expression:"item.lon"}})],1)])])],1)],2)}))],2)],1),e("div",{staticClass:"q-mt-sm col-12"},[e("q-toggle",{attrs:{color:"grey-9",label:"Show last update time"},model:{value:t.currentSettings.isNeedTime,callback:function(e){t.$set(t.currentSettings,"isNeedTime",e)},expression:"currentSettings.isNeedTime"}})],1)])])},ts=[],es={name:"MapLocationSchema",props:["widget","board"],data(){const t={topics:[],items:[],height:6,width:3,maxTopicsLength:0,minWidth:3,minHeight:6,isNeedTime:!0},e=Object(bt["b"])();return{defaultSettings:t,currentSettings:Object.assign({},t,this.widget.settings),defaultTopic:e,defaultItem:{name:"",lat:Object(bt["b"])({topicFilter:"topic/to/lat",topicTemplate:"topic/to/lat"}),lon:Object(bt["b"])({topicFilter:"topic/to/lon",topicTemplate:"topic/to/lon"})}}},methods:{addItem(){this.currentSettings.items.push(F()(this.defaultItem)),this.updateTopics()},removeItem(t){this.$delete(this.currentSettings.items,t),this.updateTopics()},upItem(t){const e=this.currentSettings.items.splice(t,1)[0];this.currentSettings.items.splice(t-1,0,e)},downItem(t){const e=this.currentSettings.items.splice(t,1)[0];this.currentSettings.items.splice(t+1,0,e)},updateTopics(){this.$set(this.currentSettings,"topics",this.currentSettings.items.reduce(((t,e)=>(t.push(e.lat),t.push(e.lon),t)),[]))},isitemValid(t){const e=this.currentSettings.items[t];return!(this.currentSettings.items.filter((t=>t.name===e.name)).length>1)},isValidLatValue(t){const e=R()(this.currentSettings,`items[${t}].lat.topicFilter`,"#/");return!this.widget.dataTopics.map((t=>t.topicFilter)).includes(e)&&this.validateTopic(e)},isValidLonValue(t){const e=R()(this.currentSettings,`items[${t}].lon.topicFilter`,"#/");return!this.widget.dataTopics.map((t=>t.topicFilter)).includes(e)&&this.validateTopic(e)},validate(){return this.currentSettings.items.reduce(((t,e,i)=>(t=t&&this.isitemValid(i),t=t&&this.isValidLatValue(i),t=t&&this.isValidLonValue(i),t)),!0)}},created(){this.$emit("update",this.currentSettings)},mixins:[J],components:{Topic:_t},watch:{widget:{deep:!0,handler(t,e){if(this.$emit("validate",this.validate()),V()(t,e))return!1;this.$emit("update",this.currentSettings)}}}},is=es,ss=(i("a699"),Object(f["a"])(is,Zi,ts,!1,null,null,null)),as=ss.exports;q()(ss,"components",{QList:Lt["a"],QItemLabel:mt["a"],QBtn:pt["a"],QExpansionItem:Nt["a"],QItemSection:ut["a"],QInput:y["a"],QToggle:Se["a"]});var ns=function(){var t=this,e=t._self._c;return e("div",[e("div",{staticClass:"row"},[e("div",{staticClass:"map__items-wrapper col-12 relative-position q-mb-sm"},[e("q-list",{attrs:{bordered:""}},[e("q-item-label",{staticClass:"q-py-md q-px-sm list__header",class:{"text-red-6":!t.currentSettings.items.length}},[t._v("\n          Items"+t._s(t.currentSettings.items.length?"":" are empty")+"\n          "),e("q-btn",{staticClass:"absolute-right",attrs:{color:"grey-9",flat:"",label:"ADD",icon:"mdi-plus"},on:{click:t.addItem}})],1),t._l(t.currentSettings.items,(function(i,s){return e("q-expansion-item",{key:`${s}${i.name}`,attrs:{group:"map-items","header-class":["bg-"+(t.isitemValid(s)?"grey-4":"red-2")],"expand-icon":"mdi-cog",value:s===t.currentSettings.items.length-1}},[e("template",{slot:"header"},[e("q-item-section",{attrs:{side:""}},[e("div",[e("q-btn",{staticClass:"col-1",attrs:{disabled:0===s,round:"",dense:"",flat:"",icon:"mdi-arrow-up"},on:{click:function(e){return e.stopPropagation(),t.upItem(s)}}}),e("q-btn",{staticClass:"col-1",attrs:{disabled:s===t.currentSettings.items.length-1,round:"",dense:"",flat:"",icon:"mdi-arrow-down"},on:{click:function(e){return e.stopPropagation(),t.downItem(s)}}})],1)]),e("q-item-section",[e("span",{staticClass:"ellipsis full-width"},[t._v(t._s(i.name||"New item"))])]),e("q-item-section",{attrs:{side:""}},[e("q-btn",{attrs:{flat:"",color:"red-6",round:"",dense:"",icon:"mdi-delete"},on:{click:function(e){return t.removeItem(s)}}})],1)],1),e("div",{staticClass:"row q-pa-sm"},[e("q-input",{staticClass:"full-width",attrs:{outlined:"",dense:"","hide-bottom-space":"",color:"grey-9",label:"Name",autofocus:""},model:{value:i.name,callback:function(e){t.$set(i,"name",e)},expression:"item.name"}}),e("q-expansion-item",{staticClass:"col-12 q-mt-sm",staticStyle:{border:"solid #e0e0e0 1px"},attrs:{"default-opened":"",label:"Route settings","header-class":["bg-"+(t.isValidRouteValue(s)?"grey-4":"red-2")]}},[e("div",{staticClass:"row"},[e("div",{staticClass:"col-12 q-pa-xs"},[e("topic",{attrs:{label:"Route value",board:t.board,config:{needSelectors:!0}},on:{input:t.updateTopics},model:{value:i.route,callback:function(e){t.$set(i,"route",e)},expression:"item.route"}})],1)])])],1)],2)}))],2)],1),e("div",{staticClass:"q-mt-sm col-12"},[e("q-toggle",{attrs:{color:"grey-9",label:"Show last update time"},model:{value:t.currentSettings.isNeedTime,callback:function(e){t.$set(t.currentSettings,"isNeedTime",e)},expression:"currentSettings.isNeedTime"}})],1)])])},os=[],rs={name:"MapRouteSchema",props:["widget","board"],data(){const t={topics:[],items:[],height:6,width:3,maxTopicsLength:0,minWidth:3,minHeight:6,isNeedTime:!0};return{defaultSettings:t,currentSettings:Object.assign({},t,this.widget.settings),defaultTopic:{topicFilter:"",payloadType:0,payloadField:""},defaultItem:{name:"",route:Object(bt["b"])({topicFilter:"topic/to/route",topicTemplate:"topic/to/route"})}}},methods:{addItem(){this.currentSettings.items.push(F()(this.defaultItem)),this.updateTopics()},removeItem(t){this.$delete(this.currentSettings.items,t),this.updateTopics()},upItem(t){const e=this.currentSettings.items.splice(t,1)[0];this.currentSettings.items.splice(t-1,0,e)},downItem(t){const e=this.currentSettings.items.splice(t,1)[0];this.currentSettings.items.splice(t+1,0,e)},updateTopics(){this.$set(this.currentSettings,"topics",this.currentSettings.items.reduce(((t,e)=>(t.push(e.route),t)),[]))},isitemValid(t){const e=this.currentSettings.items[t];return!(this.currentSettings.items.filter((t=>t.name===e.name)).length>1)},isValidRouteValue(t){const e=R()(this.currentSettings,`items[${t}].route.topicFilter`,"#/");return!this.widget.dataTopics.map((t=>t.topicFilter)).includes(e)&&this.validateTopic(e)},validate(){return this.currentSettings.items.reduce(((t,e,i)=>(t=t&&this.isitemValid(i),t=t&&this.isValidRouteValue(i),t)),!0)}},created(){this.$emit("update",this.currentSettings)},mixins:[J],components:{Topic:_t},watch:{widget:{deep:!0,handler(t,e){if(this.$emit("validate",this.validate()),V()(t,e))return!1;this.$emit("update",this.currentSettings)}}}},ls=rs,cs=(i("152c"),Object(f["a"])(ls,ns,os,!1,null,null,null)),ds=cs.exports;q()(cs,"components",{QList:Lt["a"],QItemLabel:mt["a"],QBtn:pt["a"],QExpansionItem:Nt["a"],QItemSection:ut["a"],QInput:y["a"],QToggle:Se["a"]});var us=function(){var t=this,e=t._self._c;return e("div",[e("div",{staticClass:"row"},[e("div",{staticClass:"col-xs-12 q-mb-sm"},[e("q-input",{attrs:{outlined:"",dense:"","hide-bottom-space":"",color:"grey-9",label:"Default icon",error:!t.currentSettings.defaultIcon},model:{value:t.currentSettings.defaultIcon,callback:function(e){t.$set(t.currentSettings,"defaultIcon",e)},expression:"currentSettings.defaultIcon"}},[e("q-icon",{attrs:{slot:"append",name:`mdi-${t.currentSettings.defaultIcon}`,size:"1.5rem"},slot:"append"})],1)],1),e("q-input",{staticClass:"col-12",attrs:{outlined:"",dense:"","hide-bottom-space":"",color:"grey-9",label:"Math expression",placeholder:"%value%"},model:{value:t.currentSettings.math,callback:function(e){t.$set(t.currentSettings,"math",e)},expression:"currentSettings.math"}}),e("div",{staticClass:"text-grey-9",staticStyle:{"font-size":".8rem"}},[t._v("You can use math expressions to calculate the final value. Example: (%value% * 1000) / 1024, where %value% is the payload from your subscription.")]),e("div",{staticClass:"status-indicator__items-wrapper col-12 relative-position q-mb-sm q-mt-lg"},[e("q-list",{attrs:{bordered:""}},[e("q-item-label",{staticClass:"q-py-md q-px-sm list__header",class:{"text-red-6":!t.currentSettings.items.length}},[t._v("\n          Items"+t._s(t.currentSettings.items.length?"":" are empty")+"\n          "),e("q-btn",{staticClass:"absolute-right",attrs:{color:"grey-9",flat:"",label:"ADD",icon:"mdi-plus"},on:{click:t.addItem}})],1),t._l(t.currentSettings.items,(function(i,s){return e("q-expansion-item",{key:`${s}${i.value}`,attrs:{group:"status-indicator-items","header-class":["bg-"+(t.checkUniqueItem(i,s)&&i.actionTopic?"grey-4":"red-2")],"expand-icon":"mdi-cog",value:s===t.currentSettings.items.length-1}},[e("template",{slot:"header"},[e("q-item-section",{attrs:{side:""}},[e("div",[e("q-btn",{staticClass:"col-1",attrs:{disabled:0===s,round:"",dense:"",flat:"",icon:"mdi-arrow-up"},on:{click:function(e){return e.stopPropagation(),t.upItem(s)}}}),e("q-btn",{staticClass:"col-1",attrs:{disabled:s===t.currentSettings.items.length-1,round:"",dense:"",flat:"",icon:"mdi-arrow-down"},on:{click:function(e){return e.stopPropagation(),t.downItem(s)}}})],1)]),e("q-item-section",[e("span",{staticClass:"ellipsis full-width"},[t._v(t._s(t.getItemLabel(i,s)))])]),i.default?t._e():e("q-item-section",{attrs:{side:""}},[e("q-btn",{attrs:{flat:"",color:"red-6",round:"",dense:"",icon:"mdi-delete"},on:{click:function(e){return t.removeItem(s)}}})],1)],1),e("div",{staticClass:"row q-pa-sm"},[i.default?e("div",{staticClass:"col-12 text-grey-8 q-mt-sm",staticStyle:{"font-size":".9rem"}},[t._v("\n              Default item. Used if there is no data in the source or data doesn't match the specified items.\n            ")]):t._e(),e("div",{staticClass:"q-mb-sm",class:["col-"+(i.default?"12":"6")]},[e("q-input",{staticClass:"q-mr-xs",attrs:{outlined:"",dense:"","hide-bottom-space":"",autofocus:"",color:"grey-9",label:"Label"},model:{value:i.label,callback:function(e){t.$set(i,"label",e)},expression:"item.label"}})],1),i.default?t._e():e("div",{staticClass:"col-6"},[e("typed-input",{staticClass:"q-ml-xs",attrs:{settings:{label:"Value",error:!t.checkUniqueItem(i,s)}},model:{value:i.val,callback:function(e){t.$set(i,"val",e)},expression:"item.val"}})],1),e("div",{staticClass:"col-12 q-mb-sm"},[e("q-input",{staticClass:"q-mr-xs",style:{color:i.color},attrs:{outlined:"",dense:"","hide-bottom-space":"",color:"grey-9",label:"Icon"},model:{value:i.icon,callback:function(e){t.$set(i,"icon",e)},expression:"item.icon"}},[e("q-icon",{style:{color:i.color},attrs:{slot:"append",name:`mdi-${i.icon||t.currentSettings.defaultIcon}`,size:"1.5rem"},slot:"append"}),e("q-btn",{style:{backgroundColor:i.color},attrs:{slot:"after",flat:""},slot:"after"},[e("q-menu",{staticClass:"q-pa-sm",attrs:{anchor:"top right",self:"bottom right"}},[e("q-color",{attrs:{"format-model":"hex"},model:{value:i.color,callback:function(e){t.$set(i,"color",e)},expression:"item.color"}})],1)],1)],1)],1),i.default?e("div",{staticClass:"col-12 text-grey-6 q-mt-sm",staticStyle:{"font-size":".8rem"}},[t._v("\n              You can find more icons on "),e("a",{attrs:{href:"https://materialdesignicons.com/",target:"blank"}},[t._v("MDI")])]):t._e(),i.default?t._e():e("q-input",{staticClass:"col-12",attrs:{outlined:"",dense:"","hide-bottom-space":"",color:"grey-9",label:"Math expression",placeholder:"%value%",error:!t.checkUniqueItem(i,s)},model:{value:i.math,callback:function(e){t.$set(i,"math",e)},expression:"item.math"}}),i.default?t._e():e("div",{staticClass:"text-grey-9",staticStyle:{"font-size":".8rem"}},[t._v("You can use math expressions to calculate the final value. Example: (%value% * 1000) / 1024, where %value% is the payload from your subscription.")]),1===t.currentSettings.mode?e("div",{staticClass:"col-6"},[e("q-input",{staticClass:"q-mr-xs",attrs:{outlined:"",dense:"","hide-bottom-space":"",color:"grey-9",label:"Action topic",error:!i.actionTopic},model:{value:i.actionTopic,callback:function(e){t.$set(i,"actionTopic",e)},expression:"item.actionTopic"}})],1):t._e(),1===t.currentSettings.mode?e("div",{staticClass:"col-6"},[e("q-input",{staticClass:"q-ml-xs",attrs:{outlined:"",dense:"","hide-bottom-space":"",color:"grey-9",label:"Action payload"},model:{value:i.actionPayload,callback:function(e){t.$set(i,"actionPayload",e)},expression:"item.actionPayload"}})],1):t._e()],1)],2)}))],2)],1),e("q-input",{staticClass:"col-12",attrs:{outlined:"",dense:"","hide-bottom-space":"",color:"grey-9",type:"number",label:"Reset timeout, s"},model:{value:t.currentSettings.resetTimeout,callback:function(e){t.$set(t.currentSettings,"resetTimeout",t._n(e))},expression:"currentSettings.resetTimeout"}}),e("q-toggle",{staticClass:"q-mt-sm col-12",attrs:{color:"grey-9",label:"Show labels with icons"},model:{value:t.currentSettings.isNeedShowTitles,callback:function(e){t.$set(t.currentSettings,"isNeedShowTitles",e)},expression:"currentSettings.isNeedShowTitles"}}),e("q-toggle",{staticClass:"q-mt-sm col-12",attrs:{color:"grey-9",label:"Show last update time"},model:{value:t.currentSettings.isNeedTime,callback:function(e){t.$set(t.currentSettings,"isNeedTime",e)},expression:"currentSettings.isNeedTime"}})],1)])},ps=[];const ms=0,hs=1;var gs={name:"StatusIndicatorSchema",props:["widget","board"],data(){const t={label:"item",icon:"",color:"#9e9e9e",val:"",actionTopic:"topic/to/action",actionPayload:""},e={items:[{label:"default",icon:"",color:"#9e9e9e",math:"",val:"",default:!0,actionTopic:"topic/to/action",actionPayload:""}],save:!0,mode:ms,math:"",defaultIcon:"circle",resetTimeout:0,height:2,width:1,maxTopicsLength:1,minWidth:1,minHeight:2,isNeedShowTitles:!1,isNeedTime:!0};return{defaultSettings:e,defaultItem:t,currentItem:Object.assign({},t),currentSettings:Object.assign({},e,this.widget.settings),modeOptions:[{label:"Default mode",value:ms},{label:"Command mode",value:hs}]}},methods:{addItem(){this.currentSettings.items.push(this.currentItem),this.currentItem=Object.assign({},this.defaultItem)},removeItem(t){this.$delete(this.currentSettings.items,t)},upItem(t){const e=this.currentSettings.items.splice(t,1)[0];this.currentSettings.items.splice(t-1,0,e)},downItem(t){const e=this.currentSettings.items.splice(t,1)[0];this.currentSettings.items.splice(t+1,0,e)},checkUniqueItem(t,e){let i=!0;return this.currentSettings.items.some(((s,a)=>{const n=s.val===t.val,o=s.math===t.math;return n&&o&&(i=a===e),n})),i},validate(){return!!this.currentSettings.defaultIcon&&(this.currentSettings.mode===ms||this.currentSettings.mode===hs&&this.currentSettings.items.reduce(((t,e)=>t&&!!e.actionTopic),!0))&&!!this.currentSettings.items.length&&this.currentSettings.items.reduce(((t,e,i,s)=>{const a=`${e.val} - ${e.math}`;return t[a]||(t[a]=0),t[a]++,i===s.length-1?Object.keys(t).reduce(((e,i)=>e?1===t[i]:e),!0):t}),{})},getItemLabel(t,e){let i="";return t.label?(i+=`${t.label} `,t.default||(i+=`[${void 0===t.val?"N/A":t.val}]`)):i=`${void 0===t.val?`item ${e+1}`:t.val}`,i}},created(){this.$emit("update",this.currentSettings)},watch:{currentSettings:{deep:!0,handler(t,e){if(this.$emit("validate",this.validate()),V()(t,e))return!1;this.$emit("update",t)}}}},bs=gs,vs=(i("1975"),Object(f["a"])(bs,us,ps,!1,null,null,null)),fs=vs.exports;q()(vs,"components",{QInput:y["a"],QIcon:x["a"],QList:Lt["a"],QItemLabel:mt["a"],QBtn:pt["a"],QExpansionItem:Nt["a"],QItemSection:ut["a"],QMenu:ae["a"],QColor:_e["a"],QToggle:Se["a"]});var ys=function(){var t=this,e=t._self._c;return e("div",[e("div",{staticClass:"row"},[e("q-toggle",{staticClass:"q-mt-sm",attrs:{color:"grey-9",label:"Save last status on server (retained message)"},model:{value:t.currentSettings.save,callback:function(e){t.$set(t.currentSettings,"save",e)},expression:"currentSettings.save"}}),e("div",{staticClass:"col-12 q-mt-sm"},[e("q-input",{staticClass:"q-mr-sm",attrs:{dense:"",outlined:"","hide-bottom-space":"",color:"grey-9",label:"Topic"},on:{input:function(e){t.currentSettings.topics[0].topicFilter=t.currentSettings.topics[0].topicTemplate}},model:{value:t.currentSettings.topics[0].topicTemplate,callback:function(e){t.$set(t.currentSettings.topics[0],"topicTemplate",e)},expression:"currentSettings.topics[0].topicTemplate"}}),t.board.settings.variables&&t.board.settings.variables.length?e("variables-helper",{attrs:{variables:t.board.settings.variables},on:{add:e=>t.currentSettings.topics[0].topicTemplate+=e}}):t._e()],1),e("div",{staticClass:"q-mt-sm col-12"},[e("q-toggle",{attrs:{color:"grey-9",label:"Show last update time"},model:{value:t.currentSettings.isNeedTime,callback:function(e){t.$set(t.currentSettings,"isNeedTime",e)},expression:"currentSettings.isNeedTime"}})],1)],1)])},xs=[],Ss={name:"TextSenderSchema",props:["widget","board"],data(){const t={height:2,topics:[Object(bt["b"])({topicFilter:"topic/to/data",topicTemplate:"topic/to/data"})],width:2,minWidth:1,minHeight:2,maxTopicsLength:0,isNeedTime:!0,save:!0};return{defaultSettings:t,currentSettings:Object.assign({},t,this.widget.settings)}},created(){this.$emit("update",this.currentSettings)},watch:{currentSettings:{deep:!0,handler(t){this.$emit("update",t)}}},components:{VariablesHelper:it}},_s=Ss,qs=Object(f["a"])(_s,ys,xs,!1,null,null,null),ws=qs.exports;q()(qs,"components",{QToggle:Se["a"],QInput:y["a"]});var Ts=function(){var t=this,e=t._self._c;return e("div",[e("div",{staticClass:"row q-mt-lg"},[e("div",{staticClass:"calculator__items-wrapper col-12 relative-position q-mb-sm"},[e("q-list",{attrs:{bordered:""}},[e("q-item-label",{staticClass:"q-py-md q-px-sm list__header",class:{"text-red-6":!t.currentSettings.variables.length}},[t._v("\n          Variables"+t._s(t.currentSettings.variables.length?"":" are empty")+"\n           "),e("q-btn",{staticClass:"absolute-right",attrs:{color:"grey-9",icon:"mdi-plus",flat:"",label:"ADD"},on:{click:t.addItem}})],1),t._l(t.currentSettings.variables,(function(i,s){return e("q-expansion-item",{key:`${s}`,attrs:{group:"variables","header-class":[t.isitemValid(s)?"bg-purple-2":"bg-red-2"],"expand-icon":"mdi-cog",value:s===t.currentSettings.variables.length-1}},[e("template",{slot:"header"},[e("q-item-section",{attrs:{side:""}},[e("div",[e("q-btn",{staticClass:"col-1",attrs:{disabled:0===s,round:"",dense:"",flat:"",icon:"mdi-arrow-up"},on:{click:function(e){return e.stopPropagation(),t.upItem(s)}}}),e("q-btn",{staticClass:"col-1",attrs:{disabled:s===t.currentSettings.variables.length-1,round:"",dense:"",flat:"",icon:"mdi-arrow-down"},on:{click:function(e){return e.stopPropagation(),t.downItem(s)}}})],1)]),e("q-item-section",[e("span",{staticClass:"ellipsis full-width"},[t._v(t._s(i.name||"New item"))])]),e("q-item-section",{attrs:{side:""}},[e("q-btn",{attrs:{flat:"",color:"red-6",round:"",dense:"",icon:"mdi-delete"},on:{click:function(e){return t.removeItem(s)}}})],1)],1),e("div",{staticClass:"row q-pa-sm"},[e("q-input",{staticClass:"col-12 q-mb-xs",attrs:{outlined:"",dense:"","hide-bottom-space":"",color:"grey-9",label:"Name",autofocus:""},model:{value:i.name,callback:function(e){t.$set(i,"name",e)},expression:"item.name"}}),e("q-input",{staticClass:"col-8 q-pr-xs q-mb-sm",attrs:{outlined:"",dense:"","hide-bottom-space":"",color:"grey-9",label:"Math expression"},model:{value:i.math,callback:function(e){t.$set(i,"math",e)},expression:"item.math"}}),e("q-select",{staticClass:"col-4 q-mb-sm",attrs:{outlined:"",dense:"","hide-bottom-space":"",color:"grey-9",options:t.formatOptions,"emit-value":"","map-options":"",label:"Format value as"},model:{value:i.valueFormat,callback:function(e){t.$set(i,"valueFormat",e)},expression:"item.valueFormat"}}),i.valueFormat===t.constants.WIDGET_VALUE_FORMAT_DATE?e("q-input",{staticClass:"col-12 q-mb-xs",attrs:{outlined:"",dense:"","hide-bottom-space":"",color:"grey-9",label:"Datetime format",placeholder:"DD/MM/YYYY HH:mm:ss.SSS"},model:{value:i.dateFormat,callback:function(e){t.$set(i,"dateFormat",e)},expression:"item.dateFormat"}}):t._e(),e("div",{staticClass:"col-12 text-grey-7 q-px-sm q-mb-sm",staticStyle:{"font-size":"12px","line-height":"1.2"}},[t._v("\n              You can use math expressions to calculate the final value. Example:\n              (%topic[1]% - %variable[var1]% * 1000) / 1024, where %topic1% is the payload from your subscription by first topic (if need field from JSON %topic[1]($.somefield)%), %variable[var1]% is calculated value of variable with name var1.\n            ")])],1)],2)}))],2)],1),e("q-input",{staticClass:"col-8 q-mb-sm full-width",attrs:{type:"textarea",outlined:"",dense:"","hide-bottom-space":"",color:"grey-9",label:"Template"},model:{value:t.currentSettings.template,callback:function(e){t.$set(t.currentSettings,"template",e)},expression:"currentSettings.template"}}),e("div",{staticClass:"col-12 text-grey-7 q-px-sm q-mb-sm",staticStyle:{"font-size":"12px","line-height":"1.2"}},[t._v("\n      Create final message html template. Example:\n      By topic with value %topic[1]% data is %variable[var1]%, where %topic1% is the payload from your subscription by first topic (if need field from JSON %topic[1]($.somefield)%),\n      %variable[var1]% is calculated value of variable with name var1.\n    ")]),e("div",{staticClass:"q-mt-sm col-12"},[e("q-toggle",{attrs:{color:"grey-9",label:"Show last update time"},model:{value:t.currentSettings.isNeedTime,callback:function(e){t.$set(t.currentSettings,"isNeedTime",e)},expression:"currentSettings.isNeedTime"}})],1)],1)])},$s=[],Cs={name:"CalculatorSchema",props:["widget","board"],data(){const t={variables:[],height:2,width:2,minWidth:1,minHeight:2,template:"",isNeedTime:!0},e={name:"",math:"",valueFormat:0};return{defaultSettings:t,defaultVar:e,constants:{WIDGET_VALUE_FORMAT_STRING:vt["s"],WIDGET_VALUE_FORMAT_HUMAN_READABLE_SIZE:vt["o"],WIDGET_VALUE_FORMAT_DATE:vt["m"],WIDGET_VALUE_FORMAT_PRE:vt["r"],WIDGET_VALUE_FORMAT_MARKDOWN:vt["q"],WIDGET_VALUE_FORMAT_JSON:vt["p"],WIDGET_VALUE_FORMAT_DURATION:vt["n"]},currentSettings:Object.assign({},t,this.widget.settings),formatOptions:[{label:"String",value:vt["s"]},{label:"Human readable size, B",value:vt["o"]},{label:"Datetime, s",value:vt["m"]},{label:"Duration, s",value:vt["n"]},{label:"Preformated",value:vt["r"]},{label:"Markdown",value:vt["q"]},{label:"JSON",value:vt["p"]}]}},methods:{addItem(){this.currentSettings.variables.push(F()(this.defaultVar))},removeItem(t){this.$delete(this.currentSettings.variables,t)},upItem(t){const e=this.currentSettings.variables.splice(t,1)[0];this.currentSettings.variables.splice(t-1,0,e)},downItem(t){const e=this.currentSettings.variables.splice(t,1)[0];this.currentSettings.variables.splice(t+1,0,e)},isitemValid(t){const e=this.currentSettings.variables[t];return!(this.currentSettings.variables.filter((t=>t.name===e.name)).length>1)},validate(){return this.currentSettings.variables.reduce(((t,e,i)=>(t=t&&this.isitemValid(i),t)),!0)}},created(){this.$emit("update",this.currentSettings)},mixins:[J],watch:{widget:{deep:!0,handler(t,e){if(this.$emit("validate",this.validate()),V()(t,e))return!1;this.$emit("update",t)}}}},ks=Cs,Is=(i("e7e0"),Object(f["a"])(ks,Ts,$s,!1,null,null,null)),Vs=Is.exports;q()(Is,"components",{QList:Lt["a"],QItemLabel:mt["a"],QBtn:pt["a"],QExpansionItem:Nt["a"],QItemSection:ut["a"],QInput:y["a"],QSelect:ct["a"],QToggle:Se["a"]});var Ms=function(){var t=this,e=t._self._c;return e("div",[e("div",{staticClass:"row"},[e("div",{staticClass:"col-12 relative-position q-mb-sm"},[e("q-slide-transition",[t.activeItem?e("div",[e("q-input",{staticClass:"col-8 q-my-sm",attrs:{outlined:"",dense:"","hide-bottom-space":"",color:"grey-9",label:"Label"},model:{value:t.activeItem.label,callback:function(e){t.$set(t.activeItem,"label",e)},expression:"activeItem.label"}}),e(`${t.activeItem.type}-schema`,{key:t.activeItemIndex+t.activeItem.type,tag:"component",attrs:{settings:t.activeItem,board:t.board},on:{update:e=>t.updateItem(e,t.activeItemIndex)}})],1):t._e()])],1),e("div",{staticClass:"col-12"},[e("q-toggle",{attrs:{color:"grey-9",label:"Show last update time"},model:{value:t.currentSettings.isNeedTime,callback:function(e){t.$set(t.currentSettings,"isNeedTime",e)},expression:"currentSettings.isNeedTime"}})],1)])])},Os=[],Bs=function(){var t=this,e=t._self._c;return e("div",{staticClass:"row"},[e("topic",{staticClass:"col-12 q-mb-sm",attrs:{board:t.board,config:{needSelectors:!0,needDefault:!0}},model:{value:t.current.topic,callback:function(e){t.$set(t.current,"topic",e)},expression:"current.topic"}}),e("div",{staticClass:"col-6 q-mb-sm"},[e("q-input",{staticClass:"q-mr-sm",attrs:{outlined:"",dense:"","hide-bottom-space":"",color:"grey-9",label:"Prefix"},model:{value:t.current.settings.prefix,callback:function(e){t.$set(t.current.settings,"prefix",e)},expression:"current.settings.prefix"}})],1),e("div",{staticClass:"col-6"},[e("q-input",{staticClass:"q-ml-sm",attrs:{outlined:"",dense:"","hide-bottom-space":"",color:"grey-9",label:"Postfix"},model:{value:t.current.settings.postfix,callback:function(e){t.$set(t.current.settings,"postfix",e)},expression:"current.settings.postfix"}})],1),e("q-select",{staticClass:"col-12 q-mb-sm",attrs:{"emit-value":"","map-options":"",outlined:"",dense:"","hide-bottom-space":"",color:"grey-9","use-chips":"",multiple:"",options:t.modificatorsOptions,label:"Text style"},scopedSlots:t._u([{key:"option",fn:function(i){return[e("q-item",t._g(t._b({},"q-item",i.itemProps,!1),i.itemEvents),[e("q-item-section",[e("q-item-label",{class:[`text-${i.opt.value}`]},[t._v(t._s(i.opt.label))])],1)],1)]}}]),model:{value:t.current.settings.modificators,callback:function(e){t.$set(t.current.settings,"modificators",e)},expression:"current.settings.modificators"}},[e("q-btn",{style:{backgroundColor:t.current.settings.color},attrs:{slot:"after",flat:""},slot:"after"},[e("q-menu",{staticClass:"q-pa-sm",attrs:{anchor:"top right",self:"bottom right"}},[e("q-color",{attrs:{"format-model":"hex"},model:{value:t.current.settings.color,callback:function(e){t.$set(t.current.settings,"color",e)},expression:"current.settings.color"}})],1)],1)],1),e("q-input",{staticClass:"col-8 q-pr-xs q-mb-sm",attrs:{outlined:"",dense:"","hide-bottom-space":"",color:"grey-9",label:"Math expression",placeholder:"%value%"},model:{value:t.current.settings.math,callback:function(e){t.$set(t.current.settings,"math",e)},expression:"current.settings.math"}}),e("q-select",{staticClass:"col-4 q-mb-sm",attrs:{outlined:"",dense:"","hide-bottom-space":"",color:"grey-9",options:t.formatOptions,"emit-value":"","map-options":"",label:"Format value as"},model:{value:t.current.settings.valueFormat,callback:function(e){t.$set(t.current.settings,"valueFormat",e)},expression:"current.settings.valueFormat"}}),t.current.settings.valueFormat===t.constants.WIDGET_VALUE_FORMAT_DATE?e("q-input",{staticClass:"col-12 q-mb-xs",attrs:{outlined:"",dense:"","hide-bottom-space":"",color:"grey-9",label:"Datetime format",placeholder:"DD/MM/YYYY HH:mm:ss.SSS"},model:{value:t.current.settings.dateFormat,callback:function(e){t.$set(t.current.settings,"dateFormat",e)},expression:"current.settings.dateFormat"}}):t._e(),e("div",{staticClass:"col-12 text-grey-7 q-px-sm q-mb-sm",staticStyle:{"font-size":"12px","line-height":"1"}},[t._v("You can use math expressions to calculate the final value. Example: (%value% * 1000) / 1024, where %value% is the payload from your subscription.")]),e("q-checkbox",{staticClass:"q-mb-sm",attrs:{label:"Need autoresize text",color:"grey-9"},model:{value:t.current.settings.autoresize,callback:function(e){t.$set(t.current.settings,"autoresize",e)},expression:"current.settings.autoresize"}}),t.current.settings.autoresize?t._e():e("q-input",{staticClass:"q-mb-sm col-12",attrs:{outlined:"",dense:"","hide-bottom-space":"",color:"grey-9",label:"Text styles"},model:{value:t.current.settings.style,callback:function(e){t.$set(t.current.settings,"style",e)},expression:"current.settings.style"}})],1)},Es=[],As={props:["settings","board"],data(){return{constants:{WIDGET_VALUE_FORMAT_STRING:vt["s"],WIDGET_VALUE_FORMAT_HUMAN_READABLE_SIZE:vt["o"],WIDGET_VALUE_FORMAT_DATE:vt["m"],WIDGET_VALUE_FORMAT_PRE:vt["r"],WIDGET_VALUE_FORMAT_MARKDOWN:vt["q"],WIDGET_VALUE_FORMAT_JSON:vt["p"],WIDGET_VALUE_FORMAT_DURATION:vt["n"]},formatOptions:[{label:"String",value:vt["s"]},{label:"Human readable size, B",value:vt["o"]},{label:"Datetime, s",value:vt["m"]},{label:"Duration, s",value:vt["n"]},{label:"Preformated",value:vt["r"]},{label:"Markdown",value:vt["q"]},{label:"JSON",value:vt["p"]}],current:F()(this.settings),modificatorsOptions:[{label:"Bold",value:"bold"},{label:"Italic",value:"italic"},{label:"Strike",value:"strike"},{label:"Uppercase",value:"uppercase"},{label:"Lowercase",value:"lowercase"},{label:"Capitalize",value:"capitalize"}]}},watch:{current:{deep:!0,handler(){this.$emit("update",this.current)}},settings:{deep:!0,handler(t){this.current=Q()(t,this.current)}}},components:{Topic:_t}},Fs=As,Ls=i("8f8e"),Ns=Object(f["a"])(Fs,Bs,Es,!1,null,null,null),Ds=Ns.exports;q()(Ns,"components",{QInput:y["a"],QSelect:ct["a"],QBtn:pt["a"],QMenu:ae["a"],QColor:_e["a"],QItem:dt["a"],QItemSection:ut["a"],QItemLabel:mt["a"],QCheckbox:Ls["a"]});var Qs=function(){var t=this,e=t._self._c;return e("div",{staticClass:"row"},[e("topic",{staticClass:"col-12 q-mb-sm",attrs:{board:t.board,config:{needSelectors:!0,needDefault:!0}},model:{value:t.current.topic,callback:function(e){t.$set(t.current,"topic",e)},expression:"current.topic"}}),e("q-btn-toggle",{staticClass:"q-my-sm col-12",attrs:{rounded:"","toggle-text-color":"grey-9","text-color":"grey-6",flat:"",options:t.modeOptions},model:{value:t.current.settings.mode,callback:function(e){t.$set(t.current.settings,"mode",e)},expression:"current.settings.mode"}}),e("div",{staticClass:"col-6 q-pr-sm"},[e("typed-input",{staticClass:"q-mb-sm",attrs:{settings:{label:"True value"}},model:{value:t.current.settings.trueValue,callback:function(e){t.$set(t.current.settings,"trueValue",e)},expression:"current.settings.trueValue"}}),e("q-input",{staticClass:"q-mb-sm",attrs:{outlined:"",dense:"","hide-bottom-space":"",color:"grey-9",label:"True value icon"},model:{value:t.current.settings.trueIcon,callback:function(e){t.$set(t.current.settings,"trueIcon",e)},expression:"current.settings.trueIcon"}},[e("q-icon",{attrs:{slot:"append",name:`mdi-${t.current.settings.trueIcon||"toggle-switch-outline"}`,size:"1.5rem"},slot:"append"}),e("q-btn",{style:{backgroundColor:t.current.settings.trueColor},attrs:{slot:"after",flat:""},slot:"after"},[e("q-menu",{staticClass:"q-pa-sm",attrs:{anchor:"top right",self:"bottom right"}},[e("q-color",{attrs:{"format-model":"hex"},model:{value:t.current.settings.trueColor,callback:function(e){t.$set(t.current.settings,"trueColor",e)},expression:"current.settings.trueColor"}})],1)],1)],1),1===t.current.settings.mode?e("div",{staticClass:"q-mb-sm"},[e("q-input",{attrs:{outlined:"",dense:"","hide-bottom-space":"",color:"grey-9",label:"True action topic"},model:{value:t.current.settings.trueActionTopic,callback:function(e){t.$set(t.current.settings,"trueActionTopic",e)},expression:"current.settings.trueActionTopic"}},[t.current.settings.trueActionTopic?e("q-btn",{attrs:{slot:"after",icon:"mdi-arrow-right",dense:"",flat:""},on:{click:function(e){t.current.settings.falseActionTopic=t.current.settings.trueActionTopic}},slot:"after"}):t._e()],1),t.board.settings.variables&&t.board.settings.variables.length?e("variables-helper",{attrs:{variables:t.board.settings.variables},on:{add:e=>t.current.settings.trueActionTopic+=e}}):t._e()],1):t._e(),1===t.current.settings.mode?e("q-input",{attrs:{outlined:"",dense:"","hide-bottom-space":"",color:"grey-9",label:"True action payload"},model:{value:t.current.settings.truePayload,callback:function(e){t.$set(t.current.settings,"truePayload",e)},expression:"current.settings.truePayload"}},[t.current.settings.truePayload?e("q-btn",{attrs:{slot:"after",icon:"mdi-arrow-right",dense:"",flat:""},on:{click:function(e){t.current.settings.falsePayload=t.current.settings.truePayload}},slot:"after"}):t._e()],1):t._e()],1),e("div",{staticClass:"col-6 q-pl-sm"},[e("typed-input",{staticClass:"q-mb-sm",attrs:{settings:{label:"False value"}},model:{value:t.current.settings.falseValue,callback:function(e){t.$set(t.current.settings,"falseValue",e)},expression:"current.settings.falseValue"}}),e("q-input",{staticClass:"q-mb-sm",attrs:{outlined:"",dense:"","hide-bottom-space":"",color:"grey-9",label:"False value icon"},model:{value:t.current.settings.falseIcon,callback:function(e){t.$set(t.current.settings,"falseIcon",e)},expression:"current.settings.falseIcon"}},[e("q-icon",{attrs:{slot:"append",name:`mdi-${t.current.settings.falseIcon||"toggle-switch-off-outline"}`,size:"1.5rem"},slot:"append"}),e("q-btn",{style:{backgroundColor:t.current.settings.falseColor},attrs:{slot:"after",flat:""},slot:"after"},[e("q-menu",{staticClass:"q-pa-sm",attrs:{anchor:"top right",self:"bottom right"}},[e("q-color",{attrs:{"format-model":"hex"},model:{value:t.current.settings.falseColor,callback:function(e){t.$set(t.current.settings,"falseColor",e)},expression:"current.settings.falseColor"}})],1)],1)],1),1===t.current.settings.mode?e("div",{staticClass:"q-mb-sm"},[e("q-input",{attrs:{outlined:"",dense:"","hide-bottom-space":"",color:"grey-9",label:"False action topic"},model:{value:t.current.settings.falseActionTopic,callback:function(e){t.$set(t.current.settings,"falseActionTopic",e)},expression:"current.settings.falseActionTopic"}}),t.board.settings.variables&&t.board.settings.variables.length?e("variables-helper",{attrs:{variables:t.board.settings.variables},on:{add:e=>t.current.settings.falseActionTopic+=e}}):t._e()],1):t._e(),1===t.current.settings.mode?e("q-input",{attrs:{outlined:"",dense:"","hide-bottom-space":"",color:"grey-9",label:"False action payload"},model:{value:t.current.settings.falsePayload,callback:function(e){t.$set(t.current.settings,"falsePayload",e)},expression:"current.settings.falsePayload"}}):t._e()],1),e("q-input",{staticClass:"col-12 q-mt-sm",attrs:{outlined:"",dense:"","hide-bottom-space":"",color:"grey-9",label:"Math expression",placeholder:"%value%"},model:{value:t.current.settings.math,callback:function(e){t.$set(t.current.settings,"math",e)},expression:"current.settings.math"}}),e("div",{staticClass:"text-grey-9",staticStyle:{"font-size":".8rem"}},[t._v("You can use math expressions to calculate the final value. Example: (%value% * 1000) / 1024, where %value% is the payload from your subscription.")])],1)},Hs=[],Rs={props:["settings","board"],data(){return{modeOptions:[{label:"Default mode",value:0},{label:"Command mode",value:1}],current:F()(this.settings)}},watch:{current:{deep:!0,handler(){this.$emit("update",this.current)}},settings:{deep:!0,handler(t){this.current=Q()(t,this.current)}}},components:{Topic:_t,VariablesHelper:it}},Ps=Rs,zs=Object(f["a"])(Ps,Qs,Hs,!1,null,null,null),js=zs.exports;q()(zs,"components",{QBtnToggle:lt["a"],QInput:y["a"],QIcon:x["a"],QBtn:pt["a"],QMenu:ae["a"],QColor:_e["a"]});var Ws=function(){var t=this,e=t._self._c;return e("div",{staticClass:"row"},[e("topic",{staticClass:"col-12 q-mb-sm",attrs:{board:t.board,config:{needSelectors:!0,needDefault:!0}},model:{value:t.current.topic,callback:function(e){t.$set(t.current,"topic",e)},expression:"current.topic"}}),e("div",{staticClass:"col-xs-12 q-mb-sm"},[e("q-input",{attrs:{outlined:"",dense:"","hide-bottom-space":"",color:"grey-9",label:"Default icon",error:!t.current.settings.defaultIcon},model:{value:t.current.settings.defaultIcon,callback:function(e){t.$set(t.current.settings,"defaultIcon",e)},expression:"current.settings.defaultIcon"}},[e("q-icon",{attrs:{slot:"append",name:`mdi-${t.current.settings.defaultIcon}`,size:"1.5rem"},slot:"append"})],1)],1),e("q-input",{staticClass:"col-12 q-mb-sm",attrs:{outlined:"",dense:"","hide-bottom-space":"",color:"grey-9",label:"Math expression",placeholder:"%value%"},model:{value:t.current.settings.math,callback:function(e){t.$set(t.current.settings,"math",e)},expression:"current.settings.math"}}),e("q-input",{staticClass:"col-12",attrs:{outlined:"",dense:"","hide-bottom-space":"",color:"grey-9",type:"number",label:"Reset timeout, s"},model:{value:t.current.settings.resetTimeout,callback:function(e){t.$set(t.current.settings,"resetTimeout",t._n(e))},expression:"current.settings.resetTimeout"}}),e("div",{staticClass:"status-indicator__items-wrapper col-12 relative-position q-mb-sm q-mt-sm"},[e("q-list",{attrs:{bordered:""}},[e("q-item-label",{staticClass:"q-py-md q-px-sm list__header",class:{"text-red-6":!t.current.settings.items.length}},[t._v("\n        Items"+t._s(t.current.settings.items.length?"":" are empty")+"\n        "),e("q-btn",{staticClass:"absolute-right",attrs:{color:"grey-9",flat:"",label:"ADD",icon:"mdi-plus"},on:{click:t.addItem}})],1),t._l(t.current.settings.items,(function(i,s){return e("q-expansion-item",{key:`${s}${i.value}`,attrs:{group:"status-indicator-items","header-class":["bg-"+(t.checkUniqueItem(i,s)?"grey-4":"red-2")],"expand-icon":"mdi-cog",value:s===t.current.settings.items.length-1}},[e("template",{slot:"header"},[e("q-item-section",[e("span",{staticClass:"ellipsis full-width"},[t._v(t._s(t.getItemLabel(i,s)))])]),i.default?t._e():e("q-item-section",{attrs:{side:""}},[e("q-btn",{attrs:{flat:"",color:"red-6",round:"",dense:"",icon:"mdi-delete"},on:{click:function(e){return t.removeItem(s)}}})],1)],1),e("div",{staticClass:"row q-pa-sm"},[i.default?e("div",{staticClass:"col-12 text-grey-8 q-mt-sm",staticStyle:{"font-size":".9rem"}},[t._v("\n            Default item. Used if there is no data in the source or data doesn't match the specified items.\n          ")]):t._e(),e("div",{staticClass:"q-mb-sm",class:["col-"+(i.default?"12":"6")]},[e("q-input",{staticClass:"q-mr-xs",attrs:{outlined:"",dense:"","hide-bottom-space":"",color:"grey-9",label:"Label"},model:{value:i.label,callback:function(e){t.$set(i,"label",e)},expression:"item.label"}})],1),i.default?t._e():e("div",{staticClass:"col-6"},[e("typed-input",{staticClass:"q-ml-xs",attrs:{settings:{label:"Value",error:!t.checkUniqueItem(i,s)}},model:{value:i.val,callback:function(e){t.$set(i,"val",e)},expression:"item.val"}})],1),e("div",{staticClass:"col-12 q-mb-sm"},[e("q-input",{staticClass:"q-mr-xs",style:{color:i.color},attrs:{outlined:"",dense:"","hide-bottom-space":"",color:"grey-9",label:"Icon"},model:{value:i.icon,callback:function(e){t.$set(i,"icon",e)},expression:"item.icon"}},[e("q-icon",{style:{color:i.color},attrs:{slot:"append",name:`mdi-${i.icon||t.current.settings.defaultIcon}`,size:"1.5rem"},slot:"append"}),e("q-btn",{style:{backgroundColor:i.color},attrs:{slot:"after",flat:""},slot:"after"},[e("q-menu",{staticClass:"q-pa-sm",attrs:{anchor:"top right",self:"bottom right"}},[e("q-color",{attrs:{"format-model":"hex"},model:{value:i.color,callback:function(e){t.$set(i,"color",e)},expression:"item.color"}})],1)],1)],1)],1),i.default?e("div",{staticClass:"col-12 text-grey-6 q-mt-sm",staticStyle:{"font-size":".8rem"}},[t._v("\n            You can find more icons on "),e("a",{attrs:{href:"https://materialdesignicons.com/",target:"blank"}},[t._v("MDI")])]):t._e(),i.default?t._e():e("q-input",{staticClass:"col-12",attrs:{outlined:"",dense:"","hide-bottom-space":"",color:"grey-9",label:"Math expression",placeholder:"%value%",error:!t.checkUniqueItem(i,s)},model:{value:i.math,callback:function(e){t.$set(i,"math",e)},expression:"item.math"}}),i.default?t._e():e("div",{staticClass:"text-grey-9",staticStyle:{"font-size":".8rem"}},[t._v("You can use math expressions to calculate the final value. Example: (%value% * 1000) / 1024, where %value% is the payload from your subscription.")])],1)],2)}))],2)],1)],1)},Us=[],Gs={props:["settings","board"],data(){const t={label:"Item",icon:"",color:"#000",math:"",val:""};return{defaultItem:t,currentItem:Object.assign({},t),current:F()(this.settings)}},methods:{addItem(){this.current.settings.items.push(this.currentItem),this.currentItem=Object.assign({},this.defaultItem)},removeItem(t){this.$delete(this.current.settings.items,t)},checkUniqueItem(t,e){let i=!0;return this.current.settings.items.some(((s,a)=>{const n=s.val===t.val,o=s.math===t.math;return n&&o&&(i=a===e),n})),i},validate(t){return t=t||this.current,!!t.settings.defaultIcon&&!!t.settings.items.length&&t.settings.items.reduce(((t,e,i,s)=>{const a=`${e.val} - ${e.math}`;return t[a]||(t[a]=0),t[a]++,i===s.length-1?Object.keys(t).reduce(((e,i)=>e?1===t[i]:e),!0):t}),{})},getItemLabel(t,e){let i="";return t.label?(i+=`${t.label} `,t.default||(i+=`[${void 0===t.val?"N/A":t.val}]`)):i=`${void 0===t.val?`item ${e+1}`:t.val}`,i}},watch:{current:{deep:!0,handler(){this.$emit("update",this.current)}},settings:{deep:!0,handler(t){this.current=Q()(t,this.current)}}},components:{Topic:_t}},Ys=Gs,Js=Object(f["a"])(Ys,Ws,Us,!1,null,null,null),Ks=Js.exports;q()(Js,"components",{QInput:y["a"],QIcon:x["a"],QList:Lt["a"],QItemLabel:mt["a"],QBtn:pt["a"],QExpansionItem:Nt["a"],QItemSection:ut["a"],QMenu:ae["a"],QColor:_e["a"]});var Xs=function(){var t=this,e=t._self._c;return e("div",{staticClass:"row"},[e("q-input",{staticClass:"q-mb-sm col-12",attrs:{outlined:"",dense:"","hide-bottom-space":"",color:"grey-9",label:"Text"},model:{value:t.current.settings.label,callback:function(e){t.$set(t.current.settings,"label",e)},expression:"current.settings.label"}}),e("q-select",{staticClass:"col-12 q-mb-sm",attrs:{"emit-value":"","map-options":"",outlined:"",dense:"","hide-bottom-space":"",color:"grey-9","use-chips":"",multiple:"",options:t.modificatorsOptions,label:"Text style"},scopedSlots:t._u([{key:"option",fn:function(i){return[e("q-item",t._g(t._b({},"q-item",i.itemProps,!1),i.itemEvents),[e("q-item-section",[e("q-item-label",{class:[`text-${i.opt.value}`]},[t._v(t._s(i.opt.label))])],1)],1)]}}]),model:{value:t.current.settings.modificators,callback:function(e){t.$set(t.current.settings,"modificators",e)},expression:"current.settings.modificators"}},[e("q-btn",{style:{backgroundColor:t.current.settings.color},attrs:{slot:"after",flat:""},slot:"after"},[e("q-menu",{staticClass:"q-pa-sm",attrs:{anchor:"top right",self:"bottom right"}},[e("q-color",{attrs:{"format-model":"hex"},model:{value:t.current.settings.color,callback:function(e){t.$set(t.current.settings,"color",e)},expression:"current.settings.color"}})],1)],1)],1),e("q-checkbox",{staticClass:"q-mb-sm",attrs:{label:"Need autoresize text",color:"grey-9"},model:{value:t.current.settings.autoresize,callback:function(e){t.$set(t.current.settings,"autoresize",e)},expression:"current.settings.autoresize"}}),t.current.settings.autoresize?t._e():e("q-input",{staticClass:"q-mb-sm col-12",attrs:{outlined:"",dense:"","hide-bottom-space":"",color:"grey-9",label:"Text styles"},model:{value:t.current.settings.style,callback:function(e){t.$set(t.current.settings,"style",e)},expression:"current.settings.style"}})],1)},Zs=[],ta={props:["settings"],data(){return{current:{...this.settings},modificatorsOptions:[{label:"Bold",value:"bold"},{label:"Italic",value:"italic"},{label:"Strike",value:"strike"},{label:"Uppercase",value:"uppercase"},{label:"Lowercase",value:"lowercase"},{label:"Capitalize",value:"capitalize"}]}},watch:{current:{deep:!0,handler(){this.$emit("update",this.current)}}}},ea=ta,ia=Object(f["a"])(ea,Xs,Zs,!1,null,null,null),sa=ia.exports;q()(ia,"components",{QInput:y["a"],QSelect:ct["a"],QBtn:pt["a"],QMenu:ae["a"],QColor:_e["a"],QItem:dt["a"],QItemSection:ut["a"],QItemLabel:mt["a"],QCheckbox:Ls["a"]});const aa="text",na="toggle",oa="status",ra="static-text",la={text:Ds,toggle:js,status:Ks,"static-text":sa};var ca={data(){return{activeItemIndex:void 0}},mixins:[J],computed:{activeItem(){let t;return"undefined"!==typeof this.activeItemIndex&&(t=this.currentSettings.items[this.activeItemIndex]),t},errorsByItems(){return this.currentSettings.items.reduce(((t,e,i,s)=>{const a=void 0===e.topic||!!e.topic&&this.validateTopic(e.topic.topicFilter),n=R()(la[e.type],"methods.validate",(()=>!0)),o=a&&n(e);return o||(t[i]=!0),t}),{})}}},da={name:"SchemeSchema",props:["widget","board"],data(){const t={items:[],topics:[],image:null,height:6,width:3,minWidth:1,minHeight:2,maxTopicsLength:0,isNeedTime:!0};return{defaultSettings:t,constants:{WIDGET_ITEM_TYPE_TEXT:aa,WIDGET_ITEM_TYPE_STATIC_TEXT:ra,WIDGET_ITEM_TYPE_TOGGLE:na,WIDGET_ITEM_TYPE_STATUS:oa},currentSettings:Object.assign({},t,this.widget.settings),defaultTopic:Object(bt["b"])()}},methods:{getDefaultItem(t){const e=Object(bt["b"])(),i={position:{top:5,left:5},label:"New Item",width:20,height:10},s={text:{math:"",valueFormat:0,prefix:"",postfix:"",modificators:[],color:"#9e9e9e",autoresize:!0,style:""},toggle:{math:"",trueValue:"1",trueIcon:"",trueActionTopic:"",truePayload:"",trueColor:"#9e9e9e",falseColor:"#333",falseValue:"0",mode:0,falseIcon:"",falseActionTopic:"",falsePayload:""},status:{mode:0,math:"",defaultIcon:"circle",resetTimeout:0,items:[{label:"default",default:!0,icon:"",color:"#9e9e9e",math:"",val:""}]},"static-text":{label:"*Your label*",modificators:[],color:"#9e9e9e",autoresize:!0,style:""}},a={...i,type:t,settings:s[t]};return t!==ra&&(a.topic=e),F()(a)},addTypedItem(t){this.currentSettings.items.push(this.getDefaultItem(t)),this.activeItemIndex=this.currentSettings.items.length-1},removeItem(t){this.activeItemIndex=void 0,this.$delete(this.currentSettings.items,t)},updateImage(t){this.currentSettings.image=t},updateTopics(){this.$set(this.currentSettings,"topics",this.currentSettings.items.map((t=>t.topic)).filter((t=>!!t)))},updateItem(t,e){this.$set(this.currentSettings.items,e,t),this.updateTopics()},validate(){const t=this.currentSettings;return!!t.image&&(!t.items.length||!Object.keys(this.errorsByItems).length)}},mixins:[J,ca],watch:{widget:{deep:!0,handler(t,e){if(this.$emit("validate",this.validate()),V()(t,e))return!1;this.$emit("update",t)}}},created(){this.$emit("update",this.currentSettings),this.$widgetBus.$on("add",this.addTypedItem),this.$widgetBus.$on("remove",this.removeItem),this.$widgetBus.$on("update:image",this.updateImage),this.$widgetBus.$on("select",(t=>this.activeItemIndex=t))},destroyed(){this.$widgetBus.$off("add",this.addTypedItem),this.$widgetBus.$off("remove",this.removeItem),this.$widgetBus.$off("update:image",this.updateImage),this.$widgetBus.$off("select",(t=>this.activeItemIndex=t))},components:{StaticTextSchema:sa,TextSchema:Ds,ToggleSchema:js,StatusSchema:Ks}},ua=da,pa=Object(f["a"])(ua,Ms,Os,!1,null,null,null),ma=pa.exports;q()(pa,"components",{QSlideTransition:xt["a"],QInput:y["a"],QToggle:Se["a"]});var ha=function(){var t=this,e=t._self._c;return t.mini?e("div",{staticStyle:{"text-align":"center"},on:{click:function(e){return e.stopPropagation(),t.actionHandler.apply(null,arguments)}}},[e("div",{class:["bg-"+(null!==t.currentValue?`${t.item.color}-1`:"grey-3")],staticStyle:{height:"60px",width:"60px","line-height":"60px",margin:"0 auto","border-radius":"5px"}},[e("q-icon",{class:t.controlClasses,attrs:{size:"3rem",color:null===t.item.currentValue?"grey-4":t.currentValue?`${t.item.color}-7`:"grey-6",name:t.currentValue?`mdi-${t.item.settings.trueIcon||"toggle-switch-outline"}`:`mdi-${t.item.settings.falseIcon||"toggle-switch-off-outline"}`}})],1),e("div",{staticClass:"ellipsis q-mt-sm"},[t._v(t._s(t.item.name))])]):e("q-icon",{class:t.controlClasses,staticStyle:{width:"100%",height:"100%"},style:{color:t.color},attrs:{size:"3.8rem",name:t.currentValue?`mdi-${t.item.settings.trueIcon||"toggle-switch-outline"}`:`mdi-${t.item.settings.falseIcon||"toggle-switch-off-outline"}`},nativeOn:{click:function(e){return e.stopPropagation(),t.actionHandler.apply(null,arguments)}}})},ga=[],ba=i("52cd"),va=i.n(ba);i("6ce5"),i("2834"),i("4ea1");function fa(t,e,i){let s=va.a.query(t,e);return null!==s&&void 0!==s&&s.length||(s=i),1===s.length&&(s=s[0]),s}var ya={methods:{getCleanValue(t,e={}){const i=t instanceof Uint8Array;if(null===t)t=e.default||"N/A";else switch(e.payloadType){case vt["h"]:t=i?t.toString():JSON.stringify(t);break;case vt["g"]:try{t=JSON.parse(i?t.toString():JSON.stringify(t))}catch(s){t="N/A"}break;default:t=i?t.toString():JSON.stringify(t)}return t},getValueByTopic(t,e={}){const i=t instanceof Uint8Array;if(null===t)t=e.default||"N/A";else switch(e.payloadType){case vt["h"]:t=i?t.toString():JSON.stringify(t);break;case vt["g"]:try{if(e.payloadField){const s=i?JSON.parse(t.toString()):t,a=fa(s,e.payloadField,"N/A");if(e.payloadNameField){const i=fa(s,e.payloadNameField,"N/A");t=[i,a]}else t=a}else t=JSON.parse(i?t.toString():JSON.stringify(t))}catch(s){t="N/A"}break;default:t=i?t.toString():JSON.stringify(t)}return t}}},xa=i("7937"),Sa=i("1cd1"),_a=i("2bac");const{humanStorageSize:qa}=xa["c"],wa=t=>{const e=Math.floor(t/864e5);t%=864e5;const i=Math.floor(t/36e5);t%=36e5;const s=Math.floor(t/6e4);t%=6e4;const a=Math.floor(t/1e3);return(e?e+" days ":"")+(i?i+" hours ":"")+(s?s+" minutes ":"")+(!a&&(e||i||s||a)?"":a+" seconds ")},Ta=Object(Sa["a"])(_a["a"]);Ta.import({equal:function(t,e){return t===e},unequal:function(t,e){return t!==e}},{override:!0});var $a={methods:{mathProcessing(t,e){if(e&&"N/A"!==t)try{let i=e.replace(/%value%/g,t);i=i.replace(/<%([a-zA-Z0-9-+&@#/%?=~_|!:,.;\s[\]']*)%>/gim,((e,i)=>{let s=R()(t,i,void 0);return s=void 0===s?"nill":"string"===typeof s?`"${s}"`:s,s})),i=i.replace(/nill/gim,'"nill"'),t=Ta.evaluate(i)}catch(i){t=!1}return t},formatValue(t,e){if(t=this.mathProcessing(t,e.math),e.valueFormat)try{switch(e.valueFormat){case vt["s"]:break;case vt["o"]:t=qa(t);break;case vt["m"]:{const i=e.dateFormat||"DD/MM/YYYY HH:mm:ss";t="N/A"!==t?Kt["a"].formatDate(1e3*t,i):t;break}case vt["n"]:t="N/A"!==t?wa(1e3*t):t}}catch(i){}return t}}},Ca={name:"Switcher",props:["item","index","value","mini","blocked"],data(){return{WIDGET_STATUS_DISABLED:vt["k"]}},computed:{color(){let t="#e0e0e0e";return null!==this.currentValue&&(t=this.currentValue?this.item.settings.trueColor:this.item.settings.falseColor),t},controlClasses(){const t=[];return null===this.currentValue?t.push("disabled"):this.isActiveWidget&&t.push("cursor-pointer"),t},currentValue(){const t=this.item.settings.accumulateLogic,e=t===ve,i=this.item.settings.trueValue,s=this.item.settings.falseValue;return this.item.dataTopics.reduce(((e,a,n,o)=>{if(null===e)return e;let r=R()(this.value,`['${a.topicFilter}'].payload`,null);switch((null!==r||1===o.length&&a.default)&&(r=this.mathProcessing(this.getValueByTopic(r,a),this.item.settings.math)),t){case ve:e=r===i?e&&!0:r===s?e&&!1:null;break;case fe:e=r===i?e||!0:r===s?e||!1:null;break}return e}),e)},actionTopic(){let t=null;return null===this.currentValue?t=null:this.item.settings.mode===be?t=this.currentValue?this.item.settings.falseActionTopic:this.item.settings.trueActionTopic:1===this.item.topics.length?t=this.item.topics[0]:this.item.settings.mode===ge&&(t=this.item.settings.actionTopic),t},isActiveWidget(){return!!this.actionTopic&&(this.item.settings.mode===be||!this.item.settings.math&&this.item.settings.mode===ge)}},methods:{getValue(){let t="";return t=this.item.settings.mode===be?this.currentValue?this.item.settings.falsePayload:this.item.settings.truePayload:this.item.dataTopics.reduce(((t,e,i,s)=>{let a=R()(this.value,`['${e.topicFilter}'].payload`,null);return(null!==a||1===s.length&&e.default)&&(a=this.mathProcessing(this.getValueByTopic(a,e),this.item.settings.math)),a===this.item.settings.trueValue&&t===this.item.settings.trueValue?this.item.settings.falseValue:a===this.item.settings.falseValue&&t===this.item.settings.falseValue?this.item.settings.trueValue:a?this.item.settings.falseValue:this.item.settings.trueValue}),this.item.settings.falseValue),t},actionHandler(){if(this.isActiveWidget){const t=this.getValue(),e=this.actionTopic;let i=t;const s=this.item.dataTopics[0];this.item.settings.mode===ge&&s.payloadField&&(i=this.getCleanValue(this.value[e]&&this.value[e].payload,s),"N/A"!==i&&(va.a.apply(i,s.payloadField,(()=>t)),i=JSON.stringify(i)));const a={topic:e,payload:i,settings:{retain:this.item.settings.save}};this.$emit("action",a)}}},mixins:[ya,$a]},ka=Ca,Ia=Object(f["a"])(ka,ha,ga,!1,null,null,null),Va=Ia.exports;q()(Ia,"components",{QIcon:x["a"]});var Ma=function(){var t=this,e=t._self._c;return t.mini?e("div",{staticStyle:{"text-align":"center"},on:{click:function(e){return e.stopPropagation(),t.showTooltip.apply(null,arguments)}}},[e("div",{class:["bg-"+(null!==t.text?`${t.item.color}-1`:"grey-3")],staticStyle:{height:"60px",width:"60px","line-height":"60px",margin:"0 auto","border-radius":"5px"}},[e("div",{staticClass:"ellipsis",style:{fontSize:(t.stringLength>5?16:18)+"px"}},[e("span",{staticStyle:{"font-weight":"bold"}},[t._v(t._s(`${t.item.settings.prefix}`))]),t._v(t._s(`${t.text}`)),e("span",{staticStyle:{"font-weight":"bold"}},[t._v(t._s(`${t.item.settings.postfix}`))])]),e("q-tooltip",{ref:"tooltip"},[e("span",{staticStyle:{"font-weight":"bold"}},[t._v(t._s(`${t.item.settings.prefix}`))]),t._v("\n      "+t._s(`${t.text}`)+"\n      "),e("span",{staticStyle:{"font-weight":"bold"}},[t._v(t._s(`${t.item.settings.postfix}`))])])],1),e("div",{staticClass:"ellipsis q-mt-sm"},[t._v(t._s(t.item.name))])]):e("div",{staticClass:"informer__payload-wrapper",staticStyle:{"padding-bottom":"15px"}},[e("text-view",{staticClass:"informer__payload",class:["text-"+(null!==t.value[t.topic]?"grey-9":"grey-5")],attrs:{text:t.text,title:t.title,prefix:t.item.settings.prefix,postfix:t.item.settings.postfix,settings:t.item.settings}})],1)},Oa=[],Ba=function(){var t=this,e=t._self._c;return e("div",[t.settings.valueFormat===t.WIDGET_VALUE_FORMAT_PRE?[t.prefix?e("span",{staticStyle:{"font-weight":"bold"}},[t._v(t._s(`${t.prefix}`))]):t._e(),e("pre",{staticStyle:{margin:"0"}},[t._v(t._s(t.text))]),t.postfix?e("span",{staticStyle:{"font-weight":"bold"}},[t._v(t._s(`${t.postfix}`))]):t._e(),t.showTooltip?e("q-tooltip",[t.prefix?e("span",{staticStyle:{"font-weight":"bold"}},[t._v(t._s(`${t.prefix}`))]):t._e(),e("pre",{staticStyle:{margin:"0"}},[t._v(t._s(t.title))]),t.postfix?e("span",{staticStyle:{"font-weight":"bold"}},[t._v(t._s(`${t.postfix}`))]):t._e()]):t._e()]:t.settings.valueFormat===t.WIDGET_VALUE_FORMAT_MARKDOWN?[t.prefix?e("span",{staticStyle:{"font-weight":"bold"}},[t._v(t._s(`${t.prefix}`))]):t._e(),e("markdown",{attrs:{source:t.text}}),t.postfix?e("span",{staticStyle:{"font-weight":"bold"}},[t._v(t._s(`${t.postfix}`))]):t._e(),t.showTooltip?e("q-tooltip",[t.prefix?e("span",{staticStyle:{"font-weight":"bold"}},[t._v(t._s(`${t.prefix}`))]):t._e(),t._v("\n      "+t._s(t.title)+"\n      "),t.postfix?e("span",{staticStyle:{"font-weight":"bold"}},[t._v(t._s(`${t.postfix}`))]):t._e()]):t._e()]:t.settings.valueFormat===t.WIDGET_VALUE_FORMAT_JSON?[t.prefix?e("span",{staticStyle:{"font-weight":"bold"}},[t._v(t._s(`${t.prefix}`))]):t._e(),e("json-tree",{attrs:{data:t.getJsonValue()}}),t.postfix?e("span",{staticStyle:{"font-weight":"bold"}},[t._v(t._s(`${t.postfix}`))]):t._e()]:(t.settings.valueFormat===t.WIDGET_VALUE_FORMAT_STRING||t.settings.valueFormat===t.WIDGET_VALUE_FORMAT_HUMAN_READABLE_SIZE||(t.settings.valueFormat,t.WIDGET_VALUE_FORMAT_DATE),[t.prefix?e("span",{staticStyle:{"font-weight":"bold"}},[t._v(t._s(`${t.prefix}`))]):t._e(),t._v("\n    "+t._s(t.text)+"\n    "),t.postfix?e("span",{staticStyle:{"font-weight":"bold"}},[t._v(t._s(`${t.postfix}`))]):t._e(),t.showTooltip?e("q-tooltip",[t.prefix?e("span",{staticStyle:{"font-weight":"bold"}},[t._v(t._s(`${t.prefix}`))]):t._e(),t._v("\n      "+t._s(t.title)+"\n      "),t.postfix?e("span",{staticStyle:{"font-weight":"bold"}},[t._v(t._s(`${t.postfix}`))]):t._e()]):t._e()])],2)},Ea=[],Aa=function(){var t=this,e=t._self._c;return e("markdown",{staticClass:"markdown-block",attrs:{"table-class":"markdown-table",source:t.source,prerender:t.prerenderHandler,postrender:t.postrenderHandler}},[t._t("default")],2)},Fa=[],La=i("9ce6"),Na=i.n(La),Da=i("5e38"),Qa=i.n(Da),Ha={name:"flespi-markdown",props:["source"],data(){return{}},methods:{prerenderHandler(t){return Qa()(t)},postrenderHandler(t){return t.replace(/\*\*\s\*\s\*\*/g,"*")}},mounted(){this.$prism.highlightAll()},updated(){this.$prism.highlightAll()},components:{Markdown:Na.a}},Ra=Ha,Pa=(i("4880"),Object(f["a"])(Ra,Aa,Fa,!1,null,null,null)),za=Pa.exports,ja=function(){var t=this,e=t._self._c;return Array.isArray(t.data)||"object"===typeof t.data?e("div",[e("span",{class:{"text-white":void 0!==t.inverted}},[t._v(t._s(Array.isArray(t.data)?"[":"{"))]),t._l(t.data,(function(i,s,a){return e("div",{key:`${s}-${a}`,staticClass:"margin-left"},[i&&"object"===typeof i?e("div",[e("div",{staticClass:"cursor-pointer",on:{click:function(e){t.toggle(Array.isArray(t.data)?s:a)}}},[t.showObj[Array.isArray(t.data)?s:a]?e("q-icon",{staticStyle:{"vertical-align":"baseline"},attrs:{color:void 0!==t.inverted?"white":"grey-9",name:"mdi-menu-down"}}):e("q-icon",{staticStyle:{"vertical-align":"baseline"},attrs:{color:void 0!==t.inverted?"white":"grey-9",name:"mdi-menu-right"}}),e("span",{class:[t.theme.label]},[t._v(t._s(s))]),e("span",{class:{"text-white":void 0!==t.inverted}},[t._v(" : "+t._s(Array.isArray(i)?`Array [${i.length}]`:"Object"))])],1),t.showObj[Array.isArray(t.data)?s:a]?e("json-tree",{staticClass:"margin-left",attrs:{data:i,inverted:t.inverted}}):t._e()],1):e("div",[e("span",{class:[t.theme.label]},[t._v(t._s(s))]),e("span",{class:{"text-white":void 0!==t.inverted}},[t._v(" : ")]),e("span",{class:{[t.theme.typeNumberOrBool]:"number"===typeof i||"boolean"===typeof i,[t.theme.typeString]:"string"===typeof i,[t.theme.typeEmpty]:"undefined"===typeof i||null===i}},[t._v(t._s(JSON.stringify(i)))])])])})),e("span",{class:{"text-white":void 0!==t.inverted}},[t._v(t._s(Array.isArray(t.data)?"]":"}"))])],2):e("div",[e("span",{class:{[t.theme.typeNumberOrBool]:"number"===typeof t.data||"boolean"===typeof t.data,[t.theme.typeString]:"string"===typeof t.data,[t.theme.typeEmpty]:"undefined"===typeof t.data||null===t.data},staticStyle:{"font-size":"1rem"}},[t._v(t._s(t.data))])])},Wa=[],Ua={name:"JsonTree",props:{data:{requered:!0},inverted:{type:Boolean,default(){}}},data(){const t=[],e=Object.keys(this.data).length;for(let i=0,s=e;i<s;i++)t.push(!0);return{showObj:t}},computed:{theme(){return void 0!==this.inverted?{label:"text-pink-4",typeString:"text-red-3",typeNumberOrBool:"text-blue-3",typeEmpty:"text-grey-5"}:{label:"text-pink-8",typeString:"text-red-6",typeNumberOrBool:"text-blue-6",typeEmpty:"text-grey-6"}}},methods:{toggle(t){m["default"].set(this.showObj,t,!this.showObj[t])}}},Ga=Ua,Ya=(i("ad26"),Object(f["a"])(Ga,ja,Wa,!1,null,null,null)),Ja=Ya.exports;q()(Ya,"components",{QIcon:x["a"]});var Ka={props:["prefix","postfix","text","title","settings","showTooltip"],data(){return{WIDGET_VALUE_FORMAT_STRING:vt["s"],WIDGET_VALUE_FORMAT_HUMAN_READABLE_SIZE:vt["o"],WIDGET_VALUE_FORMAT_DATE:vt["m"],WIDGET_VALUE_FORMAT_DURATION:vt["n"],WIDGET_VALUE_FORMAT_PRE:vt["r"],WIDGET_VALUE_FORMAT_MARKDOWN:vt["q"],WIDGET_VALUE_FORMAT_JSON:vt["p"]}},methods:{getJsonValue(){let t=this.text;try{t=JSON.parse(t)}catch(e){}return t}},components:{Markdown:za,JsonTree:Ja}},Xa=Ka,Za=Object(f["a"])(Xa,Ba,Ea,!1,null,null,null),tn=Za.exports;q()(Za,"components",{QTooltip:S["a"]});var en={name:"Informer",props:["item","index","mini","value"],data(){return{WIDGET_STATUS_DISABLED:vt["k"]}},methods:{showTooltip(){this.$q.platform.is.mobile&&this.$refs.tooltip.toogle()}},computed:{topic(){return R()(this.item,"dataTopics[0].topicFilter")},title(){const t=R()(this.value,`['${this.topic}'].payload`,null);return this.getValueByTopic(t,this.item.dataTopics[0])},text(){return this.formatValue(this.title,this.item.settings)},stringLength(){return this.item.settings.prefix.length+this.text.length+this.item.settings.postfix.length}},components:{TextView:tn},mixins:[ya,$a]},sn=en,an=(i("7953"),Object(f["a"])(sn,Ma,Oa,!1,null,null,null)),nn=an.exports;q()(an,"components",{QTooltip:S["a"]});var on=function(){var t=this,e=t._self._c;return e("div",{staticClass:"sattic-informer__payload-wrapper"},[e("text-view",{staticClass:"static-informer__payload text-grey-9",attrs:{text:t.text,title:t.text,settings:t.item.settings,"show-tooltip":!1}})],1)},rn=[],ln={name:"StaticInformer",props:["item","index","mini","value","blocked"],data(){return{WIDGET_STATUS_DISABLED:vt["k"]}},computed:{text(){return this.item.settings.text}},components:{TextView:tn},mixins:[ya]},cn=ln,dn=(i("dc2a"),Object(f["a"])(cn,on,rn,!1,null,null,null)),un=dn.exports,pn=function(){var t=this,e=t._self._c;return e("div",{staticClass:"multi-informer__payload-wrapper",staticStyle:{"padding-bottom":"15px"}},t._l(t.text,(function(i,s){return e("text-view",{key:s,staticClass:"multi-informer__payload",class:["text-"+(null!==t.value[t.item.settings.items[s].topic.topicFilter]?"grey-9":"grey-5")],attrs:{text:i,title:t.title[s],prefix:t.item.settings.items[s].prefix,postfix:t.item.settings.items[s].postfix,settings:t.item.settings.items[s]}})})),1)},mn=[],hn={name:"MultiInformer",props:["item","index","mini","value","blocked"],data(){return{WIDGET_STATUS_DISABLED:vt["k"]}},methods:{showTooltip(){this.$q.platform.is.mobile&&this.$refs.tooltip.toogle()}},computed:{title(){return this.item.settings.items.map((t=>{const e=t.topic.topicFilter,i=R()(this.value,`['${e}'].payload`,null);return this.getValueByTopic(i,t.topic)}))},text(){return this.title.map(((t,e)=>{const i=this.item.settings.items[e];return this.formatValue(t,i)}))}},components:{TextView:tn},mixins:[ya,$a]},gn=hn,bn=(i("f608c"),Object(f["a"])(gn,pn,mn,!1,null,null,null)),vn=bn.exports,fn=function(){var t=this,e=t._self._c;return t.mini?e("div",{staticStyle:{"text-align":"center"},on:{click:function(e){return e.stopPropagation(),t.actionHandler.apply(null,arguments)}}},[e("div",{class:[`bg-${t.item.color}-1`],staticStyle:{height:"60px",width:"60px","line-height":"60px",margin:"0 auto","border-radius":"5px"}},[e("q-btn",{attrs:{disabled:t.item.status===t.WIDGET_STATUS_DISABLED,size:"0.8rem",dense:"",round:"",icon:`mdi-${t.item.settings.icon||"send"}`,color:`${t.item.color}-7`}}),e("q-tooltip",[t._v("Payload"+t._s(t.item.settings.payload?`: ${t.item.settings.payload}`:" is empty"))])],1),e("div",{staticClass:"ellipsis q-mt-sm"},[t._v(t._s(t.item.name))])]):e("div",{staticClass:"clicker__payload q-py-none q-px-sm"},[e("q-btn",{staticClass:"payload__button",attrs:{disabled:t.item.status===t.WIDGET_STATUS_DISABLED,color:`${t.item.color}-7`,label:t.item.settings.icon?void 0:t.item.settings.label||"Send",icon:t.item.settings.icon?`mdi-${t.item.settings.icon}`:void 0,rounded:""},on:{click:t.actionHandler}})],1)},yn=[],xn={name:"Clicker",props:["item","index","mini","value"],data(){return{WIDGET_STATUS_DISABLED:vt["k"]}},methods:{actionHandler(){this.item.settings.topics.forEach((t=>{const e={topic:t.topicTemplate,payload:t.payload,settings:{retain:this.item.settings.save}};this.$emit("action",e)}))}}},Sn=xn,_n=(i("00a1"),Object(f["a"])(Sn,fn,yn,!1,null,null,null)),qn=_n.exports;q()(_n,"components",{QBtn:pt["a"],QTooltip:S["a"]});var wn=function(){var t=this,e=t._self._c;return t.mini?e("div",{staticStyle:{"text-align":"center"},on:{click:function(e){return e.stopPropagation(),t.showTooltip.apply(null,arguments)}}},[e("div",{class:["bg-"+(null!==t.currentValueText?`${t.item.color}-1`:"grey-3")],staticStyle:{height:"60px",width:"60px","line-height":"60px",margin:"0 auto","border-radius":"5px"}},[e("div",{staticClass:"ellipsis",style:{fontSize:(t.stringLength>5?16:18)+"px"}},[t._v("\n      "+t._s(`${t.currentValue}${t.item.settings.units}`)+"\n    ")]),e("q-tooltip",{ref:"tooltip"},[t._v("\n      "+t._s(`${t.currentValue}${t.item.settings.units}`)+"\n    ")])],1),e("div",{staticClass:"ellipsis q-mt-sm"},[t._v(t._s(t.item.name))])]):e("div",{staticStyle:{width:"100%",height:"100%"}},[e("div",{staticClass:"radial__payload",staticStyle:{height:"100%"}},[e("q-resize-observer",{on:{resize:t.onResize}}),e("radial-gauge",{attrs:{options:t.options,value:t.currentValue}})],1)])},Tn=[],$n=function(){var t=this,e=t._self._c;return e("canvas",{staticClass:"canvas-gauges"})},Cn=[],kn=i("af13");E()(((t,e)=>{t.value=e}),1e3,{trailing:!0,leading:!0});var In={props:{value:Number,options:{type:Object,default:()=>({})}},data(){return{currentOptions:Q()({},this.options),chart:null}},mounted(){this.value&&(this.currentOptions.value=JSON.parse(JSON.stringify(this.value))),this.currentOptions.renderTo=this.$el,this.chart=new kn["RadialGauge"](this.currentOptions).draw()},beforeDestroy(){this.chart.destroy()},watch:{options:{deep:!0,handler(t){this.currentOptions=Q()(this.currentOptions,t),this.chart.update(this.currentOptions)}},value(t){this.setValue(this.chart,JSON.parse(JSON.stringify(t)))}},methods:{setValue:(t,e)=>{t.value=e}}},Vn=In,Mn=Object(f["a"])(Vn,$n,Cn,!1,null,null,null),On=Mn.exports,Bn={name:"Radial",props:["item","index","mini","value","blocked"],data(){return{WIDGET_STATUS_DISABLED:vt["k"],width:0,height:0,colors:{plate:{grey:"#bdbdbd",red:"#e57373",green:"#81c784",orange:"#ffb74d",blue:"#64b5f6","light-blue":"#4fc3f7",purple:"#ba68c8","deep-orange":"#ff8a65",cyan:"#4dd0e1",brown:"#a1887f","blue-grey":"#90a4ae"},borderOuter:{grey:"#fafafa",red:"#ffebee",green:"#e8f5e9",orange:"#fff3e0",blue:"#e3f2fd","light-blue":"#e1f5fe",purple:"#f3e5f5","deep-orange":"#fbe9e7",cyan:"#e0f7fa",brown:"#efebe9","blue-grey":"#eceff1"},borderMiddle:{grey:"#f5f5f5",red:"#ffcdd2",green:"#c8e6c9",orange:"#ffe0b2",blue:"#bbdefb","light-blue":"#b3e5fc",purple:"#f3e5f5","deep-orange":"#ffccbc",cyan:"#b2ebf2",brown:"#d7ccc8","blue-grey":"#cfd8dc"},borderInner:{grey:"#eee",red:"#ef9a9a",green:"#a5d6a7",orange:"#ffcc80",blue:"#90caf9","light-blue":"#81d4fa",purple:"#e1bee7","deep-orange":"#ffab91",cyan:"#80deea",brown:"#bcaaa4","blue-grey":"#b0bec5"}}}},methods:{showTooltip(){this.$q.platform.is.mobile&&this.$refs.tooltip.toogle()},onResize({width:t,height:e}){this.width=t,this.height=e}},computed:{valuesBySettings(){const t=this.item.dataTopics[0],e=this.item.settings.topics[0],i=this.item.settings.topics[1],s={};return t&&(s[t.topicFilter]=parseFloat(this.getValueByTopic(R()(this.value,`['${t.topicFilter}'].payload`,null),t))),e&&(s[e.topicFilter]=parseFloat(this.getValueByTopic(R()(this.value,`['${e.topicFilter}'].payload`,null),e))),i&&(s[i.topicFilter]=parseFloat(this.getValueByTopic(R()(this.value,`['${i.topicFilter}'].payload`,null),i))),s},currentValueText(){const t=R()(this.item,"dataTopics[0].topicFilter"),e=R()(this.valuesBySettings,`['${t}']`,"N/A");return e},currentValue(){const t=R()(this.item,"dataTopics[0].topicFilter"),e=R()(this.valuesBySettings,`['${t}']`,"N/A");return"number"!==typeof e||Number.isNaN(e)?0:this.mathProcessing(e,this.item.settings.math)},stringLength(){return this.currentValue.length+this.item.settings.units.length},maxValue(){return this.item.settings.maxValueMode===vt["i"]?this.item.settings.maxValue:this.item.settings.minValueMode===vt["j"]?this.valuesBySettings[R()(this.item,"settings.topics[1].topicFilter")]:this.valuesBySettings[R()(this.item,"settings.topics[0].topicFilter")]},minValue(){return this.item.settings.minValueMode===vt["i"]?this.item.settings.minValue:this.valuesBySettings[R()(this.item,"settings.topics[0].topicFilter")]},options(){const t=this.item.settings,e=t=>{const e=(this.maxValue-this.minValue)/10;return new Array(11).fill(0).reduce(((t,i,s,a)=>{if(0===s)t.push(this.minValue);else if(s===a.length-1)t.push(this.maxValue);else{let i=Math.round(100*(t[t.length-1]+e))/100;Number.isNaN(i)&&(i="N/A"),t.push(i)}return t}),[])};return{valueText:this.currentValue,minValue:this.minValue,maxValue:this.maxValue,width:this.width-16,height:this.height-16,majorTicks:e(t),units:t.units,animation:!0,animationRule:"linear",animationDuration:300,colorPlate:this.colors.plate[this.item.color],colorBorderOuter:this.colors.borderOuter[this.item.color],colorBorderOuterEnd:this.colors.borderOuter[this.item.color],colorBorderMiddle:this.colors.borderMiddle[this.item.color],colorBorderMiddleEnd:this.colors.borderMiddle[this.item.color],colorBorderInner:this.colors.borderInner[this.item.color],colorBorderInnerEnd:this.colors.borderInner[this.item.color],borderShadowWidth:1,colorNeedleShadowDown:"#222",colorNeedle:"#d32f2f",colorNeedleEnd:"#d32f2f",colorUnits:"#616161",highlights:[{from:this.minValue,to:t.lowLevel,color:"rgba(165,214,167,1)"},{from:t.lowLevel,to:t.midLevel,color:"rgba(220,231,117,1)"},{from:t.midLevel,to:t.highLevel,color:"rgba(255,179,0,1)"},{from:t.highLevel,to:this.maxValue,color:"rgba(244,81,30,1)"}]}}},components:{RadialGauge:On},mixins:[ya,$a]},En=Bn,An=(i("1d3f"),i("3980")),Fn=Object(f["a"])(En,wn,Tn,!1,null,null,null),Ln=Fn.exports;q()(Fn,"components",{QTooltip:S["a"],QResizeObserver:An["a"]});var Nn=function(){var t=this,e=t._self._c;return t.mini?e("div",{staticStyle:{"text-align":"center"},on:{click:function(e){return e.stopPropagation(),t.showTooltip.apply(null,arguments)}}},[e("div",{class:["bg-"+(null!==t.currentValueText?`${t.item.color}-1`:"grey-3")],staticStyle:{height:"60px",width:"60px","line-height":"60px",margin:"0 auto","border-radius":"5px"}},[e("div",{staticClass:"ellipsis",style:{fontSize:(t.stringLength>5?16:18)+"px"}},[t._v("\n      "+t._s(`${t.currentValue}${t.item.settings.units}`)+"\n    ")]),e("q-tooltip",{ref:"tooltip"},[t._v("\n      "+t._s(`${t.currentValue}${t.item.settings.units}`)+"\n    ")])],1),e("div",{staticClass:"ellipsis q-mt-sm"},[t._v(t._s(t.item.name))])]):e("div",{staticStyle:{width:"100%",height:"100%"}},[e("div",{staticClass:"linear__payload",staticStyle:{height:"100%"}},[e("q-resize-observer",{on:{resize:t.onResize}}),e("linear-gauge",{attrs:{options:t.options,value:t.currentValue}})],1)])},Dn=[],Qn=function(){var t=this,e=t._self._c;return e("canvas",{staticClass:"canvas-gauges"})},Hn=[],Rn={props:{value:Number,options:{type:Object,default:()=>({})}},data(){return{currentOptions:Q()({},this.options),chart:null}},mounted(){this.value&&(this.currentOptions.value=JSON.parse(JSON.stringify(this.value))),this.currentOptions.renderTo=this.$el,this.chart=new kn["LinearGauge"](this.currentOptions).draw()},beforeDestroy(){this.chart.destroy()},watch:{options:{deep:!0,handler(t){this.currentOptions=Q()(this.currentOptions,t),this.chart.update(this.currentOptions)}},value(t){this.setValue(this.chart,t)}},methods:{setValue:(t,e)=>{t.value=JSON.parse(JSON.stringify(e))}}},Pn=Rn,zn=Object(f["a"])(Pn,Qn,Hn,!1,null,null,null),jn=zn.exports,Wn={name:"Linear",props:["item","index","mini","value","blocked"],data(){return{WIDGET_STATUS_DISABLED:vt["k"],width:0,height:0,colors:{border:{grey:"#fafafa",red:"#ffebee",green:"#e8f5e9",orange:"#fff3e0",blue:"#e3f2fd","light-blue":"#e1f5fe",purple:"#f3e5f5","deep-orange":"#fbe9e7",cyan:"#e0f7fa",brown:"#efebe9","blue-grey":"#eceff1"},barColorsProgress:{grey:"#bdbdbd",red:"#e57373",green:"#81c784",orange:"#ffb74d",blue:"#64b5f6","light-blue":"#4fc3f7",purple:"#ba68c8","deep-orange":"#ff8a65",cyan:"#4dd0e1",brown:"#a1887f","blue-grey":"#90a4ae"},barColors:{grey:"#f5f5f5",red:"#ffcdd2",green:"#c8e6c9",orange:"#ffe0b2",blue:"#bbdefb","light-blue":"#b3e5fc",purple:"#e1bee7","deep-orange":"#ffccbc",cyan:"#b2ebf2",brown:"#d7ccc8","blue-grey":"#cfd8dc"}}}},methods:{showTooltip(){this.$q.platform.is.mobile&&this.$refs.tooltip.toogle()},onResize({width:t,height:e}){this.width=t,this.height=e}},computed:{valuesBySettings(){const t=this.item.dataTopics[0],e=this.item.settings.topics[0],i=this.item.settings.topics[1],s={};return t&&(s[t.topicFilter]=parseFloat(this.getValueByTopic(R()(this.value,`['${t.topicFilter}'].payload`,null),t))),e&&(s[e.topicFilter]=parseFloat(this.getValueByTopic(R()(this.value,`['${e.topicFilter}'].payload`,null),e))),i&&(s[i.topicFilter]=parseFloat(this.getValueByTopic(R()(this.value,`['${i.topicFilter}'].payload`,null),i))),s},currentValueText(){const t=R()(this.item,"dataTopics[0].topicFilter"),e=R()(this.valuesBySettings,`['${t}']`,"N/A");return e},currentValue(){const t=R()(this.item,"dataTopics[0].topicFilter"),e=R()(this.valuesBySettings,`['${t}']`,"N/A");return"number"!==typeof e||Number.isNaN(e)?0:this.mathProcessing(e,this.item.settings.math)},stringLength(){return this.currentValue.length+this.item.settings.units.length},maxValue(){return this.item.settings.maxValueMode===vt["i"]?this.item.settings.maxValue:this.item.settings.minValueMode===vt["j"]?this.valuesBySettings[R()(this.item,"settings.topics[1].topicFilter")]:this.valuesBySettings[R()(this.item,"settings.topics[0].topicFilter")]},minValue(){return this.item.settings.minValueMode===vt["i"]?this.item.settings.minValue:this.valuesBySettings[R()(this.item,"settings.topics[0].topicFilter")]},options(){const t=this.item.settings,e=t=>{const e=(this.maxValue-this.minValue)/10;return new Array(11).fill(0).reduce(((t,i,s,a)=>{if(0===s)t.push(this.minValue);else if(s===a.length-1)t.push(this.maxValue);else{let i=Math.round(100*(t[t.length-1]+e))/100;Number.isNaN(i)&&(i="N/A"),t.push(i)}return t}),[])};return{valueText:this.currentValue,minValue:this.minValue,maxValue:this.maxValue,width:this.width-16,height:this.height-16,majorTicks:e(t),units:t.units,animation:!0,animationRule:"linear",animationDuration:300,colorPlate:this.colors.border[this.item.color],colorBorderOuter:this.colors.border[this.item.color],colorBorderOuterEnd:this.colors.border[this.item.color],colorBorderMiddle:this.colors.border[this.item.color],colorBorderMiddleEnd:this.colors.border[this.item.color],colorBorderInner:this.colors.border[this.item.color],colorBorderInnerEnd:this.colors.border[this.item.color],borderShadowWidth:0,colorNeedleShadowDown:"#222",colorNeedle:"#d32f2f",colorNeedleEnd:"#d32f2f",colorUnits:"#616161",barWidth:8,colorBarProgress:this.colors.barColorsProgress[this.item.color],colorBar:this.colors.barColors[this.item.color],highlights:[{from:this.minValue,to:t.lowLevel,color:"rgba(79,195,247,1)"},{from:t.lowLevel,to:t.midLevel,color:"rgba(165,214,167,1)"},{from:t.midLevel,to:t.highLevel,color:"rgba(255,179,0,1)"},{from:t.highLevel,to:this.maxValue,color:"rgba(244,81,30,1)"}]}}},components:{LinearGauge:jn},mixins:[ya,$a]},Un=Wn,Gn=(i("dcc6"),Object(f["a"])(Un,Nn,Dn,!1,null,null,null)),Yn=Gn.exports;q()(Gn,"components",{QTooltip:S["a"],QResizeObserver:An["a"]});var Jn=function(){var t=this,e=t._self._c;return e("div",{staticStyle:{width:"100%",height:"100%"}},[e("div",{staticClass:"frame__payload",staticStyle:{height:"100%"}},[e("q-resize-observer",{on:{resize:t.onResize}}),null!==t.link?e("iframe",{ref:"frame",attrs:{src:t.link,frameborder:"0",height:t.height,width:t.width,autoplay:"",allowfullscreen:""}}):e("div",{staticClass:"bg-grey-5 text-grey-8 relative-position q-pt-xs",staticStyle:{height:"95%"}},[e("div",{staticStyle:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)"}},[e("q-icon",{attrs:{name:"mdi-block-helper",size:t.height/2+"px"}})],1),e("div",{staticStyle:{"font-size":"1.5rem"}},[t._v("Invalid link address")])])],1)])},Kn=[],Xn={name:"Frame",props:["item","index","mini","value","blocked"],data(){return{width:0,height:0,currentPayloads:[],isReady:!this.item.settings.readyMessage,IFRAME_MODE_INTEGRATION:ci,IFRAME_MODE_SHOW:di}},methods:{onResize({width:t,height:e}){this.width=t,this.height=e},send(t){this.$refs.frame&&this.$refs.frame.contentWindow.postMessage(t,"*")},getPayload(t){let e;if(this.item.settings.mode===ci){const i=this.item.settings.items[t].topic,s=R()(this.value,`['${i.topicFilter}'].payload`,null),a=this.getValueByTopic(s,i),n=R()(this.value,`['${i.topicFilter}'].topic`),o=n&&n.split("/");e=this.item.settings.items[t].template,e=e.replace("<{topic}>",n),e=e.replace(/<{topic\[(\d)\]}>/g,((t,e)=>o&&o[e])),e=e.replace(/<{payload}>/g,JSON.stringify(a)),e=e.replace(/<%([a-zA-Z0-9-+&@#/%?=~_|!:,.;\s]*)%>/gim,((t,e)=>JSON.stringify(R()(a,e,null))))}return e},update(){this.item.settings.items.forEach(((t,e)=>{if(!this.isReady)return!1;const i=this.getPayload(e);this.currentPayloads[e]!==i&&this.send(i),this.$set(this.currentPayloads,e,i)}))},checkTopicByAcl(t,e){return-1===t.indexOf("+")&&-1===t.indexOf("#")&&e.some((e=>{const i=new RegExp(e.replace("+","[0-9a-zA-Z-,.]+$").replace("#","(.*)"));return!!t.match(i)}))},handleActionMessage(t){if("string"===typeof t&&0===t.indexOf("MQTTTiles|")){let i="",s=null;t=t.split("|");const a=-1===t[1].indexOf("=>");t=t[a?2:1].split("=>"),i=t[0];try{s=JSON.parse(t[1])}catch(e){s=t[1]}if("publish"===i&&s&&"object"===typeof s){const t=this.checkTopicByAcl(s.topic,this.item.settings.aclTopics);if(t){const t={topic:s.topic,payload:s.payload,settings:{retain:s.retain}};console.log(t),this.$emit("action",t)}}}}},computed:{link(){if(this.item.settings.mode===ci)return this.item.settings.link;{const t=/\b(?:https?|ftp):\/\/[a-z0-9-+&@#/%?=~_|!:,.;]*[a-z0-9-+&@#/%=~_|]/gim,e=R()(this.item,"dataTopics[0].topicFilter"),i=R()(this.value,`['${e}'].payload`,null),s=this.getValueByTopic(i,this.item.dataTopics[0]);return s&&s.toString().match(t)?s:null}}},watch:{value:{deep:!0,handler(){this.update()}},item:{deep:!0,handler(){this.item.settings.initMessage&&this.send(this.item.settings.initMessage)}},blocked(t){this.send(`MQTTTiles|blocked=>${t}`)}},created(){window.addEventListener("message",(t=>{!this.isReady&&this.item.settings.readyMessage&&t.data===this.item.settings.readyMessage?(this.item.settings.initMessage&&this.send(this.item.settings.initMessage),this.isReady=!0,this.update(),this.send(`MQTTTiles|blocked=>${this.blocked}`)):this.handleActionMessage(t.data)}))},mounted(){this.$nextTick((()=>{this.item.settings.initMessage&&this.send(this.item.settings.initMessage),this.item.settings.readyMessage||this.send(`MQTTTiles|blocked=>${this.blocked}`)}))},mixins:[ya]},Zn=Xn,to=(i("2f2f"),Object(f["a"])(Zn,Jn,Kn,!1,null,null,null)),eo=to.exports;q()(to,"components",{QResizeObserver:An["a"],QIcon:x["a"]});var io=function(){var t=this,e=t._self._c;return t.mini?e("div",{staticStyle:{"text-align":"center"}},[e("div",{class:["bg-"+(null!==t.currentValue?`${t.item.color}-1`:"grey-3")],staticStyle:{height:"60px",width:"60px","line-height":"60px",margin:"0 auto","border-radius":"5px"}},[e("div",{staticClass:"ellipsis",style:{fontSize:(t.stringLength>5?16:18)+"px"}},[t._v("\n      "+t._s(`${t.currentLabel}`)+"\n    ")]),e("q-tooltip",{ref:"tooltip"},[t._v("\n      "+t._s(`${t.currentLabel} (${t.currentValue})`)+"\n    ")])],1),e("div",{staticClass:"ellipsis q-mt-sm"},[t._v(t._s(t.item.name))])]):e("q-list",{staticStyle:{height:"100%",overflow:"auto"}},[t.item.settings.items.length?t._l(t.item.settings.items,(function(i,s){return e("q-item",{key:`${s}${i.value}`,staticClass:"q-pa-none q-mb-xs",attrs:{tag:"label"}},[e("q-item-section",{attrs:{avatar:""}},[e("q-radio",{attrs:{val:i.val,color:`${t.item.color}-7`},model:{value:t.currentValue,callback:function(e){t.currentValue=e},expression:"currentValue"}})],1),e("q-item-section",{staticClass:"cursor-pointer"},[e("q-item-label",[t._v(t._s(i.label||i.val||"Empty"))]),t.item.settings.mode===t.COMMAND_MODE?e("q-item-label",{attrs:{caption:""}},[t._v(t._s(i.actionTopic))]):t._e(),t.item.settings.mode===t.COMMAND_MODE?e("q-item-label",{attrs:{caption:""}},[t._v("("+t._s(i.actionPayload||"*Empty*")+")")]):t._e()],1)],1)})):e("div",{staticClass:"text-italic text-bold text-center",class:[`text-${t.item.color}-8`]},[t._v("No items")])],2)},so=[],ao={name:"Singleselect",props:["item","index","value","mini","blocked"],data(){return{WIDGET_STATUS_DISABLED:vt["k"],DEFAULT_MODE:fi,COMMAND_MODE:yi,actionTopic:null,actionPayload:""}},computed:{currentLabel(){const t=this.item.settings.items.filter((t=>t.val===this.currentValue))[0];return t?t.label:"N/A"},stringLength(){return this.currentLabel.length},currentValue:{get(){const t=R()(this.item,"dataTopics[0].topicFilter"),e=this.getValueByTopic(R()(this.value,`['${t}'].payload`,null),this.item.dataTopics[0]);return e},set(t){this.setAction(t),this.actionHandler()}}},methods:{setAction(t){let e="",i="";if(this.item.settings.mode===fi){e=R()(this.item,"dataTopics[0].topicFilter"),i=t;const s=R()(this.item,"dataTopics[0].payloadField");s&&(i=this.getCleanValue(R()(this.value,`['${e}'].payload`,null),this.item.dataTopics[0]),"N/A"!==i&&(va.a.apply(i,s,(()=>t)),i=JSON.stringify(i)))}else{const s=this.item.settings.items.filter((e=>e.val===t))[0];e=s.actionTopic,i=s.actionPayload}this.actionTopic=e,this.actionPayload=i},actionHandler(){if(null!==this.actionTopic){const t={topic:this.actionTopic,payload:this.actionPayload,settings:{retain:this.item.settings.save}};this.$emit("action",t)}}},mixins:[ya]},no=ao,oo=i("3786"),ro=Object(f["a"])(no,io,so,!1,null,null,null),lo=ro.exports;q()(ro,"components",{QTooltip:S["a"],QList:Lt["a"],QItem:dt["a"],QItemSection:ut["a"],QRadio:oo["a"],QItemLabel:mt["a"]});var co=function(){var t=this,e=t._self._c;return e("div",{staticStyle:{width:"100%",position:"relative"}},t._l(t.widgets,(function(i,s){return e("div",{key:s,staticClass:"q-ma-sm",staticStyle:{display:"inline-block",position:"relative"},style:{width:t.widgetsWidth,minHeight:"radial"===t.item.settings.type||"linear"===t.item.settings.type?50*t.item.settings.widgetSettings.height+"px":""}},[e("q-card",{staticClass:"multiplier__widget-wrapper full-height full-width",class:t.wrapperClasses,attrs:{flat:"",inline:""}},[e("q-item",{staticClass:"q-px-sm q-pt-sm q-pb-none",staticStyle:{"min-height":"0"}},[e("q-item-section",{staticClass:"ellipsis",class:[`text-${t.item.settings.color}-7`],staticStyle:{"font-size":".9rem"}},[e("q-item-label",{staticClass:"ellipsis"},[t._v(t._s(i.name))]),e("q-tooltip",[t._v(t._s(i.name))])],1)],1),e("q-card-section",{staticClass:"q-pa-none",staticStyle:{height:"calc(100% - 25px)"}},[e(t.item.settings.type,{tag:"component",attrs:{item:t.widgets[s],value:{},index:s,blocked:!0}})],1),t.widgets[s].settings.isNeedTime?e("div",{staticClass:"widget__timestamp absolute-bottom-left",class:[`text-${t.item.settings.color}-7`,`bg-${t.item.settings.color}-1`]},[t._v("\n        12:00:00\n      ")]):t._e()],1)],1)})),0)},uo=[],po=function(){var t=this,e=t._self._c;return e("q-card",{staticClass:"complex__items-editor row col-12",class:[`bg-${t.item.color}-1`]},[e("div",{staticClass:"items__top col-12 flex q-px-md q-py-xs",staticStyle:{"background-color":"rgba(255,255,255,0.5)"}},[t._l(t.settings.items.filter((t=>"top"===t.position)),(function(i,s){return e(`my-${t.settings.items[i.index].type}`,{key:`top${s}${i.index}`,tag:"component",staticClass:"complex__element cursor-pointer",attrs:{item:t.settings.items[i.index],color:i.color,selected:!!t.edited&&"top"===t.edited.position&&t.edited.indexByPosition===s},nativeOn:{click:function(e){return t.selectHandler("top",s)}}})})),e("add-menu",{staticClass:"q-ml-sm",attrs:{anchor:"bottom left",self:"top left"},on:{add:e=>t.addItem(e,"top")}})],2),e("div",{staticClass:"items__left col-6 flex q-pa-sm"},[t._l(t.settings.items.filter((t=>"left"===t.position)),(function(i,s){return e(`my-${t.settings.items[i.index].type}`,{key:`left${s}${i.index}`,tag:"component",staticClass:"complex__element cursor-pointer",attrs:{item:t.settings.items[i.index],color:i.color,selected:!!t.edited&&"left"===t.edited.position&&t.edited.indexByPosition===s},nativeOn:{click:function(e){return t.selectHandler("left",s)}}})})),e("add-menu",{staticStyle:{width:"100%","min-height":"30px"},attrs:{anchor:"top middle",self:"bottom middle"},on:{add:e=>t.addItem(e,"left")}})],2),e("div",{staticClass:"items__right col-6 q-pa-sm"},[t._l(t.settings.items.filter((t=>"right"===t.position)),(function(i,s){return e(`my-${t.settings.items[i.index].type}`,{key:`right${s}${i.index}`,tag:"component",staticClass:"complex__element text-center cursor-pointer",attrs:{item:t.settings.items[i.index],color:i.color,selected:!!t.edited&&"right"===t.edited.position&&t.edited.indexByPosition===s},nativeOn:{click:function(e){return t.selectHandler("right",s)}}})})),e("add-menu",{staticStyle:{width:"100%","min-height":"30px"},attrs:{anchor:"top middle",self:"bottom middle"},on:{add:e=>t.addItem(e,"right")}})],2),e("div",{staticClass:"items__bottom col-12 flex q-px-md q-py-xs",staticStyle:{"background-color":"rgba(255,255,255,0.5)"}},[t._l(t.settings.items.filter((t=>"bottom"===t.position)),(function(i,s){return e(`my-${t.settings.items[i.index].type}`,{key:`bottom${s}${i.index}`,tag:"component",staticClass:"complex__element cursor-pointer",attrs:{item:t.settings.items[i.index],color:i.color,selected:!!t.edited&&"bottom"===t.edited.position&&t.edited.indexByPosition===s},nativeOn:{click:function(e){return t.selectHandler("bottom",s)}}})})),e("add-menu",{staticClass:"q-ml-sm",attrs:{anchor:"top right",self:"bottom middle"},on:{add:e=>t.addItem(e,"bottom")}})],2)])},mo=[],ho=function(){var t=this,e=t._self._c;return e("q-btn",{attrs:{dense:"",flat:"","icon-right":"mdi-plus",label:"add"}},[e("q-menu",{attrs:{anchor:t.anchor,self:t.self}},[e("q-list",{attrs:{dense:""}},[e("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:""},nativeOn:{click:function(e){return t.$emit("add","text")}}},[e("q-item-section",{attrs:{avatar:""}},[e("q-icon",{attrs:{name:"mdi-text-short"}})],1),e("q-item-section",[t._v("Text")])],1),e("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:""},on:{click:function(e){return t.$emit("add","knob")}}},[e("q-item-section",{attrs:{avatar:""}},[e("q-icon",{attrs:{name:"mdi-circle-slice-5"}})],1),e("q-item-section",[t._v("Knob")])],1),e("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:""},on:{click:function(e){return t.$emit("add","progress")}}},[e("q-item-section",{attrs:{avatar:""}},[e("q-icon",{attrs:{name:"mdi-percent"}})],1),e("q-item-section",[t._v("Progress")])],1)],1)],1)],1)},go=[],bo={name:"AddMenu",props:["anchor","self"]},vo=bo,fo=Object(f["a"])(vo,ho,go,!1,null,null,null),yo=fo.exports;q()(fo,"components",{QBtn:pt["a"],QMenu:ae["a"],QList:Lt["a"],QItem:dt["a"],QItemSection:ut["a"],QIcon:x["a"]}),q()(fo,"directives",{ClosePopup:oe["a"]});var xo=function(){var t=this,e=t._self._c;return e("div",{staticClass:"q-pa-xs",class:{"bg-grey-3":t.selected,"rounded-borders":t.selected,[`text-${t.color}-7`]:!0}},[e("div",{staticClass:"text-bold",staticStyle:{"word-break":"break-all"}},[t._v(t._s(t.item.label))]),e("div",{staticStyle:{"word-break":"break-all","font-size":".8rem"}},[t._v(t._s(t.computedValue))])])},So=[],_o={name:"Text",props:["item","value","selected","color"],computed:{computedValue(){const t=this.formatValue(this.value,this.item);return"N/A"===t||void 0===t?"*novalue*":t}},mixins:[$a]},qo=_o,wo=Object(f["a"])(qo,xo,So,!1,null,null,null),To=wo.exports,$o=function(){var t=this,e=t._self._c;return e("div",{staticClass:"q-pa-xs",class:{"bg-grey-3":t.selected,"rounded-borders":t.selected,[`text-${t.color}-7`]:!0}},[e("q-knob",{staticClass:"q-ma-sm",attrs:{thickness:.1,size:"7rem",value:void 0===t.value?50:"N/A"===t.value?0:t.value,min:t.item.min,max:t.item.max,readonly:"","show-value":"",color:`${t.color}-7`,"track-color":`${t.color}-2`}},[e("div",{staticClass:"text-center",staticStyle:{"font-size":".8rem",width:"100%"}},[t._v(t._s(t.item.label))]),e("div",{staticClass:"text-center",staticStyle:{"font-size":".8rem",width:"100%"}},[t._v(t._s(`${void 0===t.value?"value":t.value}/${void 0===t.value?"max":t.item.max}`))])])],1)},Co=[],ko={name:"Knob",props:["item","value","selected","color"]},Io=ko,Vo=i("3845"),Mo=Object(f["a"])(Io,$o,Co,!1,null,null,null),Oo=Mo.exports;q()(Mo,"components",{QKnob:Vo["a"]});var Bo=function(){var t=this,e=t._self._c;return e("div",{staticClass:"q-pa-xs",class:{"bg-grey-3":t.selected,"rounded-borders":t.selected,[`text-${t.color}-7`]:!0}},[e("div",[t._v(t._s(t.item.label))]),e("q-linear-progress",{staticStyle:{"min-width":"150px"},attrs:{value:t.percentage/100,color:`${t.color}-7`}}),e("div",{staticStyle:{float:"right","font-size":".8rem"}},[t._v(t._s(`${void 0===t.value?"value":t.value}/${void 0===t.value?"max":t.item.max}`))])],1)},Eo=[],Ao={name:"Progress",props:["item","value","selected","color"],computed:{percentage(){return"undefined"===typeof this.value||null===this.value||"N/A"===this.value?0:100*(this.value-this.item.min)/(this.item.max-this.item.min)}}},Fo=Ao,Lo=i("6b1d"),No=Object(f["a"])(Fo,Bo,Eo,!1,null,null,null),Do=No.exports;q()(No,"components",{QLinearProgress:Lo["a"]});var Qo={props:["item","index","value"],data(){return{edited:null}},computed:{settings(){return this.item.settings}},methods:{addItem(t,e){this.$widgetBus.$emit("add",{type:t,position:e}),this.$nextTick((()=>{const t=this.settings.items.filter((t=>t.position===e)).length-1;this.selectHandler(e,t)}))},selectHandler(t,e){let i=-1;this.settings.items.reduce(((s,a,n)=>(a.position===t&&(s++,s===e&&(i=n)),s)),-1),this.edited={position:t,indexByPosition:e,index:i},this.$widgetBus.$emit("edit",this.edited)}},components:{AddMenu:yo,MyText:To,MyKnob:Oo,MyProgress:Do}},Ho=Qo,Ro=Object(f["a"])(Ho,po,mo,!1,null,null,null),Po=Ro.exports;q()(Ro,"components",{QCard:se["a"]});var zo={name:"MultiplierPreview",props:["item","index","value"],data(){return{WIDGET_STATUS_DISABLED:vt["k"]}},computed:{widgets(){let t=["example","example1","example2"];"complex"===this.item.settings.type&&(t=["example"]);const e={switcher:"1",informer:"*some text*",radial:50,linear:50,singleselect:"1",complex:'{"a": 1, "b": 2, "c": 3}'};return t.reduce(((t,i)=>(t[i]={name:i,id:i,color:this.item.settings.color,type:this.item.settings.type,topics:["example"],dataTopics:[Object(bt["b"])({topicTemplate:"example",topicFilter:"example",default:e[this.item.settings.type]})],settings:F()(this.item.settings.widgetSettings),status:vt["k"]},t)),{})},wrapperClasses(){const t=[`bg-${this.item.settings.color}-1`];return"radial"!==this.item.settings.type&&"linear"!==this.item.settings.type||t.push("absolute"),t},widgetsWidth(){let t=this.item.settings.widgetSettings.width/this.item.settings.width*100;return t=t<=33?33:t<=50?50:100,this.$q.platform.is.mobile&&(t=100),`calc(${t}% - 16px)`}},components:{Switcher:Va,Informer:nn,Radial:Ln,Linear:Yn,Singleselect:lo,Complex:Po}},jo=zo,Wo=(i("5ece"),Object(f["a"])(jo,co,uo,!1,null,"10080630",null)),Uo=Wo.exports;q()(Wo,"components",{QCard:se["a"],QItem:dt["a"],QItemSection:ut["a"],QItemLabel:mt["a"],QTooltip:S["a"],QCardSection:ne["a"]});var Go=function(){var t=this,e=t._self._c;return t.mini?e("div",{staticStyle:{"text-align":"center"},on:{click:function(e){return e.stopPropagation(),t.showTooltip.apply(null,arguments)}}},[e("div",{class:["bg-"+(null!==t.currentValueText?`${t.item.color}-1`:"grey-3")],staticStyle:{height:"60px",width:"60px","line-height":"60px",margin:"0 auto","border-radius":"5px"}},[e("div",{staticClass:"ellipsis",style:{fontSize:(t.stringLength>5?16:18)+"px"}},[t._v("\n      "+t._s(`${t.currentValueText}`)+"\n    ")]),e("q-tooltip",{ref:"tooltip"},[t._v("\n      "+t._s(`${t.currentValueText}`)+"\n    ")])],1),e("div",{staticClass:"ellipsis q-mt-sm"},[t._v(t._s(t.item.name))])]):e("div",{staticClass:"full-width full-height"},[e("div",{staticClass:"slider__payload q-px-md flex flex-center",staticStyle:{height:"100%"}},[e("div",{staticStyle:{width:"100%"}},[e("q-slider",{attrs:{value:t.isValueValid?t.currentValue:0,color:`${t.item.color}-7`,disable:!t.isValueValid,min:t.minValue,max:t.maxValue,step:t.item.settings.step},on:{change:t.actionHandler}}),e("div",{class:[`text-${t.item.color}-7`,"text-bold"]},[t._v(t._s(t.currentValueText))])],1)])])},Yo=[],Jo={name:"Slider",props:["item","index","mini","value","blocked"],data(){return{WIDGET_STATUS_DISABLED:vt["k"]}},methods:{showTooltip(){this.$q.platform.is.mobile&&this.$refs.tooltip.toogle()},actionHandler(t){const e=this.item.dataTopics[0],i=e.topicFilter,s=e.payloadField;let a=`${t}`;s&&(a=this.getCleanValue(this.value[i]&&this.value[i].payload,e),"N/A"!==a&&(va.a.apply(a,s,(()=>+t)),a=JSON.stringify(a)));const n={topic:i,payload:a,settings:{retain:this.item.settings.save}};this.$emit("action",n)}},computed:{valuesBySettings(){const t=this.item.dataTopics[0],e=this.item.settings.topics[0],i=this.item.settings.topics[1],s={};return t&&(s[t.topicFilter]=parseFloat(this.getValueByTopic(R()(this.value,`['${t.topicFilter}'].payload`,null),t))),e&&(s[e.topicFilter]=parseFloat(this.getValueByTopic(R()(this.value,`['${e.topicFilter}'].payload`,null),e))),i&&(s[i.topicFilter]=parseFloat(this.getValueByTopic(R()(this.value,`['${i.topicFilter}'].payload`,null),i))),s},currentValueText(){return`${this.currentValue}${this.item.settings.units}`},currentValue:{get(){const t=R()(this.item,"dataTopics[0].topicFilter"),e=R()(this.valuesBySettings,`['${t}']`,"N/A");return e},set(t){this.actionHandler(t)}},isValueValid(){return"number"===typeof this.currentValue&&!Number.isNaN(this.currentValue)},stringLength(){return this.currentValueText.length+this.item.settings.units.length},maxValue(){return this.item.settings.maxValueMode===vt["i"]?this.item.settings.maxValue:this.item.settings.minValueMode===vt["j"]?this.valuesBySettings[R()(this.item,"settings.topics[1].topicFilter")]:this.valuesBySettings[R()(this.item,"settings.topics[0].topicFilter")]},minValue(){return this.item.settings.minValueMode===vt["i"]?this.item.settings.minValue:this.valuesBySettings[R()(this.item,"settings.topics[0].topicFilter")]}},mixins:[ya]},Ko=Jo,Xo=(i("8a3b"),i("c1d0")),Zo=Object(f["a"])(Ko,Go,Yo,!1,null,null,null),tr=Zo.exports;q()(Zo,"components",{QTooltip:S["a"],QSlider:Xo["a"]});var er=function(){var t=this,e=t._self._c;return t.mini?e("div",{staticStyle:{"text-align":"center"},on:{click:function(e){return e.stopPropagation(),t.showTooltip.apply(null,arguments)}}},[e("div",{class:["bg-"+(t.disable?"grey-3":`${t.item.color}-1`)],staticStyle:{height:"60px",width:"60px","line-height":"60px",margin:"0 auto","border-radius":"5px"}},[e("div",{staticStyle:{"border-radius":"50%",height:"80%",width:"80%",display:"inline-block","vertical-align":"middle"},style:{backgroundColor:t.miniColor}})]),e("div",{staticClass:"ellipsis q-mt-sm"},[t._v(t._s(t.item.name))])]):e("div",{staticClass:"color__payload-wrapper flex flex-center"},[t.item.settings.mode===t.COLOR_MODE_SIMPLE?e("color-picker",{attrs:{hue:t.color.h,disabled:t.disable},on:{input:t.actionHandler}}):e("q-color",{class:[`bg-${t.item.color}-1`],staticStyle:{border:"none"},attrs:{disable:t.disable,value:t.color,readonly:t.item.dataTopics[0]&&!!t.item.dataTopics[0].topicField,"default-value":"#FFF"},on:{input:t.actionHandler}})],1)},ir=[],sr=i("1ba3"),ar=(i("4c60"),i("bc78"));const{rgbToHex:nr,rgbToHsv:or,hexToRgb:rr,hsvToRgb:lr}=ar["a"];var cr={name:"Color",props:["item","index","mini","value"],data(){return{WIDGET_STATUS_DISABLED:vt["k"],COLOR_FORMAT_HEX:zi,COLOR_FORMAT_RGB:ji,COLOR_FORMAT_HSV:Wi,COLOR_MODE_SIMPLE:Ui,COLOR_MODE_FULL:Gi,disable:!1}},methods:{showTooltip(){this.$q.platform.is.mobile&&this.$refs.tooltip.toogle()},toggleStatus(t){return this.disable=t,t},getObjByTemplate(t,e){let i={};const s=[];e=e.replace(/\{|\}|\[|\]|\(|\)/g,(t=>`\\${t}`)),e=new RegExp(e.replace(/%[hex|r|g|b|h|s|v|a]{1,3}%/g,(t=>(s.push(t.slice(1,-1)),"([.#A-Za-z0-9]+)"))));try{let a=t.match(e);return a=a.slice(1),s.forEach(((t,e)=>{this.item.settings.format===zi&&"hex"===t?i[t]=void 0===a[e]?"#ffffff":a[e]:i[t]=void 0===a[e]?100:parseInt(a[e])})),this.item.settings.format===zi&&(i=i.hex),i}catch(a){return s.forEach(((t,e)=>{i[t]=100})),i}},getModelColor(t){if(this.toggleStatus("N/A"===t),this.item.settings.valueTemplate)t=this.getObjByTemplate(t,this.item.settings.valueTemplate);else try{t=JSON.parse(t)}catch(e){}switch(this.item.settings.format){case zi:this.item.settings.mode===Ui?(t="string"===typeof t&&0===t.indexOf("#")?t:`#${t}`,t=or(rr(t))):(t=rr("string"===typeof t?t:"#ffffff"),t=`rgb(${t.r},${t.g},${t.b})`);break;case ji:if(this.item.settings.mode===Ui)t=or(t);else{const e="string"===typeof t&&0===t.indexOf("#"),i="object"===typeof t&&void 0!==t.h&&void 0!==t.s&&void 0!==t.v;t=e?rr(t):i?lr(t):t,t=`rgb(${t.r},${t.g},${t.b})`}break;case Wi:this.item.settings.mode===Gi&&(t=lr(t),t=`rgb(${t.r},${t.g},${t.b})`);break}return t},getRGBObj(t){const e=t.match(/rgba?\((\d{1,3}), ?(\d{1,3}), ?(\d{1,3})\)?(?:, ?(\d(?:\.\d?))\))?/);return e?{r:Number(e[1]),g:Number(e[2]),b:Number(e[3])}:{r:0,g:0,b:0}},getActionColor(t){if(this.item.settings.mode===Ui)switch(t={h:t,s:100,v:100,a:100},this.item.settings.format){case zi:t=nr(lr(t));break;case ji:t=lr(t);break;case Wi:break}else t=this.getRGBObj(t),this.item.settings.format===Wi?t=or(t):this.item.settings.format===zi&&(t=nr(t));return this.item.settings.valueTemplate&&(t=this.item.settings.valueTemplate.replace(/%[hex|r|g|b|h|s|v|a]{1,3}%/g,(e=>{const i=e.slice(1,-1);return void 0===t[i]?t||"":t[i]}))),this.item.settings.publishTemplate&&(t=this.item.settings.publishTemplate.replace("%value%",JSON.stringify(t))),t}},computed:{topic(){return R()(this.item,"dataTopics[0].topicFilter")},colorValue(){const t=R()(this.value,`['${this.topic}'].payload`,null);return this.getValueByTopic(t,this.item.dataTopics[0])},color(){return this.getModelColor(this.colorValue)},miniColor(){let t=this.color;return"string"===typeof t?t:(void 0!==t.r&&void 0!==t.g&&void 0!==t.b||(t=lr(t)),`rgba(${t.r}, ${t.g}, ${t.b}, ${void 0===t.a?100:t.a})`)}},created(){this.actionHandler=O()((t=>{const e=R()(this.item,"dataTopics[0]");t=this.getActionColor(t);const i=e.topicFilter,s=e.payloadField;let a=t;s?(a=this.getCleanValue(this.value[i]&&this.value[i].payload,e),"N/A"!==a&&(va.a.apply(a,s,(()=>t)),a=JSON.stringify(a))):"object"===typeof t&&(a=JSON.stringify(t));const n={topic:i,payload:a,settings:{retain:this.item.settings.save}};this.$emit("action",n)}),300)},components:{ColorPicker:sr["a"]},mixins:[ya]},dr=cr,ur=(i("3fc9"),Object(f["a"])(dr,er,ir,!1,null,null,null)),pr=ur.exports;q()(ur,"components",{QColor:_e["a"]});var mr=function(){var t=this,e=t._self._c;return e("div",{staticStyle:{width:"100%",height:"100%"}},[e("iframe",{ref:"map",staticStyle:{width:"100%",height:"100%"},attrs:{src:t.route,frameborder:"0",allowfullscreen:""}}),e("div",{staticClass:"absolute-top-left q-pa-xs hidden",class:[`text-${t.item.color}-7`,`bg-${t.item.color}-1`],staticStyle:{"font-size":".8rem","border-bottom-left-radius":"4px"}},[t._v(t._s(t.positions))])])},hr=[],gr={name:"MapLocation",props:["item","index","mini","value","blocked"],data(){const t=Object($["a"])();return{route:`https://flespi.io/mapview/#/salt/${t}`,salt:t,WIDGET_STATUS_DISABLED:vt["k"],prevPositions:{}}},computed:{positions(){const t=this.item.settings.items.reduce(((t,e,i)=>{const s=this.item.settings.topics[2*i],a=this.item.settings.topics[2*i+1],n=R()(this.value,`['${s.topicFilter}'].payload`,null),o=R()(this.value,`['${a.topicFilter}'].payload`,null);let r=parseFloat(this.getValueByTopic(n,s)),l=parseFloat(this.getValueByTopic(o,a));return r&&l?t[e.name]={latlng:[r,l],title:[r,l],label:e.name}:this.prevPositions[e.name]&&this.prevPositions[e.name].lat&&this.prevPositions[e.name].lon&&(r=this.prevPositions[e.name].lat,l=this.prevPositions[e.name].lon,t[e.name]={latlng:[r,l],title:[r,l],label:e.name}),t}),{});return this.setPosition(t),t}},methods:{setPosition(t){this.$refs.map&&this.$refs.map.contentWindow.postMessage(`MapView-${this.salt}|cmd:{"namedmarkers": ${JSON.stringify(t)}, "clear": "all", "fullscreencontrol": true}`,"*"),this.prevPositions=t}},watch:{"item.settings.items"(){this.setPosition(this.positions)}},created(){window.addEventListener("message",(t=>{t.data===`MapView-${this.salt}|state:{"ready": true}`&&this.setPosition(this.positions)}))},mixins:[ya]},br=gr,vr=Object(f["a"])(br,mr,hr,!1,null,null,null),fr=vr.exports,yr=function(){var t=this,e=t._self._c;return e("div",{staticStyle:{width:"100%",height:"100%"}},[e("iframe",{ref:"map",staticStyle:{width:"100%",height:"100%"},attrs:{src:t.route,frameborder:"0",allowfullscreen:""}})])},xr=[],Sr={name:"MapRoute",props:["item","index","mini","value","blocked"],data(){const t=Object($["a"])();return{route:`https://flespi.io/mapview/#/salt/${t}`,salt:t,WIDGET_STATUS_DISABLED:vt["k"],prevRoute:[]}},methods:{setRoutes(t){this.$refs.map&&this.$refs.map.contentWindow.postMessage(`MapView-${this.salt}|cmd:{"addgroutes": ${JSON.stringify(t)}, "clear": "all", "fullscreencontrol": true}`,"*"),this.prevRoute=t},getRoutes(){const t=this.item.settings.items.reduce(((t,e,i)=>{const s=this.item.settings.topics[i];let a=this.getValueByTopic(this.value[s.topicFilter]&&this.value[s.topicFilter].payload,s);return a="N/A"===a?"":a,Array.isArray(a)?t=[...t,...a]:t.push(a),t}),[]);return t}},created(){window.addEventListener("message",(t=>{t.data===`MapView-${this.salt}|state:{"ready": true}`&&this.setRoutes(this.getRoutes())}))},mixins:[ya],watch:{value:{deep:!0,handler(t){const e=this.getRoutes();(e.length!==this.prevRoute.length||this.prevRoute.some(((t,i)=>t!==e[i])))&&this.setRoutes(this.getRoutes())}},"item.settings.topics"(){this.setRoutes(this.getRoutes())}}},_r=Sr,qr=Object(f["a"])(_r,yr,xr,!1,null,null,null),wr=qr.exports,Tr=function(){var t=this,e=t._self._c;return t.mini?e("div",{staticStyle:{"text-align":"center"}},[e("div",{class:["bg-"+(null!==t.currentValue?`${t.item.color}-1`:"grey-3")],staticStyle:{height:"60px",width:"60px","line-height":"60px",margin:"0 auto","border-radius":"5px"}},[t.needShowIcon?e("q-icon",{style:{color:t.activeItem.color},attrs:{size:"3rem",name:`mdi-${t.activeItem.icon||t.item.settings.defaultIcon}`}}):e("div",{staticStyle:{"text-overflow":"ellipsis",overflow:"hidden"},style:{color:t.activeItem.color}},[t._v(t._s(t.activeItem.label))])],1),e("div",{staticClass:"ellipsis q-mt-sm"},[t._v(t._s(t.item.name))])]):e("div",{staticClass:"full-width full-height"},[t.needShowIcon?e("q-icon",{staticStyle:{width:"100%"},style:{color:t.activeItem.color,fontSize:`${t.size}rem`,height:t.activeItem.label&&t.item.settings.isNeedShowTitles?"calc(100% - 25px)":"100%"},attrs:{name:`mdi-${t.activeItem.icon||t.item.settings.defaultIcon}`}}):e("div",{staticClass:"flex flex-center",staticStyle:{width:"100%",height:"100%"},style:{color:t.activeItem.color}},[t._v(t._s(t.activeItem.label))]),t.activeItem.label&&t.needShowIcon&&t.item.settings.isNeedShowTitles?e("div",{staticClass:"flex flex-center ellipsis",staticStyle:{width:"100%"},style:{color:t.activeItem.color}},[t._v(t._s(t.activeItem.label))]):t._e()],1)},$r=[],Cr={name:"StatusIndicator",props:["item","index","value","mini","in-shortcuts","blocked"],data(){return{WIDGET_STATUS_DISABLED:vt["k"],DEFAULT_MODE:ms,COMMAND_MODE:hs,actionTopic:null,actionPayload:"",valueExpired:!1,expireValueTimeoutId:0}},computed:{needShowIcon(){return this.item.settings.defaultIcon||this.activeItem.icon||!this.activeItem.label},size(){const t=this.item.settings.height,e=this.item.settings.width,i=t>e?e:t,s=this.activeItem.label&&this.needShowIcon&&this.item.settings.isNeedShowTitles?2:2.5;return i*s},currentValue:{get(){const t=R()(this.item,"dataTopics[0].topicFilter"),e=R()(this.value,`['${t}'].payload`,null);return this.item.settings.resetTimeout?this.setExpireLogic():this.clearExpireLogic(),this.valueExpired?null:this.mathProcessing(this.getValueByTopic(e,this.item.dataTopics[0]),this.item.settings.math)},set(t){this.setAction(t),this.actionHandler()}},activeItem(){const t=this.item.settings.items[0],e=this.item.settings.items.slice(1).filter((t=>t.val===this.mathProcessing(this.currentValue,t.math)));return e[0]||t},contentHeight(){let t="calc(100% - 22px)";return!this.item.name&&this.blocked&&(t="calc(100% - 4px)"),t}},methods:{setAction(t){let e="",i="";if(this.item.settings.mode===ms)e=this.item.dataTopics[0].topicFilter,i=t;else{const s=this.item.settings.items.filter((e=>e.val===t))[0];e=s.actionTopic,i=s.actionPayload}this.actionTopic=e,this.actionPayload=i},actionHandler(){if(null!==this.actionTopic){const t={topic:this.actionTopic,payload:this.actionPayload,settings:{retain:this.item.settings.save}};this.$emit("action",t)}},setExpireLogic(){this.expireValueTimeoutId&&(clearTimeout(this.expireValueTimeoutId),this.expireValueTimeoutId=0);const t=Date.now(),e=this.time+1e3*this.item.settings.resetTimeout;t>e?this.valueExpired=!0:(this.valueExpired=!1,this.expireValueTimeoutId=setTimeout((()=>{this.valueExpired=!0}),e-t))},clearExpireLogic(){this.valueExpired=!1,this.expireValueTimeoutId&&(clearTimeout(this.expireValueTimeoutId),this.expireValueTimeoutId=0)}},mixins:[ya,te,$a]},kr=Cr,Ir=(i("a2d8"),Object(f["a"])(kr,Tr,$r,!1,null,null,null)),Vr=Ir.exports;q()(Ir,"components",{QIcon:x["a"]});var Mr=function(){var t=this,e=t._self._c;return e("div",{staticClass:"text-sender__payload-wrapper relative-position",staticStyle:{height:"100%"}},[e("q-btn",{staticClass:"text-sender__send q-pa-none q-mr-xs absolute-bottom-right",attrs:{size:"0.7rem",icon:"mdi-send",dense:"",flat:"",color:"yellow-9"},on:{click:t.sendHandler}},[e("q-tooltip",[t._v("Send")])],1),e("textarea",{directives:[{name:"model",rawName:"v-model",value:t.textModel,expression:"textModel"}],staticClass:"text-sender__payload absolute-top-left absolute-bottom-right",attrs:{placeholder:"Type your text here"},domProps:{value:t.textModel},on:{input:function(e){e.target.composing||(t.textModel=e.target.value)}}})],1)},Or=[],Br={name:"TextSender",props:["item","index","mini","value","blocked"],data(){return{WIDGET_STATUS_DISABLED:vt["k"],textModel:""}},methods:{setTextModel(t){this.textModel=t},sendHandler(){const t={topic:this.item.settings.topics[0].topicFilter,payload:this.textModel,settings:{retain:this.item.settings.save}};this.$emit("action",t)}},computed:{text(){const t=this.item.settings.topics[0],e=this.getValueByTopic(this.value[t.topicFilter]&&this.value[t.topicFilter].payload,t);return this.setTextModel(e),e}},watch:{value:{deep:!0,immediate:!0,handler(){const t=this.item.settings.topics[0],e=this.getValueByTopic(this.value[t.topicFilter]&&this.value[t.topicFilter].payload,t);this.setTextModel(e)}}},mixins:[ya,$a]},Er=Br,Ar=(i("6de5"),Object(f["a"])(Er,Mr,Or,!1,null,null,null)),Fr=Ar.exports;q()(Ar,"components",{QBtn:pt["a"],QTooltip:S["a"]});var Lr=function(){var t=this,e=t._self._c;return e("div",{staticClass:"calculator__payload-wrapper",staticStyle:{"padding-bottom":"15px"},domProps:{innerHTML:t._s(t.text)}})},Nr=[];const Dr={whiteList:{a:["href","title","target","style","class"],span:["style","class"],div:["style","class"],table:["style","class"],tr:["style","class"],td:["style","class"],th:["style","class"],b:["style","class"],i:["style","class"],em:["style","class"],sub:["style","class"],sup:["style","class"],s:["style","class"],hr:["style","class"],small:["style","class"],br:["style","class"]}};var Qr={name:"Calculator",props:["item","index","mini","value"],data(){return{WIDGET_STATUS_DISABLED:vt["k"]}},methods:{resolveValues(t){return t.replace(/%topic\[(\d*)\](\((.*)\))?%/g,((t,e,i,s)=>{let a="";return a=s?`<%${e}${s.slice(1)}%>`:`<%${e}%>`,a}))}},computed:{valuesByIndex(){return this.item.dataTopics.reduce(((t,e,i)=>{const s=R()(this.value,`['${e.topicFilter}'].payload`,null);return t[i+1]=this.getValueByTopic(s,e),t}),{})},variables(){return this.item.settings.variables.reduce(((t,e)=>{let i=e.math;return i=i.replace(/%variable\[([a-zA-Z0-9-+&@#/%?=~_|!:,.;\s]*)\]%/g,((e,i)=>t[i]||"nill")),t[e.name]=this.formatValue(this.mathProcessing(this.valuesByIndex,this.resolveValues(i)),{...e,math:void 0}),t}),{})},text(){let t=this.item.settings.template;return t=t.replace(/%variable\[([a-zA-Z0-9-+&@#/%?=~_|!:,.;\s]*)\]%/g,((t,e)=>this.variables[e]||"nill")),t=t.replace(/%topic\[(\d*)\](\((.*)\))?%/g,((t,e,i,s)=>{let a=this.valuesByIndex[e];return s&&(a=R()(a,`${e}${s.slice(1)}`,void 0)),a||"nill"})),Qa()(t,Dr)}},mixins:[ya,$a]},Hr=Qr,Rr=Object(f["a"])(Hr,Lr,Nr,!1,null,null,null),Pr=Rr.exports,zr=function(){var t=this,e=t._self._c;return t.currentSettings.image?e("div",{staticClass:"full-height"},[e("div",{staticClass:"scheme__add-pannel",class:[`bg-${t.item.color}-2`]},[t._l(t.itemTypes,(function(i){return e("q-btn",{key:i.value,attrs:{flat:"",dense:"",icon:i.icon,color:"grey-7"},on:{click:function(e){return t.addTypedItem(i.value)}}},[e("q-tooltip",[t._v("Add "+t._s(i.label))])],1)})),e("q-btn",{staticClass:"float-right",attrs:{dense:"",flat:"",icon:"mdi-close",color:"red"},on:{click:t.clearImage}},[e("q-tooltip",[t._v("Remove image")])],1)],2),e("div",{ref:"imageWrapper",staticClass:"scheme__image-wrapper q-pa-xs relative-position",class:[`bg-${t.item.color}-1`],attrs:{draggable:"false"}},[e("img",{style:{maxHeight:`${t.maxHeight}px`},attrs:{src:t.currentSettings.image,width:"100%",draggable:"false"},on:{click:function(e){return t.setActive(void 0)}}}),t._l(t.currentSettings.items,(function(i,s){return e("div",{directives:[{name:"touch-pan",rawName:"v-touch-pan.prevent.mouse",value:e=>{t.activeItemIndex===s&&t.onMove(e,s)},expression:"e => { if (activeItemIndex === index) { onMove(e, index) } }",modifiers:{prevent:!0,mouse:!0}}],key:s,ref:"dragItems",refInFor:!0,staticClass:"scheme__item-view-wrapper absolute cursor-pointer",class:{"scheme__item-view-wrapper--active":t.activeItemIndex===s,"scheme__item-view-wrapper--error":t.errorsByItems[s]},style:{left:`${i.position.left}%`,top:`${i.position.top}%`,width:`${i.width}%`,height:`${i.height}%`},on:{click:function(e){return t.setActive(s)}}},[e(`${i.type}-view`,{tag:"component",staticClass:"full-height overflow-hidden",attrs:{item:i}}),t.activeItemIndex===s?[e("div",{directives:[{name:"touch-pan",rawName:"v-touch-pan.prevent.mouse",value:e=>t.onResize(e,s),expression:"e => onResize(e, index)",modifiers:{prevent:!0,mouse:!0}}],staticClass:"item-view-wrapper__size-handler"}),e("q-btn",{staticClass:"absolute-top-right",staticStyle:{top:"-4px",right:"-4px"},attrs:{color:"red",icon:"mdi-close",dense:"",round:"",unelevated:"",size:"5px"},on:{click:function(e){return t.removeItem(s)}}},[e("q-tooltip",[t._v("Remove widget")])],1)]:t._e()],2)}))],2)]):e("q-file",{ref:"file",staticClass:"scheme__image-picker q-mb-md",attrs:{borderless:"",accept:"image/*","max-file-size":"1048576"},on:{input:t.getBase64},model:{value:t.image,callback:function(e){t.image=e},expression:"image"}},[e("div",{staticClass:"absolute-full text-center"},[e("q-icon",{staticStyle:{"margin-top":"40px"},attrs:{name:"mdi-image",color:t.item.color,size:"4rem"}}),e("div",{staticClass:"text-h5 text-grey-9"},[t._v("Upload image")]),e("div",{staticClass:"text-grey-9",staticStyle:{"font-size":".8rem"}},[t._v("Max size: 2MB")])],1)])},jr=[],Wr=function(){var t=this,e=t._self._c;return e("div",{ref:"text",staticClass:"scheme__text",class:t.item.settings.modificators.map((t=>`text-${t}`)),style:`color:${t.item.settings.color}; ${t.item.settings.style}`},[t._v("\n  "+t._s(t.item.settings.label)+"\n")])},Ur=[],Gr=i("13f7"),Yr={props:["item","value","widget"],data(){return{textEl:null}},methods:{fitInit(){this.textEl=Object(Gr["a"])(this.$refs.text,{minSize:8,maxSize:75})},fitRemove(){this.textEl.unsubscribe()},fit(){this.item.settings.autoresize&&this.textEl.fit()}},mounted(){this.item.settings.autoresize&&this.fitInit()},beforeDestroy(){this.item.settings.autoresize&&this.fitRemove()},watch:{"widget.settings.height"(){this.fit()},"widget.settings.width"(){this.fit()},"item.width"(){this.fit()},"item.height"(){this.fit()},"item.settings.modificators":{deep:!0,handler(){this.fit()}},"item.settings.autoresize"(t){t?this.fitInit():this.fitRemove()}}},Jr=Yr,Kr=Object(f["a"])(Jr,Wr,Ur,!1,null,null,null),Xr=Kr.exports,Zr=function(){var t=this,e=t._self._c;return e("text-view",{ref:"text",staticClass:"scheme__text",class:[...t.item.settings.modificators.map((t=>`text-${t}`)),""+(t.needOverflow?"scheme__text--block":"")],style:`color:${t.item.settings.color}; ${t.item.settings.style}`,attrs:{text:t.text,title:t.item.label,prefix:t.item.settings.prefix,postfix:t.item.settings.postfix,settings:t.item.settings}})},tl=[],el={props:["item","value","widget"],components:{TextView:tn},data(){return{textEl:null,WIDGET_VALUE_FORMAT_STRING:vt["s"],WIDGET_VALUE_FORMAT_HUMAN_READABLE_SIZE:vt["o"],WIDGET_VALUE_FORMAT_DATE:vt["m"],WIDGET_VALUE_FORMAT_PRE:vt["r"],WIDGET_VALUE_FORMAT_MARKDOWN:vt["q"],WIDGET_VALUE_FORMAT_JSON:vt["p"],WIDGET_VALUE_FORMAT_DURATION:vt["n"]}},computed:{needOverflow(){const t=this.item.settings.valueFormat;return t===vt["p"]||t===vt["q"]},title(){let t;if(this.value)t=this.getValueByTopic(this.value,this.item.topic);else{const e=this.item.settings.valueFormat;t=e===vt["p"]?JSON.stringify({label:"value",some:"example"}):e===vt["n"]||e===vt["o"]?100:e===vt["m"]?Date.now():this.item.label}return t},text(){return this.formatValue(this.title,this.item.settings)}},methods:{fitInit(){this.textEl=Object(Gr["a"])(this.$refs.text.$el,{minSize:8,maxSize:75})},fitRemove(){this.textEl.unsubscribe()},fit(){this.item.settings.autoresize&&this.textEl.fit()}},mounted(){this.item.settings.autoresize&&this.fitInit()},beforeDestroy(){this.item.settings.autoresize&&this.fitRemove()},watch:{"widget.settings.height"(){this.fit()},"widget.settings.width"(){this.fit()},"item.width"(){this.fit()},"item.height"(){this.fit()},"item.settings.modificators":{deep:!0,handler(){this.fit()}},value(){this.fit()},"item.settings.autoresize"(t){t?this.fitInit():this.fitRemove()}},mixins:[ya,$a]},il=el,sl=(i("1f6e"),Object(f["a"])(il,Zr,tl,!1,null,"ca020040",null)),al=sl.exports,nl=function(){var t=this,e=t._self._c;return e("div",{ref:"wrapper",staticClass:"text-center full-height"},[e("q-resize-observer",{on:{resize:t.onResize}}),e("q-icon",{class:[""+(t.isActiveWidget?"cursor-pointer":"")],style:{color:t.color},attrs:{size:`${t.size}px`,name:t.currentValue?`mdi-${t.item.settings.trueIcon||"toggle-switch-outline"}`:`mdi-${t.item.settings.falseIcon||"toggle-switch-off-outline"}`},nativeOn:{click:function(e){return t.actionHandler.apply(null,arguments)}}})],1)},ol=[];const rl=0,ll=1;var cl={props:["item","value","widget"],data(){return{wrapperSize:{width:15,height:15}}},computed:{size(){const{width:t,height:e}=this.wrapperSize,i=e>t?t:e;return i},color(){let t="#e0e0e0e";return null!==this.currentValue&&(t=this.currentValue?this.item.settings.trueColor:this.item.settings.falseColor),t},actionTopic(){let t=null;return t=null===this.currentValue?null:this.item.settings.mode===ll?this.currentValue?this.item.settings.falseActionTopic:this.item.settings.trueActionTopic:this.item.topic.topicTemplate,t},isActiveWidget(){return!!this.actionTopic&&(this.item.settings.mode===ll||!this.item.settings.math&&this.item.settings.mode===rl)},currentValue(){const t=this.item.settings.trueValue,e=this.item.settings.falseValue,i=null!==this.value?this.mathProcessing(this.getValueByTopic(this.value,this.item.topic),this.item.settings.math):this.value,s=i===t||i!==e&&null;return s}},methods:{onResize(t){this.wrapperSize={...t}},getValue(){let t="";if(this.item.settings.mode!==ll){const t=null!==this.value?this.getValueByTopic(this.value,this.item.topic):this.value;return t===this.item.settings.trueValue?this.item.settings.falseValue:t===this.item.settings.falseValue?this.item.settings.trueValue:t?this.item.settings.falseValue:this.item.settings.trueValue}return t=this.currentValue?this.item.settings.falsePayload:this.item.settings.truePayload,t},actionHandler(){if(null!==this.currentValue&&this.isActiveWidget){const t=this.getValue(),e=this.actionTopic;let i=t;const s=this.item.topic;this.item.settings.mode===rl&&s.payloadField&&(i=this.getCleanValue(this.value[e]&&this.value[e].payload,s),"N/A"!==i&&(va.a.apply(i,s.payloadField,(()=>t)),i=JSON.stringify(i)));const a={topic:e,payload:i,settings:{retain:this.item.settings.save}};this.$emit("action",a)}}},mixins:[ya,te,$a]},dl=cl,ul=Object(f["a"])(dl,nl,ol,!1,null,null,null),pl=ul.exports;q()(ul,"components",{QResizeObserver:An["a"],QIcon:x["a"]});var ml=function(){var t=this,e=t._self._c;return e("div",{ref:"wrapper",staticClass:"text-center full-height"},[e("q-resize-observer",{on:{resize:t.onResize}}),e("q-icon",{staticStyle:{width:"100%"},style:{color:t.activeItem.color,fontSize:`${t.size}px`,height:t.activeItem.label&&t.item.settings.isNeedShowTitles?"calc(100% - 25px)":"100%"},attrs:{name:`mdi-${t.activeItem.icon||t.item.settings.defaultIcon}`}})],1)},hl=[],gl={props:["item","value","widget"],data(){return{valueExpired:!1,expireValueTimeoutId:0,wrapperSize:{width:15,height:15}}},computed:{size(){const{width:t,height:e}=this.wrapperSize,i=e>t?t:e;return i},currentValue:{get(){const t=this.value;return this.item.settings.resetTimeout?this.setExpireLogic():this.clearExpireLogic(),null===t||this.valueExpired?null:this.mathProcessing(this.getValueByTopic(t,this.item.topic),this.item.settings.math)},set(t){this.setAction(t),this.actionHandler()}},activeItem(){const t=this.item.settings.items[0],e=this.item.settings.items.slice(1).filter((t=>t.val===this.mathProcessing(this.currentValue,t.math)));return e[0]||t}},methods:{onResize(t){this.wrapperSize={...t}},setExpireLogic(){this.expireValueTimeoutId&&(clearTimeout(this.expireValueTimeoutId),this.expireValueTimeoutId=0);const t=Date.now(),e=this.time+1e3*this.item.settings.resetTimeout;t>e?this.valueExpired=!0:(this.valueExpired=!1,this.expireValueTimeoutId=setTimeout((()=>{this.valueExpired=!0}),e-t))},clearExpireLogic(){this.valueExpired=!1,this.expireValueTimeoutId&&(clearTimeout(this.expireValueTimeoutId),this.expireValueTimeoutId=0)}},mixins:[ya,te,$a]},bl=gl,vl=Object(f["a"])(bl,ml,hl,!1,null,null,null),fl=vl.exports;q()(vl,"components",{QResizeObserver:An["a"],QIcon:x["a"]});var yl={name:"SchemePreview",props:["item","index","value"],data(){return{image:null,itemTypes:[{label:"text",value:aa,icon:"mdi-format-text-variant"},{label:"static text",value:ra,icon:"mdi-format-text"},{label:"toggle",value:na,icon:"mdi-toggle-switch-outline"},{label:"status",value:oa,icon:"mdi-lightbulb-outline"}],maxHeight:0}},computed:{currentSettings(){return this.item.settings}},methods:{addTypedItem(t){this.$widgetBus.$emit("add",t)},removeItem(t){this.$widgetBus.$emit("remove",t)},setActive(t){this.activeItemIndex=t,this.$widgetBus.$emit("select",t)},clearImage(){this.$widgetBus.$emit("update:image",null),this.$nextTick((()=>{this.$refs.file.removeAtIndex(0),this.image=null}))},getBase64(t){if(t){var e=new FileReader;e.readAsDataURL(t),e.onload=()=>{this.$widgetBus.$emit("update:image",e.result)}}},onMove(t,e){const{position:i,height:s,width:a}=this.currentSettings.items[e],n=this.$refs.imageWrapper.getBoundingClientRect(),o=this.$refs.dragItems[e].getBoundingClientRect(),r=n.width,l=n.height,c=t.delta.y/l*100,d=t.delta.x/r*100,u={top:i.top+c,left:i.left+d};o.top<n.top?u.top=0:o.bottom>n.bottom&&(u.top=100-s),o.left<n.left?u.left=0:o.right>n.right&&(u.left=100-a),this.$set(this.currentSettings.items[e],"position",u)},onResize(t,e){const i=this.$refs.imageWrapper.getBoundingClientRect(),s=i.width,a=i.height,n=this.currentSettings.items[e];let o=t.delta.y/a*100,r=t.delta.x/s*100;t.position.top>i.bottom&&(o=0),t.position.left>i.right&&(r=0);let l=n.width+r,c=n.height+o,d=2e3/s,u=2e3/a;l<d&&(l=d),c<u&&(c=u),this.$set(this.currentSettings.items[e],"width",l),this.$set(this.currentSettings.items[e],"height",c)},onResizeWrapper(t){this.maxHeight=t-182}},watch:{"$q.screen.height":{immediate:!0,handler(t){this.onResizeWrapper(t)}}},components:{StaticTextView:Xr,TextView:al,ToggleView:pl,StatusView:fl},mixins:[ca]},xl=yl,Sl=(i("fbed"),i("7d53")),_l=i("8572"),ql=i("75c3"),wl=Object(f["a"])(xl,zr,jr,!1,null,"72c4ddc8",null),Tl=wl.exports;q()(wl,"components",{QBtn:pt["a"],QTooltip:S["a"],QFile:Sl["a"],QIcon:x["a"],QField:_l["a"]}),q()(wl,"directives",{TouchPan:ql["a"]});const $l={"map-route":{minWidth:"480px",minHeight:"340px"},"map-location":{minWidth:"480px",minHeight:"340px"},frame:{minWidth:"480px",minHeight:"340px",maxWidth:"480px",maxHeight:"340px"},radial:{minWidth:"430px",minHeight:"340px"},linear:{minWidth:"150px",minHeight:"420px",maxWidth:"160px",maxHeight:"420px"}};var Cl={name:"Settings",props:["value","settings","mode","board"],data(){const t={name:"New widget",color:"grey",type:"informer",topics:[],dataTopics:[],settings:{},status:vt["k"]};return{defaultSettings:t,currentSettings:this.settings?Q()({},t,this.settings):Q()({},t),typeOptions:[{label:"Text",value:"informer",rightIcon:"mdi-format-text-variant"},{label:"Multi text",value:"multi-informer",rightIcon:"mdi-card-text-outline"},{label:"Static text",value:"static-informer",rightIcon:"mdi-format-text"},{label:"Toggle",value:"switcher",rightIcon:"mdi-toggle-switch-outline"},{label:"Button",value:"clicker",rightIcon:"mdi-send"},{label:"Textarea",value:"text-sender",rightIcon:"mdi-text-subject"},{label:"Slider",value:"slider",rightIcon:"mdi-ray-vertex"},{label:"Color",value:"color",rightIcon:"mdi-palette"},{label:"Map (Location)",value:"map-location",rightIcon:"mdi-map-marker-outline"},{label:"Map (Route)",value:"map-route",rightIcon:"mdi-map-marker-distance"},{label:"Status Indicator",value:"status-indicator",rightIcon:"mdi-lightbulb-outline"},{label:"Formula",value:"calculator",rightIcon:"mdi-calculator"},{label:"Radial gauge",value:"radial",rightIcon:"mdi-gauge"},{label:"Linear gauge",value:"linear",rightIcon:"mdi-oil-temperature"},{label:"Iframe",value:"frame",rightIcon:"mdi-window-maximize"},{label:"Radio button",value:"singleselect",rightIcon:"mdi-radiobox-marked"},{label:"Multiplier",value:"multiplier",rightIcon:"mdi-monitor-multiple"},{label:"Complex",value:"complex",rightIcon:"mdi-ballot-outline"},{label:"Scheme",value:"scheme",rightIcon:"mdi-floor-plan"}],typeElementWidth:0,colors:["grey","red","green","orange","blue","light-blue","purple","deep-orange","cyan","brown","blue-grey"],isValideSchema:!0,defaultTopic:Object(bt["b"])(),saveButtonLabels:{[vt["d"]]:"Save",[vt["f"]]:"Update",[vt["e"]]:"Clone"}}},computed:{validateCurrentSettings(){return!!this.isValidCurrentTopics&&this.currentSettings.topics.every((t=>this.validateTopic(t)))},status:{get(){return this.value},set(t){this.$emit("input",t)}},isValidCurrentTopics(){return(!!this.currentSettings.dataTopics.length||0===this.currentSettings.settings.maxTopicsLength)&&this.currentSettings.dataTopics.every((t=>this.validateTopic(t.topicFilter)))&&this.currentSettings.dataTopics.every((t=>1===this.currentSettings.dataTopics.filter((e=>e.topicFilter===t.topicFilter)).length))&&(void 0===this.currentSettings.settings.maxTopicsLength||void 0!==this.currentSettings.settings.maxTopicsLength&&this.currentSettings.settings.maxTopicsLength===this.currentSettings.dataTopics.length)},topicsHighlight(){return this.currentSettings.dataTopics.reduce(((t,e,i)=>(this.validateTopic(e.topicFilter)&&this.checkUniqueTopic(e.topicFilter,i)?t[i]="grey-4":t[i]="red-2",t)),[])},previewStyles(){const t=$l[this.currentSettings.type]||{},e={minWidth:"280px",minHeight:"110px",maxWidth:"560px",borderRadius:"4px",border:"1px solid transparent",boxShadow:"0 1px 5px rgba(0,0,0,0.2),0 2px 2px rgba(0,0,0,0.14),0 3px 1px -2px rgba(0,0,0,0.12)!important"};return{...e,...t}}},methods:{saveSettingsHandler(){this.$emit("save",this.currentSettings),this.closeHandler()},closeHandler(){this.$emit("input",!1),this.$emit("hide"),this.$nextTick((()=>{this.currentSettings=Q()({},this.defaultSettings)}))},typeChangeHandler(t){this.currentSettings.type!==t&&(this.currentSettings.settings={},this.currentSettings.dataTopics=[]),this.$set(this.currentSettings,"type",t)},setColor(t){m["default"].set(this.currentSettings,"color",t)},validateSchemas(t){this.isValideSchema=t},addTopicHandler(){this.currentSettings.dataTopics.push(Object.assign({},this.defaultTopic))},removeTopicHandler(t){m["default"].delete(this.currentSettings.dataTopics,t)},checkUniqueTopic(t,e){let i=!0;return this.currentSettings.dataTopics.map((t=>t.topicFilter)).some(((s,a)=>{const n=s===t;return n&&(i=a===e),n})),i},updateWidgetHandler(t){this.currentSettings=Q()(this.currentSettings,t)},updateSettingsHandler(t){this.$set(this.currentSettings,"settings",t)},generateTopics(){let t=this.currentSettings.dataTopics.map((t=>t.topicFilter));return this.currentSettings.settings.topics&&(t=de()([...t,...this.currentSettings.settings.topics.map((t=>t.topicFilter))])),t},onResize({width:t}){this.typeElementWidth=t}},watch:{settings(t){this.currentSettings=Q()({},this.defaultSettings,t)},"currentSettings.dataTopics"(){this.currentSettings.topics=this.generateTopics()},"currentSettings.settings.topics":{deep:!0,handler(){this.currentSettings.topics=this.generateTopics()}}},created(){m["default"].prototype.$widgetBus=new m["default"]},destroyed(){m["default"].prototype.$widgetBus=void 0},mixins:[J],components:{Topic:_t,WidgetWrapper:le,Switcher:we,Informer:Ve,Clicker:Ge,Radial:ti,Linear:oi,Frame:gi,Singleselect:qi,Multiplier:Ai,Complex:Mi,StaticInformer:Fe,Scheme:ma,MultiInformer:Re,Slider:Hi,Color:Xi,MapLocation:as,MapRoute:ds,StatusIndicator:fs,TextSender:ws,Calculator:Vs,SwitcherView:Va,InformerView:nn,ClickerView:qn,RadialView:Ln,LinearView:Yn,FrameView:eo,SingleselectView:lo,MultiplierView:Uo,ComplexView:Po,StaticInformerView:un,SchemeView:Tl,MultiInformerView:vn,SliderView:tr,ColorView:pr,MapLocationView:fr,MapRouteView:wr,StatusIndicatorView:Vr,TextSenderView:Fr,CalculatorView:Pr}},kl=Cl,Il=(i("dd34"),i("a12b")),Vl=Object(f["a"])(kl,ue,pe,!1,null,null,null),Ml=Vl.exports;q()(Vl,"components",{QDialog:Et["a"],QToolbar:At["a"],QToolbarTitle:Ft["a"],QInput:y["a"],QSelect:ct["a"],QResizeObserver:An["a"],QItem:dt["a"],QItemSection:ut["a"],QIcon:x["a"],QItemLabel:mt["a"],QTooltip:S["a"],QList:Lt["a"],QBtn:pt["a"],QExpansionItem:Nt["a"],QVirtualScroll:Il["a"]});var Ol=i("7be8"),Bl=i.n(Ol),El=function(){var t=this,e=t._self._c;return e("div",{staticStyle:{width:"100%",position:"relative"}},[t._l(t.renderedWidgets,(function(i,s){return e("div",{key:s,staticClass:"q-ma-sm",staticStyle:{display:"inline-block",position:"relative"},style:{width:t.widgetsWidth,minHeight:"radial"===t.item.settings.type||"linear"===t.item.settings.type?50*t.item.settings.widgetSettings.height+"px":""}},[e("q-card",{staticClass:"multiplier__widget-wrapper full-height full-width",class:t.wrapperClasses,attrs:{flat:"",inline:""}},[e("q-item",{staticClass:"q-px-sm q-pt-sm q-pb-none",staticStyle:{"min-height":"0"}},[e("q-item-section",{staticClass:"ellipsis",class:[`text-${t.item.settings.color}-7`],staticStyle:{"font-size":".9rem"}},[e("q-item-label",{staticClass:"ellipsis"},[t._v(t._s(i.name))]),e("q-tooltip",[t._v(t._s(i.name))])],1)],1),e("q-card-section",{staticClass:"q-pa-none",staticStyle:{height:"calc(100% - 25px)"}},[e(t.item.settings.type,{tag:"component",attrs:{item:t.widgets[s],value:t.values[s],index:s},on:{action:e=>{t.$emit("action",e)}}})],1),t.widgets[s].settings.isNeedTime?e("div",{staticClass:"widget__timestamp absolute-bottom-left",class:[`text-${t.item.settings.color}-7`,`bg-${t.item.settings.color}-1`]},[t._v("\n        "+t._s(t.getTime(t.values[s]))+"\n      ")]):t._e()],1)],1)})),t.widgetsIds.length>t.limit?e("div",{staticClass:"flex flex-center"},[e("q-pagination",{attrs:{max:Math.ceil(t.widgetsIds.length/t.limit),"max-pages":t.item.settings.width,"direction-links":"",color:t.item.color},model:{value:t.batch,callback:function(e){t.batch=e},expression:"batch"}})],1):t._e()],2)},Al=[],Fl=function(){var t=this,e=t._self._c;return e("div",{staticClass:"q-mb-sm"},[t.topItems.length?e("div",{ref:"itemsTop",staticClass:"items__top flex q-px-md q-py-xs"},t._l(t.topItems,(function(i,s){return e(`my-${t.renderItems[i.index].type}`,{key:`top${s}${i.index}`,tag:"component",attrs:{item:t.renderItems[i.index],value:i.val,color:t.item.color}})})),1):t._e(),e("div",{staticClass:"row"},[t.leftItems.length?e("div",{staticClass:"items__left flex q-pa-sm",class:{"col-6":t.leftItems.length&&t.rightItems.length,"col-12":!t.rightItems.length,"justify-center":!t.rightItems.length},staticStyle:{overflow:"hidden"}},t._l(t.leftItems,(function(i,s){return e(`my-${t.renderItems[i.index].type}`,{key:`left${s}${i.index}`,tag:"component",attrs:{item:t.renderItems[i.index],value:i.val,color:t.item.color}})})),1):t._e(),t.rightItems.length?e("div",{staticClass:"items__right q-pa-sm",class:{"col-6":t.leftItems.length&&t.rightItems.length,"col-12":!t.leftItems.length}},t._l(t.rightItems,(function(i,s){return e(`my-${t.renderItems[i.index].type}`,{key:`right${s}${i.index}`,tag:"component",attrs:{item:t.renderItems[i.index],value:i.val,color:t.item.color}})})),1):t._e()]),t.bottomItems.length?e("div",{ref:"itemsBottom",staticClass:"items__bottom flex q-px-md q-py-xs"},t._l(t.bottomItems,(function(i,s){return e(`my-${t.renderItems[i.index].type}`,{key:`bottom${s}${i.index}`,tag:"component",attrs:{item:t.renderItems[i.index],value:i.val,color:t.item.color}})})),1):t._e()])},Ll=[],Nl={name:"Complex",props:["item","index","value","mini"],data(){return{WIDGET_STATUS_DISABLED:vt["k"]}},computed:{currentValue:{get(){const t=this.value[this.item.dataTopics[0].topicFilter]&&this.value[this.item.dataTopics[0].topicFilter].payload;if(null===t)return null;{const e=this.item.dataTopics[0];return e.payloadType===vt["h"]&&(e.payloadType=vt["g"]),this.getValueByTopic(t,this.item.dataTopics[0])}}},renderItems(){return this.item.settings.items.reduce(((t,e)=>{const i={type:e.type,label:e.label,position:e.position,index:e.index,val:e.path?R()(this.currentValue,e.path,"N/A"):null===this.currentValue?"N/A":this.currentValue};switch(e.type){case"knob":i.min=e.minValueMode?parseFloat(this.getValueByTopic(this.value[e.minValue.topicFilter]&&this.value[e.minValue.topicFilter].payload,e.minValue)):e.minValue,i.max=e.maxValueMode?parseFloat(this.getValueByTopic(this.value[e.maxValue.topicFilter]&&this.value[e.maxValue.topicFilter].payload,e.maxValue)):e.maxValue;break;case"progress":i.min=e.minValueMode?parseFloat(this.getValueByTopic(this.value[e.minValue.topicFilter]&&this.value[e.minValue.topicFilter].payload,e.minValue)):e.minValue,i.max=e.maxValueMode?parseFloat(this.getValueByTopic(this.value[e.maxValue.topicFilter]&&this.value[e.maxValue.topicFilter].payload,e.maxValue)):e.maxValue;break;case"text":i.math=e.math||"",i.valueFormat=e.valueFormat||0;break}return t.push(i),t}),[])},topItems(){return this.renderItems.filter((t=>"top"===t.position))},leftItems(){return this.renderItems.filter((t=>"left"===t.position))},rightItems(){return this.renderItems.filter((t=>"right"===t.position))},bottomItems(){return this.renderItems.filter((t=>"bottom"===t.position))}},methods:{get:R.a},mixins:[ya],components:{MyText:To,MyKnob:Oo,MyProgress:Do}},Dl=Nl,Ql=(i("6ad6"),Object(f["a"])(Dl,Fl,Ll,!1,null,null,null)),Hl=Ql.exports,Rl={name:"Multiplier",props:["item","index","value","mini","blocked"],data(){return{WIDGET_STATUS_DISABLED:vt["k"],widgets:{},batch:1,limit:100}},computed:{wrapperClasses(){const t=[`bg-${this.item.settings.color}-1`];return"radial"!==this.item.settings.type&&"linear"!==this.item.settings.type||t.push("absolute"),t},currentTopic(){const t=R()(this.item,"dataTopics[0].topicFilter"),e=t.split("/").slice(0,this.item.settings.groupLayout+1),i=e.join("/");return i},renderedWidgets(){const t=(this.batch-1)*this.limit,e=this.batch*this.limit;return this.widgetsIds.reduce(((i,s,a)=>(a>=t&&a<e&&(i[s]=this.widgets[s]),i)),{})},widgetsIds(){return Object.keys(this.widgets)},currentValue(){if(!this.value)return{};const t=R()(this.item,"dataTopics[0].topicFilter");if(!t||!this.value[t])return{};const e=this.currentTopic.split("/");e.forEach(((t,i)=>{-1!==t.indexOf(",")&&(e[i]="+")}));let i=null;return-1===e.indexOf("+")?i=1===e.length?this.value[t]:R()(this.value[t],e.slice(0,-1).join("."),null):(i=e.reduce(((t,e,i)=>(t="+"===e?t.reduce(((t,e)=>{const i=Object.keys(e.value);return i.forEach((i=>{const s={name:`${e.name?`${e.name}[`:""}${i}${e.name?"]":""}`,value:e.value[i]};t.push(s)})),t}),[]):t.reduce(((t,i,s)=>(t[s].value=i.value&&i.value[e],t)),t),t)),[{name:"",value:this.value[t]}]),i=i.reduce(((t,e)=>(t[e.name]=e.value,t)),{})),i=Object.keys(i).reduce(((t,e)=>(t[e]=i[e],t)),{}),i},values(){return Object.keys(this.currentValue).reduce(((t,e)=>{const i=this.widgets[e];if(!i)return t;const s=this.item.dataTopics[0].topicFilter,a={[s]:this.currentValue[e]};return i.topics.forEach((t=>{if(s===t)return!1;a[t]={},a[t].payload=R()(this.value,`['${t}'].payload`)})),t[e]=a,t}),{})},widgetsWidth(){let t=this.item.settings.widgetSettings.width/this.item.settings.width*100;return t=t<=33?33:t<=50?50:100,this.$q.platform.is.mobile&&(t=100),`calc(${t}% - 16px)`}},methods:{needRender(t){return!this.item.settings.math||this.mathProcessing(t,this.item.settings.math)},initMultiplier(){const t=this.currentValue;if(!t)return!1;this.widgets={},Object.keys(t).forEach((e=>{const i=this.needRender(t[e]&&t[e].payload);!this.widgets[e]&&i&&this.initWidget(e)}))},processingMultiplier(){const t=this.currentValue,e=this.widgets,i=Object.keys(t),s=Object.keys(e),a=de()([...i,...s]);a.forEach(((i,s)=>{const a=this.needRender(t[i]&&t[i].payload);t[i]&&!e[i]&&a?this.initWidget(i):(t[i]&&void 0!==t[i].payload||!e[i])&&a||this.$delete(e,i)}))},getWidgetByName(t){let e=[R()(this.item,"dataTopics[0].topicFilter")];this.item.settings.widgetSettings.topics&&(e=[...e,...this.item.settings.widgetSettings.topics.map((t=>t.topicFilter))]);let i=t;if(1===R()(this.item,"dataTopics[0].payloadType")&&this.item.settings.nameField){const e=R()(this.currentValue,`['${t}'].payload`,null);i=this.getValueByTopic(e,{...this.item.dataTopics[0],payloadField:this.item.settings.nameField})}const s={name:i,id:t,color:this.item.settings.color,type:this.item.settings.type,topics:e,dataTopics:[{...this.item.dataTopics[0]}],settings:F()(this.item.settings.widgetSettings),status:vt["k"]};return s},initWidget(t){this.$set(this.widgets,t,this.getWidgetByName(t))},getTime(t){const e=t[this.currentTopic];return Zt(Xt(e))}},created(){this.initMultiplier()},watch:{value:{deep:!0,handler(t){this.processingMultiplier()}},"item.dataTopics":{deep:!0,handler(){this.initMultiplier()}}},mixins:[ya,$a],components:{Switcher:Va,Informer:nn,Radial:Ln,Linear:Yn,Singleselect:lo,Complex:Hl,MapLocation:fr,MapRoute:wr}},Pl=Rl,zl=(i("2f81"),i("3b16")),jl=Object(f["a"])(Pl,El,Al,!1,null,"78bcc2ba",null),Wl=jl.exports;q()(jl,"components",{QCard:se["a"],QItem:dt["a"],QItemSection:ut["a"],QItemLabel:mt["a"],QTooltip:S["a"],QCardSection:ne["a"],QPagination:zl["a"]});var Ul=function(){var t=this,e=t._self._c;return e("div",{staticClass:"full-width full-height"},[e("q-resize-observer",{on:{resize:t.onResize}}),e("div",{staticClass:"scheme-view__image-wrapper q-pa-xs relative-position row inline",style:t.wrapperStyle},[e("img",{ref:"image",style:t.imageStyle,attrs:{src:t.item.settings.image,draggable:"false"}}),t._l(t.item.settings.items,(function(i,s){return e("div",{key:s,staticClass:"scheme__item-view-wrapper absolute",style:{left:`${i.position.left}%`,top:`${i.position.top}%`,width:`${i.width}%`,height:`${i.height}%`}},[e(`${i.type}-view`,{ref:"items",refInFor:!0,tag:"component",attrs:{item:t.item.settings.items[s],widget:t.item,value:t.values[s]},on:{action:e=>t.$emit("action",e)}})],1)}))],2)],1)},Gl=[],Yl={name:"Scheme",props:["item","index","mini","value","blocked"],data(){return{WIDGET_STATUS_DISABLED:vt["k"],imageStyle:{},wrapperStyle:{}}},methods:{showTooltip(){this.$q.platform.is.mobile&&this.$refs.tooltip.toogle()},onResize({width:t,height:e}){const i={};i.maxHeight=e-10+"px",i.maxWidth=t-8+"px",this.imageStyle=i,this.$nextTick((()=>{const i={},s=this.$refs.image.getBoundingClientRect();i.marginLeft=(t-s.width-8)/2+"px",i.marginTop=(e-s.height-10)/2+"px",this.wrapperStyle=i;const a=this.$refs.items;a&&a.forEach((t=>t.fit&&t.fit()))}))}},computed:{values(){return this.item.settings.items.map((t=>{const e=t.topic,i=e&&e.topicFilter||null;let s;return this.value[i]&&(s=this.value[i].payload),s}))}},components:{TextView:al,ToggleView:pl,StatusView:fl,StaticTextView:Xr},mixins:[ya,$a]},Jl=Yl,Kl=(i("224a"),Object(f["a"])(Jl,Ul,Gl,!1,null,null,null)),Xl=Kl.exports;q()(Kl,"components",{QResizeObserver:An["a"]});const Zl={lg:1200,md:996,sm:768,xs:480,xxs:0};function tc(t){t=t||window.innerWidth;const e=["xxs","xs","sm","md","lg"];return e.reduce(((e,i)=>t>Zl[i]?i:e),null)}var ec={name:"Board",props:["board","boards","widgets","values","canShare","isFrized","hasConnection","variablesValues"],data(){return{settingsModel:!1,boardSettingsModalModel:!1,currentSettings:void 0,editedWidgetId:void 0,editedWidgetTopics:void 0,colNum:12,rowHeight:50,breakpoints:Zl,breakpoint:"xxs",operationMode:-1,variablesWrapperHeight:0,exportEnabled:!1,exportedWidgetsIndexes:null}},computed:{currentLayout:{get(){return this.board.layouts[this.breakpoint]},set(t){if(this.breakpoint!==this.$refs.grid&&this.$refs.grid.lastBreakpoint)return!1;this.$emit("update:layout",{layout:t,breakpoint:this.breakpoint})}},wrapperHeight(){let t=0;return this.board.settings.variables&&this.board.settings.variables.length&&(t+=this.variablesWrapperHeight),(this.isFrized&&this.board.name||!this.isFrized)&&(t+=50),`calc(100% - ${t}px)`},variablesListValues(){return this.board.settings.variables.map((t=>{let e={};if(t.type&&0!==t.type){if(1===t.type){const i=Object.values(this.variablesValues[t.name]||{});e=i.reduce(((t,e)=>{const{label:i,value:s}=this.getVariableModel(e);return t[s]={label:i,value:s},t}),{}),Object.defineProperty(e,"length",{enumerable:!1,value:i.length})}}else e=t.values.reduce(((t,e)=>{const{label:i,value:s}=this.getVariableModel(e);return t[s]={label:i,value:s},t}),{}),Object.defineProperty(e,"length",{enumerable:!1,value:t.values.length});return e}))}},methods:{openSettings(){this.settingsModel=!0},hideSettingsHandler(){this.currentSettings=void 0,this.editedWidgetId=void 0,this.editedWidgetTopics=void 0},saveSettingsHandler(t){t=this.modifyWidgetByVariables(t),void 0!==this.editedWidgetId?this.$emit("edit:widget",{settings:t,widgetId:this.editedWidgetId,topics:this.editedWidgetTopics}):this.$emit("add:widget",t),this.operationMode=-1,this.setLastModifyBoard()},addWidgetHandler(){this.operationMode=vt["d"],this.openSettings()},editWidgetSettings(t){this.currentSettings=this.widgets[t],this.editedWidgetId=t,this.editedWidgetTopics=[...this.currentSettings.topics],this.operationMode=vt["f"],this.openSettings()},resizeHandler(t,e,i){this.$emit("resized",{index:t,height:e,width:i}),this.setLastModifyBoard()},onResize({width:t}){this.breakpoint=tc(t)},shareHandler(){this.$emit("share")},uploadHandler(){this.$emit("upload")},duplicateWidgetHandler(t){this.currentSettings=F()(this.widgets[t]),m["default"].delete(this.currentSettings,"id"),this.operationMode=vt["e"],this.openSettings()},deleteWidgetHandler(t){this.$emit("delete:widget",{widgetId:t,settings:this.widgets[t]}),this.setLastModifyBoard()},fastBindHandler(t){this.$emit("fast-bind",t),this.setLastModifyBoard()},blockBoardHandler(){this.$emit("block"),this.setLastModifyBoard()},preventCollisionBoardHandler(){this.$emit("prevent"),this.setLastModifyBoard()},setLastModifyBoard(){this.$emit("modify")},onVariablesWrapperResize({height:t}){this.variablesWrapperHeight=t},changeVaribleHandler(t,e){this.$set(this.board.activeVariables,t,e),this.board.widgetsIndexes.forEach((t=>{let e=F()(this.widgets[t]);e=this.modifyWidgetByVariables(e),this.$emit("edit:widget",{settings:e,widgetId:e.id,topics:[...this.widgets[t].topics]})}))},modifyWidgetByVariables(t){const e=t=>{t.topicTemplate||(t.topicTemplate=t.topicFilter);const e=this.board.activeVariables;t.topicFilter=t.topicTemplate.replace(/<%([a-zA-Z0-9-+&@#/%?=~_|!:,.;\s]*)%>/gim,((t,i)=>e[i]||t))};let i=[];return t.dataTopics.length&&(t.dataTopics.forEach(e),i=[...i,...t.dataTopics]),t.settings.topics&&t.settings.topics.length&&(t.settings.topics.forEach(e),i=[...i,...t.settings.topics]),t.topics=de()(i.map((t=>t.topicFilter))),t},naturalSort(t,e){return t.sort(((t,i)=>{if(e&&(t=t[e],i=i[e]),t="string"===typeof t?t.toLowerCase():t,i="string"===typeof i?i.toLowerCase():i,t!==i){const e=Number(t),s=Number(i);return e+""===t&&s+""===i?e-s:t>i?1:-1}}))},actionHandler(t){const e=this.board.activeVariables;t.topic=t.topic.replace(/<%([a-zA-Z0-9-+&@#/%?=~_|!:,.;\s]*)%>/gim,((t,i)=>e[i]||t)),this.$emit("action",t)},getVariableModel(t){let e,i;return Array.isArray(t)?[e,i]=t:(i=t,e=t),e="string"===typeof e?e:JSON.stringify(e),{label:e,value:i}},getVariableValues(t){let e=this.variablesListValues[t];const i=this.board.settings.variables[t];return e=i.sortVarsBy?this.naturalSort(Object.values(e),"label"):this.naturalSort(Object.values(e),"value"),e},modifyBoardSettings(){this.boardSettingsModalModel=!0},editBoardHandler(t){t.widgetsIndexes.forEach((e=>{let i=F()(this.widgets[e]);t.settings.variables.forEach((e=>{e.values.includes(t.activeVariables[e.name])||(t.activeVariables[e.name]=void 0)})),i=this.modifyWidgetByVariables(i,t),this.$emit("edit:widget",{settings:i,widgetId:i.id,topics:[...this.widgets[e].topics]})})),this.$emit("edit:board",{id:this.board.id,board:t})},exportWidgets(t){this.exportedWidgetsIndexes[t]?this.$delete(this.exportedWidgetsIndexes,t):this.$set(this.exportedWidgetsIndexes,t,!0)},prepareExport(){this.exportedWidgetsIndexes={},this.exportEnabled=!0},doneExport(){const t=Object.keys(this.exportedWidgetsIndexes).map((t=>this.widgets[t]));this.$emit("export-widgets",t),this.exportedWidgetsIndexes=null,this.exportEnabled=!1},importWidgets(){this.$emit("import-widgets")},share(t){this.canShare?t():this.$emit("share-error")},getInShortcutsAbility(t){return"informer"===t.type||"clicker"===t.type||"color"===t.type||"linear"===t.type||"radial"===t.type||"singleselect"===t.type||"slider"===t.type||"status-indicator"===t.type||"switcher"===t.type||void 0}},components:{Settings:Ml,WidgetWrapper:le,BoardSettings:Qt,BoardVariable:Wt,Switcher:Va,Informer:nn,MultiInformer:vn,StaticInformer:un,Clicker:qn,Radial:Ln,Linear:Yn,Frame:eo,Singleselect:lo,Multiplier:Wl,Complex:Hl,Slider:tr,Color:pr,StatusIndicator:Vr,MapLocation:fr,MapRoute:wr,TextSender:Fr,Calculator:Pr,Scheme:Xl,GridLayout:Bl.a.GridLayout,GridItem:Bl.a.GridItem,VirtualList:Gt.a}},ic=ec,sc=(i("3a0c"),Object(f["a"])(ic,z,j,!1,null,null,null)),ac=sc.exports;q()(sc,"components",{QBtn:pt["a"],QTooltip:S["a"],QToolbar:At["a"],QToolbarTitle:Ft["a"],QMenu:ae["a"],QList:Lt["a"],QItem:dt["a"],QItemSection:ut["a"],QIcon:x["a"],QResizeObserver:An["a"]}),q()(sc,"directives",{ClosePopup:oe["a"]});var nc=function(){var t=this,e=t._self._c;return e("div",{staticClass:"dash__boards"},[t.isFrized?t._e():e("q-btn",{staticClass:"absolute button--add",attrs:{fab:"",color:`${t.$theme}-9`,icon:"mdi-plus"},on:{click:t.openSettingsHandler}},[e("q-tooltip",[t._v("Add new board")])],1),e("remote-boards",{attrs:{boards:t.remoteBoards,"can-share":t.canShare},on:{import:e=>t.$emit("import",e),"delete-uploaded":e=>t.$emit("delete-uploaded",e),"share-uploaded":e=>t.share("share-uploaded",e)},model:{value:t.isPanelShowed,callback:function(e){t.isPanelShowed=e},expression:"isPanelShowed"}}),e("q-toolbar",{class:[`bg-${t.$theme}-2`]},[e("q-toolbar-title",{staticClass:"text-grey-9"},[t._v("Boards")]),t.connectionSettings&&!t.$integrationMode?[t.attachMode?e("q-btn",{attrs:{flat:"",color:"green"},on:{click:t.attachHandler}},[e("div",{staticClass:"flex flex-center"},[e("q-icon",{attrs:{name:"mdi-check"}}),t._v("\n          Attach\n        ")],1)]):e("q-btn",{attrs:{icon:"mdi-link-variant",flat:"",color:"grey-9"},on:{click:function(e){t.attachMode=!0}}},[e("q-tooltip",[t._v("Attach boards to connection")])],1)]:t._e(),t._t("actions")],2),e("div",{staticClass:"q-px-sm scroll boards__wrapper",class:[`bg-${t.$theme}-1`],style:{height:t.isPanelShowed?"calc(100% - 199px)":"calc(100% - 50px)"}},[t.boardsKeys.length||Object.keys(t.boardsConfigs).length?e("div",{staticClass:"row"},[t._l(t.boards,(function(i,s){return e("div",{key:s,staticClass:"q-pt-md q-px-sm col-xl-4 col-md-6 col-sm-6 col-xs-12 relative-position"},[t.attachMode?e("div",{staticClass:"absolute-top-left absolute-bottom-right q-mt-md q-mx-sm flex flex-center",staticStyle:{"background-color":"rgba(255, 255, 255, .4)","z-index":"1"}},[e("q-btn",{staticClass:"absolute-top-left absolute-bottom-right",staticStyle:{width:"100%"},attrs:{icon:"mdi-check",color:t.currentAttachedBoard.includes(s)?"green":"grey",size:"4rem",flat:""},on:{click:function(e){return t.changeAttachedBoards(s)}}})],1):t._e(),e("q-card",[e("q-item",{staticClass:"q-py-none q-px-sm",class:[`bg-${t.$theme}-2`],staticStyle:{"min-height":"40px"}},[e("q-item-section",{staticClass:"ellipsis"},[e("div",{staticClass:"ellipsis",staticStyle:{height:"24px","line-height":"24px"}},[t._v("\n                "+t._s(i.name||"*No name*")+"\n                "),i.name?e("q-tooltip",[t._v(t._s(i.name))]):t._e()],1),e("div",{staticClass:"ellipsis text-grey-9",staticStyle:{height:"14px","line-height":"14px","font-size":"14px"}},[t._v("\n                "+t._s(i.id)+"\n              ")])]),e("q-item-section",{attrs:{side:""}},[e("div",[e("q-btn",{attrs:{round:"",dense:"",flat:"",icon:"mdi-link",color:"grey-"+(t.canShare?9:7),ripple:!!t.canShare},nativeOn:{click:function(e){return t.share("share",s)}}},[e("q-tooltip",[t._v("Get link")])],1),e("q-btn",{attrs:{round:"",dense:"",flat:"",icon:"mdi-fullscreen",color:"grey-9"},nativeOn:{click:function(e){return t.$emit("select",s)}}},[e("q-tooltip",[t._v("Show full board")])],1),e("q-btn",{attrs:{round:"",dense:"",flat:"",icon:"mdi-dots-vertical",color:"grey-9"}},[e("q-menu",{attrs:{anchor:"bottom right",self:"top right"}},[e("q-list",{attrs:{dense:""}},[t.connectionSettings?e("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:""},on:{click:function(e){return e.stopPropagation(),t.$emit("export",s)}}},[e("q-item-section",{attrs:{avatar:""}},[e("q-icon",{attrs:{name:"mdi-cloud-upload-outline"}})],1),e("q-item-section",[t._v("Save to broker")])],1):t._e(),e("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:""},on:{click:function(e){return e.stopPropagation(),t.$emit("export-as",s)}}},[e("q-item-section",{attrs:{avatar:""}},[e("q-icon",{attrs:{name:"mdi-export-variant"}})],1),e("q-item-section",[t._v("Export")])],1),e("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:""},on:{click:function(e){return e.stopPropagation(),t.$emit("get-board-info",s)}}},[e("q-item-section",{attrs:{avatar:""}},[e("q-icon",{attrs:{name:"mdi-information-outline"}})],1),e("q-item-section",[t._v("Board info")])],1),e("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:""},on:{click:function(e){return e.stopPropagation(),t.openEditSettingsHandler(s)}}},[e("q-item-section",{attrs:{avatar:""}},[e("q-icon",{attrs:{name:"mdi-cog"}})],1),e("q-item-section",[t._v("Settings")])],1),e("q-separator"),e("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:""},on:{click:function(e){return e.stopPropagation(),t.$emit("delete",s)}}},[e("q-item-section",{attrs:{avatar:""}},[e("q-icon",{attrs:{name:"mdi-delete-outline",color:"red"}})],1),e("q-item-section",[t._v("Remove")])],1)],1)],1)],1)],1)])],1),e("q-separator"),e("q-card-section",{staticClass:"row relative-position",class:{[`bg-${t.$theme}-1`]:!0}},[e("div",{staticClass:"text-grey-8 col-12 q-mb-sm",staticStyle:{"font-size":"15px"}},[t._v("Shortcuts")]),i.shortcutsIndexes.length?t._l([0,1,2,3],(function(s,a){return e("div",{key:a,staticClass:"col-3 q-px-xs",staticStyle:{"margin-bottom":"2px"}},[t.widgets[i.shortcutsIndexes[a]]&&void 0!==t.values[i.shortcutsIndexes[a]]?e(t.widgets[i.shortcutsIndexes[a]].type,{tag:"component",attrs:{item:t.widgets[i.shortcutsIndexes[a]],value:t.values[i.shortcutsIndexes[a]],index:i.shortcutsIndexes[a],mini:!0},on:{action:e=>{t.actionHandler(i.id,e)}}}):t._e()],1)})):e("div",{staticClass:"shortcuts--empty col-12",staticStyle:{"min-height":"89px","margin-bottom":"2px"}},[e("div",{staticClass:"text-center text-grey-8 q-mb-sm q-mt-sm",staticStyle:{"font-size":"1.2rem"}},[t._v("You have no shortcuts")]),e("div",{staticClass:"text-center text-grey-8"},[t._v("You can add one on "),e("q-btn",{attrs:{icon:"mdi-fullscreen",color:`${t.$theme}-8`,size:"sm",dense:"",unelevated:"",label:"full board view"},on:{click:function(e){return t.$emit("select",s)}}})],1)]),i.settings.lastModify?e("div",{staticClass:"absolute-top-right text-grey-5 q-pr-xs",staticStyle:{"font-size":".7rem"}},[t._v(t._s(t.date(i.settings.lastModify,"DD-MM-YYYY HH:mm:ss")))]):t._e(),e("span",{staticClass:"text-bold text-white absolute rounded-borders q-px-xs",class:[`bg-${t.$theme}-4`],staticStyle:{"font-size":"10px",bottom:"4px",right:"4px",cursor:"default"},attrs:{title:"Widgets count"}},[t._v(t._s(i.widgetsIndexes.length))]),e("div",{staticClass:"absolute-bottom-left q-ml-xs"},t._l(i.settings.variables,(function(i){return e("q-icon",{key:i.name,staticClass:"q-mr-xs",attrs:{name:t.getIcon(i),color:"grey-7"}},[e("q-tooltip",[t._v("Variable: "+t._s(i.name))])],1)})),1)],2)],1)],1)})),t.attachMode?t._l(t.boardsConfigs,(function(i,s){return e("div",{key:s,staticClass:"q-pt-md q-px-sm col-xl-4 col-md-6 col-sm-6 col-xs-12 relative-position"},[e("div",{staticClass:"absolute-top-left absolute-bottom-right q-mt-md q-mx-sm flex flex-center",staticStyle:{"background-color":"rgba(255, 255, 255, .4)","z-index":"1"}},[e("q-btn",{staticClass:"absolute-top-left absolute-bottom-right",staticStyle:{width:"100%"},attrs:{icon:"mdi-check",color:t.currentAttachedBoard.includes(s)?"green":"grey",size:"4rem",flat:""},on:{click:function(e){return t.changeAttachedBoards(s)}}})],1),e("q-card",[e("q-item",{staticClass:"q-py-none q-px-sm bg-grey-4"},[e("q-item-section",{staticClass:"ellipsis"},[e("div",{staticClass:"ellipsis",staticStyle:{height:"24px","line-height":"24px"}},[t._v("\n                  "+t._s(i.name||"*No name*")+"\n                  "),i.name?e("q-tooltip",[t._v(t._s(i.name))]):t._e()],1),e("div",{staticClass:"ellipsis text-grey-9",staticStyle:{height:"14px","line-height":"14px","font-size":"14px"}},[t._v("\n                  "+t._s(i.id)+"\n                ")])])],1),e("q-separator"),e("q-card-section",{staticClass:"row relative-position",class:{"bg-grey-2":!i.shortcutsIndexes.length}},[e("div",{staticClass:"text-grey-8 col-12 q-mb-sm",staticStyle:{"font-size":"15px"}},[t._v("Shortcuts")]),i.shortcutsIndexes.length?t._l(i.shortcutsIndexes.map((t=>i.widgetsIndexes.filter((e=>e.id===t))[0])),(function(i,s){return e("div",{key:s,staticClass:"col-3 q-px-xs",staticStyle:{"margin-bottom":"2px"}},[e("div",{staticStyle:{"text-align":"center"}},[e("div",{class:[`bg-${i.color}-1`],staticStyle:{height:"60px",width:"60px","line-height":"60px",margin:"0 auto","border-radius":"5px"}},[e("div",{staticClass:"ellipsis"},[t._v("\n                        N/A\n                      ")])]),e("div",{staticClass:"ellipsis q-mt-sm"},[t._v(t._s(i.name))])])])})):e("div",{staticClass:"shortcuts--empty col-12",staticStyle:{"min-height":"89px","margin-bottom":"2px"}},[e("div",{staticClass:"text-center text-grey-8 q-mb-sm q-mt-sm",staticStyle:{"font-size":"1.2rem"}},[t._v("You have no shortcuts")]),e("div",{staticClass:"text-center text-grey-8"},[t._v("You can add one on "),e("q-btn",{attrs:{icon:"mdi-fullscreen",color:`${t.$theme}-8`,size:"sm",dense:"",label:"full board view"},on:{click:function(e){return t.$emit("select",s)}}})],1)]),i.settings.lastModify?e("div",{staticClass:"absolute-top-right text-grey-5 q-pr-xs",staticStyle:{"font-size":".7rem"}},[t._v(t._s(t.date(i.settings.lastModify,"DD-MM-YYYY HH:mm:ss")))]):t._e(),e("span",{staticClass:"text-bold text-white absolute rounded-borders q-px-xs",class:[`bg-${t.$theme}-4`],staticStyle:{"font-size":"10px",bottom:"4px",right:"4px",cursor:"default"},attrs:{title:"Widgets count"}},[t._v(t._s(i.widgetsIndexes.length))])],2)],1)],1)})):t._e()],2):e("div",{staticClass:"text-grey-9 text-bold wrapper--empty"},[e("div",{staticClass:"q-mb-sm",class:[`text-${t.$theme}-9`]},[t._v("No boards")]),t.isFrized?t._e():e("div",[e("q-btn",{attrs:{color:`${t.$theme}-9`,icon:"mdi-plus-circle-outline",label:"New board"},on:{click:t.openSettingsHandler}})],1)])]),t.settingsModalModel?e("board-settings",{attrs:{settings:t.editedBoardModel,boards:t.boards},on:{add:t.addBoardHandler,edit:t.editBoardHandler,hide:t.hideModalHandler,open:e=>t.$emit("select",e)},model:{value:t.settingsModalModel,callback:function(e){t.settingsModalModel=e},expression:"settingsModalModel"}}):t._e()],1)},oc=[],rc=function(){var t=this,e=t._self._c;return e("div",[Object.keys(t.boards).length?e("div",{staticClass:"remote-control text-center"},[e("span",{staticClass:"remote-control__button text-white q-px-sm text-bold text-uppercase cursor-pointer shadow-3",class:[`bg-${t.$theme}-6`],on:{click:function(e){return t.$emit("input",!t.value)}}},[t._v(t._s(t.value?"hide":"saved boards"))])]):t._e(),e("transition",{attrs:{appear:"","enter-active-class":"animated slideInDown","leave-active-class":"animated slideOutUp"}},[Object.keys(t.boards).length&&t.value?e("div",{staticClass:"relative-position boards__remote flex no-wrap",class:[`bg-${t.$theme}-1`]},[t.scrollPosition>0?e("q-btn",{staticClass:"slider-controls absolute-top-left absolute-bottom-left",attrs:{icon:"mdi-chevron-left",dense:"",flat:""},on:{click:t.scrollLeft}}):t._e(),e("div",{ref:"wrapper",staticClass:"flex no-wrap overflow-hidden q-pb-md q-pt-lg boards__remote-wrapper"},[e("q-resize-observer",{on:{resize:t.onResize}}),t._l(t.boards,(function(i,s){return e("q-intersection",{key:`remote-${s}`,staticClass:"q-my-xs q-px-sm q-my-sm remote__board",attrs:{transition:"flip-right"}},[e("q-card",[e("q-item",{staticClass:"q-py-none q-pl-sm q-pr-none",class:[`bg-${t.$theme}-2`],staticStyle:{"min-height":"20px"}},[e("q-item-section",{staticClass:"ellipsis"},[e("div",{staticClass:"ellipsis",staticStyle:{height:"24px","line-height":"24px"}},[t._v("\n                  "+t._s(i.name||"*No name*")+"\n                  "),i.name?e("q-tooltip",[t._v(t._s(i.name))]):t._e()],1),e("div",{staticClass:"ellipsis text-grey-9",staticStyle:{height:"14px","line-height":"14px","font-size":"14px"}},[t._v("\n                  "+t._s(i.id)+"\n                ")])]),e("q-item-section",{attrs:{side:""}},[e("q-btn",{attrs:{round:"",dense:"",flat:"",icon:"mdi-dots-vertical",color:"grey-9"}},[e("q-menu",{attrs:{anchor:"bottom right",self:"top right"}},[e("q-list",{class:[`bg-${t.$theme}-1`],attrs:{dense:""}},[e("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{disable:!t.canShare,clickable:""},on:{click:function(e){return e.stopPropagation(),t.$emit("share-uploaded",s)}}},[e("q-item-section",{attrs:{avatar:""}},[e("q-icon",{attrs:{name:"mdi-link"}})],1),e("q-item-section",[t._v("Get link")])],1),e("q-separator"),e("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:""},on:{click:function(e){return e.stopPropagation(),t.$emit("delete-uploaded",s)}}},[e("q-item-section",{attrs:{avatar:""}},[e("q-icon",{attrs:{name:"mdi-delete-outline",color:"red"}})],1),e("q-item-section",[t._v("Remove")])],1)],1)],1)],1)],1)],1),e("q-separator"),e("q-card-section",{staticClass:"text-center relative-position",class:[`bg-${t.$theme}-1`]},[i.settings.lastModify?e("div",{staticClass:"absolute-top-right text-grey-7 q-pr-xs",staticStyle:{"font-size":".7rem"}},[t._v(t._s(t.date(i.settings.lastModify,"DD-MM-YYYY HH:mm:ss")))]):t._e(),e("q-icon",{staticClass:"cursor-pointer",attrs:{name:"mdi-download",size:"20px",color:"grey-9"},nativeOn:{click:function(e){return t.$emit("import",s)}}}),i.appVersion?e("span",{staticClass:"text-grey-7 absolute",staticStyle:{"font-size":"10px",bottom:"4px",left:"4px",cursor:"default"},attrs:{title:"MQTT Tiles version"}},[t._v("v."+t._s(i.appVersion))]):t._e(),e("span",{staticClass:"text-bold text-white absolute rounded-borders q-px-xs",class:[`bg-${t.$theme}-4`],staticStyle:{"font-size":"10px",bottom:"4px",right:"4px",cursor:"default"},attrs:{title:"Widgets count"}},[t._v(t._s(i.widgetsIndexes.length))])],1)],1)],1)}))],2),t.scrollPosition<t.wrapperWidth?e("q-btn",{staticClass:"slider-controls absolute-top-right absolute-bottom-right",attrs:{icon:"mdi-chevron-right",dense:"",flat:""},on:{click:t.scrollRight}}):t._e()],1):t._e()])],1)},lc=[],cc={props:["boards","canShare","value"],data(){return{scrollPosition:0,wrapperWidth:0,wrapperClientWidth:0}},methods:{date:Kt["a"].formatDate,scrollLeft(){this.$refs.wrapper.scrollLeft-=this.wrapperClientWidth-100,this.scrollPosition=this.$refs.wrapper.scrollLeft},scrollRight(){this.$refs.wrapper.scrollLeft+=this.wrapperClientWidth-100,this.scrollPosition=this.$refs.wrapper.scrollLeft},onResize(t){const e=this.$refs.wrapper;this.wrapperWidth=e.scrollWidth-e.offsetWidth,this.wrapperClientWidth=e.offsetWidth}}},dc=cc,uc=(i("feef"),i("ad56")),pc=Object(f["a"])(dc,rc,lc,!1,null,"3dc6962e",null),mc=pc.exports;q()(pc,"components",{QBtn:pt["a"],QResizeObserver:An["a"],QIntersection:uc["a"],QCard:se["a"],QItem:dt["a"],QItemSection:ut["a"],QTooltip:S["a"],QMenu:ae["a"],QList:Lt["a"],QIcon:x["a"],QSeparator:mi["a"],QCardSection:ne["a"]}),q()(pc,"directives",{ClosePopup:oe["a"]});var hc={name:"Boards",props:["boards","boardsConfigs","widgets","values","remoteBoards","canShare","isFrized","connectionSettings"],data(){return{isPanelShowed:!1,settingsModalModel:!1,editedBoardModel:null,attachMode:!1,currentAttachedBoard:this.attachedBoards?[...this.attachedBoards]:[]}},computed:{attachedBoards(){return this.connectionSettings&&this.connectionSettings.attachedBoards||[]},boardsKeys(){return Object.keys(this.boards)}},methods:{date:Kt["a"].formatDate,openSettingsHandler(){this.settingsModalModel=!0},openEditSettingsHandler(t){this.editedBoardModel=F()(this.boards[t]),this.openSettingsHandler()},editBoardHandler(t){t.widgetsIndexes.forEach((e=>{let i=F()(this.widgets[e]);t.settings.variables.forEach((e=>{e.values.includes(t.activeVariables[e.name])||(t.activeVariables[e.name]=void 0)})),i=this.modifyWidgetByVariables(i,t),this.$emit("edit:widget",{settings:i,widgetId:i.id,topics:[...this.widgets[e].topics]})})),this.$emit("edit",{id:this.editedBoardModel.id,board:t}),this.editedBoardModel=null},addBoardHandler(t){this.$emit("add",t)},hideModalHandler(){this.editedBoardModel=null},modifyWidgetByVariables(t,e){const i=t=>{t.topicTemplate||(t.topicTemplate=t.topicFilter);const i=e.activeVariables;t.topicFilter=t.topicTemplate.replace(/<%([a-zA-Z0-9-+&@#/%?=~_|!:,.;\s]*)%>/gim,((t,e)=>i[e]||t))};let s=[];return t.dataTopics.length&&(t.dataTopics.forEach(i),s=[...s,...t.dataTopics]),t.settings.topics&&t.settings.topics.length&&(t.settings.topics.forEach(i),s=[...s,...t.settings.topics]),t.topics=de()(s.map((t=>t.topicFilter))),t},actionHandler(t,e){const i=this.boards[t].activeVariables;e.topic=e.topic.replace(/<%([a-zA-Z0-9-+&@#/%?=~_|!:,.;\s]*)%>/gim,((t,e)=>i[e]||t)),this.$emit("action",e)},attachHandler(){this.$emit("change:attach",this.currentAttachedBoard),this.attachMode=!1},changeAttachedBoards(t){const e=this.currentAttachedBoard.indexOf(t),i=-1!==e;i?this.$delete(this.currentAttachedBoard,e):this.currentAttachedBoard.push(t)},getIcon(t){let e="";return t.preset&&("devices"===t.preset?e="mdi-developer-board":"channels"===t.preset?e="mdi-call-merge":"calcs"===t.preset?e="mdi-calculator-variant":"custom"===t.preset&&(e=1===t.type?"mdi-alpha-v-box":"mdi-variable")),e},share(t,e){this.canShare?this.$emit(t,e):this.$emit("share-error")}},watch:{boardsConfigs:{handler(t){this.currentAttachedBoard=this.attachedBoards&&this.attachedBoards.length?[...this.attachedBoards]:[]},immediate:!0,deep:!0},connectionSettings(){!this.boardsKeys.length&&this.attachedBoards.length?this.$emit("change:attach",[]):this.attachMode=!1,this.currentAttachedBoard=this.attachedBoards&&this.attachedBoards.length?[...this.attachedBoards]:[]}},components:{BoardSettings:Qt,RemoteBoards:mc,Switcher:Va,Clicker:qn,Informer:nn,Linear:Yn,Radial:Ln,Singleselect:lo,Slider:tr,Color:pr,StatusIndicator:Vr}},gc=hc,bc=(i("c54e"),Object(f["a"])(gc,nc,oc,!1,null,null,null)),vc=bc.exports;q()(bc,"components",{QBtn:pt["a"],QTooltip:S["a"],QToolbar:At["a"],QToolbarTitle:Ft["a"],QIcon:x["a"],QCard:se["a"],QItem:dt["a"],QItemSection:ut["a"],QMenu:ae["a"],QList:Lt["a"],QSeparator:mi["a"],QCardSection:ne["a"]}),q()(bc,"directives",{ClosePopup:oe["a"]});var fc=i("193b"),yc=i.n(fc);function xc(t,e,i,s){const a=i.split("/"),n=t.topic.split("/");let o=e;const r=[];if(a.forEach(((t,e)=>{r.push(n[e])})),t.payload.length){let e=t;r.length?yc()(o,r,e,Object):o=e}else if(r.length){const t=r.slice(0,-1).join("."),e=r.slice(-1)[0],i=t?R()(o,t,null):o;i&&m["default"].delete(i,e)}else o=null;return o}function Sc(t,e,i,s){if(!t||i!==s.dataTopics[0].topicFilter){let e=null;return t&&t.length&&(e=t.slice(-1)[0]),e}let a=e?F()(e):{};return t.forEach((t=>{a=xc(t,a,i,s)})),a}function _c(t,e,i,s){return t&&(t.length&&t.slice(-1)[0]||e)||null}const qc={multiplier:Sc};var wc=function(t){return qc[t]||_c},Tc=i("b697"),$c=i.n(Tc),Cc={"1.5.3":t=>(t.settings.minWidth=1,t),"1.5.4":t=>(t.settings.icon="",t),"1.10.6":t=>{const e=t.settings;return"string"===typeof e.topic&&(e.topics=[Object(bt["b"])({topicTemplate:e.topic,topicFilter:e.topic})]),t},"1.10.7":t=>{const e=t.settings;return"string"===typeof e.payload&&e.topics.forEach((t=>{t.payload=e.payload})),t}},kc={"1.5.4":t=>{const e=t.settings;if(void 0===e.mode&&(e.mode=di),e.mode===di&&(e.items=[],e.topics=[]),e.mode===ci){const i=F()(t.dataTopics[0]);e.maxTopicsLength=0,e.items=[{label:"New item",template:e.template,topic:i}],e.topics=[i],t.dataTopics=[],delete e.template}return t},"1.10.1":t=>{const e=t.settings;return e.readyMessage="",t},"1.10.3":t=>{const e=t.settings;return e.initMessage="",t},"1.12.13":t=>{const e=t.settings;return e.aclTopics||(e.aclTopics=[]),t}},Ic={"1.5.4":t=>(t.settings.trueIcon="",t.settings.falseIcon="",t),"1.14.1":t=>{const e={grey:"#757575",red:"#e53935",green:"#43a047",orange:"#fb8c00",blue:"#1e88e5","light-blue":"#039be5",purple:"#8e24aa","deep-orange":"#f4511e",cyan:"#00acc1",brown:"#6d4c41","blue-grey":"#546e7a"};return t.settings.trueColor=e[t.color],t.settings.falseColor="#333",t}},Vc={"1.11.4":t=>{const e=t.settings;return e.items=[{name:"Item 1",lat:e.topics[0],lon:e.topics[1]}],t}},Mc={"1.11.4":t=>{const e=t.settings;return e.items=[{name:"Item 1",route:e.topics[0]}],t}},Oc={"1.16.2":t=>{const e=t.settings;return e.items.forEach((t=>{t.settings.style="",t.settings.autoresize=!0})),t}};const Bc={clicker:Cc,frame:kc,switcher:Ic,"map-location":Vc,"map-route":Mc,scheme:Oc};function Ec(t,e,i){return t.reduce(((t,s)=>{const a=Bc[s.type]||{},n=Object.keys(a);return n.forEach((t=>{if($c.a.compare(t,e,">")&&$c.a.compare(t,i,"<="))try{a[t](s)}catch(n){console.log(n)}})),t.push(s),t}),[])}var Ac=Ec,Fc=function(){var t=this,e=t._self._c;return e("q-dialog",{attrs:{"prevent-close":""},model:{value:t.dialogModel,callback:function(e){t.dialogModel=e},expression:"dialogModel"}},[e("div",{staticClass:"bg-white",class:[`bg-${t.$theme}-1`],staticStyle:{"min-width":"300px"}},[e("div",{staticClass:"q-pa-md"},[e("div",{staticClass:"text-h5 text-bold q-mb-sm"},[t._v(t._s(t.title))]),e("div",{staticClass:"text-grey-6"},[t._v(t._s(t.message))]),e("div",{staticClass:"text-grey-6"},[e("q-checkbox",{attrs:{color:"grey-9",label:"Rename to save a copy"},model:{value:t.isNeedCopy,callback:function(e){t.isNeedCopy=e},expression:"isNeedCopy"}}),e("q-input",{attrs:{outlined:"",dense:"","hide-bottom-space":"",color:"grey-9",disable:!t.isNeedCopy,label:"Name",error:t.isNeedCopy&&t.oldName===t.name},model:{value:t.nameModel,callback:function(e){t.nameModel=e},expression:"nameModel"}})],1)]),e("div",{staticClass:"flex justify-end q-mt-md q-pa-sm"},[e("q-btn",{attrs:{color:"grey-9",flat:"",label:"Close"},on:{click:function(e){t.mode="cancel"}}}),e("q-btn",{attrs:{color:"grey-9",flat:"",label:t.isNeedCopy?t.loadLabel:t.replaceLabel,disabled:t.isNeedCopy&&t.oldName===t.name},on:{click:function(e){t.mode="ok"}}})],1)])])},Lc=[],Nc={props:{initName:String},data(){return{dialogModel:!1,isNeedCopy:!1,name:"",oldName:"",mode:"",replaceLabel:"Replace",loadLabel:"Save"}},computed:{title(){return this.isNeedCopy?"Save board":"Replace board"},message(){return this.isNeedCopy?"Save the new board?":"Such board exists. Replace?"},nameModel:{get(){return this.name},set(t){this.$emit("change:name",t),this.name=t}}},methods:{open(t){return this.replaceLabel=t&&t.replaceLabel||"Replace",this.loadLabel=t&&t.loadLabel||"Save",this.$nextTick((()=>{this.name=this.initName,this.oldName=this.initName})),this.dialogModel=!0,new Promise(((t,e)=>{const i=setInterval((()=>{this.mode&&("ok"===this.mode?t(this.oldName):e(new Error("canceled")),this.mode="",this.isNeedCopy=!1,this.dialogModel=!1,clearInterval(i))}),50)}))}}},Dc=Nc,Qc=Object(f["a"])(Dc,Fc,Lc,!1,null,null,null),Hc=Qc.exports;q()(Qc,"components",{QDialog:Et["a"],QCheckbox:Ls["a"],QInput:y["a"],QBtn:pt["a"]});var Rc=function(){var t=this,e=t._self._c;return e("q-dialog",{attrs:{maximized:t.$q.platform.is.mobile},on:{hide:t.close},model:{value:t.opened,callback:function(e){t.opened=e},expression:"opened"}},[e("div",{style:{width:t.$q.platform.is.mobile?"100%":"50vw"}},[e("q-toolbar",{staticClass:"text-white",class:[`bg-${t.$theme}-9`]},[e("q-toolbar-title",[t._v("\n        "+t._s(t.mode?"Export":"Import")+"\n      ")])],1),e("div",{staticClass:"scrol q-pa-md",class:[`bg-${t.$theme}-1`],style:{height:t.$q.platform.is.mobile?"calc(100% - 100px)":"50vh"}},[1===t.mode?[e("div",{staticClass:"export-modal-view"},[e("div",{staticClass:"export-modal-view__string",staticStyle:{height:"45%"}},[e("q-input",{attrs:{outlined:"",dense:"","hide-bottom-space":"",rows:7,"input-style":"resize: none;",type:"textarea",readonly:!0,value:t.data,label:"Config",color:"grey-9"}},[e("q-btn",{attrs:{slot:"append",dense:"",flat:"",icon:"mdi-content-copy"},on:{click:t.copyString},slot:"append"})],1)],1),e("div",{staticClass:"text-center text-italic q-mt-lg",staticStyle:{height:"10%","font-size":"2rem"}},[t._v("or")]),e("div",{staticClass:"export-modal-view__file flex flex-center q-mt-lg",staticStyle:{height:"45%"}},[e("q-btn",{attrs:{label:"Download file",size:"1.6rem",color:"grey-9",flat:"",icon:"mdi-download"},on:{click:t.downloadFile}})],1)])]:0===t.mode?[e("div",{staticClass:"import-modal-view full-height"},[e("div",{staticClass:"export-modal-view__string",staticStyle:{height:"45%"}},[e("q-input",{staticClass:"full-height",attrs:{outlined:"",dense:"","hide-bottom-space":"",row:7,"input-style":"resize: none;",type:"textarea",label:"Config",color:"grey-9",placeholder:"Put exported config here"},model:{value:t.importData,callback:function(e){t.importData=e},expression:"importData"}})],1),e("div",{staticClass:"text-center text-italic",staticStyle:{height:"10%","font-size":"2rem"}},[t._v("or")]),e("div",{staticClass:"export-modal-view__file flex flex-center relative-position rounded-borders",staticStyle:{height:"45%",border:"dashed 1px black"}},[t.canAddFiles?e("q-btn",{staticClass:"absolute-top-right",staticStyle:{top:"-20px",right:"8px","z-index":"1"},attrs:{icon:"mdi-plus",color:`${t.$theme}-9`,"fab-mini":""},on:{click:t.pickFiles}},[e("q-tooltip",[t._v("Pick Files")])],1):t._e(),e("q-uploader",{ref:"uploader",staticClass:"full-width full-height",class:[`bg-${t.$theme}-1`],attrs:{url:"",color:`${t.$theme}-9`,accept:".txt","hide-upload-btn":""},on:{added:t.preview,removed:function(e){t.canAddFiles=!0}},scopedSlots:t._u([{key:"header",fn:function(i){return[e("div",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"row no-wrap items-center q-pa-sm q-gutter-xs"},[i.isUploading?e("q-spinner",{staticClass:"q-uploader__spinner"}):t._e(),e("div",{staticClass:"col"},[e("div",{staticClass:"q-uploader__title"},[t._v("Upload your files")])]),i.canAddFiles?e("q-btn",{attrs:{type:"a",icon:"add_box",round:"",dense:"",flat:""}},[e("q-uploader-add-trigger"),e("q-tooltip",[t._v("Pick Files")])],1):t._e()],1)]}},{key:"list",fn:function(i){return[i.files.length?t._e():e("div",{staticClass:"text-center"},[e("q-icon",{attrs:{name:"mdi-file-import-outline",size:"6rem",color:"grey-9"}}),e("div",{staticStyle:{"font-size":"18px"}},[t._v("Select an importing file.")])],1),e("q-list",{attrs:{separator:""}},t._l(i.files,(function(s){return e("q-item",{key:s.name},[e("q-item-section",[e("q-item-label",{staticClass:"full-width ellipsis"},[t._v("\n                        "+t._s(s.name)+"\n                      ")]),e("q-item-label",{attrs:{caption:""}},[t._v("\n                        "+t._s(s.__sizeLabel)+"\n                      ")])],1),s.__img?e("q-item-section",{staticClass:"gt-xs",attrs:{thumbnail:""}},[e("img",{attrs:{src:s.__img.src}})]):t._e(),e("q-item-section",{attrs:{side:""}},[e("q-btn",{attrs:{color:"red",size:"12px",flat:"",dense:"",round:"",icon:"mdi-delete"},on:{click:function(t){return i.removeFile(s)}}})],1)],1)})),1)]}}])})],1)])]:t._e()],2),e("q-toolbar",{class:[`bg-${t.$theme}-9`]},[e("q-toolbar-title"),e("q-btn",{staticClass:"q-mr-sm",attrs:{flat:"",color:"white",dense:""},on:{click:t.close}},[t._v("Close")]),0===t.mode?e("q-btn",{staticClass:"q-mr-sm",attrs:{flat:"",dense:"",color:"white"},on:{click:t.importHandler}},[t._v("Import")]):t._e()],1)],1)])},Pc=[],zc=(i("88a7"),i("271a"),i("5494"),i("cdde")),jc={props:["mode","data"],data(){return{opened:!1,canAddFiles:!0,reader:new FileReader,importData:""}},methods:{open(){this.opened=!0},close(){this.opened=!1,this.canAddFiles=!0,this.$emit("close")},preview(t){this.canAddFiles=!1,this.reader.readAsText(t[0])},importHandler(){this.close(),this.$nextTick((()=>{this.$emit("import",this.importData),this.importData=""}))},copyString(){Object(zc["a"])(this.data).then((t=>{this.$q.notify({color:"positive",icon:"content_copy",message:"Copied",timeout:1e3,position:"bottom-left"})}),(t=>{this.$q.notify({color:"negative",icon:"content_copy",message:"Error coping",timeout:1e3,position:"bottom-left"})}))},downloadFile(){const t=document.createElement("a");t.style.display="none";const e=new Blob([this.data],{type:"text/plain"}),i=t.href=URL.createObjectURL(e);t.download="data.txt",document.body.appendChild(t),t.click(),setTimeout((function(){document.body.removeChild(t),window.URL.revokeObjectURL(i)}),0)},pickFiles(){this.$refs.uploader.pickFiles()}},created(){this.reader.onload=t=>{this.importData=t.target.result,this.$nextTick((()=>{this.importHandler()}))}}},Wc=jc,Uc=i("ee89"),Gc=i("0d59"),Yc=i("cc04"),Jc=Object(f["a"])(Wc,Rc,Pc,!1,null,null,null),Kc=Jc.exports;q()(Jc,"components",{QDialog:Et["a"],QToolbar:At["a"],QToolbarTitle:Ft["a"],QInput:y["a"],QBtn:pt["a"],QTooltip:S["a"],QUploader:Uc["a"],QSpinner:Gc["a"],QUploaderAddTrigger:Yc["a"],QIcon:x["a"],QList:Lt["a"],QItem:dt["a"],QItemSection:ut["a"],QItemLabel:mt["a"]});var Xc=function(){var t=this,e=t._self._c;return e("q-dialog",{attrs:{value:!!t.board,position:t.position},on:{"before-hide":function(e){return t.$emit("close")},"escape-key":function(e){return t.$emit("close")}}},[e("div",{class:[`bg-${t.$theme}-1`],style:{minWidth:t.$q.screen.width>500?"500px":"100%"}},[e("div",{staticClass:"q-py-xs flex row reverse",class:[`bg-${t.$theme}-9`]},[e("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",color:"white",round:"",icon:"mdi-close"},on:{click:function(e){return t.$emit("close")}}})],1),e("q-separator"),e("div",{staticClass:"q-pa-md",staticStyle:{"min-height":"91px"}},[e("div",{staticClass:"row no-wrap items-center"},[e("div",{staticClass:"col"},[e("div",{staticClass:"text-h6 ellipsis",staticStyle:{"line-height":"1.25rem"}},[t._v(t._s(t.name))]),e("div",{staticClass:"text-grey-9",staticStyle:{"line-height":"1.25rem","font-size":".9rem"}},[t._v(t._s(t.get(t.board,"settings.id","<no_alias>")))])]),e("div",{staticClass:"col-auto text-grey text-caption row no-wrap items-center"},[e("q-icon",{attrs:{name:t.blocked?"mdi-lock":"mdi-lock-open",size:"1.2rem"}},[e("q-tooltip",[t._v(t._s(t.blocked?"Board locked":"Board unlocked"))])],1)],1)]),t.boardVars.length?e("div",t._l(t.boardVars,(function(i){return e("q-icon",{key:i.name,staticClass:"q-mr-xs",attrs:{size:"1.2rem",name:t.getIcon(i),color:"grey-9"}},[e("q-tooltip",[t._v("Variable: "+t._s(i.name))])],1)})),1):t._e()]),t.topics.subscribe&&t.topics.subscribe.length||t.topics.publish&&t.topics.publish.length?e("div",{staticClass:"scroll q-pa-md",class:[`bg-${t.$theme}-2`],staticStyle:{"font-size":"0.9rem","max-height":"calc(100% - 142px)"}},[t.topics.subscribe&&t.topics.subscribe.length?e("div",{staticClass:"text-white q-pa-sm row"},[e("div",{staticClass:"col text-grey-9 text-weight-medium"},[t._v("Topics")]),e("div",{staticClass:"col-auto text-grey-9 text-caption row no-wrap items-center"},[e("q-icon",{staticClass:"cursor-pointer",attrs:{name:"mdi-content-copy",size:"0.9rem"},on:{click:function(e){t.copy("Subscribe\n\r"+t.topics.subscribe.join("\n")+"\rPublish\n\r"+t.topics.publish.join("\n"))}}})],1)]):t._e(),e("div",[t.topics.subscribe&&t.topics.subscribe.length?e("div",{staticClass:"bg-orange text-white q-pa-sm row",staticStyle:{"border-radius":"5px 5px 0 0"}},[e("div",{staticClass:"col"},[t._v("Subscribe")]),e("div",{staticClass:"col-auto text-white text-caption row no-wrap items-center"},[e("q-icon",{staticClass:"cursor-pointer",attrs:{name:"mdi-content-copy",size:"0.9rem"},on:{click:function(e){t.copy(t.topics.subscribe.join("\n"))}}})],1)]):t._e(),t.topics.subscribe&&t.topics.subscribe.length?e("div",{staticClass:"bg-orange-2 q-pa-xs text-grey-10 q-mb-sm topics--bordered topics--orange"},t._l(t.topics.subscribe,(function(i,s){return e("div",{key:i,staticClass:"row"},[e("div",{staticClass:"col"},[t._v(t._s(i))]),e("div",{staticClass:"col-auto text-grey text-caption row no-wrap items-center"},[e("q-icon",{staticClass:"cursor-pointer",attrs:{name:"mdi-content-copy",size:"0.9rem"},on:{click:function(e){return t.copy(i)}}})],1),s<t.topics.subscribe.length-1?e("q-separator"):t._e()],1)})),0):t._e(),t.topics.publish&&t.topics.publish.length?e("div",{staticClass:"bg-indigo text-white q-pa-sm row",staticStyle:{"border-radius":"5px 5px 0 0"}},[e("div",{staticClass:"col"},[t._v("Publish")]),e("div",{staticClass:"col-auto text-white text-caption row no-wrap items-center"},[e("q-icon",{staticClass:"cursor-pointer",attrs:{name:"mdi-content-copy",size:"0.9rem"},on:{click:function(e){t.copy(t.topics.publish.join("\n"))}}})],1)]):t._e(),t.topics.publish&&t.topics.publish.length?e("div",{staticClass:"bg-indigo-2 q-pa-xs text-grey-10 topics--bordered topics--indigo"},t._l(t.topics.publish,(function(i,s){return e("div",{key:i,staticClass:"row"},[e("div",{staticClass:"col"},[t._v(t._s(i))]),e("div",{staticClass:"col-auto text-grey text-caption row no-wrap items-center"},[e("q-icon",{staticClass:"cursor-pointer",attrs:{name:"mdi-content-copy",size:"0.9rem"},on:{click:function(e){return t.copy(i)}}})],1),s<t.topics.publish.length-1?e("q-separator"):t._e()],1)})),0):t._e()])]):t._e()],1)])},Zc=[];function td(t){return{publish:t.settings.topics.map((t=>(t.topicTemplate||t.topicFilter).replace(/<%.*%>/g,"+")))}}function ed(t){let e;if(t.settings.mode===fi){const i=t.dataTopics[0];e=[i.topicTemplate||i.topicFilter]}else e=t.settings.items.map((t=>t.actionTopic));return{publish:e,subscribe:t.dataTopics.map((t=>(t.topicTemplate||t.topicFilter).replace(/<%.*%>/g,"+")))}}function id(t){let e;if(t.settings.mode===be)e=[t.settings.falseActionTopic,t.settings.trueActionTopic];else if(1===t.dataTopics.length){const i=t.dataTopics[0];e=[(i.topicTemplate||i.topicFilter).replace(/<%.*%>/g,"+")]}else t.settings.mode===ge&&(e=[t.settings.actionTopic]);return{publish:e,subscribe:t.dataTopics.map((t=>(t.topicTemplate||t.topicFilter).replace(/<%.*%>/g,"+")))}}function sd(t){const e=t.settings.topics[0];return{publish:[(e.topicTemplate||e.topicFilter).replace(/<%.*%>/g,"+")]}}function ad(t){return{subscribe:t.dataTopics.map((t=>(t.topicTemplate||t.topicFilter).replace(/<%.*%>/g,"+")))}}function nd(t){const e=t.dataTopics.map((t=>(t.topicTemplate||t.topicFilter).replace(/<%.*%>/g,"+")));return{subscribe:[...e],publish:[...e]}}function od(t){return{subscribe:t.dataTopics.map((t=>(t.topicTemplate||t.topicFilter).replace(/<%.*%>/g,"+")))}}function rd(t){const e=t.settings.mode;let i,s;return e===ci?s=t.settings.items.map((t=>{const e=t.topic;return(e.topicTemplate||e.topicFilter).replace(/<%.*%>/g,"+")})):e===di&&(i=t.dataTopics.map((t=>(t.topicTemplate||t.topicFilter).replace(/<%.*%>/g,"+")))),{subscribe:i,publish:s}}function ld(t){return{subscribe:t.dataTopics.map((t=>(t.topicTemplate||t.topicFilter).replace(/<%.*%>/g,"+")))}}function cd(t){return{subscribe:t.settings.topics.map((t=>(t.topicTemplate||t.topicFilter).replace(/<%.*%>/g,"+")))}}function dd(t){return{subscribe:t.dataTopics.map((t=>(t.topicTemplate||t.topicFilter).replace(/<%.*%>/g,"+")))}}function ud(t){return{subscribe:t.dataTopics.map((t=>(t.topicTemplate||t.topicFilter).replace(/<%.*%>/g,"+")))}}function pd(t){return{subscribe:[...t.dataTopics.map((t=>(t.topicTemplate||t.topicFilter).replace(/<%.*%>/g,"+"))),...t.settings.topics.map((t=>(t.topicTemplate||t.topicFilter).replace(/<%.*%>/g,"+")))]}}function md(t){return{subscribe:[...t.dataTopics.map((t=>(t.topicTemplate||t.topicFilter).replace(/<%.*%>/g,"+"))),...t.settings.topics.map((t=>(t.topicTemplate||t.topicFilter).replace(/<%.*%>/g,"+")))]}}function hd(t){const e=t.dataTopics.map((t=>(t.topicTemplate||t.topicFilter).replace(/<%.*%>/g,"+")));return{subscribe:[...e,...t.settings.topics.map((t=>(t.topicTemplate||t.topicFilter).replace(/<%.*%>/g,"+")))],publish:[...e]}}function gd(t){return{subscribe:t.settings.topics.map((t=>(t.topicTemplate||t.topicFilter).replace(/<%.*%>/g,"+")))}}function bd(t){return{subscribe:t.settings.topics.map((t=>(t.topicTemplate||t.topicFilter).replace(/<%.*%>/g,"+")))}}const vd={clicker:td,singleselect:ed,switcher:id,"text-sender":sd,calculator:ad,color:nd,complex:od,frame:rd,informer:ld,"multi-informer":cd,multiplier:dd,"status-indicator":ud,linear:pd,radial:md,slider:hd,"map-location":gd,"map-route":bd};function fd(t,e){let i=[`xflespifront/mqtttiles/boards/${t.id}`];t.settings.variables&&(i=[...i,...t.settings.variables.map((t=>t.topic.topicTemplate))]);const s=e.reduce(((t,e)=>{const i=vd[e.type]||(()=>({})),s=i(e);return s.subscribe&&(t.subscribe=[...t.subscribe,...s.subscribe]),s.publish&&(t.publish=[...t.publish,...s.publish]),t}),{subscribe:i,publish:[]});return s.subscribe&&(s.subscribe=de()(s.subscribe).sort()),s.publish&&(s.publish=de()(s.publish).sort()),s}var yd={props:{board:{type:Object}},data(){return{position:"top"}},computed:{topics(){return this.board?fd(this.board.settings,this.board.widgets):{}},boardVars(){return R()(this.board,"settings.settings.variables",[])},name(){return R()(this.board,"settings.name")||"*No name*"},blocked(){return R()(this.board,"settings.settings.blocked",!1)}},methods:{close(){this.$emit("close")},get:R.a,getIcon(t){let e="";return t.preset?"devices"===t.preset?e="mdi-developer-board":"channels"===t.preset?e="mdi-call-merge":"calcs"===t.preset?e="mdi-calculator-variant":"custom"===t.preset&&(e=1===t.type?"mdi-alpha-v-box":"mdi-variable"):e=1===t.type?"mdi-alpha-v-box":"mdi-variable",e},copy(t){Object(zc["a"])(t)}}},xd=yd,Sd=(i("de08"),Object(f["a"])(xd,Xc,Zc,!1,null,null,null)),_d=Sd.exports;q()(Sd,"components",{QDialog:Et["a"],QBtn:pt["a"],QSeparator:mi["a"],QIcon:x["a"],QTooltip:S["a"]}),q()(Sd,"directives",{ClosePopup:oe["a"]});var qd=i("9224");const wd={"1.6.5":t=>{const e=t.settings.variables||[];return e.forEach(((t,e)=>{t.type?t.topic.payloadNameField="":t.values=t.values.map((t=>[t,t]))})),t}};function Td(t,e,i){return t.map((t=>$d(t,e,i)))}function $d(t,e,i){const s=wd,a=Object.keys(s);return a.forEach((a=>{if($c.a.compare(a,e,">")&&$c.a.compare(a,i,"<="))try{s[a](t)}catch(n){console.log(n)}})),t}var Cd={methods:{migrateBoard:$d,migrateBoards:Td}};const kd=function(t){Object.keys(t).forEach((e=>{t[e].status=vt["k"]}))},Id=function(t,e){return t=F()(t),e=F()(e),kd(e),Object.keys(t).forEach((i=>{t[i].widgetsIndexes=t[i].widgetsIndexes.map((t=>e[t])),t[i].appVersion=qd["a"]})),t},Vd=function(t,e){return t=F()(t),e=F()(e),kd(e),t.widgetsIndexes=t.widgetsIndexes.map((t=>e[t])),t.appVersion=qd["a"],t},Md=(t,e)=>N()(t,(t=>t===e));var Od={name:"Dash",props:["clientSettings","initBoards"],data(){return{fullView:!(this.clientSettings&&this.clientSettings.flespiBoard),client:void 0,connack:void 0,clientStatus:!1,clientErrors:[],boards:{},boardsConfigs:{},widgets:{},subscriptions:{},subscriptionsStatuses:{},subscriptionsIndetifiers:{},currentSubscriptionIndetifier:0,widgetsBySubscription:{},activeBoardId:void 0,colsByBreakpoint:{lg:12,md:10,sm:6,xs:4,xxs:2},boardsFromConnection:{},exportBoardId:"",expireMessagesProcess:0,expireMessagesStore:{},importExportMode:void 0,importExportData:void 0,importExportEntity:void 0,values:{},boardsVariablesValues:{},boardInfo:void 0,flespiToken:void 0}},computed:{boardsIds(){return Object.keys(this.boards)},subscriptionsTopics(){return Object.keys(this.subscriptions)},canShareByClientToken(){return this.connack&&this.flespiToken&&1!==this.flespiToken.access.type},canShare(){const t=this.clientSettings&&this.clientSettings.syncCreds&&this.clientSettings.syncCreds.length;return this.clientStatus&&!!this.clientSettings&&-1!==this.clientSettings.host.indexOf("flespi")&&!this.clientSettings.flespiBoard&&(t||this.canShareByClientToken||!0)},isAttachedBoardsMode(){return!!this.clientSettings&&!!this.clientSettings.attachedBoards}},methods:{uid:$["a"],valuesProcessing(){const t=this.values;Object.keys(this.widgets).forEach((e=>{this.values[e]||this.$set(this.values,e,{});const i=t[e],s=this.widgets[e];let a=!1;const n=s.topics.reduce(((t,n)=>{let o=this.subscriptionsStatuses[n]&&this.subscriptions[n];const r=!!i[n];r||(t[n]={});const l=wc(s.type)(o,R()(this.values,`${e}['${n}']`,void 0),n,s);return i[n]!==l&&(a=!0),t[n]=l,t}),{});a&&this.$set(this.values,e,n)}))},boardsVariablesValuesProcessing(){this.boardsVariablesValues=this.boardsIds.reduce(((t,e)=>{const i=this.boards[e],s=i.settings.variables&&i.settings.variables.filter((t=>1===t.type))||[];t[e]||(t[e]={});const a=s.reduce(((t,e,i)=>{const s=e.topic.topicFilter,a=this.subscriptionsStatuses[s]&&this.subscriptions[s]?this.subscriptions[s]:[];return t[e.name]||(t[e.name]={}),a.forEach((i=>{const s=e.topic.topicFilter;if(!this.subscriptions[s])return!1;const a=this.getValueByTopic(i.payload,e.topic),n=i.topic;a&&"N/A"!==a?t[e.name][n]=a:t[e.name][n]&&delete t[e.name][n]})),t}),Object.assign({},t[e]));return this.$set(t,e,a),t}),Object.assign({},this.boardsVariablesValues))},busMessagesProcessing(){this.valuesProcessing(),this.boardsVariablesValuesProcessing(),this.clearMessages()},clearMessages(){this.subscriptionsTopics.forEach((t=>{Array.isArray(this.subscriptions[t])&&this.subscriptions[t].splice(0,this.subscriptions[t].length-1)}))},getVariableValue(t,e,i){const s={},a=e.topic.topicFilter;if(!this.subscriptions[a])return s;const n=this.getValueByTopic(i.payload,e.topic),o=i.topic;return n&&"N/A"!==n?this.$set(s,o,n):s[o]&&this.$delete(s,o),s},boardsVariablesValuesClear(){this.boardsIds.forEach((t=>{const e=this.boards[t],i=e.settings.variables&&e.settings.variables.filter((t=>1===t.type))||[];this.boardsVariablesValues[t]={},i.forEach(((e,i)=>{this.boardsVariablesValues[t][e.name]={}}))}))},checkTopic(t,e){if(t===e)return!0;const i=t.split("/"),s=e.split("/");return"$share"===s[0]&&s.splice(0,2),(s.length===i.length||"#"===s[s.length-1])&&s.reduce(((t,e,s)=>"#"===e||"+"===e?t&&!0:t&&e===i[s]),!0)},clearObject(t){return Object.keys(t).reduce(((e,i)=>{let s=t[i];return s instanceof Object&&(s=this.clearObject(s),Object.keys(s).length||(s=void 0)),void 0!==s&&null!==s&&(e[i]=s),e}),{})},getSharedTopicFilter(t){return t.replace(/^\$share\/[^/]+\//,"")},resolveTopics(t,e){0===e.indexOf("$share")&&(e=this.getSharedTopicFilter(e));const i=e.split("/"),s=t.split("/");return(s.length===i.length||"#"===i[i.length-1])&&i.reduce(((t,e,i)=>"#"===e||"+"===e?t&&!0:t&&e===s[i]),!0)},errorHandler(t,e){t.timestamp=Date.now(),this.clientErrors.push(t),e&&this.showError(t)},showError(t){this.$q.notify({message:t.message,color:"negative",icon:"mdi-alert-outline",timeout:2e3})},isConnectivityIsEqual(t,e){return!!t&&!!e&&t.clientId===e.clientId&&t.host===e.host&&t.clean===e.clean&&t.keapalive===e.keapalive&&t.username===e.username&&t.password===e.password&&t.protocolVersion===e.protocolVersion&&t.syncNamespace===e.syncNamespace&&V()(t.properties,e.properties)},initClient(){const t=()=>{this.clientStatus=!1,this.$emit("change-status",!1)},e=this.clearObject(this.clientSettings),i=p.connect(e.host,e);i.on("message",((t,i,s)=>{if(-1!==t.indexOf(e.syncNamespace))return this.savedBoardProcess(t.split("/").slice(-1)[0],i),!1;this.setValueByTopic(t,{...s,timestamp:Date.now()}),this.expireMessagesHandler(s),this.debouncedBusMessagesProcessing()})),i.on("connect",(t=>{this.connack=t,this.flespiToken=JSON.parse(R()(this.connack,"properties.userProperties.token",null)),this.clientStatus=!0,this.$emit("change-status",!0),this.initWidgets(),this.clientSettings.flespiBoard||this.getSyncedBoards(),this.$integrationMode&&this.$integrationBus.send("connected")})),i.on("error",(t=>{this.errorHandler(t,!1)})),i.on("close",t),i.on("offline",(()=>{t(),this.expireMessagesProcessingStop()})),i.on("end",t),this.client=i},createClient(){this.initClient()},setValueByTopic(t,e){if(null===e)return this.$set(this.subscriptions,t,e),!0;let i=e&&e.properties&&e.properties.subscriptionIdentifier;i?(Array.isArray(i)||(i=[i]),i.forEach((t=>{const i=this.subscriptionsIndetifiers[t];this.writeValueByTopic(i,e)}))):this.subscriptionsTopics.forEach((i=>{this.checkTopic(t,i)&&this.writeValueByTopic(i,e)}))},writeValueByTopic(t,e){Array.isArray(this.subscriptions[t])?this.subscriptions[t].push(e):this.$set(this.subscriptions,t,[e])},expireMessagesHandler(t){t.properties&&t.properties.messageExpiryInterval?(this.expireMessagesProcess||this.expireMessagesProcessing(),this.expireMessagesStore[t.topic]=Date.now()+Math.floor(1e3*t.properties.messageExpiryInterval)):this.expireMessagesStore[t.topic]&&this.$delete(this.expireMessagesStore,t.topic)},expireMessagesProcessing(){this.expireMessagesProcess=setInterval((()=>{const t=Date.now();Object.keys(this.expireMessagesStore).forEach((e=>{const i=this.expireMessagesStore[e];i<t&&(this.subscriptionsTopics.forEach((t=>{this.checkTopic(e,t)&&this.subscriptions[t]&&this.subscriptions[t].push({topic:e,payload:k()().slice(0,-1)})})),this.$delete(this.expireMessagesStore,i))}))}),3e4)},expireMessagesProcessingStop(){this.expireMessagesProcess&&clearInterval(this.expireMessagesProcess),this.expireMessagesStore={},this.expireMessagesProcess=0},async subscribe(){if(this.client){let[t,e]=arguments;if(5===this.clientSettings.protocolVersion){e||(e={}),e.properties||(e.properties={});const i=Number(Object.keys(this.subscriptionsIndetifiers).find((e=>this.subscriptionsIndetifiers[e]===t)))||++this.currentSubscriptionIndetifier;if(e.properties.subscriptionIdentifier=i,this.subscriptionsIndetifiers[i]=t,0!==t.indexOf("flespi/")&&this.clientSettings.subscribeWithTokenCid){const t=R()(this.flespiToken,"cid",void 0);e.properties.userProperties||(e.properties.userProperties={}),t&&(e.properties.userProperties.cid=t)}}return this.client.subscribe(t,e).then((()=>{const t=arguments[0];return this.subscriptionsStatuses[t]=!0,arguments})).catch((t=>{this.errorHandler(t)}))}},async unsubscribe(t){if(this.client){const[t,e]=arguments;if(5===this.clientSettings.protocolVersion){const e=Object.keys(this.subscriptionsIndetifiers).find((e=>this.subscriptionsIndetifiers[e]===t));-1!==e&&delete this.subscriptionsIndetifiers[e]}return this.client.unsubscribe(t,e).then((()=>{const t=arguments[0];delete this.subscriptionsStatuses[t]})).catch((t=>{this.errorHandler(t)}))}},async publish(){if(this.client)return this.client.publish(...arguments).catch((t=>(this.errorHandler(t,!0),t)));this.showError(new Error("You have no active clients"),!0)},async destroyClient(){await this.client.end(!0),this.subscriptionsStatuses={}},setActiveBoard(t){this.activeBoardId=t,this.$emit("change:title",this.getTitle()),this.$integrationMode&&this.$integrationBus.send("activeBoard",t)},clearActiveBoard(){this.activeBoardId=void 0,this.$emit("change:title",this.getTitle()),this.$integrationMode&&this.$integrationBus.send("activeBoard",void 0)},actionHandler({topic:t,payload:e,settings:i}){i.qos||(i.qos=1),this.publish(t,e,i)},addBoard(t){this.isAttachedBoardsMode?this.$set(this.boardsConfigs,t.id,this.packBoard(t,this.widgets)):(this.$set(this.boards,t.id,t),this.resolveBoardVariables(t),this.setModifyTimeBoardHandler(t.id))},deleteBoardHandler(t){this.resolveBoardVariables(void 0,this.boards[t]);const e=this.boards[t].widgetsIndexes;e.forEach((e=>{const i=this.widgets[e].topics;i.forEach((i=>{const s=this.widgetsBySubscription[i];Md(s,e),s.length||(this.hasBoardsVariableWithSameSubscription(t,i)||(this.unsubscribe(i),this.$delete(this.subscriptions,i)),this.$delete(this.widgetsBySubscription,i))})),this.$delete(this.widgets,e)})),this.$delete(this.boards,t)},deleteBoardDialogHandler(t){this.$q.dialog({title:`Delete ${this.boards[t].name||"*No name*"} board?`,message:`You are about to delete the ${this.boards[t].name||"*No name*"} board. The board will be removed from all connections. Continue?`,color:"grey-9",ok:!0,cancel:!0}).onOk((()=>{this.deleteBoardHandler(t)}))},deleteUploadedBoard(t){this.$q.dialog({title:"Delete remote board?",message:"Do you really want to delete remote board?",color:"grey-9",ok:!0,cancel:!0}).onOk((()=>{this.publish(`${this.clientSettings.syncNamespace}/${t}`,"",{qos:1,retain:!0})}))},editBoardHandler({id:t,board:e}){this.resolveBoardVariables(e,this.boards[t]),this.$set(this.boards,t,e),t!==e.id&&this.replaceBoardHandler(t),this.setModifyTimeBoardHandler(e.id)},setModifyTimeBoardHandler(t){this.$set(this.boards[t].settings,"lastModify",Date.now())},replaceBoardHandler(t){const e=this.boards[t];this.$set(this.boards,e.id,e),this.activeBoardId===t&&(this.clearActiveBoard(),this.$nextTick((()=>{this.setActiveBoard(e.id)}))),this.$delete(this.boards,t),e.widgetsIndexes.forEach(((t,i)=>{const s=Object($["a"])();this.$set(this.widgets,s,this.widgets[t]),this.$set(e.widgetsIndexes,i,s),this.$set(this.widgets[s],"id",s),this.$delete(this.widgets,t);const a=e.shortcutsIndexes.indexOf(t);-1!==a&&this.$set(e.shortcutsIndexes,a,s),this.widgets[s].topics.forEach(((e,i)=>{const a=this.widgetsBySubscription[e];this.$set(a,a.indexOf(t),s)})),Object.keys(e.layouts).forEach((t=>{e.layouts[t][i].i=s}))}))},blockBoardHandler(){const t=this.boards[this.activeBoardId];this.$set(t.settings,"blocked",!t.settings.blocked)},preventBoardHandler(){const t=this.boards[this.activeBoardId];this.$set(t.settings,"preventCollision",!t.settings.preventCollision)},packBoard(t,e){return Vd(t,e)},unpackBoard(t){const e={},i=[];return t.widgetsIndexes=Ac(t.widgetsIndexes,t.appVersion,qd["a"]),t.widgetsIndexes.forEach((t=>(i.push(t.id),e[t.id]=t,e))),t.widgetsIndexes=i,{widgets:e,board:t}},initBoard(t){t=this.migrateBoard(F()(t),t.appVersion,qd["a"]);const{board:e,widgets:i}=this.unpackBoard(t);t=e,t.appVersion=qd["a"],this.$set(this.boards,t.id,t),this.resolveBoardVariables(t),Object.keys(i).forEach((t=>{this.addWidget(i[t])}))},initSavedBoards(t){if(t){let e={};Object.keys(t).forEach((i=>{let s=t[i];const{board:a,widgets:n}=this.unpackBoard(s);e={...e,...n},s=a,this.resolveBoardVariables(s),t[i]=this.migrateBoard(s,s.appVersion,qd["a"]),t[i].appVersion=qd["a"]})),this.boards=t,e&&(this.widgets=e,this.runtimeInitWidgets())}},resolveBoardVariables(t,e){e||(e={settings:{}}),t||(t={settings:{}});const i=e.settings.variables&&e.settings.variables.filter((t=>1===t.type))||[],s=t.settings.variables&&t.settings.variables.filter((t=>1===t.type))||[],a=i.map((t=>t.topic.topicFilter)),n=s.map((t=>t.topic.topicFilter));e.id&&(this.boardsVariablesValues[e.id]=void 0),t.id&&(this.boardsVariablesValues[t.id]={}),a.forEach(((t,i)=>{if(n.includes(t))return!1;this.widgetsBySubscription[t]&&this.widgetsBySubscription[t].length||this.hasBoardsVariableWithSameSubscription(e.id,t)||this.unsubscribe(t)})),n.forEach((t=>{const e=!!this.subscriptions[t],i={qos:1},s=this.clientSettings&&this.clientSettings.userProperties;s&&(i.properties={},i.properties.userProperties=s),e?this.unsubscribe(t).then((()=>{this.subscribe(t,i)})):(this.setValueByTopic(t,null),this.subscribe(t,i))}))},hasBoardsVariableWithSameSubscription(t,e){return!!this.boardsIds.filter((i=>i!==t&&!(!this.boards[i].settings.variables||!this.boards[i].settings.variables.filter((t=>1===t.type&&t.topic.topicFilter===e)).length))).length},runtimeInitWidgets(){const t=Object.keys(this.widgets);t.forEach((t=>{const e=this.widgets[t].topics;e.forEach((e=>{this.subscriptions[e]||this.setValueByTopic(e,null),this.widgetsBySubscription[e]||(this.widgetsBySubscription[e]=[]),this.widgetsBySubscription[e].push(t)}))}))},initWidgets(){const t=Object.keys(this.widgets);t.forEach((t=>{this.$set(this.widgets[t],"status",vt["l"])}));const e=Object.keys(this.subscriptions);if(e.length){const t=()=>{const t={qos:1},e=this.clientSettings&&this.clientSettings.userProperties;return e&&(t.properties={},t.properties.userProperties=e),t};Promise.all(e.map((e=>this.subscribe(e,t())))).then((t=>{this.clientInited=!0}))}},widgetLayoutSetup(t,e,i,s,a){a=a||this.activeBoardId;const n=this.boards[a],o=this.colsByBreakpoint[s],r=n.layouts[s],{x:l,y:c}=d();function d(){const e=r.reduce(((t,e)=>((t.y===e.y&&t.x<=e.x||t.y<e.y)&&(t=e),t)),{y:0,x:0,h:0,w:0});return e.x+e.w+t<=o?{x:e.x+e.w,y:e.y}:{x:0,y:e.y+1}}r.push({h:e,w:t,i:i,x:l,y:c})},widgetLayoutsSetup(t,e,i,s){Object.keys(this.colsByBreakpoint).forEach((a=>{this.widgetLayoutSetup(t,e,i,a,s)}))},layoutUpdateHandler({layout:t,breakpoint:e}){this.$set(this.boards[this.activeBoardId].layouts,e,t)},deleteWidgetFromLayout(t){const e=this.boards[this.activeBoardId],i=e.layouts;Object.keys(this.colsByBreakpoint).forEach((e=>{this.$delete(i[e],t)}))},addWidget(t,e){return e=e||this.activeBoardId,t.id||(t.id=Object($["a"])(),this.widgetLayoutsSetup(t.settings.width,t.settings.height,t.id,e),this.boards[e].widgetsIndexes.push(t.id)),t.topics.forEach((e=>{const i=void 0!==this.subscriptions[e],s="multiplier"===t.type,a={qos:1},n=this.clientSettings&&this.clientSettings.userProperties;n&&(a.properties={},a.properties.userProperties=n),this.widgetsBySubscription[e]||(this.widgetsBySubscription[e]=[]),i?s&&this.unsubscribe(e).then((()=>{this.subscribe(e,a)})):(this.setValueByTopic(e,null),this.subscribe(e,a)),this.widgetsBySubscription[e].push(t.id)})),this.clientStatus&&(t.status=vt["l"]),this.$set(this.widgets,t.id,t),this.widgets[t.id]},editWidget({widgetId:t,settings:e,topics:i}){(o()(e.topics,i).length||o()(i,e.topics).length)&&(i.forEach((i=>{if(e.topics.includes(i))return!1;Md(this.widgetsBySubscription[i],t),this.widgetsBySubscription[i].length||(this.hasBoardsVariableWithSameSubscription(void 0,i)||(this.unsubscribe(i),this.$delete(this.subscriptions,i)),this.$delete(this.widgetsBySubscription,i))})),e.topics.forEach((s=>{if(i.includes(s))return!1;const a=!!this.subscriptions[s],n="multiplier"===e.type,o={qos:1},r=this.clientSettings&&this.clientSettings.userProperties;r&&(o.properties={},o.properties.userProperties=r),this.widgetsBySubscription[s]||(this.widgetsBySubscription[s]=[]),a?n&&this.unsubscribe(s).then((()=>{this.subscribe(s,o)})):(this.setValueByTopic(s,null),this.subscribe(s,o)),this.widgetsBySubscription[s].push(t)}))),this.$set(this.widgets,t,e),this.valuesProcessing()},deleteWidget({widgetId:t,settings:e}){this.$q.dialog({title:"Delete widget?",message:`Do you really want to delete ${e.name} widget?`,color:"grey-9",ok:!0,cancel:!0}).onOk((()=>{this.removeFromShortcuts(t);const i=this.boards[this.activeBoardId].widgetsIndexes,s=i.indexOf(t);this.$delete(i,s),this.deleteWidgetFromLayout(s),e.topics.forEach((e=>{const i=this.widgetsBySubscription[e];Md(i,t),i.length||(this.hasBoardsVariableWithSameSubscription(void 0,e)||(this.unsubscribe(e),this.$delete(this.subscriptions,e)),this.$delete(this.widgetsBySubscription,e))})),this.$delete(this.widgets,t)}))},fastBindWidgetHandler(t){const e=this.boards[this.activeBoardId].shortcutsIndexes,i=e.indexOf(t);if(-1!==i)this.$delete(e,i);else{if(4===e.length)return this.$q.notify({message:"Shortcuts can contain four widgets maximum",detail:"Delete something to add a new widget.",color:"warning",delay:1e3}),!1;e.push(t)}},removeFromShortcuts(t){Object.keys(this.boards).forEach((e=>{const i=this.boards[e].shortcutsIndexes,s=i.indexOf(t);-1!==s&&this.$delete(i,s)}))},resizeHandler({index:t,height:e,width:i}){const s=this.widgets[t];this.$set(s.settings,"height",e),this.$set(s.settings,"width",i);const a=this.boards[this.activeBoardId],n=a.layouts;Object.keys(n).forEach((s=>{const a=n[s].filter((e=>e.i===t))[0];a.h=e,a.w=i}))},getSyncedBoards(){Object.keys(this.boardsFromConnection).length&&(this.boardsFromConnection={}),this.subscribe(`${this.clientSettings.syncNamespace}/+`)},savedBoardProcess(t,e){if(!e.length)return this.$delete(this.boardsFromConnection,t),!1;e=JSON.parse(e),"object"===typeof e&&(this.$set(this.boardsFromConnection,t,e),t===this.activeBoardId&&this.clientSettings.flespiBoard&&(this.activeBoardId=null,this.deleteBoardHandler(t),this.initBoard(this.boardsFromConnection[t]),this.setActiveBoard(t)))},importBoardHandler(t){const e=t.id;this.exportBoardId=e,this.boards[e]?this.$refs.copyReplaceDialog.open({loadLabel:"Restore"}).then((e=>{e!==this.exportBoardId&&(t.id=this.exportBoardId,t.widgetsIndexes.forEach(((e,i)=>{const s=Object($["a"])(),a=t.shortcutsIndexes.indexOf(t.widgetsIndexes[i].id);-1!==a&&this.$set(t.shortcutsIndexes,a,s),t.widgetsIndexes[i].id=s,Object.keys(t.layouts).forEach((e=>{t.layouts[e][i].i=s}))}))),this.isAttachedBoardsMode?this.$set(this.boardsConfigs,t.id,t):this.initBoard(t),this.exportBoardId=""})).catch((()=>{})):this.isAttachedBoardsMode?this.$set(this.boardsConfigs,t.id,t):this.initBoard(t)},importBoardFromConnectionHandler(t){const e=F()(this.boardsFromConnection[t]);this.importBoardHandler(e)},exportPrepareBoardHandler(t){return this.exportBoardId=t,this.boardsFromConnection[t]?this.$refs.copyReplaceDialog.open().then((t=>this.exportBoardHandler(t,this.exportBoardId))).catch((()=>{})):Promise.resolve(this.exportBoardHandler(t,this.exportBoardId))},exportBoardHandler(t,e){let i,s;t===e?(i=this.boards[t],s=t):(i=this.boards[t],i.id=e,this.replaceBoardHandler(t),s=e);const a=`${this.clientSettings.syncNamespace}/${s}`;return this.publish(a,JSON.stringify(Vd(i,this.widgets)),{qos:1,retain:!0}).then((t=>t instanceof Error?t:(this.closeExportHandler(),s)))},uploadBoardToConnection(t,e){this.exportBoardHandler(t,e)},closeExportHandler(){this.exportBoardId=""},shareHandler(t){const e={boardId:t,tokens:[{label:"<Connection token>",credentions:{username:this.clientSettings.username},accessable:this.canShareByClientToken}],hasRemote:!!this.boardsFromConnection[t],currentRemoteBoards:Object.keys(this.boardsFromConnection),host:this.clientSettings.host,syncNamespace:this.clientSettings.syncNamespace,updateBoardMethod:this.exportBoardHandler};if(this.clientSettings.syncCreds){const t=F()(this.clientSettings.syncCreds);e.tokens=[...e.tokens,...t]}this.$emit("share:prepare",e)},shareErrorHandler(){this.clientSettings?this.$q.notify({type:"warning",timeout:0,message:"Attention",caption:'You need to have a Standard or ACL token for sharing set up in the MQTT Client settings. Please read more <a href="https://flespi.com/blog/mqtt-tiles-shareable-and-flexible-iot-dashboards" target="_blank">here</a>.',html:!0,icon:"mdi-alert",position:"bottom-left",actions:[{label:"Update settings",color:"white",handler:()=>{this.$emit("update-client-settings")}},{label:"Close",color:"white",handler:()=>{}}]}):this.$q.notify({type:"warning",timeout:5e3,message:"Attention",caption:"You need to choose client.",icon:"mdi-alert",position:"bottom-left",closeBtn:!0})},shareUploadedHandler(t){const e={boardId:t,tokens:[{label:"<Connection token>",credentions:{username:this.clientSettings.username},accessable:this.canShareByClientToken}],hasRemote:!1,isRemote:!0,host:this.clientSettings.host,syncNamespace:this.clientSettings.syncNamespace,updateBoardMethod:this.exportBoardHandler};if(this.clientSettings.syncCreds){const t=F()(this.clientSettings.syncCreds);e.tokens=[...e.tokens,...t]}this.$emit("share:prepare",e)},shareSync(){const t=this.clientSettings.flespiBoard,e=`${this.clientSettings.syncNamespace}/${t}`;let i;this.$q.loading.show(),this.subscribe(e).then((()=>{i=this.boardsFromConnection[t],i?(this.initBoard(i),this.setActiveBoard(t)):this.$q.notify({color:"negative",message:`Board ${t} not found`,timeout:1e3,position:"bottom-left"})})).catch((()=>{})).finally((()=>{this.$q.loading.hide()}))},exportBoardAsHandler(t){const e=this.boards[t],i=Vd(e,this.widgets);this.exportAsHandler(i)},exportWidgetsFromBoard(t){if(!t.length)return!1;const e=F()(t).map((t=>(t.id=void 0,t.status=vt["k"],t)));this.exportAsHandler(e)},exportAsHandler(t){this.importExportMode=1,this.importExportData=P["a"].encode(JSON.stringify(t)),this.$refs.importExportModal.open()},importExportClose(){this.importExportMode=void 0,this.importExportData=void 0},importClickHandler(t){this.importExportMode=0,this.importExportEntity=t,this.$refs.importExportModal.open()},importFromUserHandler(t){let e;try{e=JSON.parse(t)}catch(i){e=JSON.parse(P["a"].decode(t))}"board"===this.importExportEntity?this.importBoardHandler(e):"widgets"===this.importExportEntity&&e.forEach((t=>{this.addWidget(t)}))},updateBoards(t,e){this.$emit("update:boards",{...this.boardsConfigs,...Id(t,e)})},changeAttachedBoards(t){this.$emit("change:attach",t)},getTitle(){const t=(this.activeBoardId&&this.boards[this.activeBoardId].name?`${this.boards[this.activeBoardId].name} - `:"")+"MQTT Tiles";return t},integrationModeActivate(){this.$integrationBus.on("SetBoards",(t=>{this.initSavedBoards(t)})),this.$integrationBus.on("CreateBoard",(()=>{const t=Object.freeze({name:"New board",id:"",settings:{blocked:!1,variables:[]},activeVariables:{},shortcutsIndexes:[],widgetsIndexes:[],layouts:{lg:[],md:[],sm:[],xs:[],xxs:[]}}),e=Q()({},t);e.id=Object($["a"])(),this.addBoard(e),this.$integrationBus.send("boardCreated",e.id)})),this.$integrationBus.on("AddWidget",(({boardId:t,widgetConfig:e})=>{const i=this.addWidget(e,t);this.$integrationBus.send("widgetCreated",i.id)})),this.$integrationBus.on("SetActiveBoard",(t=>{this.setActiveBoard(t)}))},getBoardInfoHandler(t,e){const i=e?t.widgetsIndexes:t.widgetsIndexes.map((t=>this.widgets[t]));this.boardInfo={settings:t,widgets:i}}},created(){if(this.debouncedBusMessagesProcessing=E()(this.busMessagesProcessing,1e3,{leading:!1}),this.debouncedUpdateBoards=O()(this.updateBoards,500,{trailing:!0}),this.valuesProcessing(),this.clientSettings)return this.clientSettings.flespiBoard&&this.shareSync(),!0;if(this.initBoards){let t={...this.initBoards},e={...this.initBoards};this.clientSettings&&this.clientSettings.attachedBoards?t=this.clientSettings.attachedBoards.reduce(((i,s)=>(t[s]&&(i[s]=t[s],delete e[s]),i)),{}):e={},this.boardsConfigs=e,this.initSavedBoards(t)}this.$integrationMode&&this.integrationModeActivate(),window&&window.addEventListener("beforeunload",(()=>{this.client&&this.client.end(!0)})),this.$emit("change:title",this.getTitle())},destroyed(){this.client&&this.client.end()},watch:{clientSettings:{handler(t,e){const i=!!t&&!e;return!this.isConnectivityIsEqual(t,e)&&(this.client&&this.destroyClient(),kd(this.widgets),this.boardsFromConnection={},Object.keys(this.subscriptions).forEach((t=>{this.setValueByTopic(t,null)})),e&&this.debouncedBusMessagesProcessing(),this.boardsVariablesValuesClear(),t?void(i?this.createClient():setTimeout((()=>{this.createClient()}),500)):(this.client=void 0,!1))},immediate:!0},"clientSettings.attachedBoards"(t,e){t&&!e?e=Object.keys(this.boards):!t&&e?(t=[...Object.keys(this.boardsConfigs),...Object.keys(this.boards)],e=[]):t||e||(e=[],t=[]),e.forEach((e=>{if(this.boards[e]&&!t.includes(e)){const t=this.packBoard(this.boards[e],this.widgets);this.activeBoardId===e&&this.clearActiveBoard(),this.deleteBoardHandler(e),this.$set(this.boardsConfigs,e,t)}})),t.forEach((t=>{!this.boards[t]&&this.boardsConfigs[t]&&(this.initBoard(this.boardsConfigs[t]),this.$delete(this.boardsConfigs,t))}))},boardsConfigs:{deep:!0,handler(){this.fullView&&this.debouncedUpdateBoards(this.boards,this.widgets)}},boards:[{deep:!0,handler(t){this.fullView&&this.debouncedUpdateBoards(t,this.widgets)}},{handler:"boardsVariablesValuesProcessing"}],widgets:[{deep:!0,handler(t){this.fullView&&this.debouncedUpdateBoards(this.boards,t)}},{handler:"valuesProcessing"}]},components:{Board:ac,Boards:vc,CopyReplaceDialog:Hc,ImportExportModal:Kc,BoardInfoDialog:_d},mixins:[ya,Cd]},Bd=Od,Ed=(i("272a"),Object(f["a"])(Bd,r,l,!1,null,null,null)),Ad=Ed.exports;q()(Ed,"components",{QBtn:pt["a"]});var Fd=function(){var t=this,e=t._self._c;return e("q-dialog",{attrs:{maximized:t.$q.platform.is.mobile},on:{hide:t.closeHandler},model:{value:t.status,callback:function(e){t.status=e},expression:"status"}},[e("div",{style:{width:t.$q.platform.is.mobile?"100%":"50vw"}},[e("q-toolbar",{staticClass:"text-white",class:[`bg-${t.$theme}-9`]},[e("q-toolbar-title",[t._v("Share wizard")])],1),e("div",{staticClass:"scroll",class:[`bg-${t.$theme}-1`],style:{height:t.$q.platform.is.mobile?"calc(100% - 100px)":"50vh"}},[e("q-stepper",{ref:"stepper",staticClass:"share-stepper",class:[`bg-${t.$theme}-1`],attrs:{flat:"",animated:"","done-color":"green-6","active-color":"amber-9","header-class":1===t.stepsEnum.length?"hidden":"",contracted:""},model:{value:t.currentStep,callback:function(e){t.currentStep=e},expression:"currentStep"}},[e("q-step",{attrs:{name:"tokens",title:"Tokens",icon:"mdi-fingerprint",done:"replace"===t.currentStep||"link"===t.currentStep}},[e("div",{staticClass:"text-grey-8"},[t._v("Tokens")]),e("q-list",{staticClass:"q-mb-md",attrs:{separator:"",bordered:""}},t._l(t.currentConfig.tokens,(function(i,s){return e("q-item",{key:i.credentions.username,attrs:{active:i.label===t.shareBoardModel.token.label,clickable:"","active-class":`bg-${t.$theme}-2`},on:{click:function(e){t.setToken(i),t.currentSelectedToken=s,t.validateToken(i)}}},[e("q-item-section",[e("q-item-label",{staticClass:"text-grey-9 text-weight-bold"},[t._v(t._s(i.label))]),e("q-item-label",{staticClass:"text-grey-8 ellipsis",staticStyle:{"font-size":".8rem"}},[t._v(t._s(i.credentions.username))])],1),void 0!==i.accessable?e("q-item-section",{attrs:{side:""}},[i.accessable?e("div",[e("span",{staticClass:"text-white bg-green-8 rounded-borders text-weight-bold q-px-sm",staticStyle:{"font-size":".8rem"}},[t._v("valid")]),e("q-tooltip",[t._v("Validation pass")])],1):e("div",[e("span",{staticClass:"text-white bg-red-8 rounded-borders text-weight-bold q-px-xs",staticStyle:{"font-size":".8rem"}},[t._v("invalid")]),e("q-tooltip",[t._v("You can`t share by this token")])],1)]):t._e()],1)})),1),e("div",{staticClass:"col-12 q-mb-md row"},[e("hr",{staticClass:"q-separator q-separator--horizontal col-5",staticStyle:{height:"1px","margin-top":"10px"}}),e("div",{staticClass:"col-2 text-grey-8 text-center text-uppercase"},[t._v("or")]),e("hr",{staticClass:"q-separator q-separator--horizontal col-5",staticStyle:{height:"1px","margin-top":"10px"}})]),e("div",{staticClass:"text-grey-8"},[t._v("Create new token")]),e("q-item",{staticClass:"q-px-none q-pb-none"},[e("q-item-section",[e("q-input",{staticClass:"q-mb-xs",attrs:{label:"Label",color:"grey-9",outlined:"","hide-bottom-space":"",dense:""},model:{value:t.newTokenLabel,callback:function(e){t.newTokenLabel=e},expression:"newTokenLabel"}}),e("q-input",{attrs:{label:"Token",color:"grey-9",outlined:"","hide-bottom-space":"",dense:"",error:!t.newTokenValid||t.newTokenError},on:{input:function(e){t.newTokenError=!1}},model:{value:t.newTokenValue,callback:function(e){t.newTokenValue=e},expression:"newTokenValue"}})],1),e("q-item-section",{attrs:{side:""}},[e("q-btn",{staticClass:"full-height",attrs:{label:"add",loading:t.addingNewToken,flat:"",disable:!t.newTokenValid||t.newTokenError||!t.newTokenValue},on:{click:t.addToken}})],1)],1),t.newTokenError?e("div",{staticClass:"text-red",staticStyle:{"font-size":".7rem"}},[t._v("You need to have a Standard or ACL token for sharing set up in the MQTT Client settings. Please read more "),e("a",{attrs:{href:"https://flespi.com/blog/mqtt-tiles-shareable-and-flexible-iot-dashboards",target:"_blank"}},[t._v("here")]),t._v(".")]):t._e(),t.newTokenValid?t._e():e("div",{staticClass:"text-red",staticStyle:{"font-size":".7rem"}},[t._v("Your token must be unique in list.")])],1),t.currentConfig.hasRemote?e("q-step",{attrs:{name:"replace",title:"Upload",icon:"mdi-file-replace-outline",done:"link"===t.currentStep}},[e("div",{staticClass:"q-mx-sm q-my-md text-grey-8 text-center",staticStyle:{"font-size":"1.2rem"}},[t._v("Such board exists. Continue?")]),e("q-checkbox",{attrs:{color:"grey-9",label:"Rename to save a copy"},model:{value:t.isNeedCopy,callback:function(e){t.isNeedCopy=e},expression:"isNeedCopy"}}),e("q-input",{attrs:{color:"grey-9",outlined:"","hide-bottom-space":"",dense:"",disable:!t.isNeedCopy,label:"Name",error:t.isNeedCopy&&(t.shareBoardModel.boardId===t.currentConfig.boardId||t.currentConfig.currentRemoteBoards&&t.currentConfig.currentRemoteBoards.includes(t.shareBoardModel.boardId)||!t.currentConfig.currentRemoteBoards)},model:{value:t.shareBoardModel.boardId,callback:function(e){t.$set(t.shareBoardModel,"boardId",e)},expression:"shareBoardModel.boardId"}})],1):t._e(),e("q-step",{attrs:{name:"link",title:"Link","active-icon":t.isLinkCopied&&"link"===t.currentStep?"mdi-check":void 0,"active-color":t.isLinkCopied&&"link"===t.currentStep?"green":void 0,icon:"mdi-link",done:t.isLinkCopied&&"link"===t.currentStep}},[t.updatedBoardFlag?[e("q-input",{attrs:{type:"textarea",readonly:"",outlined:"",dense:"","hide-bottom-space":"","input-style":"resize: none;"},model:{value:t.link,callback:function(e){t.link=e},expression:"link"}}),e("div",{staticClass:"text-center q-mt-md"},[e("q-btn",{attrs:{flat:"",icon:"mdi-content-copy",size:"1.2rem"},on:{click:t.copyLink}},[t._v("Copy")])],1)]:!1===t.updatedBoardFlag?[e("div",{staticClass:"rounded-borders bg-red-1 q-pa-md"},[e("div",{staticClass:"text-h6 text-red-8 q-mb-sm"},[e("q-icon",{attrs:{name:"mdi-alert-outline"}}),t._v("\n                Share error\n              ")],1),e("div",{staticClass:"text-grey-8"},[t._v("Link can`t be generated without updating the board in connection. ("),e("span",{staticClass:"text-grey-7"},[t._v(t._s(t.updateBoardError.message))]),t._v(")")])])]:void 0===t.updatedBoardFlag?[e("div",[t._v("\n              Generating...\n            ")])]:t._e()],2)],1)],1),e("q-toolbar",{staticClass:"text-white",class:[`bg-${t.$theme}-9`]},[e("q-btn",{staticClass:"q-mr-sm absolute",attrs:{flat:"",dense:""},on:{click:t.closeHandler}},[t._v("Close")]),e("q-toolbar-title"),t.canBack?e("q-btn",{attrs:{flat:""},on:{click:t.prevStepHandler}},[t._v("Back")]):t._e(),t.updateBoardError?t._e():e("q-btn",{staticClass:"q-ml-sm",attrs:{flat:"",disable:!t.isValidStep},on:{click:t.nextStepHandler}},[t._v(t._s("link"===t.currentStep?"Done":"Next"))])],1)],1)])},Ld=[],Nd={name:"ShareWizard",props:["value","config"],data(){return{stepsConst:{STEP_TOKEN:"tokens",STEP_REPLACE:"replace",STEP_LINK:"link"},currentStep:0,shareBoardModel:{token:"",boardId:this.config.boardId,isRemote:this.config.isRemote},link:"",isNeedCopy:!1,isLinkCopied:!1,currentConfig:F()(this.config),steps:[],updatedBoardFlag:void 0,updateBoardError:void 0,region:null,newTokenLabel:"",newTokenValue:"",addingNewToken:!1,newTokenError:!1}},computed:{status:{get(){return this.value},set(t){this.$emit("input",t)}},isValidStep(){switch(this.currentStep){case"tokens":return this.shareBoardModel.token&&this.shareBoardModel.token.accessable;case"replace":return!this.isNeedCopy||this.isNeedCopy&&this.shareBoardModel.boardId!==this.currentConfig.boardId&&this.currentConfig.currentRemoteBoards&&!this.currentConfig.currentRemoteBoards.includes(this.shareBoardModel.boardId);default:return!0}},stepsEnum(){return Object.values(this.steps)},canBack(){return!!this.stepsEnum.length&&this.currentStep!==this.steps[0].value&&!this.updateBoardError},newTokenValid(){return this.currentConfig.tokens.reduce(((t,e)=>(e.credentions.username===this.newTokenValue&&(t=!1),t)),!0)}},created(){const t={};let e=0;this.getRegionByHost(this.currentConfig.host).then((()=>{t[e]={label:"Token",value:this.stepsConst.STEP_TOKEN},this.currentStep=this.stepsConst.STEP_TOKEN,e++,this.currentConfig.hasRemote?(t[e]={label:"Replace",value:this.stepsConst.STEP_REPLACE},this.currentStep||(this.currentStep=this.stepsConst.STEP_REPLACE),e++):this.setboardId(this.currentConfig.boardId,this.currentConfig.boardId),t[e]={label:"Link",value:this.stepsConst.STEP_LINK},this.currentStep||(this.currentStep=this.stepsConst.STEP_LINK),this.steps=t}))},methods:{getRegionByHost(t){return fetch("https://flespi.io/auth/regions",{mode:"cors"}).then((t=>t.json())).then((e=>{this.region=e.result.reduce(((e,i)=>(0===`wss://${i["mqtt-ws"]}`.indexOf(t)&&(e=i),e)),null)}))},closeHandler(){this.link="",this.shareBoardModel={},this.currentStep=this.stepsConst.STEP_TOKEN,this.steps=[],this.updatedBoardFlag=void 0,this.updateBoardError=void 0,this.$emit("input",!1),this.$emit("hide")},nextStepHandler(){this.validateCurrentStep().then((t=>{t&&this.$refs.stepper.next()}))},prevStepHandler(){this.isLinkCopied&&(this.isLinkCopied=!1),this.$refs.stepper.previous()},validateCurrentStep(){switch(this.currentStep){case"tokens":{const t=this.validateToken(this.shareBoardModel.token);return t&&this.shareBoardModel.boardId&&this.generateLink(),t}case"replace":return this.setboardId(this.shareBoardModel.boardId,this.currentConfig.boardId);case"link":return Promise.resolve(this.closeHandler())}},validateToken(t){const e=0===t.credentions.username.indexOf("FlespiToken ")?t.credentions.username:`FlespiToken ${t.credentions.username}`;return fetch(`${this.region.rest}/auth/info`,{mode:"cors",headers:{Authorization:e}}).then((t=>t.json())).then((e=>{const i=R()(e,"result[0].access.type",1),s=!!e.errors,a=1!==i;return a?(this.setToken(t),this.$set(t,"accessable",!0)):!s&&a||this.$set(t,"accessable",!1),!(s||!a)}))},setToken(t){this.$set(this.shareBoardModel,"token",t)},setboardId(t,e){this.$set(this.shareBoardModel,"boardId",t);let i=Promise.resolve(!0);return this.currentConfig.isRemote?(this.updatedBoardFlag=!0,this.$emit("share",this.shareBoardModel),this.generateLink()):i=this.currentConfig.updateBoardMethod(e,t).then((t=>t instanceof Error?(this.updatedBoardFlag=!1,this.updateBoardError=t,!0):(this.updatedBoardFlag=!0,this.$emit("share",this.shareBoardModel),this.generateLink(),!0))),i},generateLink(){const t=R()(this.shareBoardModel,"token.credentions.username","");if(!t)return;const e=this.currentConfig.syncNamespace,i=this.currentConfig.host,s={token:t,topic:e,boardId:this.shareBoardModel.boardId};0!==i.indexOf("wss://mqtt.flespi.io")&&(s.host=i);const a=`${window.location.origin}${window.location.pathname}#/${P["a"].encode(JSON.stringify(s))}`;this.link=a},copyLink(){Object(zc["a"])(this.link).then((t=>{this.$q.notify({color:"positive",icon:"content_copy",message:"Link copied",timeout:1e3,position:"bottom-left"}),this.isLinkCopied=!0}),(t=>{this.$q.notify({color:"negative",icon:"content_copy",message:"Error coping link",timeout:1e3,position:"bottom-left"})}))},addToken(){const t={credentions:{username:this.newTokenValue},label:this.newTokenLabel};this.addingNewToken=!0,this.validateToken(t).then((e=>{e?(this.currentConfig.tokens.push(t),this.$root.$emit("new-share-token",t),this.newTokenValue="",this.newTokenLabel=""):this.newTokenError=!0,this.addingNewToken=!1}))}}},Dd=Nd,Qd=(i("2d3c"),i("f531")),Hd=i("87fe"),Rd=Object(f["a"])(Dd,Fd,Ld,!1,null,null,null),Pd=Rd.exports;q()(Rd,"components",{QDialog:Et["a"],QToolbar:At["a"],QToolbarTitle:Ft["a"],QStepper:Qd["a"],QStep:Hd["a"],QList:Lt["a"],QItem:dt["a"],QItemSection:ut["a"],QItemLabel:mt["a"],QTooltip:S["a"],QSeparator:mi["a"],QInput:y["a"],QBtn:pt["a"],QCheckbox:Ls["a"],QIcon:x["a"]});var zd={name:"PageIndex",meta(){return{title:this.title}},data(){return{title:"",initBoards:this.$integrationMode?void 0:this.$q.localStorage.getItem(vt["b"]),shareWizardOpened:!1,shareWizardConfig:void 0}},methods:{updateBoards(t){const e=t?Object.keys(t):[],i=this.initBoards?Object.keys(this.initBoards):[],s=o()(i,e),a=o()(e,i);s.length&&this.$emit("delete:boards",s),a.length&&this.$emit("add:boards",a),this.$integrationMode?this.$integrationBus.send("saveBoards",t):(this.$q.localStorage.set(vt["b"],t),this.initBoards=t)},sharePrepareHandler(t){this.shareWizardConfig=t,this.shareWizardOpened=!0},shareBoard(t){},changeAttachedBoards(t){this.$emit("change:attach",t)}},props:["client"],components:{Dash:Ad,ShareWizard:Pd}},jd=zd,Wd=i("9989"),Ud=Object(f["a"])(jd,s,a,!1,null,null,null);e["default"]=Ud.exports;q()(Ud,"components",{QPage:Wd["a"]})},"8b76":function(t,e,i){},"8be3":function(t,e,i){},"8ce2":function(t,e,i){},9224:function(t){t.exports=JSON.parse('{"a":"1.16.6"}')},9505:function(t,e,i){},9620:function(t,e,i){},"994d":function(t,e,i){},a11b:function(t,e,i){"use strict";i.d(e,"a",(function(){return s})),i.d(e,"b",(function(){return a}));const s=()=>({clientName:"New client",clientId:`mqtt-tiles-${Math.random().toString(16).substr(2,8)}`,host:"wss://mqtt.flespi.io",keepalive:60,protocolVersion:5,clean:!0,username:"FlespiToken XXXXXXXXXXXXXXXXXXX",password:"",properties:{sessionExpiryInterval:void 0},subscribeWithTokenCid:!0,syncNamespace:"xflespifront/mqtttiles/boards"}),a=(t={})=>({topicTemplate:"",topicFilter:"",payloadType:0,payloadField:"",payloadNameField:"",default:"",...t})},a1a7:function(t,e,i){},a2d8:function(t,e,i){"use strict";i("d505")},a699:function(t,e,i){"use strict";i("0fea")},a765:function(t,e,i){"use strict";i("5412")},a9ea:function(t,e,i){},ad26:function(t,e,i){"use strict";i("c82c")},aeac:function(t,e,i){"use strict";i("beee")},bd96:function(t,e,i){},beee:function(t,e,i){},c2e3:function(t,e,i){},c54e:function(t,e,i){"use strict";i("9505")},c82c:function(t,e,i){},d505:function(t,e,i){},d886:function(t,e,i){},db97:function(t){t.exports=JSON.parse('{"devices":{"selectors":[{"name":"devices","getter":{"name":"getDevices","params":[]},"value":{"label":"all","value":"+"}}],"children":{"state":{"topic":{"topicPattern":"flespi/state/gw/devices/${devices}/${fields}","payloadType":"string"},"selectors":[{"name":"fields","list":[{"label":"ID","value":"id"},{"label":"Name","value":"name"},{"label":"Device type ID","value":"device_type_id"},{"label":"Configuration","value":"configuration"},{"label":"Settings","value":"settings"},{"label":"Messages size","value":"messages_size"},{"label":"Messages TTL","value":"messages_ttl"},{"label":"Messages rotate","value":"messages_rotate"},{"label":"Blocked status","value":"blocked"},{"label":"Connected status","value":"connected"},{"label":"CID","value":"cid"}],"value":{"label":"all","value":"+"}}]},"messages":{"topic":{"topicPattern":"flespi/message/gw/devices/${devices}","payloadType":"JSON"}},"intervals":{"topic":{"topicPattern":"flespi/interval/gw/calcs/${calcs}/devices/${devices}/${events}","payloadType":"JSON"},"selectors":[{"name":"calcs","getter":{"name":"getCalcs","params":["devices"]},"value":{"label":"all","value":"+"}},{"name":"events","list":[{"label":"Created","value":"created"},{"label":"Updated","value":"updated"},{"label":"Deleted","value":"deleted"}],"value":{"label":"all","value":"+"}}]},"logs":{"topic":{"topicPattern":"flespi/log/gw/devices/${devices}/${event type}","payloadType":"JSON"},"selectors":[{"name":"event type","list":[{"label":"Created","value":"created"},{"label":"Updated","value":"updated"},{"label":"Deleted","value":"deleted"},{"label":"Blocked","value":"blocked"},{"label":"Unblocked","value":"unblocked"},{"label":"Connected","value":"connected"},{"label":"Disconnected","value":"disconnected"}],"value":{"label":"all","value":"+"}}]},"telemetry":{"topic":{"topicPattern":"flespi/state/gw/devices/${devices}/telemetry/${parameters}","payloadType":"string"},"selectors":[{"name":"parameters","getter":{"name":"getDevicesTelemetry","params":["devices"]},"value":{"label":"all","value":"+"}}]},"settings":{"topic":{"topicPattern":"flespi/state/gw/devices/${devices}/settings/${name}","payloadType":"JSON"},"selectors":[{"name":"name","getter":{"name":"getDevicesSettings","params":["devices"]},"value":{"label":"all","value":"+"}}]}}},"analytics":{"selectors":[{"name":"calcs","getter":{"name":"getCalcs","params":["devices"]},"value":{"label":"all","value":"+"}},{"name":"devices","getter":{"name":"getDevices","params":["calcs"]},"value":{"label":"all","value":"+"}}],"children":{"state":{"topic":{"topicPattern":"flespi/state/gw/calcs/${calcs}/devices/${devices}/${statuses}","payloadType":"JSON"},"selectors":[{"name":"statuses","list":[{"label":"Synchronization state","value":"synced"},{"label":"Last detected interval","value":"last"},{"label":"Currently active interval","value":"active"}],"value":{"label":"all","value":"+"}}]},"intervals":{"topic":{"topicPattern":"flespi/interval/gw/calcs/${calcs}/devices/${devices}/${events}","payloadType":"JSON"},"selectors":[{"name":"events","list":[{"label":"Created","value":"created"},{"label":"Updated","value":"updated"},{"label":"Deleted","value":"deleted"}],"value":{"label":"all","value":"+"}}]}}}}')},dc2a:function(t,e,i){"use strict";i("67e1")},dcc6:function(t,e,i){"use strict";i("3264")},dd34:function(t,e,i){"use strict";i("a9ea")},dd8b:function(t,e,i){},de08:function(t,e,i){"use strict";i("bd96")},e2f8:function(t,e,i){"use strict";i("11e5")},e56a:function(t,e,i){},e612:function(t,e,i){},e7e0:function(t,e,i){"use strict";i("2484")},ea98:function(t,e,i){},eb38:function(t,e,i){},edaf7:function(t,e,i){},f608c:function(t,e,i){"use strict";i("1a79")},fb4f:function(t,e,i){"use strict";i("fd00")},fbed:function(t,e,i){"use strict";i("9620")},fcee:function(t,e,i){},fd00:function(t,e,i){},feef:function(t,e,i){"use strict";i("00b3")}}]);