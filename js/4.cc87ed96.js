(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[4],{"5a50":function(t,e,n){"use strict";n.d(e,"b",(function(){return s})),n.d(e,"k",(function(){return a})),n.d(e,"l",(function(){return o})),n.d(e,"c",(function(){return i})),n.d(e,"a",(function(){return r})),n.d(e,"h",(function(){return c})),n.d(e,"g",(function(){return l})),n.d(e,"i",(function(){return u})),n.d(e,"j",(function(){return d})),n.d(e,"d",(function(){return p})),n.d(e,"f",(function(){return h})),n.d(e,"e",(function(){return m})),n.d(e,"s",(function(){return f})),n.d(e,"o",(function(){return g})),n.d(e,"m",(function(){return v})),n.d(e,"r",(function(){return b})),n.d(e,"q",(function(){return y})),n.d(e,"p",(function(){return S})),n.d(e,"n",(function(){return q}));var s="mqtt-tiles-boards",i="mqtt-tiles-clients",r="mqtt-tiles-active-client",a=0,o=1,c=0,l=1,u=0,d=1,p=0,h=1,m=2,f=0,g=1,v=2,b=3,y=4,S=5,q=6},9224:function(t){t.exports=JSON.parse('{"a":"1.11.1"}')},f241:function(t,e,n){"use strict";n.r(e);var s=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("q-layout",{attrs:{view:"hHh Lpr lFf"}},[n("client-settings",{attrs:{settings:t.currentSettings},on:{save:t.saveSettingsHandler,hide:t.hideSettingsHandler},model:{value:t.clientSettingsOpened,callback:function(e){t.clientSettingsOpened=e},expression:"clientSettingsOpened"}}),t.fullViewMode?n("q-header",[n("q-toolbar",{staticClass:"bg-grey-9"},[t.fullViewMode&&!t.$integrationMode?n("q-btn",{attrs:{flat:"",rounded:"",icon:"mdi-menu"},on:{click:function(e){t.leftDrawerOpen=!t.leftDrawerOpen}}}):t._e(),n("q-toolbar-title",{staticStyle:{"line-height":"36px"}},[n("img",{staticStyle:{height:"30px","vertical-align":"text-bottom"},attrs:{src:"statics/mqtttiles-logo.png",alt:"MQTT Tiles"}}),t._v("\n        MQTT Tiles\n        "),n("sup",{staticStyle:{position:"relative","font-size":".9rem","padding-left":"4px"}},[t._v(t._s(t.version))])])],1)],1):t._e(),t.fullViewMode&&!t.$integrationMode?n("q-drawer",{attrs:{side:"left"},model:{value:t.leftDrawerOpen,callback:function(e){t.leftDrawerOpen=e},expression:"leftDrawerOpen"}},[n("div",{staticClass:"connections__subheader q-px-md bg-grey-9",staticStyle:{position:"relative",height:"70px"}},[n("span",{staticClass:"text-white",staticStyle:{"font-size":"1.4rem","line-height":"70px"}},[t._v("My connections")]),n("q-btn",{staticClass:"text-grey-9",staticStyle:{position:"absolute",bottom:"-20px",right:"16px","z-index":"1"},attrs:{"fab-mini":"",icon:"mdi-plus",color:"white"},on:{click:t.openSettings}})],1),t.clientsIds.length?n("q-list",{staticClass:"scroll",staticStyle:{position:"absolute",top:"70px",bottom:"0",right:"0",left:"0"}},[n("q-item-label",{staticClass:"q-py-md q-pl-md text-grey-9"},[n("span",[t._v("Connections")])]),t._l(t.clients,(function(e,s){var i;return n("q-item",{key:s,class:{active:s===t.activeClientId},attrs:{clickable:""},on:{click:function(e){return t.setActiveClient(s)}}},[n("q-item-section",{attrs:{avatar:""}},[t.connected&&s===t.activeClientId?n("q-btn",{attrs:{icon:"mdi-lan-connect",dense:"",flat:""},on:{click:function(e){return e.stopPropagation(),t.setActiveClient()}}},[n("q-tooltip",[t._v("Disconnect")])],1):n("q-icon",{staticClass:"q-ma-xs",attrs:{name:"mdi-lan-disconnect",size:"1.5rem"}},[s===t.activeClientId?n("q-tooltip",[t._v("Active")]):t._e()],1)],1),n("q-item-section",[n("q-item-label",{class:(i={},i["text-"+(t.connected?"green":"red")+"-6"]=s===t.activeClientId,i)},[n("div",{staticStyle:{"max-width":"calc(100% - 25px)",display:"inline-flex"}},[n("div",{staticClass:"ellipsis"},[t._v(t._s(e.clientName))])]),n("div",{staticStyle:{display:"inline-flex"}},[e.attachedBoards&&e.attachedBoards.length?n("q-icon",{staticClass:"q-ml-xs",attrs:{name:"mdi-link-variant",flat:"",dense:"",size:"15px",color:"yellow-9"}},[n("q-tooltip",[t._v("\n                  "+t._s("Attached boards: "+e.attachedBoards.join(", "))+"\n                ")])],1):t._e()],1)]),n("q-item-label",{staticClass:"ellipsis",attrs:{caption:""}},[t._v(t._s(e.host))])],1),n("q-item-section",{staticStyle:{"padding-left":"4px!important"},attrs:{side:""}},[n("q-btn",{attrs:{round:"",flat:"",dense:"",icon:"mdi-dots-vertical"},on:{click:function(t){t.stopPropagation()}}},[n("q-menu",{attrs:{anchor:"bottom right",self:"top right"}},[n("q-list",[n("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:""},on:{click:function(e){return t.editClientSettings(s)}}},[n("q-item-section",{attrs:{avatar:""}},[n("q-icon",{attrs:{name:"mdi-settings"}})],1),n("q-item-section",[t._v("Edit")])],1),n("q-separator"),n("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:""},on:{click:function(e){return t.removeClient(s)}}},[n("q-item-section",{attrs:{avatar:""}},[n("q-icon",{attrs:{name:"mdi-delete-outline",color:"red"}})],1),n("q-item-section",[t._v("Remove")])],1)],1)],1)],1)],1)],1)}))],2):n("div",{staticClass:"q-px-md q-pt-lg text-center"},[n("div",{staticClass:"text-bold"},[t._v("No connections")]),n("div",{staticStyle:{"font-size":".8rem"}},[t._v("Create a connection to visualize its data on boards")])])],1):t._e(),n("q-page-container",[n("router-view",{attrs:{client:t.clients[t.activeClientId]},on:{"change:status":t.changeStatus,share:t.shareHandler,"change:attach":t.changeAttachedBoards,"delete:boards":t.deleteBoardsHandler,"add:boards":t.addBoardsHandler}})],1)],1)},i=[],r=(n("6b54"),n("a481"),n("6762"),n("2fdb"),n("4db1")),a=n.n(r),o=(n("28a5"),n("ac6a"),n("cadf"),n("06db"),n("456d"),function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("q-dialog",{attrs:{maximized:t.$q.platform.is.mobile},on:{hide:t.closeHandler},model:{value:t.status,callback:function(e){t.status=e},expression:"status"}},[n("div",{style:{width:t.$q.platform.is.mobile?"100%":"50vw"}},[n("q-toolbar",{staticClass:"bg-grey-9 text-white"},[n("q-toolbar-title",[t._v("\n        MQTT client\n      ")])],1),n("div",{staticClass:"q-pa-md scroll bg-white",style:{height:t.$q.platform.is.mobile?"calc(100% - 100px)":"50vh"}},[n("q-input",{attrs:{color:"grey-9 q-mb-sm",outlined:"","hide-bottom-space":"",dense:"",label:"MQTT client name",error:!t.currentSettings.clientName},model:{value:t.currentSettings.clientName,callback:function(e){t.$set(t.currentSettings,"clientName",e)},expression:"currentSettings.clientName"}}),n("q-input",{attrs:{color:"grey-9 q-mb-sm",outlined:"","hide-bottom-space":"",dense:"",label:"Client ID",error:!t.currentSettings.clientId},model:{value:t.currentSettings.clientId,callback:function(e){t.$set(t.currentSettings,"clientId",e)},expression:"currentSettings.clientId"}},[n("q-btn",{attrs:{slot:"append",flat:"",dense:"",icon:"mdi-refresh"},on:{click:function(e){t.currentSettings.clientId="mqtt-tiles-"+Math.random().toString(16).substr(2,8)}},slot:"append"})],1),n("q-input",{attrs:{color:"grey-9 q-mb-sm",outlined:"","hide-bottom-space":"",dense:"",label:"Host",error:!t.currentSettings.host||0===t.currentSettings.host.indexOf("ws:")},model:{value:t.currentSettings.host,callback:function(e){t.$set(t.currentSettings,"host",e)},expression:"currentSettings.host"}},[t.currentSettings.host&&0!==t.currentSettings.host.indexOf("ws:")?t._e():n("q-btn",{attrs:{slot:"append",flat:"",dense:"",icon:"mdi-alert-outline"},on:{click:t.hostErrorHandler},slot:"append"})],1),n("q-input",{attrs:{color:"grey-9 q-mb-sm",outlined:"","hide-bottom-space":"",dense:"",type:"number",label:"Keep alive"},model:{value:t.currentSettings.keepalive,callback:function(e){t.$set(t.currentSettings,"keepalive",t._n(e))},expression:"currentSettings.keepalive"}}),n("q-select",{attrs:{color:"grey-9 q-mb-sm",outlined:"",dense:"","hide-bottom-space":"","emit-value":"","map-options":"",options:[{label:"3.1.1",value:4},{label:"5.0",value:5}],label:"Version of MQTT"},model:{value:t.currentSettings.protocolVersion,callback:function(e){t.$set(t.currentSettings,"protocolVersion",e)},expression:"currentSettings.protocolVersion"}}),n("q-checkbox",{staticClass:"q-mr-sm",staticStyle:{height:"56px"},attrs:{color:"grey-9",label:5===t.currentSettings.protocolVersion?"Clean start":"Clean session"},model:{value:t.currentSettings.clean,callback:function(e){t.$set(t.currentSettings,"clean",e)},expression:"currentSettings.clean"}}),5===t.currentSettings.protocolVersion?n("q-input",{attrs:{outlined:"","hide-bottom-space":"",dense:"",color:"grey-9 q-mb-sm",type:"number",label:"Session expiry interval",clearable:""},model:{value:t.currentSettings.properties.sessionExpiryInterval,callback:function(e){t.$set(t.currentSettings.properties,"sessionExpiryInterval",t._n(e))},expression:"currentSettings.properties.sessionExpiryInterval"}}):t._e(),n("q-input",{attrs:{outlined:"","hide-bottom-space":"",dense:"",color:"grey-9 q-mb-sm",label:"Username"},model:{value:t.currentSettings.username,callback:function(e){t.$set(t.currentSettings,"username",e)},expression:"currentSettings.username"}},[-1!==t.currentSettings.host.indexOf("flespi")?n("q-btn",{attrs:{slot:"append",flat:"",dense:"",icon:"mdi-login"},on:{click:t.flespiLoginHandler},slot:"append"}):t._e()],1),n("q-input",{attrs:{color:"grey-9 q-mb-sm",outlined:"","hide-bottom-space":"",dense:"",label:"Password"},model:{value:t.currentSettings.password,callback:function(e){t.$set(t.currentSettings,"password",e)},expression:"currentSettings.password"}}),5===t.currentSettings.protocolVersion?n("q-expansion-item",{staticClass:"q-mt-md q-mb-sm bg-grey-4",attrs:{label:"Subscribe User Properties"}},[n("div",[t.currentSettings.userProperties?n("q-list",t._l(t.currentSettings.userProperties,(function(e,s){return n("q-item",{key:s+": "+e},[n("q-icon",{staticClass:"q-mr-sm cursor-pointer",attrs:{size:"1rem",name:"mdi-close-circle"},nativeOn:{click:function(e){return t.removeUserProperty(s)}}}),n("span",[t._v(t._s(s+": "+e))])],1)})),1):t._e(),n("q-input",{attrs:{color:"grey-9 q-ma-sm",outlined:"",dense:"","hide-bottom-space":"",label:"User property name"},model:{value:t.userProperty.name,callback:function(e){t.$set(t.userProperty,"name",e)},expression:"userProperty.name"}}),n("q-input",{attrs:{color:"grey-9 q-mx-sm q-mb-sm",outlined:"",dense:"","hide-bottom-space":"",label:"User property value"},model:{value:t.userProperty.value,callback:function(e){t.$set(t.userProperty,"value",e)},expression:"userProperty.value"}}),n("q-btn",{staticClass:"q-mt-sm",staticStyle:{width:"100%"},attrs:{disable:!t.userProperty.name||!t.userProperty.value,color:"grey-9"},on:{click:t.addUserProperty}},[t._v("Add")])],1)]):t._e(),5===t.currentSettings.protocolVersion&&-1!==t.currentSettings.host.indexOf("flespi.io")?n("div",{staticClass:"share-tokens__items-wrapper col-12 relative-position q-mt-lg q-mb-md"},[n("q-list",{attrs:{bordered:""}},[n("q-btn",{staticClass:"col-12",staticStyle:{top:"-20px",right:"8px",position:"absolute","z-index":"1130"},attrs:{color:"grey-9","fab-mini":"",icon:"mdi-plus"},on:{click:t.addSyncCredsItem}}),n("q-item-label",{staticClass:"q-py-md q-px-sm"},[n("div",{class:{"text-red-6":!t.currentSettings.syncCreds||!t.currentSettings.syncCreds.length}},[t._v("Tokens for sharing"+t._s(t.currentSettings.syncCreds&&t.currentSettings.syncCreds.length?"":" are empty"))]),n("div",{staticClass:"text-grey-6 q-mt-xs",staticStyle:{"font-size":".8rem"}},[t._v("List of standard or ACL flespi tokens to be used for sharing boards.")])]),t._l(t.currentSettings.syncCreds,(function(e,s){return n("q-expansion-item",{key:""+s,attrs:{group:"singleselect-items","header-class":["bg-"+(t.checkUniqueSyncCredsValue(e,s)?"grey-4":"red-2")],"expand-icon":"mdi-settings","default-opened":0===s}},[n("template",{slot:"header"},[n("q-item-section",{attrs:{avatar:""}},[n("div",[n("q-btn",{staticClass:"col-1",attrs:{disabled:0===s,round:"",dense:"",flat:"",icon:"mdi-arrow-up"},on:{click:function(e){return e.stopPropagation(),t.upItem(s)}}}),n("q-btn",{staticClass:"col-1",attrs:{disabled:s===t.currentSettings.syncCreds.length-1,round:"",dense:"",flat:"",icon:"mdi-arrow-down"},on:{click:function(e){return e.stopPropagation(),t.downItem(s)}}})],1)]),n("q-item-section",[n("q-item-label",{staticClass:"ellipsis"},[t._v(t._s(e.label?e.label:"New token"))]),n("q-item-label",{staticClass:"text-grey-8 ellipsis",staticStyle:{"font-size":".8rem"}},[t._v(t._s(e.credentions.username||"*Empty*"))])],1),n("q-item-section",{attrs:{side:""}},[n("q-btn",{attrs:{flat:"",color:"red-6",round:"",dense:"",icon:"mdi-delete"},on:{click:function(e){return e.stopPropagation(),t.removeSyncCredsItem(s)}}})],1)],1),n("div",{staticClass:"row"},[n("div",{staticClass:"col-12 q-my-sm q-px-sm"},[n("q-input",{attrs:{autofocus:"",outlined:"",dense:"","hide-bottom-space":"",color:"grey-9",label:"Label"},model:{value:e.label,callback:function(n){t.$set(e,"label",n)},expression:"syncCreds.label"}})],1),n("div",{staticClass:"col-12 q-mb-sm q-px-sm"},[n("q-input",{attrs:{outlined:"","hide-bottom-space":"",dense:"",color:"grey-9",label:"Token",error:!t.checkUniqueSyncCredsValue(e,s)},model:{value:e.credentions.username,callback:function(n){t.$set(e.credentions,"username",n)},expression:"syncCreds.credentions.username"}})],1)])],2)}))],2)],1):t._e()],1),n("q-toolbar",{staticClass:"bg-grey-9 text-white"},[n("q-toolbar-title"),n("q-btn",{staticClass:"q-mr-sm",attrs:{flat:"",dense:""},on:{click:t.closeHandler}},[t._v("Close")]),n("q-btn",{attrs:{flat:"",dense:"",disable:!t.validateCurrentSettings},on:{click:t.saveSettingsHandler}},[t._v(t._s(t.settings?"Update":"Save"))])],1)],1)])}),c=[],l=(n("7f7f"),n("42454")),u=n.n(l),d=function(){return{clientName:"New client",clientId:"mqtt-tiles-".concat(Math.random().toString(16).substr(2,8)),host:"wss://mqtt.flespi.io",keepalive:60,protocolVersion:5,clean:!0,username:"FlespiToken XXXXXXXXXXXXXXXXXXX",password:"",properties:{sessionExpiryInterval:void 0},syncNamespace:"xflespifront/mqtttiles/boards"}},p=n("0644"),h=n.n(p),m={name:"ClientSettings",props:["value","settings"],data:function(){var t=d();return{defaultSettings:t,currentSettings:this.settings?u()({},t,this.settings):u()({},t),userProperty:{name:"",value:""},syncCreds:{label:"",credentions:{username:""}}}},computed:{validateCurrentSettings:function(){return!!this.currentSettings.clientId&&!!this.currentSettings.host&&!(0===this.currentSettings.host.indexOf("ws:"))&&(!this.currentSettings.syncCreds||!this.currentSettings.syncCreds.length||!!this.currentSettings.syncCreds&&!!this.currentSettings.syncCreds.length&&this.currentSettings.syncCreds.reduce((function(t,e,n,s){var i=e.credentions.username;return t[i]||(t[i]=0),t[i]++,n===s.length-1?Object.keys(t).reduce((function(e,n){return e?1===t[n]:e}),!0):t}),{}))},status:function(){return this.value}},methods:{saveSettingsHandler:function(){var t=this;this.$emit("save",this.currentSettings),this.closeHandler(),this.$nextTick((function(){t.defaultSettings.clientId="mqtt-tiles-".concat(Math.random().toString(16).substr(2,8)),t.currentSettings=u()({},t.defaultSettings)}))},closeHandler:function(){this.$emit("input",!1),this.$emit("hide")},hostErrorHandler:function(){this.$q.notify({color:"warning",message:"Host must be not empty and only over secured sockets"})},addUserProperty:function(){this.currentSettings.userProperties||this.$set(this.currentSettings,"userProperties",{}),this.$set(this.currentSettings.userProperties,this.userProperty.name,this.userProperty.value),this.userProperty={value:"",name:""}},removeUserProperty:function(t){this.$delete(this.currentSettings.userProperties,t),Object.keys(this.currentSettings.userProperties).length||this.$set(this.currentSettings,"userProperties",null)},flespiLoginHandler:function(){var t=this,e=function e(n){if("string"===typeof n.data&&~n.data.indexOf("FlespiLogin|token:")){var s=n.data;s=s.replace("FlespiLogin|token:",""),s=JSON.parse(s),t.currentSettings.username=s.token,t.currentSettings.host="wss://".concat(s.region["mqtt-ws"]),window.removeEventListener("message",e)}};window.addEventListener("message",e),this.openWindow("https://flespi.io/login/#/providers")},openWindow:function(t,e){e=e||"auth";var n=500,s=600,i=void 0!==window.screenLeft?window.screenLeft:screen.left,r=void 0!==window.screenTop?window.screenTop:screen.top,a=window.innerWidth?window.innerWidth:document.documentElement.clientWidth?document.documentElement.clientWidth:screen.width,o=window.innerHeight?window.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:screen.height,c=a/2-n/2+i,l=o/2-s/2+r,u=window.open(t,e,"toolbar=no,location=no,status=yes,resizable=yes,scrollbars=yes, width="+n+", height="+s+", top="+l+", left="+c);window.focus&&u.focus()},addSyncCredsItem:function(){this.currentSettings.syncCreds||this.$set(this.currentSettings,"syncCreds",[]),this.currentSettings.syncCreds.unshift(h()(this.syncCreds))},removeSyncCredsItem:function(t){this.$delete(this.currentSettings.syncCreds,t)},upSyncCredsItem:function(t){var e=this.currentSettings.syncCreds.splice(t,1)[0];this.currentSettings.syncCreds.splice(t-1,0,e)},downSyncCredsItem:function(t){var e=this.currentSettings.syncCreds.splice(t,1)[0];this.currentSettings.syncCreds.splice(t+1,0,e)},checkUniqueSyncCredsValue:function(t,e){var n=!0;return this.currentSettings.syncCreds.map((function(t){return t.credentions.username})).some((function(s,i){var r=s===t.credentions.username;return r&&(n=i===e),r})),n}},watch:{settings:function(t){this.currentSettings=u()({},this.defaultSettings,t)}}},f=m,g=n("2877"),v=Object(g["a"])(f,o,c,!1,null,null,null),b=v.exports,y=n("18d6"),S=n("b047c"),q=n.n(S),w=n("2b0e"),C=n("27ae"),k=n("5a50"),x=n("9224"),_=(n("8e6e"),n("8a81"),n("55dd"),n("c47a")),$=n.n(_),I=n("967e"),O=n.n(I),P=(n("96cf"),n("fc74")),j=n.n(P),B=n("59a1"),M=n.n(B),H=n("70e1"),T=n.n(H),D=n("9b02"),E=n.n(D);function X(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,s)}return n}function A(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?X(Object(n),!0).forEach((function(e){$()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):X(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var N=function(){function t(e){j()(this,t),this.bus=new T.a(e)}return M()(t,[{key:"getDevices",value:function(t){var e,n,s,i,r,a,o;return O.a.async((function(c){while(1)switch(c.prev=c.next){case 0:if(e="all",!t||"all"===t){c.next=15;break}return n=t.join(","),c.prev=3,c.next=6,O.a.awrap(this.bus.gw.getCalcsDevices(n,"all",{fileds:"device_id"}));case 6:s=c.sent,i=E()(s,"data.result",[]),r=i.reduce((function(t,e){return t[e.device_id]=!0,t}),{}),e=Object.keys(r).join(","),c.next=15;break;case 12:return c.prev=12,c.t0=c["catch"](3),c.abrupt("return",[]);case 15:return c.next=17,O.a.awrap(this.bus.gw.getDevices(e,{fields:"id,name"}));case 17:return a=c.sent,o=E()(a,"data.result",[]),o=o.map((function(t){return{label:t.name,value:"".concat(t.id)}})),c.abrupt("return",o);case 21:case"end":return c.stop()}}),null,this,[[3,12]])}},{key:"getChannels",value:function(){var t,e;return O.a.async((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,O.a.awrap(this.bus.gw.getChannels("all",{fileds:"id,name"}));case 2:return t=n.sent,e=E()(t,"data.result",[]),e=e.map((function(t){return{label:t.name,value:"".concat(t.id)}})),n.abrupt("return",e);case 6:case"end":return n.stop()}}),null,this)}},{key:"getCalcs",value:function(t){var e,n,s,i,r,a,o;return O.a.async((function(c){while(1)switch(c.prev=c.next){case 0:if(e="all",!t||"all"===t){c.next=15;break}return c.prev=2,n=t.join(","),c.next=6,O.a.awrap(this.bus.gw.getCalcsDevices("all",n,{fields:"calc_id"}));case 6:s=c.sent,i=E()(s,"data.result",[]),r=i.reduce((function(t,e){return t[e.calc_id]=!0,t}),{}),e=Object.keys(r).join(","),c.next=15;break;case 12:return c.prev=12,c.t0=c["catch"](2),c.abrupt("return",[]);case 15:return c.next=17,O.a.awrap(this.bus.gw.getCalcs(e,{fileds:"id,name"}));case 17:return a=c.sent,o=E()(a,"data.result",[]),o=o.map((function(t){return{label:t.name,value:"".concat(t.id)}})),c.abrupt("return",o);case 21:case"end":return c.stop()}}),null,this,[[2,12]])}},{key:"getDevicesTelemetry",value:function(t){var e,n;return O.a.async((function(s){while(1)switch(s.prev=s.next){case 0:return s.next=2,O.a.awrap(this.bus.gw.getDevicesTelemetry(t));case 2:return e=s.sent,n=E()(e,"data.result",[]),n=n.reduce((function(t,e){var n=e.telemetry;return n&&(t=A({},t,{},n)),t}),{}),n=Object.keys(n).sort().map((function(t){return{label:t,value:t}})),s.abrupt("return",n);case 7:case"end":return s.stop()}}),null,this)}},{key:"getDevicesSettings",value:function(t){var e,n;return O.a.async((function(s){while(1)switch(s.prev=s.next){case 0:return s.next=2,O.a.awrap(this.bus.gw.getDevicesSettings(t,"all",{fields:"name,schema"}));case 2:return e=s.sent,n=E()(e,"data.result",[]),n=n.reduce((function(t,e){var n=e.name,s=e.schema.title;return t[n]||(t[n]={}),t[n][s]=!0,t}),{}),n=Object.keys(n).map((function(t){return{label:Object.keys(n[t]).join(", "),value:t}})),s.abrupt("return",n);case 7:case"end":return s.stop()}}),null,this)}},{key:"settings",get:function(){return this.bus.settings},set:function(t){this.bus.settings=t}},{key:"token",get:function(){return this.bus.token},set:function(t){this.bus.token=t}}]),t}(),V=N,L=q()((function(t){y["a"].set(k["c"],t)}),500,{trailing:!0}),z={name:"MyLayout",data:function(){return{leftDrawerOpen:this.$q.platform.is.desktop,clientSettingsOpened:!1,currentSettings:void 0,clients:{},activeClientId:void 0,editedClientId:void 0,connected:!1,version:x["a"],fullViewMode:!0}},computed:{clientsIds:function(){return Object.keys(this.clients)}},methods:{openSettings:function(){this.clientSettingsOpened=!0},hideSettingsHandler:function(){this.currentSettings=void 0,this.editedClientId=void 0},saveSettingsHandler:function(t){var e=this.editedClientId?this.editedClientId:this.clientsIds.length?parseInt(this.clientsIds[this.clientsIds.length-1])+1:0;w["default"].set(this.clients,e,t),this.setActiveClient(e)},editClientSettings:function(t){this.currentSettings=this.clients[t],this.editedClientId=t,this.openSettings()},removeClient:function(t){var e=this;this.$q.dialog({title:"Delete client?",message:"Do you really want to delete «".concat(this.clients[t].clientName,"» client?"),color:"grey-9",ok:!0,cancel:!0}).onOk((function(){e.activeClientId===t&&(e.activeClientId=void 0),w["default"].delete(e.clients,t)}))},setActiveClient:function(t){this.activeClientId=t,y["a"].set(k["a"],t),t&&(this.setFlespiMode(t),this.makeFlespiRestBus(t))},changeStatus:function(t){this.connected=t},shareHandler:function(t){},clearAttachMode:function(t){this.$q.notify({message:"No boards attached to the connection. Showing all available boards.",timeout:3e3,color:"info",icon:"mdi-link-variant",position:"bottom-left"}),this.$delete(t,"attachedBoards")},setFlespiMode:function(t){var e=this.clients[t];e.host.indexOf("flespi")>-1?w["default"].prototype.$flespiMode=!0:w["default"].prototype.$flespiMode=!1},makeFlespiRestBus:function(t){var e=this.clients[t],n=new V;n.bus.auth.getRegions().then((function(t){t=E()(t,"data.result",[]);var s=t.reduce((function(t,n){var s=n["mqtt-ws"].split(":")[0];return-1!==e.host.indexOf(s)?n:t}));s?(n.settings={server:s.rest},n.token=e.username,w["default"].prototype.$flespiRestBus=n):w["default"].prototype.$flespiRestBus=null}))},changeAttachedBoards:function(t){t.length?this.$set(this.clients[this.activeClientId],"attachedBoards",a()(t)):this.clients[this.activeClientId].attachedBoards&&this.clearAttachMode(this.clients[this.activeClientId])},deleteBoardsHandler:function(t){var e=this;Object.keys(this.clients).forEach((function(n){e.clients[n].attachedBoards&&(e.clients[n].attachedBoards.forEach((function(s,i){t.includes(s)&&e.$delete(e.clients[n].attachedBoards,i)})),e.clients[n].attachedBoards.length||e.clearAttachMode(e.clients[n]))}))},addBoardsHandler:function(t){var e=this;if(!this.activeClientId)return!1;var n=this.clients[this.activeClientId],s=!!n.attachedBoards;s&&this.$q.notify({message:"Attach new board to the connection?",timeout:0,color:"info",icon:"mdi-link-variant",position:"bottom-left",closeBtn:"Close",classes:"text-white",actions:[{label:"Attach",handler:function(){e.$set(e.clients[e.activeClientId],"attachedBoards",[].concat(a()(e.clients[e.activeClientId].attachedBoards),a()(t)))}}]})}},mounted:function(){this.$integrationBus.send("ready")},created:function(){var t=this,e=this.$q.sessionStorage.getItem("mqtt-tiles-share");if(w["default"].prototype.$flespiMode=!1,w["default"].prototype.$integrationMode=!1,this.$route.path.indexOf("integration")>-1)w["default"].prototype.$integrationMode=!0,this.$integrationBus.on("SetFlespiLogin",(function(e){var n=e.token,s=e.region,i=d();i.host="wss://".concat(s["mqtt-ws"]),i.username=n,w["default"].set(t.clients,0,i),t.setActiveClient(0)}));else if(this.$route.params.hash||e){this.fullViewMode=!1;var n,s=d();n=this.$route.params.hash?JSON.parse(C["Base64"].decode(this.$route.params.hash)):e,this.$q.sessionStorage.set("mqtt-tiles-share",n),n.host&&(s.host=n.host),s.username=n.token,s.syncNamespace=n.topic,s.syncToRetain=!0,s.flespiBoard=n.boardId,w["default"].set(this.clients,0,s),this.setActiveClient(0)}else{var i=y["a"].getItem(k["c"]),r=y["a"].getItem(k["a"]);if(i){if(this.clients=i,this.$route.params.flespiToken){var a=this.$route.params.flespiToken.replace("FlespiToken ",""),o=this.clientsIds.filter((function(e){var n=t.clients[e].username.replace("FlespiToken ","");return a===n}));if(o.length)r=o[0];else{var c=d();c.username=a;var l=(parseInt(this.clientsIds[this.clientsIds.slice(-1)])+1).toString();w["default"].set(this.clients,l,c),r=l}this.$router.push("/")}r&&this.clients[r]&&this.$nextTick((function(){t.setActiveClient(r)}))}}},watch:{clients:{deep:!0,handler:function(t){this.fullViewMode&&L(t)}}},components:{clientSettings:b}},U=z,F=Object(g["a"])(U,s,i,!1,null,null,null);e["default"]=F.exports}}]);